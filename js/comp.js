(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){},{}],2:[function(require,module,exports){module.exports=require(1)},{}],3:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;var length;if(type==="number")length=subject>0?subject>>>0:0;else if(type==="string"){if(encoding==="base64")subject=base64clean(subject);length=Buffer.byteLength(subject,encoding)}else if(type==="object"&&subject!==null){if(subject.type==="Buffer"&&isArray(subject.data))subject=subject.data;length=+subject.length>0?Math.floor(+subject.length):0}else throw new Error("First argument needs to be a number, array or string.");var buf;if(TYPED_ARRAY_SUPPORT){buf=Buffer._augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(TYPED_ARRAY_SUPPORT&&typeof subject.byteLength==="number"){buf._set(subject)}else if(isArrayish(subject)){if(Buffer.isBuffer(subject)){for(i=0;i<length;i++)buf[i]=subject.readUInt8(i)}else{for(i=0;i<length;i++)buf[i]=(subject[i]%256+256)%256}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!TYPED_ARRAY_SUPPORT&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.isBuffer=function(b){return!!(b!=null&&b._isBuffer)};Buffer.byteLength=function(str,encoding){var ret;str=str.toString();switch(encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;default:throw new Error("Unknown encoding")}return ret};Buffer.concat=function(list,totalLength){assert(isArray(list),"Usage: Buffer.concat(list[, length])");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(totalLength===undefined){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};Buffer.compare=function(a,b){assert(Buffer.isBuffer(a)&&Buffer.isBuffer(b),"Arguments must be Buffers");var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len&&a[i]===b[i];i++){}if(i!==len){x=a[i];y=b[i]}if(x<y){return-1}if(y<x){return 1}return 0};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;assert(strLen%2===0,"Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);assert(!isNaN(byte),"Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret};Buffer.prototype.toString=function(encoding,start,end){var self=this;encoding=String(encoding||"utf8").toLowerCase();start=Number(start)||0;end=end===undefined?self.length:Number(end);if(end===start)return"";var ret;switch(encoding){case"hex":ret=hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=utf8Slice(self,start,end);break;case"ascii":ret=asciiSlice(self,start,end);break;case"binary":ret=binarySlice(self,start,end);break;case"base64":ret=base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};Buffer.prototype.equals=function(b){assert(Buffer.isBuffer(b),"Argument must be a Buffer");return Buffer.compare(this,b)===0};Buffer.prototype.compare=function(b){assert(Buffer.isBuffer(b),"Argument must be a Buffer");return Buffer.compare(this,b)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;assert(end>=start,"sourceEnd < sourceStart");assert(target_start>=0&&target_start<target.length,"targetStart out of bounds");assert(start>=0&&start<source.length,"sourceStart out of bounds");assert(end>=0&&end<=source.length,"sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;var len=end-start;if(len<100||!TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+target_start]=this[i+start]}}else{target._set(this.subarray(start,start+len),target_start)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;if(TYPED_ARRAY_SUPPORT){return Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to read beyond buffer length")}if(offset>=this.length)return;return this[offset]};function readUInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){val=buf[offset];if(offset+1<len)val|=buf[offset+1]<<8}else{val=buf[offset]<<8;if(offset+1<len)val|=buf[offset+1]}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};function readUInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){if(offset+2<len)val=buf[offset+2]<<16;if(offset+1<len)val|=buf[offset+1]<<8;val|=buf[offset];if(offset+3<len)val=val+(buf[offset+3]<<24>>>0)}else{if(offset+1<len)val=buf[offset+1]<<16;if(offset+2<len)val|=buf[offset+2]<<8;if(offset+3<len)val|=buf[offset+3];val=val+(buf[offset]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to read beyond buffer length")}if(offset>=this.length)return;var neg=this[offset]&128;if(neg)return(255-this[offset]+1)*-1;else return this[offset]};function readInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=readUInt16(buf,offset,littleEndian,true);var neg=val&32768;if(neg)return(65535-val+1)*-1;else return val}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};function readInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=readUInt32(buf,offset,littleEndian,true);var neg=val&2147483648;if(neg)return(4294967295-val+1)*-1;else return val}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};function readFloat(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+3<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};function readDouble(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+7<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.writeUInt8=function(value,offset,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset>=this.length)return;this[offset]=value;return offset+1};function writeUInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"trying to write beyond buffer length");verifuint(value,65535)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}return offset+2}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return writeUInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return writeUInt16(this,value,offset,false,noAssert)};function writeUInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"trying to write beyond buffer length");verifuint(value,4294967295)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}return offset+4}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return writeUInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt8=function(value,offset,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(offset>=this.length)return;if(value>=0)this.writeUInt8(value,offset,noAssert);else this.writeUInt8(255+value+1,offset,noAssert);return offset+1};function writeInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}var len=buf.length;if(offset>=len)return;if(value>=0)writeUInt16(buf,value,offset,littleEndian,noAssert);else writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert);return offset+2}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return writeInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return writeInt16(this,value,offset,false,noAssert)};function writeInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}var len=buf.length;if(offset>=len)return;if(value>=0)writeUInt32(buf,value,offset,littleEndian,noAssert);else writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert);return offset+4}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return writeInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return writeInt32(this,value,offset,false,noAssert)};function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+7<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;assert(end>=start,"end < start");if(end===start)return;if(this.length===0)return;assert(start>=0&&start<this.length,"start out of bounds");assert(end>=0&&end<=this.length,"end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.inspect=function(){var out=[];var len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new Error("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function(arr){arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function isArray(subject){return(Array.isArray||function(subject){return Object.prototype.toString.call(subject)==="[object Array]"})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){var b=str.charCodeAt(i);if(b<=127){byteArray.push(b)}else{var start=i;if(b>=55296&&b<=57343)i++;var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%");for(var j=0;j<h.length;j++){byteArray.push(parseInt(h[j],16))}}}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert(typeof value==="number","cannot write a non-number as a number");assert(value>=0,"specified a negative value for writing an unsigned value");assert(value<=max,"value is larger than maximum value for type");assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert(typeof value==="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value");assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert(typeof value==="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}},{"base64-js":4,ieee754:5}],4:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS)return 62;if(code===SLASH)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],5:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],6:[function(require,module,exports){(function(Buffer){var createHash=require("sha.js");var md5=toConstructor(require("./md5"));var rmd160=toConstructor(require("ripemd160"));function toConstructor(fn){return function(){var buffers=[];var m={update:function(data,enc){if(!Buffer.isBuffer(data))data=new Buffer(data,enc);buffers.push(data);return this},digest:function(enc){var buf=Buffer.concat(buffers);var r=fn(buf);buffers=null;return enc?r.toString(enc):r}};return m}}module.exports=function(alg){if("md5"===alg)return new md5;if("rmd160"===alg)return new rmd160;return createHash(alg)}}).call(this,require("buffer").Buffer)},{"./md5":10,buffer:3,ripemd160:11,"sha.js":13}],7:[function(require,module,exports){(function(Buffer){var createHash=require("./create-hash");var blocksize=64;var zeroBuffer=new Buffer(blocksize);zeroBuffer.fill(0);module.exports=Hmac;function Hmac(alg,key){if(!(this instanceof Hmac))return new Hmac(alg,key);this._opad=opad;this._alg=alg;key=this._key=!Buffer.isBuffer(key)?new Buffer(key):key;if(key.length>blocksize){key=createHash(alg).update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,zeroBuffer],blocksize)}var ipad=this._ipad=new Buffer(blocksize);var opad=this._opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}this._hash=createHash(alg).update(ipad)}Hmac.prototype.update=function(data,enc){this._hash.update(data,enc);return this};Hmac.prototype.digest=function(enc){var h=this._hash.digest();return createHash(this._alg).update(this._opad).update(h).digest(enc)}}).call(this,require("buffer").Buffer)},{"./create-hash":6,buffer:3}],8:[function(require,module,exports){(function(Buffer){var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}module.exports={hash:hash}}).call(this,require("buffer").Buffer)},{buffer:3}],9:[function(require,module,exports){(function(Buffer){var rng=require("./rng");function error(){var m=[].slice.call(arguments).join(" ");throw new Error([m,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}exports.createHash=require("./create-hash");exports.createHmac=require("./create-hmac");exports.randomBytes=function(size,callback){if(callback&&callback.call){try{callback.call(this,undefined,new Buffer(rng(size)))}catch(err){callback(err)}}else{return new Buffer(rng(size))}};function each(a,f){for(var i in a)f(a[i],i)}exports.getHashes=function(){return["sha1","sha256","md5","rmd160"]};var p=require("./pbkdf2")(exports.createHmac);exports.pbkdf2=p.pbkdf2;exports.pbkdf2Sync=p.pbkdf2Sync;each(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman"],function(name){exports[name]=function(){error("sorry,",name,"is not implemented yet")}})}).call(this,require("buffer").Buffer)},{"./create-hash":6,"./create-hmac":7,"./pbkdf2":17,"./rng":18,buffer:3}],10:[function(require,module,exports){var helpers=require("./helpers");function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);
b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":8}],11:[function(require,module,exports){(function(Buffer){module.exports=ripemd160;var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];var hl=[0,1518500249,1859775393,2400959708,2840853838];var hr=[1352829926,1548603684,1836072691,2053994217,0];var bytesToWords=function(bytes){var words=[];for(var i=0,b=0;i<bytes.length;i++,b+=8){words[b>>>5]|=bytes[i]<<24-b%32}return words};var wordsToBytes=function(words){var bytes=[];for(var b=0;b<words.length*32;b+=8){bytes.push(words[b>>>5]>>>24-b%32&255)}return bytes};var processBlock=function(H,M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var al,bl,cl,dl,el;var ar,br,cr,dr,er;ar=al=H[0];br=bl=H[1];cr=cl=H[2];dr=dl=H[3];er=el=H[4];var t;for(var i=0;i<80;i+=1){t=al+M[offset+zl[i]]|0;if(i<16){t+=f1(bl,cl,dl)+hl[0]}else if(i<32){t+=f2(bl,cl,dl)+hl[1]}else if(i<48){t+=f3(bl,cl,dl)+hl[2]}else if(i<64){t+=f4(bl,cl,dl)+hl[3]}else{t+=f5(bl,cl,dl)+hl[4]}t=t|0;t=rotl(t,sl[i]);t=t+el|0;al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=t;t=ar+M[offset+zr[i]]|0;if(i<16){t+=f5(br,cr,dr)+hr[0]}else if(i<32){t+=f4(br,cr,dr)+hr[1]}else if(i<48){t+=f3(br,cr,dr)+hr[2]}else if(i<64){t+=f2(br,cr,dr)+hr[3]}else{t+=f1(br,cr,dr)+hr[4]}t=t|0;t=rotl(t,sr[i]);t=t+er|0;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=t}t=H[1]+cl+dr|0;H[1]=H[2]+dl+er|0;H[2]=H[3]+el+ar|0;H[3]=H[4]+al+br|0;H[4]=H[0]+bl+cr|0;H[0]=t};function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}function ripemd160(message){var H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof message=="string")message=new Buffer(message,"utf8");var m=bytesToWords(message);var nBitsLeft=message.length*8;var nBitsTotal=message.length*8;m[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;m[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotal<<8|nBitsTotal>>>24)&16711935|(nBitsTotal<<24|nBitsTotal>>>8)&4278255360;for(var i=0;i<m.length;i+=16){processBlock(H,m,i)}for(var i=0;i<5;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}var digestbytes=wordsToBytes(H);return new Buffer(digestbytes)}}).call(this,require("buffer").Buffer)},{buffer:3}],12:[function(require,module,exports){var u=require("./util");var write=u.write;var fill=u.zeroFill;module.exports=function(Buffer){function Hash(blockSize,finalSize){this._block=new Buffer(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0;this._s=0}Hash.prototype.init=function(){this._s=0;this._len=0};function lengthOf(data,enc){if(enc==null)return data.byteLength||data.length;if(enc=="ascii"||enc=="binary")return data.length;if(enc=="hex")return data.length/2;if(enc=="base64")return data.length/3}Hash.prototype.update=function(data,enc){var bl=this._blockSize;var length;if(!enc&&"string"===typeof data)enc="utf8";if(enc){if(enc==="utf-8")enc="utf8";if(enc==="base64"||enc==="utf8")data=new Buffer(data,enc),enc=null;length=lengthOf(data,enc)}else length=data.byteLength||data.length;var l=this._len+=length;var s=this._s=this._s||0;var f=0;var buffer=this._block;while(s<l){var t=Math.min(length,f+bl-s%bl);write(buffer,data,enc,s%bl,f,t);var ch=t-f;s+=ch;f+=ch;if(!(s%bl))this._update(buffer)}this._s=s;return this};Hash.prototype.digest=function(enc){var bl=this._blockSize;var fl=this._finalSize;var len=this._len*8;var x=this._block;var bits=len%(bl*8);x[this._len%bl]=128;fill(this._block,this._len%bl+1);if(bits>=fl*8){this._update(this._block);u.zeroFill(this._block,0)}x.writeInt32BE(len,fl+4);var hash=this._update(this._block)||this._hash();if(enc==null)return hash;return hash.toString(enc)};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};return Hash}},{"./util":16}],13:[function(require,module,exports){var exports=module.exports=function(alg){var Alg=exports[alg];if(!Alg)throw new Error(alg+" is not supported (we accept pull requests)");return new Alg};var Buffer=require("buffer").Buffer;var Hash=require("./hash")(Buffer);exports.sha=exports.sha1=require("./sha1")(Buffer,Hash);exports.sha256=require("./sha256")(Buffer,Hash)},{"./hash":12,"./sha1":14,"./sha256":15,buffer:3}],14:[function(require,module,exports){module.exports=function(Buffer,Hash){var inherits=require("util").inherits;inherits(Sha1,Hash);var A=0|0;var B=4|0;var C=8|0;var D=12|0;var E=16|0;var BE=false;var LE=true;var W=new Int32Array(80);var POOL=[];function Sha1(){if(POOL.length)return POOL.pop().init();if(!(this instanceof Sha1))return new Sha1;this._w=W;Hash.call(this,16*4,14*4);this._h=null;this.init()}Sha1.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;Hash.prototype.init.call(this);return this};Sha1.prototype._POOL=POOL;var isDV=new Buffer(1)instanceof DataView;function readInt32BE(X,i){return isDV?X.getInt32(i,false):X.readInt32BE(i)}Sha1.prototype._update=function(array){var X=this._block;var h=this._h;var a,b,c,d,e,_a,_b,_c,_d,_e;a=_a=this._a;b=_b=this._b;c=_c=this._c;d=_d=this._d;e=_e=this._e;var w=this._w;for(var j=0;j<80;j++){var W=w[j]=j<16?X.readInt32BE(j*4):rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=add(add(rol(a,5),sha1_ft(j,b,c,d)),add(add(e,W),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}this._a=add(a,_a);this._b=add(b,_b);this._c=add(c,_c);this._d=add(d,_d);this._e=add(e,_e)};Sha1.prototype._hash=function(){if(POOL.length<100)POOL.push(this);var H=new Buffer(20);H.writeInt32BE(this._a|0,A);H.writeInt32BE(this._b|0,B);H.writeInt32BE(this._c|0,C);H.writeInt32BE(this._d|0,D);H.writeInt32BE(this._e|0,E);return H};function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function add(x,y){return x+y|0}function rol(num,cnt){return num<<cnt|num>>>32-cnt}return Sha1}},{util:39}],15:[function(require,module,exports){var inherits=require("util").inherits;var BE=false;var LE=true;var u=require("./util");module.exports=function(Buffer,Hash){var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];inherits(Sha256,Hash);var W=new Array(64);var POOL=[];function Sha256(){if(POOL.length){}this.init();this._w=W;Hash.call(this,16*4,14*4)}Sha256.prototype.init=function(){this._a=1779033703|0;this._b=3144134277|0;this._c=1013904242|0;this._d=2773480762|0;this._e=1359893119|0;this._f=2600822924|0;this._g=528734635|0;this._h=1541459225|0;this._len=this._s=0;return this};var safe_add=function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535};function S(X,n){return X>>>n|X<<32-n}function R(X,n){return X>>>n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}function Sigma0256(x){return S(x,2)^S(x,13)^S(x,22)}function Sigma1256(x){return S(x,6)^S(x,11)^S(x,25)}function Gamma0256(x){return S(x,7)^S(x,18)^R(x,3)}function Gamma1256(x){return S(x,17)^S(x,19)^R(x,10)}Sha256.prototype._update=function(m){var M=this._block;var W=this._w;var a,b,c,d,e,f,g,h;var T1,T2;a=this._a|0;b=this._b|0;c=this._c|0;d=this._d|0;e=this._e|0;f=this._f|0;g=this._g|0;h=this._h|0;for(var j=0;j<64;j++){var w=W[j]=j<16?M.readInt32BE(j*4):Gamma1256(W[j-2])+W[j-7]+Gamma0256(W[j-15])+W[j-16];T1=h+Sigma1256(e)+Ch(e,f,g)+K[j]+w;T2=Sigma0256(a)+Maj(a,b,c);h=g;g=f;f=e;e=d+T1;d=c;c=b;b=a;a=T1+T2}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){if(POOL.length<10)POOL.push(this);var H=new Buffer(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};return Sha256}},{"./util":16,util:39}],16:[function(require,module,exports){exports.write=write;exports.zeroFill=zeroFill;exports.toString=toString;function write(buffer,string,enc,start,from,to,LE){var l=to-from;if(enc==="ascii"||enc==="binary"){for(var i=0;i<l;i++){buffer[start+i]=string.charCodeAt(i+from)}}else if(enc==null){for(var i=0;i<l;i++){buffer[start+i]=string[i+from]}}else if(enc==="hex"){for(var i=0;i<l;i++){var j=from+i;buffer[start+i]=parseInt(string[j*2]+string[j*2+1],16)}}else if(enc==="base64"){throw new Error("base64 encoding not yet supported")}else throw new Error(enc+" encoding not yet supported")}function zeroFill(buf,from){for(var i=from;i<buf.length;i++)buf[i]=0}},{}],17:[function(require,module,exports){(function(Buffer){var blocksize=64;var zeroBuffer=new Buffer(blocksize);zeroBuffer.fill(0);module.exports=function(createHmac,exports){exports=exports||{};exports.pbkdf2=function(password,salt,iterations,keylen,cb){if("function"!==typeof cb)throw new Error("No callback provided to pbkdf2");setTimeout(function(){cb(null,exports.pbkdf2Sync(password,salt,iterations,keylen))})};exports.pbkdf2Sync=function(key,salt,iterations,keylen){if("number"!==typeof iterations)throw new TypeError("Iterations not a number");if(iterations<0)throw new TypeError("Bad iterations");if("number"!==typeof keylen)throw new TypeError("Key length not a number");if(keylen<0)throw new TypeError("Bad key length");var key=!Buffer.isBuffer(key)?new Buffer(key):key;if(key.length>blocksize){key=createHash(alg).update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,zeroBuffer],blocksize)}var HMAC;var cplen,p=0,i=1,itmp=new Buffer(4),digtmp;var out=new Buffer(keylen);out.fill(0);while(keylen){if(keylen>20)cplen=20;else cplen=keylen;itmp[0]=i>>24&255;itmp[1]=i>>16&255;itmp[2]=i>>8&255;itmp[3]=i&255;HMAC=createHmac("sha1",key);HMAC.update(salt);HMAC.update(itmp);digtmp=HMAC.digest();digtmp.copy(out,p,0,cplen);for(var j=1;j<iterations;j++){HMAC=createHmac("sha1",key);HMAC.update(digtmp);digtmp=HMAC.digest();for(var k=0;k<cplen;k++){out[k]^=digtmp[k]}}keylen-=cplen;i++;p+=cplen}return out};return exports}}).call(this,require("buffer").Buffer)},{buffer:3}],18:[function(require,module,exports){(function(Buffer){(function(){module.exports=function(size){var bytes=new Buffer(size);crypto.getRandomValues(bytes);return bytes}})()}).call(this,require("buffer").Buffer)},{buffer:3}],19:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{throw TypeError('Uncaught, unspecified "error" event.')}return false}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],20:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],21:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],22:[function(require,module,exports){exports.endianness=function(){return"LE"};exports.hostname=function(){if(typeof location!=="undefined"){return location.hostname}else return""};exports.loadavg=function(){return[]};exports.uptime=function(){return 0};exports.freemem=function(){return Number.MAX_VALUE};exports.totalmem=function(){return Number.MAX_VALUE};exports.cpus=function(){return[]};exports.type=function(){return"Browser"};exports.release=function(){if(typeof navigator!=="undefined"){return navigator.appVersion}return""};exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}};exports.arch=function(){return"javascript"};exports.platform=function(){return"browser"};exports.tmpdir=exports.tmpDir=function(){return"/tmp"};exports.EOL="\n"},{}],23:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:24}],24:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],25:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":26}],26:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":28,"./_stream_writable":30,_process:24,"core-util-is":31,inherits:20}],27:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":29,"core-util-is":31,inherits:20}],28:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;
if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:24,buffer:3,"core-util-is":31,events:19,inherits:20,isarray:21,stream:37,"string_decoder/":32}],29:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":26,"core-util-is":31,inherits:20}],30:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":26,_process:24,buffer:3,"core-util-is":31,inherits:20,stream:37}],31:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:3}],32:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:3}],33:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":27}],34:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":26,"./lib/_stream_passthrough.js":27,"./lib/_stream_readable.js":28,"./lib/_stream_transform.js":29,"./lib/_stream_writable.js":30}],35:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":29}],36:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":30}],37:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:19,inherits:20,"readable-stream/duplex.js":25,"readable-stream/passthrough.js":33,"readable-stream/readable.js":34,"readable-stream/transform.js":35,"readable-stream/writable.js":36}],38:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],39:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":38,_process:24,inherits:20}],40:[function(require,module,exports){var ndnFunc=require("./src.js");var dropkick=require("dropkick");var createLoading=function(){var ret=document.createElement("img");ret.src="loader.gif";return $(ret)};$(document).ready(function(){dropkick(document.body).on("file",function(file){console.log("file drop event",file);ndnFunc.shareFile(file)});var chatChannel="",username="",users=[],usernameInput=$("#username"),chatRoomName=$("#chatRoomName"),chatButton=$("#startChatButton"),newChatButton=$("#newChatButton"),chatListEl=$("#chatList"),sendMessageButton=$("#sendMessageButton"),backButton=$("#backButton"),messageList=$("#messageList"),messageContent=$("#messageContent"),userList=$("#userList"),isBlurred=false,timerId=-1,pages={home:$("#homePage"),chatList:$("#chatListPage"),chat:$("#chatPage"),"delete":$("#delete")};$(window).on("blur",function(){isBlurred=true}).on("focus",function(){isBlurred=false;clearInterval(timerId);document.title="Pub Messenger"});var notificationPermission=1;if(window.webkitNotifications){notificationPermission=window.webkitNotifications.checkPermission();if(notificationPermission===1){window.webkitNotifications.requestPermission(function(event){notificationPermission=window.webkitNotifications.checkPermission()
})}}function HomeView(){if(localStorage["username"]){usernameInput.val(localStorage["username"])}chatButton.off("click");chatButton.click(function(event){if(usernameInput.val()!=""){username=usernameInput.val();window.handle=username;localStorage["username"]=username;$.mobile.changePage(pages.chatList)}})}function ChatListView(event,data){chatListEl.empty();newChatButton.off("click");newChatButton.click(function(event){if(chatRoomName.val()!==""){chatChannel=chatRoomName.val();window.roomName=chatChannel;console.log("chat list view click",pages.chat);$.mobile.changePage(pages.chat)}})}var makeSaveButton=function(fileName,file,id,button){if(file!==null||undefined){var a=document.createElement("a");a.download=fileName;a.href=URL.createObjectURL(file);button.innerText="Save";button.onclick=function(){a.click()}}console.log(a,file,fileName)};var makeDownloadButton=function(slug,extension){var button=document.createElement("button"),fileName=slug+"."+extension,id=Date.now();button.id=slug+"DL";button.innerText="download";button.onclick=function(){var loading=createLoading();$(button).append(loading);button.onclick=function(){};ndnFunc.getFile(slug,extension,function(err,file){loading.remove();console.log("file fetched",err,fileName,file);makeSaveButton(fileName,file,id,button)})};if($("#"+fileName.split(".")[0]).length===0){currentView.handleMessage({message:"shared File: "+slug+"."+extension+" ",id:id,handle:"shared",button:button})}};function DeleteChatView(event,data){if(data.options&&data.options.link){var channelName=data.options.link.attr("data-channel-name"),deleteButton=pages.delete.find("#deleteButton");deleteButton.unbind("click");deleteButton.click(function(event){console.log(pages.delete.children());pages.delete.find('[data-rel="back"]').click()})}}function ChatView(event,data){var self=this;console.log("chatView",event,data);users=[];messageList.empty();userList.empty();ndnFunc.joinRoom(chatChannel,makeDownloadButton,function(message){self.handleMessage(message,true)},userList);pages.chat.find("h1:first").text(chatChannel);messageContent.off("keydown");messageContent.bind("keydown",function(event){if((event.keyCode||event.charCode)!==13)return true;sendMessageButton.click();return false});sendMessageButton.off("click");sendMessageButton.click(function(event){var message=messageContent.val();if(message!==""){messageContent.val("");ndnFunc.chat(message)}});backButton.off("click");backButton.click(function(event){console.log("click off")})}ChatView.prototype.handleMessage=function(message,animate){if(animate!==false)animate=true;var messageEl=$("<li class='message'>"+"<span id='"+message.id+"'class='username'>"+message.handle+"</span>"+message.message+"</li>");if(message.button){message.button.innerText="download";messageEl.append(message.button)}messageList.append(messageEl);messageList.listview("refresh");if(animate===true){$("html, body").animate({scrollTop:$(document).height()-$(window).height()},"slow")}if(isBlurred){clearInterval(timerId);timerId=setInterval(function(){document.title=document.title=="Pub Messenger"?"New Message":"Pub Messenger"},2e3)}};$.mobile.changePage(pages.home);var currentView=new HomeView;$(document).bind("pagechange",function(event,data){if(data.toPage[0]==pages.chatList[0]){currentView=new ChatListView(event,data)}else if(data.toPage[0]==pages.delete[0]){currentView=new DeleteChatView(event,data)}else if(data.toPage[0]==pages.chat[0]){currentView=new ChatView(event,data)}});$(window).unload(function(){alert("hey");ndnFunc.leaveRoom()})})},{"./src.js":353,dropkick:354}],41:[function(require,module,exports){var ndn,contrib,debug={};debug.debug=require("debug")("Fetcher");function Fetcher(gremlin,uri,interestLifetimeMilliseconds){this.gremlin=gremlin;this.name=new ndn.Name(uri);this.masterInterest=new ndn.Interest(this.name);this.masterInterest.setInterestLifetimeMilliseconds(interestLifetimeMilliseconds);this.interestLifetimeMilliseconds=interestLifetimeMilliseconds;return this}Fetcher.installContrib=function(ndncontrib){ndn=ndncontrib.ndn;contrib=ndncontrib};Fetcher.prototype.setName=function(uri){this.name=new ndn.Name(uri);this.masterInterest.setName(this.name.appendSegment(0));return this};Fetcher.prototype.setType=function(type){this.type=type;return this};Fetcher.prototype.setInterestLifetimeMilliseconds=function(milliseconds){this.masterInterest.setInterestLifetimeMilliseconds(milliseconds);return this};Fetcher.prototype.setMinSuffixComponents=function(count){this.masterInterest.setMinSuffixComponents(count);return this};Fetcher.prototype.setMaxSuffixComponents=function(count){this.masterInterest.setMaxSuffixComponents(count);return this};Fetcher.prototype.setExclude=function(excludeArray){this.masterInterest.setMaxSuffixComponents(count);return this};Fetcher.prototype.get=function(callback){if(!this.type||!(this.type==="object"||"json"||"string")&&this.type.indexOf("/")===-1){callback(new TypeError("must call .setType with mimeString, 'object', 'json', 'string' || 'text'"))}else{if(this.type==="file"||this.type.split("/").length===2){if(this.type.split(":").length===2){this.getAsObjectURL(callback)}else{this.getAsFile(callback)}return this}else if(this.type==="object"||this.type==="json"){this.getAsJSON(callback);return this}else if(this.type==="string"||"text"){this.getAsString(callback);return this}}return this};Fetcher.prototype.assembleString=function(contentArray){var string="";for(var i=0;i<contentArray.length;i++){string+=contentArray[i].toString()}return string};Fetcher.prototype.assembleJSON=function(contentArray){return JSON.parse(this.assembleString(contentArray))};Fetcher.prototype.assembleFile=require("./node/assembleFile.js");Fetcher.prototype.getAsFile=function(callback,timeout){var Self=this,type=this.type.indexOf("url:")===0?this.type.substring(4):this.type;this.getParts(function(err,contentArray){if(err){callback(err)}else{callback(null,Self.assembleFile(contentArray,type))}});return this};Fetcher.prototype.getAsString=function(callback,timeout){var Self=this;this.getParts(function(err,contentArray){if(err){callback(err)}else{callback(null,Self.assembleString(contentArray))}});return this};Fetcher.prototype.getAsObjectURL=function(){var Self=this;try{if(URL){return function getObjectUrl(callback,timeout){Self.getAsFile(function(err,blob){if(err){callback(err)}else{callback(null,URL.createObjectURL(blob))}});return this}}return function(){console.log("no URL support on this platform");return this}}catch(e){return function(){console.log("no URL support on this platform");return this}}}();Fetcher.prototype.getAsJSON=function(callback){var Self=this;this.getParts(function(err,contentArray){if(err){callback(err)}else{callback(null,Self.assembleJSON(contentArray))}})};Fetcher.prototype.getParts=function(uri,interestLifetimeMilliseconds,callback){if(typeof uri==="function"){callback=uri}else if(typeof interestLifetimeMilliseconds==="function"){this.setName(uri);callback=interestLifetimeMilliseconds}else{this.setName(uri);this.setInterestLifetimeMilliseconds(interestLifetimeMilliseconds)}var totalSegments=null;var segmentsRetrieved=0;var contentArray=[];function onEachData(element,data,finalSegment){if(!totalSegments){try{totalSegments=1+finalSegment}catch(e){totalSegments=1}}var segmentNumber=data.name.get(-1).toSegment();contentArray[segmentNumber]=data.content;segmentsRetrieved++;if(segmentsRetrieved>=totalSegments){callback(null,contentArray)}}this.gremlin.io.fetchAllSegments(this.masterInterest,onEachData,callback)};module.exports=Fetcher},{"./node/assembleFile.js":44,debug:47}],42:[function(require,module,exports){var Publisher=require("./Publisher.js"),Fetcher=require("./Fetcher.js"),contrib=require("ndn-js-contrib"),ndn=contrib.ndn,debug={};debug.debug=require("debug")("IO");require("setimmediate");Publisher.installContrib(contrib);Fetcher.installContrib(contrib);function IO(gremlin,policy,onReady){gremlin.io=this;this.fetcher=new Fetcher(gremlin);this.publisher=new Publisher(gremlin,policy,onReady);this.gremlin=gremlin;return this}IO.ndn=ndn;IO.installContrib=function(contrib){Publisher.installContrib(contrib);Fetcher.installContrib(contrib);ndn=contrib.ndn;this.ndn=contrib.ndn;console.log("contrib installed")};IO.Namespace=function(prefix,gremlin,callback){var Self=this;this.prefix=new ndn.Name(prefix);this.publisher=new Publisher(gremlin,{path:this.prefix.toUri()},function(err,data){callback(err,data)});this.fetcher=new Fetcher(gremlin);return this};IO.prototype.createNamespace=function createNamespace(prefix,callback){return new IO.Namespace(prefix,this.gremlin,callback)};IO.prototype.publish=function(name,toPublish,announcer){this.publisher=this.publisher||new Publisher(this);return this.publisher.setToPublish(toPublish).setName(name).setFreshnessPeriod(60*60*1e3).publish(announcer)};IO.prototype.fetch=function(uriString,callback){this.fetcher=this.fetcher||new Fetcher(this);var parts=uriString.split("://");this.fetcher.setName(parts[1]).setInterestLifetimeMilliseconds(400).setType(parts[0]).get(callback);return this};IO.prototype.announcer=function(firstData){};IO.prototype.setAnnouncer=function(announcer){this.announcer=announcer;return this};IO.prototype.addListener=function(prefix,connectionParameters){this.FIB.addEntry(prefix,[{faceID:this.Interfaces.newFace(IO.localTransport,connectionParameters)}])};IO.prototype.handleInterest=function(element,faceID){var interest=new ndn.Interest;interest.wireDecode(element);var Self=this;this.contentStore.check(interest,function(result){if(result){Self.interfaces.dispatch(result,0|1<<faceID)}})};IO.prototype.handleData=function(element,faceID){var data=new ndn.Data;data.wireDecode(element);var results=this.PIT.lookup(data);for(var i=0;i<results.pitEntries.length;i++){results.pitEntries[i].callback(element,data,data.signedInfo.finalBlockID)}};IO.prototype.fetchAllSegments=function(firstSegmentInterest,onEachData,onTimeout){var interestsInFlight=0,windowSize=30,masterInterest=new ndn.Interest(firstSegmentInterest),finalSegmentNumber,interest=new ndn.Interest(masterInterest),callbackTriggered=false,segmentRequested=[],segmentGot=[],Self=this,finalBlockID;masterInterest.setName(firstSegmentInterest.name.getPrefix(-1));var callback=function(dataPacket,interest){if(!dataPacket){var seg=interest.name.get(-1).toSegment();if(!segmentGot[seg]){if(segmentRequested[seg]<5){segmentRequested[seg]++;var packet=interest.wireEncode().buffer;setTimeout(function(){Self.gremlin.handleInterest(packet,callback)},0)}else if(callbackTriggered===false){callbackTriggered=true;onTimeout(new Error("fetching data failed due to timeout: ",firstSegmentInterest.toUri()),null)}}}else{var data=new ndn.Data;data.wireDecode(dataPacket);finalBlockID=finalBlockID||data.signedInfo.getFinalBlockID().toSegment();onEachData(null,data,finalBlockID);interestsInFlight--;var segmentNumber=data.name.get(-1).toSegment();segmentGot[segmentNumber]=true;finalSegmentNumber=1+finalBlockID;if(interestsInFlight<windowSize){var p;for(var i=0;i<finalSegmentNumber;i++){if(segmentRequested[i]===undefined){var newInterest=new ndn.Interest(masterInterest);newInterest.name.appendSegment(i);newInterest.setInterestLifetimeMilliseconds(masterInterest.getInterestLifetimeMilliseconds());p=newInterest.wireEncode().buffer;segmentRequested[i]=0;interestsInFlight++;if(interestsInFlight===windowSize){i=finalSegmentNumber}Self.gremlin.handleInterest(p,callback)}}}}};segmentRequested[0]=0;var packet=firstSegmentInterest.wireEncode().buffer;this.gremlin.handleInterest(packet,callback)};module.exports=IO},{"./Fetcher.js":41,"./Publisher.js":43,debug:47,"ndn-js-contrib":210,setimmediate:352}],43:[function(require,module,exports){(function(Buffer){var ndn,contrib,debug={};debug.debug=require("debug")("Publisher");if(!File){var File=function File(){},Blob=function Blob(){}}function Publisher(gremlin,policy,onReady){var self=this;this.repo=new gremlin.contrib.Repository(new gremlin.contrib.ContentStore(gremlin.cache.nameTree,gremlin.contrib.Repository.RepoEntry),policy,function(){console.log("publisher repo open");gremlin.contrib.Repository.RepoEntry.installDatabase(self.repo);onReady()});this.gremlin=gremlin;return this}Publisher.installContrib=function(contrib){contrib=contrib;ndn=contrib.ndn};Publisher.prototype.setFreshnessMilliseconds=function(milliseconds){this.freshnessPeriod=milliseconds;return this};Publisher.prototype.setToPublish=function(toPublish){var er;if(typeof toPublish!=="string"){if(!(toPublish instanceof File||toPublish instanceof Blob||toPublish instanceof Buffer||toPublish instanceof Object)){er=true}else if(toPublish instanceof Object){try{JSON.stringify(toPublish)}catch(e){er=e}}if(er){throw new TypeError("toPublish must be File, Blob, Buffer, FilePath, String, or parsable JSON")}}this.toPublish=toPublish;return this};Publisher.prototype.setName=function(name){this.name=new ndn.Name(name);return this};Publisher.prototype.publish=function(callback){console.log("publish called",this.toPublish,callback);callback=callback||function(){};if(this.toPublish.type&&this.toPublish.size&&this.toPublish.name||this.toPublish instanceof Blob||Buffer.isBuffer(this.toPublish)||typeof this.toPublish==="string"&&this.toPublish.indexOf("file://")===0){this.publishFile(callback)}else if(typeof this.toPublish==="string"){callback(this.publishString())}else if(typeof this.toPublish==="object"){callback(this.publishJSON())}return this};Publisher.prototype.readFile=require("./node/readFile.js");Publisher.prototype.publishFile=function(callback){var Self=this;var name=Self.name;var segment=0;var firstData;var finalBlockID=null;var t1=Date.now();function onSegmentRead(buffer,length,segment){var n=new ndn.Name(name);n.appendSegment(segment);if(!finalBlockID){var na=new ndn.Name;na.appendSegment(length-1);finalBlockID=na.get(-1)}var d=new ndn.Data(n,new ndn.SignedInfo,buffer);d.signedInfo.setFreshnessPeriod(Self.freshnessPeriod);d.signedInfo.setFinalBlockID(finalBlockID);d.sign();var element=d.wireEncode().buffer;Self.repo.insert(element,d);Self.gremlin.handleData(element,-1);if(segment===0){firstData=d}if(segment===length+1){Self.gremlin.addListener({prefix:name.toUri(),blocking:true},function publishListener(interest,faceID,unblock){Self.repo.check(interest,function(err,element){if(!err){if(typeof faceID==="function"){faceID(element)}else{Self.gremlin.interfaces.dispatch(element,0|1<<faceID)}}else{unblock()}})});console.log(Self.toPublish.size/(Date.now()-t1));callback(firstData)}else if(segment<=length){segment=segment+1;Self.readFile(Self.toPublish,segment,onSegmentRead)}}var testInterest=new ndn.Interest(name);testInterest.name.appendSegment(0);Self.repo.check(testInterest,function(err,element){if(!element){Self.readFile(Self.toPublish,0,onSegmentRead)}else{Self.gremlin.addListener({prefix:name.toUri(),blocking:true},function publishListener(interest,faceID,unblock){Self.repo.check(interest,function(err,element){if(typeof faceID==="function"){faceID(element)}else{Self.gremlin.interfaces.dispatch(element,0|1<<faceID)}})});var d=new ndn.Data;d.wireDecode(element);callback(element)}})};Publisher.prototype.publishJSON=function(){return this.setToPublish(JSON.stringify(this.toPublish)).publishString()};Publisher.prototype.serve=function(prefix){var name=new ndn.Name(prefix),Self=this;this.gremlin.addListener({prefix:name.toUri(),blocking:true},function publishListener(interest,faceID,unblock){Self.repo.check(interest,function(element){if(element){if(typeof faceID==="function"){faceID(element,interest)}else{Self.gremlin.interfaces.dispatch(element,0|1<<faceID)}}else{unblock()}})})};Publisher.prototype.publishString=function(){var chunks=[],firstData;while(this.toPublish.length>0){chunks.push(this.toPublish.substr(0,8e3));this.toPublish=this.toPublish.substr(8e3,this.toPublish.length)}var length=chunks.length;for(var i=0;i<length;i++){var n=new ndn.Name(this.name);var d=new ndn.Data(n.appendSegment(i),new ndn.SignedInfo,chunks.shift());d.signedInfo.setFreshnessPeriod(this.freshnessPeriod);if(length===0){d.signedInfo.setFinalBlockID(n.get(-1))}else{d.signedInfo.setFinalBlockID(new ndn.Name.Component(ndn.Name.Component.fromNumberWithMarker(length-1,0)))}d.sign();var element=d.wireEncode().buffer;this.repo.insert(element,d);this.gremlin.handleData(element,-1);if(i===0){firstData=d}}return firstData};module.exports=Publisher}).call(this,require("buffer").Buffer)},{"./node/readFile.js":45,buffer:3,debug:47}],44:[function(require,module,exports){module.exports=function(contentArray,mimeType){return new Blob(contentArray,{type:mimeType})}},{}],45:[function(require,module,exports){(function(Buffer){module.exports=function(file,segment,callback){var buffer;if(file instanceof File){var reader=new FileReader;reader.onloadend=function(e){callback(new Buffer(new Uint8Array(e.target.result)),Math.ceil(file.size/8e3),segment)};reader.readAsArrayBuffer(file.slice(segment*8e3,(segment+1)*8e3))}else if(file instanceof Blob||Buffer){buffer=file.slice(segment*8e3,(segment+1)*8e3);callback(buffer,Math.ceil((file.size||file.length)/8e3),segment)}}}).call(this,require("buffer").Buffer)},{buffer:3}],46:[function(require,module,exports){var IO=require("./dist/src/IO.js"),Forwarder=require("ndn-gremlin"),gremlin,ndn=Forwarder.ndn;IO.installContrib(Forwarder.contrib);function NameSpace(prefix,gremlin,repo){var Self=this;this.gremlin=gremlin;this.repo=repo||new Forwarder.contrib.Repository(new Forwarder.contrib.ContentStore(new Forwarder.contrib.NameTree,Forwarder.contrib.Repository.RepoEntry),{path:"np"},function(){Forwarder.RepoEntry.installDatabase(Self.repo)});this.prefix=new ndn.Name(prefix);this.connectionRequestSuffix=new ndn.Name("requestPeerConnection");this.announcementSuffix=new ndn.Name("announceNewData");this.gremlin.addRegisteredPrefix(this.prefix.toUri(),0);console.log(this.prefix.toUri(),gremlin.interfaces.Faces[0]);return this}NameSpace.prototype.IO=function(suffix){var suf=new ndn.Name(suffix);return new NameSpace(this.prefix.toUri()+suf.toUri(),this.gremlin,this.repo)};NameSpace.prototype.getPeer=function(){var Self=this;var onFace=function(err,firstFaceID){if(!err){gremlin.addRegisteredPrefix(Self.prefix,firstFaceID)}};var onFaceClosed=function(closedFaceID){gremlin.requestConnection(this.prefix.toUri()+Self.connectionRequestSuffix.toUri(),onFace)};gremlin.setRegistrationPrefix("ndn/gremlin/add-nexthop").registerPrefix(this.prefix.toUri(),1).addRegisteredPrefix(this.prefix.toUri(),1).requestConnection(this.prefix.toUri()+Self.connectionRequestSuffix.toUri(),onFace,onFaceClosed).addConnectionListener(Self.prefix.toUri()+Self.connectionRequestSuffix.toUri(),maxPeers,onFace,onFaceClosed);return this};NameSpace.prototype.listen=function(onAnnounce){var Self=this;var awares=[];gremlin.addListener(Self.prefix.toUri()+Self.announcementSuffix.toUri(),function(interest,faceID){for(var i=0;i<awares.length-1;i++){if(awares[i]===interest.name.toUri()){return}}awares.push(interest.name.toUri());onAnnounce(null,interest.name.getSubName(Self.prefix.size()*2+Self.announcementSuffix.size()).toUri())})};NameSpace.prototype.subscribe=function(onAppData){var Self=this;gremlin.addListener(Self.prefix.toUri()+Self.announcementSuffix.toUri(),function(interest,faceID){gremlin.io.fetcher.setName(interest.name.getSubName(Self.prefix.size()+Self.announcementSuffix.size()).toUri()).setInterestLifetimeMilliseconds(400).setType(Self.dataType).get(onAppData)});return this};NameSpace.prototype.steward=function(){gremlin.addListener(Self.prefix.toUri()+Self.announcementSuffix.toUri(),function(interest,faceID){gremlin.io.fetchAllSegments(interest.getSubName(Self.prefix.size()+Self.announcementSuffix.size()),function(element,data,finalBlockID){gremlin.repo.insert(element,data,function(err,success){console.log("is there even a callback here?")})},function(){console.log("timeout when trying to steward announced data")})}).addListener({prefix:Self.prefix.toUri(),blocking:true},function(interest,faceID,unblock){gremlin.repo.check(interest,function(element){if(!element){unblock()}else{gremlin.dispatch(element,0|1<<faceID)}})});return this};NameSpace.prototype.announce=function(){var Self=this;return function(firstData){console.log("announcing data ",firstData.name.toUri());var announceInterest=new ndn.Interest(new ndn.Name(Self.prefix.toUri()+Self.announcementSuffix.toUri()+firstData.name.getPrefix(-1).toUri()));gremlin.handleInterest(announceInterest.wireEncode().buffer,0)};return this};NameSpace.prototype.publish=function(name,toPublish){var Self=this;var ndnName=new ndn.Name(name);gremlin.io.publisher.setName(this.prefix.toUri()+ndnName.toUri()).setFreshnessPeriod(60*60*1e3).setToPublish(toPublish).publish(Self.announce());return this};NameSpace.prototype.fetch=function(name,onAppData){var Self=this;var ndnName=new ndn.Name(name);this.gremlin.fetcher.setName(this.prefix.toUri()+ndnName.toUri()).setInterestLifetimeMilliseconds(400).setType(this.dataType).get(onAppData);return this};NameSpace.prototype.setConnectionRequestSuffix=function(suffix){this.connectionRequestSuffix=new ndn.Name(suffix);return this};NameSpace.prototype.setAnnouncementSuffix=function(suffix){this.announcementSuffix=new ndn.Name(suffix);return this};NameSpace.prototype.setDataType=function(type){this.dataType=type;return this};module.exports=IO},{"./dist/src/IO.js":42,"ndn-gremlin":56}],47:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){localStorage.removeItem("debug")}else{localStorage.debug=namespaces}}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports.enable(load())},{"./debug":48}],48:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:49}],49:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],50:[function(require,module,exports){var contrib=require("ndn-js-contrib"),ndn=contrib.ndn,os=require("os"),debug={},Manager=require("./Manager.js");debug.debug=require("debug")("Forwarder");var Forwarder=function Forwarder(options){options=options||{};this.ndn=contrib.ndn;this.contrib=contrib;this.nameTree=new contrib.NameTree;this.fib=new contrib.FIB(this.nameTree);this.listeners=new contrib.FIB(new contrib.NameTree);this.listenerCallbacks=[];this.pit=new contrib.PIT(this.nameTree);this.maxMemory=options.mem||os.freemem()*.5;this.cache=new contrib.ContentStore(this.nameTree,null,this.maxMemory);this.interfaces=new contrib.Interfaces(this);var transports=Object.keys(contrib.Transports);options.TCPServerTransport=options.tcp;options.WebSocketServerTransport=options.ws;this.remoteInfo={ipv4:options.ipv4||"0.0.0.0",domain:options.domain||"localhost",iceServers:options.iceServers||[]};for(var i=0;i<transports.length;i++){if(contrib.Transports[transports[i]].defineListener){if(contrib.Transports[transports[i]].prototype.name==="TCPServerTransport"){this.remoteInfo.tcp={port:options.tcp||8484,name:"TCPServerTransport"}}else if(contrib.Transports[transports[i]].prototype.name==="WebSocketServerTransport"){this.remoteInfo.ws={port:options.ws||8585,name:"WebSocketServerTransport"}}else if(contrib.Transports[transports[i]].prototype.name==="WebSocketTransport"){this.remoteInfo.ws={name:"WebSocketTransport"}}console.log(options[contrib.Transports[transports[i]].prototype.name],contrib.Transports[transports[i]].prototype.name);contrib.Transports[transports[i]].defineListener(this,options[contrib.Transports[transports[i]].prototype.name])}this.interfaces.installTransport(contrib.Transports[transports[i]])}Manager(this);return this};Forwarder.ndn=contrib.ndn;Forwarder.contrib=contrib;Forwarder.prototype.addConnectionListener=function(){};require("./node/ConnectionListeners.js")(Forwarder);require("./node/createSuffix.js")(Forwarder);Forwarder.prototype.handleInterest=function(element,faceID,skipListen){var override={},Self=this,interest=new ndn.Interest;interest.wireDecode(element);if(this.pit.checkDuplicate(interest)){if(typeof faceID==="function"){setImmediate(function(){faceID(undefined,interest)})}return this}else{var cacheHit=Self.cache.check(interest);if(cacheHit){if(typeof faceID==="function"){faceID(cacheHit)}else{Self.interfaces.dispatch(cacheHit,0|1<<faceID)}}else{return Closure(skipListen)}}function Closure(skipListen,skipForward,listeners){listeners=listeners||Self.listeners.findAllFibEntries(interest.name);function unblock(){var Self=this;return function unblock(skipListen){Closure(skipListen,false,listeners)}}function iterateListeners(){if(listeners.hasNext){var listener=listeners.next();var blockingCallback,connectionCallback,nonBlockingCallbacks=[];for(var i=0;i<listener.nextHops.length;i++){if(Self.listenerCallbacks[listener.nextHops[i].faceID].blocking){blockingCallback=Self.listenerCallbacks[listener.nextHops[i].faceID].callback;block=true}else if(Self.listenerCallbacks[listener.nextHops[i].faceID].connection){connectionCallback=Self.listenerCallbacks[listener.nextHops[i].faceID].callback}else{nonBlockingCallbacks.push(Self.listenerCallbacks[listener.nextHops[i].faceID])}}if(connectionCallback){connectionCallback(interest,faceID,function(skip){if(!skip&&nonBlockingCallbacks.length>0){for(var p=0;p<nonBlockingCallbacks.length;p++){nonBlockingCallbacks[p].callback(interest,faceID)}}if(blockingCallback){blockingCallback(interest,faceID,new unblock)}else{var un=new unblock;un(skip)}});return}else if(nonBlockingCallbacks.length>0){for(var j=0;j<nonBlockingCallbacks.length;j++){nonBlockingCallbacks[j].callback(interest,faceID)}}if(blockingCallback){blockingCallback(interest,faceID,new unblock)}else if(listeners.hasNext){iterateListeners()}else{forward()}}else{forward()}}if(!skipListen){iterateListeners()}else{forward()}function forward(){if(!override.skipForward){var exclude=typeof faceID==="number"?faceID:undefined;var nextHopFlag=Self.fib.findAllNextHops(interest.name,exclude);if(nextHopFlag){Self.pit.insertPitEntry(element,interest,faceID);Self.interfaces.dispatch(element,nextHopFlag)}}}return Self}};Forwarder.prototype.handleData=function(element,faceID){var data=new ndn.Data;data.wireDecode(element);var pitMatch=this.pit.lookup(data);if(pitMatch.faces){this.interfaces.dispatch(element,pitMatch.faces)}if(pitMatch.pitEntries.length>0){this.cache.insert(element,data);for(var i=0;i<pitMatch.pitEntries.length;i++){if(pitMatch.pitEntries[i].callback){pitMatch.pitEntries[i].callback(element,pitMatch.pitEntries[i].interest)}pitMatch.pitEntries[i].consume(true)}}return this};Forwarder.prototype.addListener=function(nameSpace,callback){this.listenerCallbacks=this.listenerCallbacks||[];var prefix,options,Self=this;if(typeof nameSpace==="string"){prefix=nameSpace;options={}}else{prefix=nameSpace.prefix;options=nameSpace}prefix=new ndn.Name(prefix);prefix=prefix.toUri();var listenerID=this.listenerCallbacks.length,isNew=true;if(options.connection){var connectionReplaced=false;if(this.listenerCallbacks.length>0){for(var i=0;i<this.listenerCallbacks.length;i++){if(this.listenerCallbacks[i].prefix===prefix&&this.listenerCallbacks[i].connection){this.listenerCallbacks[i].callback=callback;connectionReplaced=true;isNew=false;break}}}if(!connectionReplaced){this.listenerCallbacks.push({connection:true,callback:callback,listenerID:listenerID,prefix:prefix})}}else if(options.blocking){var blockingReplaced=false;if(this.listenerCallbacks.length>0){for(var j=0;j<this.listenerCallbacks.length;j++){if(this.listenerCallbacks[j].prefix===prefix&&this.listenerCallbacks[j].blocking){this.listenerCallbacks[j].callback=callback;blockingReplaced=true;isNew=false;break}}}if(!blockingReplaced){this.listenerCallbacks.push({blocking:true,callback:callback,listenerID:listenerID,prefix:prefix});console.log("pushed")}}else{this.listenerCallbacks.push({blocking:false,callback:callback,listenerID:listenerID,prefix:prefix})}if(isNew){this.listeners.addEntry(prefix,listenerID)
}return this};Forwarder.prototype.removeListeners=function(prefix){prefix=new ndn.Name(prefix);this.listenerCallbacks=this.listenerCallbacks||[];if(this.listenerCallbacks.length===0){return this}var listenerEntry=this.listeners.lookup(prefix);while(listenerEntry.nextHops.length){var hopEntry=listenerEntry.nextHops.pop();this.listenerCallbacks[hopEntry.faceID].callback=null}return this};Forwarder.prototype.setMaxConnections=function(maximum){this.maxConnections=maximum;return this};Forwarder.prototype.addConnection=function(){};require("./node/addConnection.js")(Forwarder);Forwarder.prototype.removeConnection=function(faceID){if(this.interfaces.Faces[faceID]){while(this.interfaces.Faces[faceID].prefixes.length>0){this.fib.lookup(this.interfaces.Faces[faceID].prefixes.pop()).removeNextHop({faceID:faceID})}this.interfaces.Faces[faceID].close();this.interfaces.Faces[faceID].closeByTransport();this.interfaces.Faces[faceID].onclose();this.connectionCount--;return this}};Forwarder.prototype.requestConnection=function(prefix,onFace,onFaceClosed){var Self=this;Self.createConnectionRequestSuffix(function(suffix,responseCB){var name=new ndn.Name(prefix);name.append(suffix.value);var interest=new ndn.Interest(name);interest.setInterestLifetimeMilliseconds(16e3);var element=interest.wireEncode().buffer;var inst=new ndn.Interest;try{inst.wireDecode(element)}catch(e){}Self.pit.insertPitEntry(element,inst,function(data,interest){if(data){try{if(responseCB){var json=JSON.parse(data.content.toString());responseCB(json)}Self.addRegisteredPrefix(prefix,Self.interfaces.Faces.length-1);onFace(null,Self.interfaces.Faces.length-1)}catch(e){}}else{onFace(new Error("connection request timeout"))}});var faceFlag=Self.fib.findAllNextHops(prefix);try{Self.interfaces.dispatch(element,faceFlag)}catch(e){}},function(connectionInfo){Self.addConnection(connectionInfo,function(id){Self.addRegisteredPrefix(prefix,id);onFace(null,id)},function(id){Self.removeConnection(id);onFaceClosed(id)})});return this};Forwarder.prototype.addRegisteredPrefix=function(prefix,faceID){this.fib.lookup(prefix).addNextHop({faceID:faceID});this.interfaces.Faces[faceID].prefixes=this.interfaces.Faces[faceID].prefixes||[];this.interfaces.Faces[faceID].prefixes.push(prefix);return this};Forwarder.prototype.registrationPrefix="marx/fib/add-nexthop";Forwarder.prototype.setRegistrationPrefix=function(prefix){this.registrationPrefix=new ndn.Name(prefix);return this};Forwarder.prototype.registerPrefix=function(prefix,faceID){var name=new ndn.Name(this.registrationPrefix);name.append(new ndn.Name(prefix));var interest=new ndn.Interest(name);this.interfaces.Faces[faceID].send(interest.wireEncode().buffer);return this};Forwarder.prototype.unregisterPrefix=function(prefix,faceID){var name=new ndn.Name("marx/fib/remove-nexthop");name.append(new ndn.Name(prefix));var interest=new ndn.Interest(name);this.interfaces.Faces[faceID].send(interest.wireEncode().buffer);return this};module.exports=Forwarder},{"./Manager.js":51,"./node/ConnectionListeners.js":52,"./node/addConnection.js":54,"./node/createSuffix.js":55,debug:57,"ndn-js-contrib":72,os:22}],51:[function(require,module,exports){module.exports=function(Forwarder){Forwarder.addListener("marx/fib/add-nexthop",function(interest,faceID){console.log("got add-nexthop");var prefix=interest.name.getSubName(3).toUri();Forwarder.fib.lookup(prefix).addNextHop({faceID:faceID});Forwarder.interfaces.Faces[faceID].prefixes=Forwarder.interfaces.Faces[faceID].prefixes||[];Forwarder.interfaces.Faces[faceID].prefixes.push(prefix)}).addListener("marx/fib/remove-nexthop",function(interest,faceID){var prefix=interest.name.getSubName(3).toUri();Forwarder.fib.lookup(prefix).removeNextHop({faceID:faceID})}).addListener("marx",function(interest,faceID){console.log("logging blocked Interest on /marx namespace, ",interest.toUri())})}},{}],52:[function(require,module,exports){var RTCPeerConnection=require("./adapter/adapter.js"),debug={};debug.debug=require("debug")("ConnectionListeners");module.exports=function(Forwarder){var ndn=Forwarder.ndn;Forwarder.prototype.addConnectionListener=function(prefix,max,onNewFace,onFaceClose){var Self=this;var current=0;Self.connectionLabels=Self.connectionLabels||[];return Self.addListener({connection:true,prefix:prefix},function(interest,faceID,unblock){if(current<max){current++;var json,d=new Self.ndn.Data;try{d.wireDecode(interest.name.get(-1).getValueAsBuffer());if(d.name.toUri()==="/connectionRequest"){json=JSON.parse(d.content.toString());if(json.ws){Self.addConnection("ws://"+json.domain+":"+json.ws.port,function(faceID){Self.addRegisteredPrefix(prefix,faceID);onNewFace(null,faceID)},function(id){current--;if(onFaceClose){onFaceClose(id)}})}else if(json.candidates&&json.config){var alreadyConnected=false;for(var i=0;i<json.labels.length;i++){for(var j=0;j<Self.connectionLabels.length;j++){if(json.labels[i]===Self.connectionLabels.length){alreadyConnected=true;break}}if(alreadyConnected){break}}if(alreadyConnected){unblock()}else{var answer={};answer.candidates=[];var answerMade=false;var channel;var pc=new RTCPeerConnection(json.config,{optional:[{RTPDataChannels:true}]});pc.ondatachannel=function(evt){Self.connectionLabels.push(evt.channel.label);Self.addConnection(evt.channel,function(id){Self.addRegisteredPrefix(prefix,id);onNewFace(null,id)},function(id){if(onFaceClose){onFaceClose(id)}current--})};var createResponse=function(){var d=new ndn.Data(new ndn.Name(interest.name),new ndn.SignedInfo,JSON.stringify(answer));console.log("made data");d.signedInfo.setFields();d.sign();console.log("signed data");var element=d.wireEncode().buffer;return element};pc.onicecandidate=function(evt){if(answer.candidates.length>0&&answerMade===false){answerMade=true;var response=createResponse();Self.interfaces.dispatch(response,0|1<<faceID)}else if(evt.candidate&&evt.candidate.sdpMid==="data"){answer.candidates.push(evt.candidate)}};pc.setRemoteDescription(new RTCSessionDescription(json.sdp));for(var k=0;k<json.candidates.length;k++){pc.addIceCandidate(new RTCIceCandidate(json.candidates[k]))}pc.createAnswer(function(description){answer.sdp=description;pc.setLocalDescription(description)})}}else{unblock()}}else{unblock()}}catch(e){unblock()}return}else{console.log("max connections for this listener");unblock()}})}}},{"./adapter/adapter.js":53,debug:57}],53:[function(require,module,exports){"use strict";var RTCPeerConnection=null;var getUserMedia=null;var attachMediaStream=null;var reattachMediaStream=null;var webrtcDetectedBrowser=null;var webrtcDetectedVersion=null;function trace(text){if(text[text.length-1]==="\n"){text=text.substring(0,text.length-1)}console.log((window.performance.now()/1e3).toFixed(3)+": "+text)}function maybeFixConfiguration(pcConfig){if(!pcConfig){return}for(var i=0;i<pcConfig.iceServers.length;i++){if(pcConfig.iceServers[i].hasOwnProperty("urls")){pcConfig.iceServers[i].url=pcConfig.iceServers[i].urls;delete pcConfig.iceServers[i].urls}}}if(navigator.mozGetUserMedia){console.log("This appears to be Firefox");webrtcDetectedBrowser="firefox";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);RTCPeerConnection=function(pcConfig,pcConstraints){maybeFixConfiguration(pcConfig);return new mozRTCPeerConnection(pcConfig,pcConstraints)};window.RTCSessionDescription=mozRTCSessionDescription;window.RTCIceCandidate=mozRTCIceCandidate;getUserMedia=navigator.mozGetUserMedia.bind(navigator);navigator.getUserMedia=getUserMedia;window.createIceServer=function(url,username,password){var iceServer=null;var urlParts=url.split(":");if(urlParts[0].indexOf("stun")===0){iceServer={url:url}}else if(urlParts[0].indexOf("turn")===0){if(webrtcDetectedVersion<27){var turnUrlParts=url.split("?");if(turnUrlParts.length===1||turnUrlParts[1].indexOf("transport=udp")===0){iceServer={url:turnUrlParts[0],credential:password,username:username}}}else{iceServer={url:url,credential:password,username:username}}}return iceServer};window.createIceServers=function(urls,username,password){var iceServers=[];for(var i=0;i<urls.length;i++){var iceServer=window.createIceServer(urls[i],username,password);if(iceServer!==null){iceServers.push(iceServer)}}return iceServers};attachMediaStream=function(element,stream){console.log("Attaching media stream");element.mozSrcObject=stream};reattachMediaStream=function(to,from){console.log("Reattaching media stream");to.mozSrcObject=from.mozSrcObject}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome");webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(result!==null){webrtcDetectedVersion=parseInt(result[2],10)}else{webrtcDetectedVersion=999}window.createIceServer=function(url,username,password){var iceServer=null;var urlParts=url.split(":");if(urlParts[0].indexOf("stun")===0){iceServer={url:url}}else if(urlParts[0].indexOf("turn")===0){iceServer={url:url,credential:password,username:username}}return iceServer};window.createIceServers=function(urls,username,password){var iceServers=[];if(webrtcDetectedVersion>=34){iceServers={urls:urls,credential:password,username:username}}else{for(var i=0;i<urls.length;i++){var iceServer=window.createIceServer(urls[i],username,password);if(iceServer!==null){iceServers.push(iceServer)}}}return iceServers};RTCPeerConnection=function(pcConfig,pcConstraints){if(webrtcDetectedVersion<34){maybeFixConfiguration(pcConfig)}return new webkitRTCPeerConnection(pcConfig,pcConstraints)};getUserMedia=navigator.webkitGetUserMedia.bind(navigator);navigator.getUserMedia=getUserMedia;attachMediaStream=function(element,stream){if(typeof element.srcObject!=="undefined"){element.srcObject=stream}else if(typeof element.mozSrcObject!=="undefined"){element.mozSrcObject=stream}else if(typeof element.src!=="undefined"){element.src=URL.createObjectURL(stream)}else{console.log("Error attaching stream to element.")}};reattachMediaStream=function(to,from){to.src=from.src}}else{console.log("Browser does not appear to be WebRTC-capable")}module.exports=RTCPeerConnection},{}],54:[function(require,module,exports){module.exports=function(Forwarder){Forwarder.prototype.addConnection=addConnection};function addConnection(objectOrURL,onOpen,onClosed){var id;console.log("addConnection ",objectOrURL);this.connectionCount=this.connectionCount||0;if(!this.maxConnections||this.interfaces.Faces.length<this.maxConnections){if(typeof objectOrURL==="string"){var url=objectOrURL;var protocol=url.split("://")[0];console.log(this);if(protocol==="ws"){this.connectionCount++;id=this.interfaces.newFace("WebSocketTransport",{host:url.split("://")[1].split(":")[0],port:url.split("://")[1].split(":")[1]||8585},onOpen,onClosed)}}else if(objectOrURL instanceof MessagePort){this.connectionCount++;id=this.interfaces.newFace("MessageChannelTransport",objectOrURL,onOpen,onClosed)}else if(objectOrURL.binaryType&&objectOrURL.readyState&&objectOrURL.label){this.connectionCount++;console.log("dataChanneltransport ducktype");id=this.interfaces.newFace("DataChannelTransport",objectOrURL,onOpen,onClosed)}}else{console.log("maximum connections reached")}return this}},{}],55:[function(require,module,exports){var RTCPeerConnection=require("./adapter/adapter.js"),debug={};debug.debug=require("debug")("RTCConnectionListener");module.exports=function(Forwarder){Forwarder.prototype.createConnectionRequestSuffix=createXSuffix};function createXSuffix(suffixCallback,connectionInfoCallback){var forwarder=this,suffixMade=false;var ndn=forwarder.ndn;forwarder.connectionLabels=forwarder.connectionLabels||[];var config={iceServers:this.remoteInfo.iceServers};var pc=new RTCPeerConnection(config,{optional:[{RTPDataChannels:true}]});var offer={};offer.candidates=[];offer.labels=forwarder.connectionLabels;function createSuffix(){offer.config=config;var string=JSON.stringify(offer);var d=new ndn.Data(new ndn.Name("connectionRequest"),new ndn.SignedInfo,string);d.signedInfo.setFields();d.sign();var enc=d.wireEncode();var suffix=new ndn.Name.Component(enc.buffer);return suffix}var datachannel=pc.createDataChannel(Math.random(),{reliable:false});datachannel.onopen=function(ev){forwarder.connectionLabels.push(datachannel.label);connectionInfoCallback(datachannel)};var onAnswer=function(answer){var sdp=new RTCSessionDescription(answer.sdp);pc.setRemoteDescription(sdp);for(var i=0;i<answer.candidates.length;i++){var candidate=new RTCIceCandidate(answer.candidates[i]);pc.addIceCandidate(candidate)}};pc.onicecandidate=function(evt){console.log("ICECAndidate",evt,offer,suffixMade);if(offer.candidates.length>1&&suffixMade===false){suffixMade=true;var suffix=createSuffix();console.log("executing suffix callback");suffixCallback(suffix,onAnswer)}else if(evt.candidate&&evt.candidate.sdpMid==="data"&&suffixMade===false){offer.candidates.push(evt.candidate)}};var constraints={optional:[],mandatory:{OfferToReceiveVideo:false}};pc.createOffer(function(description){pc.setLocalDescription(description,function(){console.log("description set")},function(er){console.log(er)});offer.sdp=description},null,constraints)}},{"./adapter/adapter.js":53,debug:57}],56:[function(require,module,exports){module.exports=require("./dist/src/Forwarder.js")},{"./dist/src/Forwarder.js":50}],57:[function(require,module,exports){module.exports=require(47)},{"./debug":58}],58:[function(require,module,exports){module.exports=require(48)},{ms:59}],59:[function(require,module,exports){module.exports=require(49)},{}],60:[function(require,module,exports){(function(Buffer){var debug={};debug.debug=require("debug")("ContentStore");var lru=require("lru-cache");var lruDebug=require("debug")("lru");var Cache;Buffer.prototype.checkMonkey=function(){};function pubKeyMatch(ar1,ar2){if(!ar1){return true}for(var i=0;i<ar1.length;i++){if(ar1[i]!==ar2[i]){return false}}return true}function csEntry(element,data){var freshnessPeriod=data.getMetaInfo().getFreshnessPeriod();this.name=data.name;this.freshnessPeriod=freshnessPeriod;this.uri=data.name.toUri();this.publisherPublicKeyDigest=data.signedInfo.publisher.publisherPublicKeyDigest;Cache.set(data.name.toUri(),{entry:this,element:element});return this}csEntry.type="csEntry";csEntry.prototype.getElement=function(callback){callback=callback||function(e){return e};return callback(Cache.get(this.uri).element)};csEntry.prototype.stale=function(node){node.csEntry=null;if(Cache.has(this.uri)){Cache.del(this.uri)}return this};var ContentStore=function ContentStore(nameTree,entryClass,maxMem){entryClass=entryClass||csEntry;if(entryClass.type==="csEntry"){Cache=lru({max:maxMem||1e8,length:function(n){return n.element.length},dispose:function(key,value){lruDebug("evicting");delete value.entry.nameTreeNode.csEntry}})}this.nameTree=nameTree;this.EntryClass=entryClass;return this};ContentStore.prototype.check=function(interest,callback,node,suffixCount,childTracker,stack){callback=callback||function(element){return element};node=node||this.nameTree.lookup(interest.name);stack=stack||1;stack++;if(stack++>Object.keys(this.nameTree).length*2){return callback(null)}var self=this;if(node[this.EntryClass.type]&&interest.matchesName(node[this.EntryClass.type].name)&&pubKeyMatch(interest.publisherPublicKeyDigest,node[this.EntryClass.type].publisherPublicKeyDigest)){return node[this.EntryClass.type].getElement(callback)}suffixCount=suffixCount||0;childTracker=childTracker||[];var maxSuffix=interest.getMaxSuffixComponents(),minSuffix=interest.getMinSuffixComponents(),childSelector=interest.getChildSelector(),atMaxSuffix=maxSuffix&&suffixCount===maxSuffix,hasChildren=node.children.length>0;function hasMoreSiblings(node){var bool=!!childTracker.length&&!!node.parent&&node.parent.children.length>childTracker[childTracker.length-1]+1;return bool}function toChild(node){suffixCount++;childTracker.push(0);if(!childSelector){return self.check(interest,callback,node.children[0],suffixCount,childTracker,stack++)}else{return self.check(interest,callback,node.children[node.children.length-1],suffixCount,childTracker,stack++)}}function toSibling(node){childTracker[childTracker.length-1]++;if(!childSelector){return self.check(interest,callback,node.parent.children[childTracker[childTracker.length-1]],suffixCount,childTracker,stack++)}else{return self.check(interest,callback,node.parent.children[node.parent.children.length+~childTracker[childTracker.length-1]],suffixCount,childTracker,stack++)}}function toAncestorSibling(node,stack){suffixCount--;childTracker.pop();if(stack++>1e4){return callback(null)}var hasParentSibling=node.parent&&node.parent.parent&&node.parent.parent.children.length>childTracker[childTracker.length-1]+1;if(hasParentSibling){return toSibling(node.parent)}else if(childTracker.length>0){return toAncestorSibling(node.parent,stack++)}else{return callback(null)}}if(childTracker.length===1){if(interest.exclude.matches(node.prefix.get(-1))){if(hasMoreSiblings(node)){return toSibling(node)}else{return callback(null)}}}if(!node.prefix.size()||!atMaxSuffix&&hasChildren){return toChild(node)}else if(hasMoreSiblings(node)){return toSibling(node)}else if(childTracker.length>1){return toAncestorSibling(node)}else{return callback(null)}};ContentStore.prototype.insert=function(element,data){var Entry=this.EntryClass;var freshness=data.getMetaInfo().getFreshnessPeriod();var node=this.nameTree.lookup(data.name),entry=new Entry(element,data);node[Entry.type]=entry;node[Entry.type].nameTreeNode=node;setTimeout(function(){if(node[Entry.type]){node[Entry.type].stale(node)}},freshness||20);return this};module.exports=ContentStore}).call(this,require("buffer").Buffer)},{buffer:3,debug:57,"lru-cache":117}],61:[function(require,module,exports){var binarySearch=require("./../Utility/binarySearch.js"),ndn,debug={};debug.debug=require("debug")("FIB");function FibEntry(prefix,nextHops){this.prefix=typeof prefix==="string"?new ndn.Name(prefix):prefix;this.nextHops=function(){var hops=[];function recurse(){if(nextHops&&nextHops.length>0){var hop;if(typeof nextHops[0].faceID!=="undefined"){hop=nextHops.shift()}else{hop={faceID:nextHops.shift()}}var i=binarySearch(hops,hop,"faceID");if(i<0){hops.splice(~i,0,hop)}return recurse()}else{return hops}}return recurse()}();return this}FibEntry.type="FibEntry";FibEntry.prototype.getNextHops=function(excludingFaceID){var returns;if(excludingFaceID!==undefined){var q={faceID:excludingFaceID},i=binarySearch(this.nextHops,q,"faceID");if(i>=0){returns=this.nextHops.slice(0,i).concat(this.nextHops.slice(i+1))}else{returns=this.nextHops}}else{returns=this.nextHops}return returns};FibEntry.prototype.removeNextHop=function(nextHop){var i=binarySearch(this.nextHops,nextHop,"faceID");if(i<0){return this}else{this.nextHops.splice(i,1);return this}};FibEntry.prototype.addNextHop=function(nextHop){var i=binarySearch(this.nextHops,nextHop,"faceID");if(i<0){this.nextHops.splice(~i,0,nextHop);return this}else{this.nextHops.splice(i,1,nextHop);return this}};function FIB(nameTree){this.nameTree=nameTree;return this}FIB.installNDN=function(NDN){ndn=NDN;return this};FIB.prototype.lookup=function(prefix){prefix=typeof prefix==="string"?new ndn.Name(prefix):prefix;var ent=this.nameTree.lookup(prefix),entry=ent.fibEntry;if(entry){return entry}else{return ent.fibEntry=new FibEntry({prefix:prefix,nextHops:[]})}};FIB.prototype.findAllFibEntries=function(prefix){var inner=this.nameTree.findAllMatches(prefix,function(match){if(match.fibEntry&&match.fibEntry.nextHops.length>0){return true}else{return false}}),iterouter={hasNext:inner.hasNext,next:function(){if(inner.hasNext){var next=inner.next();if(inner.hasNext){this.hasNext=true}else{this.hasNext=false}return next.fibEntry}else{return null}}};return iterouter};FIB.prototype.findAllNextHops=function(prefix,excludingFaceID){prefix=typeof prefix==="string"?new ndn.Name(prefix):prefix;var faceFlag=0,iterator=this.findAllFibEntries(prefix);while(iterator.hasNext){var entry=iterator.next(),nextHops=entry.getNextHops(excludingFaceID);for(var i=0;i<nextHops.length;i++){faceFlag=faceFlag|1<<nextHops[i].faceID}}return faceFlag};FIB.prototype.addEntry=function(prefix,nextHops){var fibEntry;if(typeof nextHops==="number"||typeof nextHops==="object"&&nextHops.faceID){fibEntry=new FibEntry(prefix,[nextHops])}else{fibEntry=new FibEntry(prefix,nextHops)}var node=this.nameTree.lookup(fibEntry.prefix);if(!node.fibEntry){node.fibEntry=fibEntry;return this}else{for(var i=0;i<fibEntry.nextHops.length;i++){var j=binarySearch(node.fibEntry.nextHops,fibEntry.nextHops[i],"faceID");if(j<0){node.fibEntry.nextHops.splice(~j,0,fibEntry.nextHops[i])}}return this}};FIB.Entry=FibEntry;module.exports=FIB},{"./../Utility/binarySearch.js":71,debug:57}],62:[function(require,module,exports){var ndn,Face,debug={},ndn=require("ndn-js"),TlvDecoder=require("ndn-js/js/encoding/tlv/tlv-decoder.js").TlvDecoder,Tlv=require("ndn-js/js/encoding/tlv/tlv.js").Tlv;debug.debug=require("debug")("Interfaces");var Interfaces=function Interfaces(Subject){this.subject=Subject;this.transports={};Face=ndn.Face;this.Faces=[];return this};Interfaces.installNDN=function(NDN){ndn=NDN;return this};Interfaces.prototype.transports={};Interfaces.prototype.installTransport=function(Transport){this.transports[Transport.prototype.name]=Transport;if(Transport.Listener){Transport.Listener(this)}return this};Interfaces.prototype.newFace=function(protocol,connectionParameters,onopen,onclose){var Self=this;if(!this.transports[protocol]){return-1}else{var Transport=new this.transports[protocol](connectionParameters),newFace=new ndn.Face(Transport,Transport.connectionInfo);this.Faces.push(newFace);newFace.faceID=this.Faces.length-1;var connectionInfo;if(protocol==="WebSocketTransport"){connectionInfo=new this.transports[protocol].ConnectionInfo(connectionParameters.host,connectionParameters.port)}else{connectionInfo=newFace.connectionInfo||Transport.connectionInfo||new this.transports[protocol].ConnectionInfo(Transport.socket)}if(onclose){newFace.onclose=onclose}newFace.transport.connect(connectionInfo,newFace,function(){newFace.onReceivedElement=function(element){var decoder=new TlvDecoder(element);if(decoder.peekType(Tlv.Interest,element.length)){Self.subject.handleInterest(element,this.faceID)}else if(decoder.peekType(Tlv.Data,element.length)){Self.subject.handleData(element,this.faceID)}};newFace.send=function(element){this.transport.send(element)};if(onopen){onopen(newFace.faceID)}},function(){if(onclose){onclose(newFace.faceID)}});return newFace.faceID}};Interfaces.prototype.closeFace=function(){};Interfaces.prototype.dispatch=function(element,faceFlag,callback){if(faceFlag){for(var i=0;i<faceFlag.toString(2).length;i++){if(faceFlag&1<<i){if(this.Faces[i]){try{this.Faces[i].transport.send(element)}catch(e){console.log("Face dispatch err catch")}}if(callback){callback(i)}}}}return this};module.exports=Interfaces},{debug:57,"ndn-js":127,"ndn-js/js/encoding/tlv/tlv-decoder.js":144,"ndn-js/js/encoding/tlv/tlv.js":147}],63:[function(require,module,exports){var NameTreeNode=require("./NameTreeNode.js"),binaryIndexOf=require("./../Utility/binarySearch.js"),ndn;var NameTree=function NameTree(){this.addNode("/");return this};NameTree.Node=NameTreeNode;NameTree.installNDN=function(NDN){NameTree.Node.installNDN(NDN);ndn=NDN;return this};NameTree.prototype.addNode=function(prefix){if(typeof prefix==="string"){prefix=new ndn.Name(prefix)}var self=this[prefix.toUri()];if(self){return self}else{self=this[prefix.toUri()]=new NameTree.Node(prefix);while(prefix.size()>0){var parentPrefix=prefix.getPrefix(-1);if(!this[parentPrefix.toUri()]){this[parentPrefix.toUri()]=new NameTree.Node(parentPrefix)}this[prefix.toUri()].parent=this[parentPrefix.toUri()];this[parentPrefix.toUri()].addChild(this[prefix.toUri()]);prefix=parentPrefix}}return self};NameTree.prototype.removeNode=function(prefix,cycleFinish){if(typeof prefix==="string"){prefix=new ndn.Name(prefix)}cycleFinish=cycleFinish||prefix;var self=this[prefix.toUri()];if(!self){return this}else{var child=self.children.shift();if(child!==undefined){return this.removeNode(child.prefix,cycleFinish)}else{delete this[self.prefix.toUri()];if(cycleFinish.equals(prefix)){self.parent.removeChild(self);return this}else{return this.removeNode(prefix.getPrefix(-1),cycleFinish)}}}};NameTree.prototype.lookup=function(prefix){if(typeof prefix==="string"){prefix=new ndn.Name(prefix)}var node=this[prefix.toUri()];if(node){return node}else{return this.addNode(prefix)}};NameTree.prototype.findLongestPrefixMatch=function(prefix,selector){if(typeof prefix==="string"){prefix=new ndn.Name(prefix)}selector=selector||function(){return true};var match=this[prefix.toUri()];if(match&&selector(match)){return match}else if(prefix.size()>0){return this.findLongestPrefixMatch(prefix.getPrefix(-1),selector)}else{return null}};NameTree.prototype.findAllMatches=function(prefix,selector){if(typeof prefix==="string"){prefix=new ndn.Name(prefix)}selector=selector||function(){return true};var self=this,nextReturn=self[prefix.toUri()],thisReturn,iterator={next:function(){if(!this.hasNext){return null}prefix=nextReturn.prefix;thisReturn=nextReturn;nextReturn=thisReturn&&thisReturn.parent&&selector(thisReturn.parent)?thisReturn.parent:prefix.size()>0?self.findLongestPrefixMatch(prefix.getPrefix(-1),selector):null;if(!nextReturn){this.hasNext=false}else{this.hasNext=true}return thisReturn}};if(nextReturn&&selector(nextReturn)){iterator.hasNext=true;return iterator}else if(prefix.size()>0){return this.findAllMatches(prefix.getPrefix(-1),selector)}else{iterator.hasNext=false;return iterator}};module.exports=NameTree},{"./../Utility/binarySearch.js":71,"./NameTreeNode.js":64}],64:[function(require,module,exports){var binarySearch=require("./../Utility/binarySearch.js"),ndn;var NameTreeNode=function NameTreeNode(prefix){this.prefix=typeof prefix==="string"?new ndn.Name(prefix):prefix||null;this.parent=null;this.children=[];this.fibEntry=null;this.pitEntries=[];this.measurements=null;this.strategy=null;return this};NameTreeNode.installNDN=function(NDN){ndn=NDN;return this};NameTreeNode.prototype.addChild=function addChild(child){var self=this,index=binarySearch(this.children,child.prefix.get(-1),"prefix");child=child.prefix?child:new NameTreeNode(new ndn.Name(self.prefix).append(child));if(index<0){this.children.splice(~index,0,child)}return this};NameTreeNode.prototype.removeChild=function(child){child=typeof child==="string"?{prefix:new ndn.Name(child)}:child;var index=binarySearch(this.children,child.prefix.get(-1),"prefix");if(index<0){return this}else{this.children.splice(index,1);return this}};module.exports=NameTreeNode},{"./../Utility/binarySearch.js":71}],65:[function(require,module,exports){var binarySearch=require("./../Utility/binarySearch.js"),ndn,debug={};debug.debug=require("debug")("PIT");function pubKeyMatch(ar1,ar2){if(!ar1){return true}for(var i=0;i<ar1.length;i++){if(ar1[i]!==ar2[i]){return false}}return true}function PitEntry(element,interest,faceIDorCallback){if(typeof interest!=="object"){faceIDorCallback=interest;interest=new ndn.Interest;interest.wireDecode(element)}if(!interest.nonce){interest.wireDecode(element)}this.nonce=interest.nonce;this.uri=interest.name.toUri();this.interest=interest;this.element=element;if(typeof faceIDorCallback==="function"){this.callback=faceIDorCallback}else{this.faceID=faceIDorCallback}return this}PitEntry.prototype.matches=function(data){if(this.interest.matchesName(data.name)&&pubKeyMatch(this.interest.publisherPublicKeyDigest,data.signedInfo.publisher.publisherPublicKeyDigest)){return true}else{return false}};PitEntry.prototype.consume=function(callbackCalled){if(this.nameTreeNode){var i=binarySearch(this.nameTreeNode.pitEntries,this,"nonce");if(i>=0){var removed=this.nameTreeNode.pitEntries.splice(~i,1)[0];if(removed.callback&&!callbackCalled){removed.callback(null,removed.interest)}}}return this};var PIT=function PIT(nameTree){this.nameTree=nameTree;return this};PIT.installNDN=function(NDN){ndn=NDN;return this};PIT.Entry=PitEntry;PIT.prototype.useNameTree=function(nameTree){this.nameTree=nameTree;return this};PIT.prototype.insertPitEntry=function(element,interest,faceIDorCallback){var pitEntry=new PIT.Entry(element,interest,faceIDorCallback);setTimeout(function(){pitEntry.consume()},pitEntry.interest.getInterestLifetimeMilliseconds()||10);var node=this.nameTree.lookup(pitEntry.interest.name);var i=binarySearch(node.pitEntries,pitEntry,"nonce");if(i<0){pitEntry.nameTreeNode=node;node.pitEntries.splice(~i,0,pitEntry)}return this};PIT.prototype.checkDuplicate=function(interest){var node=this.nameTree.lookup(interest.name);var i=binarySearch(node.pitEntries,interest,"nonce");if(i<0){return false}else{return true}};PIT.prototype.lookup=function(data,name,matches,faceFlag){name=name||data.name;matches=matches||[];faceFlag=faceFlag||0;var pitEntries=this.nameTree.lookup(name).pitEntries;for(var i=0;i<pitEntries.length;i++){if(pitEntries[i].matches(data)){matches.push(pitEntries[i]);if(pitEntries[i].faceID!==(null||undefined)){faceFlag=faceFlag|1<<pitEntries[i].faceID}}}if(name.size()>0){return this.lookup(data,name.getPrefix(-1),matches,faceFlag)}else{return{pitEntries:matches,faces:faceFlag}}};module.exports=PIT},{"./../Utility/binarySearch.js":71,debug:57}],66:[function(require,module,exports){(function(process,Buffer){var leveldown=require("leveldown"),levelup=require("levelup"),path=(process.env.HOME||process.env.USERPROFILE||process.env.HOMEPATH||"")+"/.NDN-Repo",ndn;var debug=true;function Repository(index,policy,onopen){Repository;var self=this;this.index=index;this.nameTree=index.nameTree;this.ndn=index.ndn;this.db=levelup(policy.path||path,{db:leveldown,valueEncoding:"json"},function(){self.populateNameTree(onopen)});return this}Repository.installNDN=function(NDN){ndn=NDN;return this};Repository.prototype.getElement=function(repoEntry,callback){this.db.get(repoEntry.uri,function(err,data){if(!err&&!Buffer.isBuffer(data)){console.log("got element",data,err);data=new Buffer(data)}callback(err,data)});return this};Repository.prototype.insert=function(element,data,callback){var db=this.db,self=this;callback=callback||function(){};if(typeof data=="function"){callback=data;data=new ndn.Data;data.wireDecode(element)}db.put(data.name.toUri(),element,function(err){self.index.insert(element,data);callback(err)});return this};Repository.prototype.populateNameTree=function(callback){var self=this,db=self.db;callback=callback||function(){return};db.createKeyStream().on("data",function(key){self.index.insert(null,new ndn.Data(new ndn.Name(key)))}).on("error",function(err){callback(err)}).on("close",function(){self.spun=true;callback()})};Repository.prototype.check=function(interest,callback,db){db=db||this;if(!db.spun){setTimeout(db.check,200,interest,callback,db)}else{db.index.check(interest,callback)}return this};module.exports=Repository}).call(this,require("_process"),require("buffer").Buffer)},{_process:24,buffer:3,leveldown:73,levelup:93}],67:[function(require,module,exports){function repoEntry(element,data){var self=this;var freshnessPeriod=data.getMetaInfo?data.getMetaInfo().getFreshnessPeriod():null;this.name=data.name;this.uri=data.name.toUri();this.freshnessPeriod=freshnessPeriod;this.publisherPublicKeyDigest=data.signedInfo?data.signedInfo.publisher.publisherPublicKeyDigest:undefined;if(freshnessPeriod){this.element=element;setTimeout(function(){delete self.element},freshnessPeriod)}return this}repoEntry.installDatabase=function(db){repoEntry.database=db};repoEntry.type="repoEntry";repoEntry.prototype.getElement=function(callback){if(this.element){callback(this.element)}else{repoEntry.database.getElement(this,callback)}};repoEntry.prototype.setElement=function(element){if(this.freshnessPeriod){this.element=element;setTimeout(function(){delete this.element},this.freshnessPeriod)}return this};repoEntry.prototype.stale=function(node){if(node.repoEntry===this&&node.repoEntry.element){delete node.repoEntry.element}return this};module.exports=repoEntry
},{}],68:[function(require,module,exports){(function(Buffer){var ElementReader=require("ndn-lib/js/encoding/element-reader.js").ElementReader;var Transport=require("ndn-lib/js/transport/transport.js").Transport;var debug={};debug.debug=require("debug")("MessageChannelTransport");function MessageChannelTransport(port){Transport.call(this);this.connectionInfo=new MessageChannelTransport.ConnectionInfo(port);return this}MessageChannelTransport.prototype=new Transport;MessageChannelTransport.prototype.name="MessageChannelTransport";MessageChannelTransport.ConnectionInfo=function MessageChannelTransportConnectionInfo(port){Transport.ConnectionInfo.call(this);this.port=port};MessageChannelTransport.ConnectionInfo.prototype=new Transport.ConnectionInfo;MessageChannelTransport.ConnectionInfo.prototype.name="MessageChannelTransport.ConnectionInfo";MessageChannelTransport.ConnectionInfo.prototype.getPort=function(){return this.port};MessageChannelTransport.ConnectionInfo.prototype.equals=function(other){if(other===null||other.port===undefined){return false}return this.port===other.port};MessageChannelTransport.prototype.connect=function(connectionInfo,elementListener,onopenCallback,onclosedCallback){this.elementReader=new ElementReader(elementListener);var self=this;connectionInfo.getPort().onmessage=function(ev){if(ev.data.buffer instanceof ArrayBuffer){try{self.elementReader.onReceivedData(new Buffer(ev.data))}catch(ex){return}}};onopenCallback()};MessageChannelTransport.prototype.send=function(element){this.connectionInfo.getPort().postMessage(element)};module.exports=MessageChannelTransport}).call(this,require("buffer").Buffer)},{buffer:3,debug:57,"ndn-lib/js/encoding/element-reader.js":507,"ndn-lib/js/transport/transport.js":512}],69:[function(require,module,exports){(function(Buffer){var ElementReader=require("ndn-lib/js/encoding/element-reader.js").ElementReader;var Transport=require("ndn-lib/js/transport/transport.js").Transport;var debug={};debug.debug=require("debug")("DataChannelTransport");function DataChannelTransport(channel){Transport.call(this);this.connectionInfo=new DataChannelTransport.ConnectionInfo(channel);return this}DataChannelTransport.prototype=new Transport;DataChannelTransport.prototype.name="DataChannelTransport";DataChannelTransport.ConnectionInfo=function DataChannelTransportConnectionInfo(channel){Transport.ConnectionInfo.call(this);channel.binaryType="arraybuffer";this.channel=channel};DataChannelTransport.ConnectionInfo.prototype=new Transport.ConnectionInfo;DataChannelTransport.ConnectionInfo.prototype.name="DataChannelTransport.ConnectionInfo";DataChannelTransport.ConnectionInfo.prototype.getChannel=function(){return this.channel};DataChannelTransport.ConnectionInfo.prototype.equals=function(other){if(other===null||other.port===undefined){return false}return this.port===other.port};DataChannelTransport.prototype.connect=function(connectionInfo,elementListener,onopenCallback,onclosedCallback){this.elementReader=new ElementReader(elementListener);var self=this;connectionInfo.getChannel().onmessage=function(ev){if(ev.data instanceof ArrayBuffer){var result=ev.data;var bytearray=new Buffer(new Uint8Array(result));try{self.elementReader.onReceivedData(bytearray)}catch(ex){cdebug("onmessage exception: ",ex);return}}};connectionInfo.getChannel().onopen=function(ev){onopenCallback()};connectionInfo.getChannel().onerror=function(ev){};connectionInfo.getChannel().onclose=function(ev){self.dc=null;self.face.readyStatus=3;self.face.closeByTransport();onclosedCallback()};if(connectionInfo.getChannel().readyState==="open"){onopenCallback()}};DataChannelTransport.prototype.send=function(element){if(this.connectionInfo.getChannel().readyState==="open"){this.connectionInfo.getChannel().send(element.toArrayBuffer())}else{}};module.exports=DataChannelTransport}).call(this,require("buffer").Buffer)},{buffer:3,debug:57,"ndn-lib/js/encoding/element-reader.js":507,"ndn-lib/js/transport/transport.js":512}],70:[function(require,module,exports){exports.MessageChannel=require("./MessageChannel.js");exports.WebRTCDataChannel=require("./WebRTCDataChannel.js");exports.WebSocketTransport=require("ndn-js").TcpTransport;module.exports=exports},{"./MessageChannel.js":68,"./WebRTCDataChannel.js":69,"ndn-js":127}],71:[function(require,module,exports){function compareArrays(query,comparator,i){if(!(i>=0))i=-1;if(i>=0||query.length==comparator.length){i++;if(comparator[i]>query[i]){return 1}else if(comparator[i]<query[i]){return-1}else if(query[i]==comparator[i]){if(i<query.length-1)return compareArrays(query,comparator,i);else return 0}}else if(comparator.length>query.length){return 1}else if(comparator.length<query.length){return-1}}var binaryIndexOfPrefix=function(array,searchElement,prop){"use strict";if(array.length==0){return-1}var minIndex=0;var maxIndex=array.length-1;var currentIndex;var currentElement;var resultIndex;var res;searchElement=prop=="prefix"?searchElement.getValue().buffer:prop=="nonce"?searchElement.nonce:prop=="faceID"?searchElement.faceID:searchElement;while(minIndex<=maxIndex){resultIndex=currentIndex=(minIndex+maxIndex)/2|0;currentElement=prop=="prefix"?array[currentIndex].prefix.get(-1).getValue().buffer:prop=="nonce"?array[currentIndex].nonce:prop=="faceID"?array[currentIndex].faceID:array[currentIndex];res=typeof searchElement!=="number"?compareArrays(searchElement,currentElement):function(){if(searchElement>currentElement)return-1;if(searchElement<currentElement)return 1;else return 0}();if(res==1){maxIndex=currentIndex-1}else if(res==-1){minIndex=currentIndex+1}else{return currentIndex}}return~(maxIndex+1)};module.exports=binaryIndexOfPrefix},{}],72:[function(require,module,exports){(function(Buffer){exports.ndn=require("ndn-js");exports.NameTree=require("./dist/src/DataStructures/NameTree.js").installNDN(exports.ndn);exports.PIT=require("./dist/src/DataStructures/PIT.js").installNDN(exports.ndn);exports.FIB=require("./dist/src/DataStructures/FIB.js").installNDN(exports.ndn);exports.ContentStore=require("./dist/src/DataStructures/ContentStore.js");exports.Interfaces=require("./dist/src/DataStructures/Interfaces.js").installNDN(exports.ndn);exports.Transports=require("./dist/src/Transports/node/export.js");exports.Repository=require("./dist/src/DataStructures/Repository.js").installNDN(exports.ndn);exports.Repository.RepoEntry=require("./dist/src/DataStructures/repoEntry.js");exports.Buffer=Buffer;module.exports=exports}).call(this,require("buffer").Buffer)},{"./dist/src/DataStructures/ContentStore.js":60,"./dist/src/DataStructures/FIB.js":61,"./dist/src/DataStructures/Interfaces.js":62,"./dist/src/DataStructures/NameTree.js":63,"./dist/src/DataStructures/PIT.js":65,"./dist/src/DataStructures/Repository.js":66,"./dist/src/DataStructures/repoEntry.js":67,"./dist/src/Transports/node/export.js":70,buffer:3,"ndn-js":127}],73:[function(require,module,exports){(function(Buffer){module.exports=Level;var IDB=require("idb-wrapper");var AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN;var util=require("util");var Iterator=require("./iterator");var isBuffer=require("isbuffer");var xtend=require("xtend");var toBuffer=require("typedarray-to-buffer");function Level(location){if(!(this instanceof Level))return new Level(location);if(!location)throw new Error("constructor requires at least a location argument");this.IDBOptions={};this.location=location}util.inherits(Level,AbstractLevelDOWN);Level.prototype._open=function(options,callback){var self=this;var idbOpts={storeName:this.location,autoIncrement:false,keyPath:null,onStoreReady:function(){callback&&callback(null,self.idb)},onError:function(err){callback&&callback(err)}};xtend(idbOpts,options);this.IDBOptions=idbOpts;this.idb=new IDB(idbOpts)};Level.prototype._get=function(key,options,callback){this.idb.get(key,function(value){if(value===undefined){return callback(new Error("NotFound"))}var asBuffer=true;if(options.asBuffer===false)asBuffer=false;if(options.raw)asBuffer=false;if(asBuffer){if(value instanceof Uint8Array)value=toBuffer(value);else value=new Buffer(String(value))}return callback(null,value,key)},callback)};Level.prototype._del=function(id,options,callback){this.idb.remove(id,callback,callback)};Level.prototype._put=function(key,value,options,callback){if(value instanceof ArrayBuffer){value=toBuffer(new Uint8Array(value))}var obj=this.convertEncoding(key,value,options);if(Buffer.isBuffer(obj.value)){obj.value=new Uint8Array(value.toArrayBuffer())}this.idb.put(obj.key,obj.value,function(){callback()},callback)};Level.prototype.convertEncoding=function(key,value,options){if(options.raw)return{key:key,value:value};if(value){var stringed=value.toString();if(stringed==="NaN")value="NaN"}var valEnc=options.valueEncoding;var obj={key:key,value:value};if(value&&(!valEnc||valEnc!=="binary")){if(typeof obj.value!=="object"){obj.value=stringed}}return obj};Level.prototype.iterator=function(options){if(typeof options!=="object")options={};return new Iterator(this.idb,options)};Level.prototype._batch=function(array,options,callback){var op;var i;var k;var copiedOp;var currentOp;var modified=[];if(array.length===0)return setTimeout(callback,0);for(i=0;i<array.length;i++){copiedOp={};currentOp=array[i];modified[i]=copiedOp;var converted=this.convertEncoding(currentOp.key,currentOp.value,options);currentOp.key=converted.key;currentOp.value=converted.value;for(k in currentOp){if(k==="type"&&currentOp[k]=="del"){copiedOp[k]="remove"}else{copiedOp[k]=currentOp[k]}}}return this.idb.batch(modified,function(){callback()},callback)};Level.prototype._close=function(callback){this.idb.db.close();callback()};Level.prototype._approximateSize=function(start,end,callback){var err=new Error("Not implemented");if(callback)return callback(err);throw err};Level.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};Level.destroy=function(db,callback){if(typeof db==="object"){var prefix=db.IDBOptions.storePrefix||"IDBWrapper-";var dbname=db.location}else{var prefix="IDBWrapper-";var dbname=db}var request=indexedDB.deleteDatabase(prefix+dbname);request.onsuccess=function(){callback()};request.onerror=function(err){callback(err)}};var checkKeyValue=Level.prototype._checkKeyValue=function(obj,type){if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(isBuffer(obj)&&obj.byteLength===0)return new Error(type+" cannot be an empty ArrayBuffer");if(String(obj)==="")return new Error(type+" cannot be an empty String");if(obj.length===0)return new Error(type+" cannot be an empty Array")}}).call(this,require("buffer").Buffer)},{"./iterator":74,"abstract-leveldown":77,buffer:3,"idb-wrapper":79,isbuffer:80,"typedarray-to-buffer":82,util:39,xtend:84}],74:[function(require,module,exports){var util=require("util");var AbstractIterator=require("abstract-leveldown").AbstractIterator;var ltgt=require("ltgt");module.exports=Iterator;function Iterator(db,options){if(!options)options={};this.options=options;AbstractIterator.call(this,db);this._order=options.reverse?"DESC":"ASC";this._limit=options.limit;this._count=0;this._done=false;var lower=ltgt.lowerBound(options);var upper=ltgt.upperBound(options);this._keyRange=lower||upper?this.db.makeKeyRange({lower:lower,upper:upper,excludeLower:ltgt.lowerBoundExclusive(options),excludeUpper:ltgt.upperBoundExclusive(options)}):null;this.callback=null}util.inherits(Iterator,AbstractIterator);Iterator.prototype.createIterator=function(){var self=this;self.iterator=self.db.iterate(function(){self.onItem.apply(self,arguments)},{keyRange:self._keyRange,autoContinue:false,order:self._order,onError:function(err){console.log("horrible error",err)}})};Iterator.prototype.onItem=function(value,cursor,cursorTransaction){if(!cursor&&this.callback){this.callback();this.callback=false;return}var shouldCall=true;if(!!this._limit&&this._limit>0&&this._count++>=this._limit)shouldCall=false;if(shouldCall)this.callback(false,cursor.key,cursor.value);if(cursor)cursor["continue"]()};Iterator.prototype._next=function(callback){if(!callback)return new Error("next() requires a callback argument");if(!this._started){this.createIterator();this._started=true}this.callback=callback}},{"abstract-leveldown":77,ltgt:81,util:39}],75:[function(require,module,exports){(function(process){function AbstractChainedBatch(db){this._db=db;this._operations=[];this._written=false}AbstractChainedBatch.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch.prototype.put=function(key,value){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;err=this._db._checkKeyValue(value,"value",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(!this._db._isBuffer(value))value=String(value);if(typeof this._put=="function")this._put(key,value);else this._operations.push({type:"put",key:key,value:value});return this};AbstractChainedBatch.prototype.del=function(key){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(typeof this._del=="function")this._del(key);else this._operations.push({type:"del",key:key});return this};AbstractChainedBatch.prototype.clear=function(){this._checkWritten();this._operations=[];if(typeof this._clear=="function")this._clear();return this};AbstractChainedBatch.prototype.write=function(options,callback){this._checkWritten();if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("write() requires a callback argument");if(typeof options!="object")options={};this._written=true;if(typeof this._write=="function")return this._write(callback);if(typeof this._db._batch=="function")return this._db._batch(this._operations,options,callback);process.nextTick(callback)};module.exports=AbstractChainedBatch}).call(this,require("_process"))},{_process:24}],76:[function(require,module,exports){(function(process){function AbstractIterator(db){this.db=db;this._ended=false;this._nexting=false}AbstractIterator.prototype.next=function(callback){var self=this;if(typeof callback!="function")throw new Error("next() requires a callback argument");if(self._ended)return callback(new Error("cannot call next() after end()"));if(self._nexting)return callback(new Error("cannot call next() before previous next() has completed"));self._nexting=true;if(typeof self._next=="function"){return self._next(function(){self._nexting=false;callback.apply(null,arguments)})}process.nextTick(function(){self._nexting=false;callback()})};AbstractIterator.prototype.end=function(callback){if(typeof callback!="function")throw new Error("end() requires a callback argument");if(this._ended)return callback(new Error("end() already called on iterator"));this._ended=true;if(typeof this._end=="function")return this._end(callback);process.nextTick(callback)};module.exports=AbstractIterator}).call(this,require("_process"))},{_process:24}],77:[function(require,module,exports){(function(process,Buffer){var xtend=require("xtend"),AbstractIterator=require("./abstract-iterator"),AbstractChainedBatch=require("./abstract-chained-batch");function AbstractLevelDOWN(location){if(!arguments.length||location===undefined)throw new Error("constructor requires at least a location argument");if(typeof location!="string")throw new Error("constructor requires a location string argument");this.location=location}AbstractLevelDOWN.prototype.open=function(options,callback){if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("open() requires a callback argument");if(typeof options!="object")options={};if(typeof this._open=="function")return this._open(options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.close=function(callback){if(typeof callback!="function")throw new Error("close() requires a callback argument");if(typeof this._close=="function")return this._close(callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.get=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("get() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._get=="function")return this._get(key,options,callback);process.nextTick(function(){callback(new Error("NotFound"))})};AbstractLevelDOWN.prototype.put=function(key,value,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("put() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(err=this._checkKeyValue(value,"value",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(!this._isBuffer(value)&&!process.browser)value=String(value);if(typeof options!="object")options={};if(typeof this._put=="function")return this._put(key,value,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.del=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("del() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._del=="function")return this._del(key,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.batch=function(array,options,callback){if(!arguments.length)return this._chainedBatch();if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(array))return callback(new Error("batch(array) requires an array argument"));if(typeof options!="object")options={};var i=0,l=array.length,e,err;for(;i<l;i++){e=array[i];if(typeof e!="object")continue;if(err=this._checkKeyValue(e.type,"type",this._isBuffer))return callback(err);if(err=this._checkKeyValue(e.key,"key",this._isBuffer))return callback(err);if(e.type=="put"){if(err=this._checkKeyValue(e.value,"value",this._isBuffer))return callback(err)}}if(typeof this._batch=="function")return this._batch(array,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.approximateSize=function(start,end,callback){if(start==null||end==null||typeof start=="function"||typeof end=="function"){throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments")}if(typeof callback!="function")throw new Error("approximateSize() requires a callback argument");if(!this._isBuffer(start))start=String(start);if(!this._isBuffer(end))end=String(end);if(typeof this._approximateSize=="function")return this._approximateSize(start,end,callback);process.nextTick(function(){callback(null,0)})};AbstractLevelDOWN.prototype._setupIteratorOptions=function(options){var self=this;options=xtend(options);["start","end","gt","gte","lt","lte"].forEach(function(o){if(options[o]&&self._isBuffer(options[o])&&options[o].length===0)delete options[o]});options.reverse=!!options.reverse;if(options.reverse&&options.lt)options.start=options.lt;if(options.reverse&&options.lte)options.start=options.lte;if(!options.reverse&&options.gt)options.start=options.gt;if(!options.reverse&&options.gte)options.start=options.gte;if(options.reverse&&options.lt&&!options.lte||!options.reverse&&options.gt&&!options.gte)options.exclusiveStart=true;return options};AbstractLevelDOWN.prototype.iterator=function(options){if(typeof options!="object")options={};options=this._setupIteratorOptions(options);if(typeof this._iterator=="function")return this._iterator(options);return new AbstractIterator(this)};AbstractLevelDOWN.prototype._chainedBatch=function(){return new AbstractChainedBatch(this)};AbstractLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};AbstractLevelDOWN.prototype._checkKeyValue=function(obj,type){if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(this._isBuffer(obj)){if(obj.length===0)return new Error(type+" cannot be an empty Buffer")}else if(String(obj)==="")return new Error(type+" cannot be an empty String")};module.exports.AbstractLevelDOWN=AbstractLevelDOWN;module.exports.AbstractIterator=AbstractIterator;module.exports.AbstractChainedBatch=AbstractChainedBatch}).call(this,require("_process"),require("buffer").Buffer)},{"./abstract-chained-batch":75,"./abstract-iterator":76,_process:24,buffer:3,xtend:78}],78:[function(require,module,exports){module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key]}}}return target}},{}],79:[function(require,module,exports){(function(name,definition,global){if(typeof define==="function"){define(definition)}else if(typeof module!=="undefined"&&module.exports){module.exports=definition()}else{global[name]=definition()}})("IDBStore",function(){"use strict";var defaultErrorHandler=function(error){throw error};var defaults={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:true,onStoreReady:function(){},onError:defaultErrorHandler,indexes:[]};var IDBStore=function(kwArgs,onStoreReady){if(typeof onStoreReady=="undefined"&&typeof kwArgs=="function"){onStoreReady=kwArgs}if(Object.prototype.toString.call(kwArgs)!="[object Object]"){kwArgs={}}for(var key in defaults){this[key]=typeof kwArgs[key]!="undefined"?kwArgs[key]:defaults[key]}this.dbName=this.storePrefix+this.storeName;this.dbVersion=parseInt(this.dbVersion,10)||1;onStoreReady&&(this.onStoreReady=onStoreReady);var env=typeof window=="object"?window:self;this.idb=env.indexedDB||env.webkitIndexedDB||env.mozIndexedDB;this.keyRange=env.IDBKeyRange||env.webkitIDBKeyRange||env.mozIDBKeyRange;this.features={hasAutoIncrement:!env.mozIndexedDB};this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"};this.openDB()};IDBStore.prototype={constructor:IDBStore,version:"1.4.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var openRequest=this.idb.open(this.dbName,this.dbVersion);var preventSuccessCallback=false;openRequest.onerror=function(error){var gotVersionErr=false;if("error"in error.target){gotVersionErr=error.target.error.name=="VersionError"}else if("errorCode"in error.target){gotVersionErr=error.target.errorCode==12}if(gotVersionErr){this.onError(new Error("The version number provided is lower than the existing one."))}else{this.onError(error)}}.bind(this);openRequest.onsuccess=function(event){if(preventSuccessCallback){return}if(this.db){this.onStoreReady();return}this.db=event.target.result;if(typeof this.db.version=="string"){this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));return}if(!this.db.objectStoreNames.contains(this.storeName)){this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."));return}var emptyTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=emptyTransaction.objectStore(this.storeName);var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName){preventSuccessCallback=true;this.onError(new Error("Cannot create index: No index name given."));return}this.normalizeIndexData(indexData);if(this.hasIndex(indexName)){var actualIndex=this.store.index(indexName);var complies=this.indexComplies(actualIndex,indexData);if(!complies){preventSuccessCallback=true;this.onError(new Error('Cannot modify index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else{preventSuccessCallback=true;this.onError(new Error('Cannot create new index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}},this);if(existingIndexes.length){preventSuccessCallback=true;this.onError(new Error('Cannot delete index(es) "'+existingIndexes.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}preventSuccessCallback||this.onStoreReady()}.bind(this);openRequest.onupgradeneeded=function(event){this.db=event.target.result;if(this.db.objectStoreNames.contains(this.storeName)){this.store=event.target.transaction.objectStore(this.storeName)}else{var optionalParameters={autoIncrement:this.autoIncrement};if(this.keyPath!==null){optionalParameters.keyPath=this.keyPath}this.store=this.db.createObjectStore(this.storeName,optionalParameters)}var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName){preventSuccessCallback=true;this.onError(new Error("Cannot create index: No index name given."))}this.normalizeIndexData(indexData);if(this.hasIndex(indexName)){var actualIndex=this.store.index(indexName);var complies=this.indexComplies(actualIndex,indexData);if(!complies){this.store.deleteIndex(indexName);this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})}existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else{this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})}},this);if(existingIndexes.length){existingIndexes.forEach(function(_indexName){this.store.deleteIndex(_indexName)},this)}}.bind(this)},deleteDatabase:function(){if(this.idb.deleteDatabase){this.idb.deleteDatabase(this.dbName)}},put:function(key,value,onSuccess,onError){if(this.keyPath!==null){onError=onSuccess;onSuccess=value;value=key}onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null,putRequest;var putTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);putTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};putTransaction.onabort=onError;putTransaction.onerror=onError;if(this.keyPath!==null){this._addIdPropertyIfNeeded(value);putRequest=putTransaction.objectStore(this.storeName).put(value)}else{putRequest=putTransaction.objectStore(this.storeName).put(value,key)}putRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};putRequest.onerror=onError;return putTransaction},get:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var getTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);getTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};getTransaction.onabort=onError;getTransaction.onerror=onError;var getRequest=getTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};getRequest.onerror=onError;return getTransaction},remove:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var removeTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);removeTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};removeTransaction.onabort=onError;removeTransaction.onerror=onError;var deleteRequest=removeTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};deleteRequest.onerror=onError;return removeTransaction},batch:function(dataArray,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);if(Object.prototype.toString.call(dataArray)!="[object Array]"){onError(new Error("dataArray argument must be of type Array."))}var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(hasSuccess)};batchTransaction.onabort=onError;batchTransaction.onerror=onError;var count=dataArray.length;var called=false;var hasSuccess=false;var onItemSuccess=function(){count--;if(count===0&&!called){called=true;hasSuccess=true}};dataArray.forEach(function(operation){var type=operation.type;var key=operation.key;var value=operation.value;var onItemError=function(err){batchTransaction.abort();if(!called){called=true;onError(err,type,key)}};if(type=="remove"){var deleteRequest=batchTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=onItemSuccess;deleteRequest.onerror=onItemError}else if(type=="put"){var putRequest;if(this.keyPath!==null){this._addIdPropertyIfNeeded(value);putRequest=batchTransaction.objectStore(this.storeName).put(value)}else{putRequest=batchTransaction.objectStore(this.storeName).put(value,key)}putRequest.onsuccess=onItemSuccess;putRequest.onerror=onItemError}},this);return batchTransaction},putBatch:function(dataArray,onSuccess,onError){var batchData=dataArray.map(function(item){return{type:"put",value:item}});return this.batch(batchData,onSuccess,onError)},removeBatch:function(keyArray,onSuccess,onError){var batchData=keyArray.map(function(key){return{type:"remove",key:key}});return this.batch(batchData,onSuccess,onError)},getBatch:function(keyArray,onSuccess,onError,arrayType){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);arrayType||(arrayType="sparse");if(Object.prototype.toString.call(keyArray)!="[object Array]"){onError(new Error("keyArray argument must be of type Array."))}var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};batchTransaction.onabort=onError;batchTransaction.onerror=onError;var data=[];var count=keyArray.length;var called=false;var hasSuccess=false;var result=null;var onItemSuccess=function(event){if(event.target.result||arrayType=="dense"){data.push(event.target.result)}else if(arrayType=="sparse"){data.length++}count--;if(count===0){called=true;hasSuccess=true;result=data}};keyArray.forEach(function(key){var onItemError=function(err){called=true;result=err;onError(err);batchTransaction.abort()};var getRequest=batchTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=onItemSuccess;getRequest.onerror=onItemError},this);return batchTransaction},getAll:function(onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var getAllTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);var store=getAllTransaction.objectStore(this.storeName);if(store.getAll){this._getAllNative(getAllTransaction,store,onSuccess,onError)}else{this._getAllCursor(getAllTransaction,store,onSuccess,onError)}return getAllTransaction},_getAllNative:function(getAllTransaction,store,onSuccess,onError){var hasSuccess=false,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};getAllTransaction.onabort=onError;getAllTransaction.onerror=onError;var getAllRequest=store.getAll();getAllRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};getAllRequest.onerror=onError},_getAllCursor:function(getAllTransaction,store,onSuccess,onError){var all=[],hasSuccess=false,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)
};getAllTransaction.onabort=onError;getAllTransaction.onerror=onError;var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor){all.push(cursor.value);cursor["continue"]()}else{hasSuccess=true;result=all}};cursorRequest.onError=onError},clear:function(onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var clearTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);clearTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};clearTransaction.onabort=onError;clearTransaction.onerror=onError;var clearRequest=clearTransaction.objectStore(this.storeName).clear();clearRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};clearRequest.onerror=onError;return clearTransaction},_addIdPropertyIfNeeded:function(dataObj){if(!this.features.hasAutoIncrement&&typeof dataObj[this.keyPath]=="undefined"){dataObj[this.keyPath]=this._insertIdCount++ +Date.now()}},getIndexList:function(){return this.store.indexNames},hasIndex:function(indexName){return this.store.indexNames.contains(indexName)},normalizeIndexData:function(indexData){indexData.keyPath=indexData.keyPath||indexData.name;indexData.unique=!!indexData.unique;indexData.multiEntry=!!indexData.multiEntry},indexComplies:function(actual,expected){var complies=["keyPath","unique","multiEntry"].every(function(key){if(key=="multiEntry"&&actual[key]===undefined&&expected[key]===false){return true}if(key=="keyPath"&&Object.prototype.toString.call(expected[key])=="[object Array]"){var exp=expected.keyPath;var act=actual.keyPath;if(typeof act=="string"){return exp.toString()==act}if(!(typeof act.contains=="function"||typeof act.indexOf=="function")){return false}if(act.length!==exp.length){return false}for(var i=0,m=exp.length;i<m;i++){if(!(act.contains&&act.contains(exp[i])||act.indexOf(exp[i]!==-1))){return false}}return true}return expected[key]==actual[key]});return complies},iterate:function(onItem,options){options=mixin({index:null,order:"ASC",autoContinue:true,filterDuplicates:false,keyRange:null,writeAccess:false,onEnd:null,onError:defaultErrorHandler},options||{});var directionType=options.order.toLowerCase()=="desc"?"PREV":"NEXT";if(options.filterDuplicates){directionType+="_NO_DUPLICATE"}var hasSuccess=false;var cursorTransaction=this.db.transaction([this.storeName],this.consts[options.writeAccess?"READ_WRITE":"READ_ONLY"]);var cursorTarget=cursorTransaction.objectStore(this.storeName);if(options.index){cursorTarget=cursorTarget.index(options.index)}cursorTransaction.oncomplete=function(){if(!hasSuccess){options.onError(null);return}if(options.onEnd){options.onEnd()}else{onItem(null)}};cursorTransaction.onabort=options.onError;cursorTransaction.onerror=options.onError;var cursorRequest=cursorTarget.openCursor(options.keyRange,this.consts[directionType]);cursorRequest.onerror=options.onError;cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor){onItem(cursor.value,cursor,cursorTransaction);if(options.autoContinue){cursor["continue"]()}}else{hasSuccess=true}};return cursorTransaction},query:function(onSuccess,options){var result=[];options=options||{};options.onEnd=function(){onSuccess(result)};return this.iterate(function(item){result.push(item)},options)},count:function(onSuccess,options){options=mixin({index:null,keyRange:null},options||{});var onError=options.onError||defaultErrorHandler;var hasSuccess=false,result=null;var cursorTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);cursorTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};cursorTransaction.onabort=onError;cursorTransaction.onerror=onError;var cursorTarget=cursorTransaction.objectStore(this.storeName);if(options.index){cursorTarget=cursorTarget.index(options.index)}var countRequest=cursorTarget.count(options.keyRange);countRequest.onsuccess=function(evt){hasSuccess=true;result=evt.target.result};countRequest.onError=onError;return cursorTransaction},makeKeyRange:function(options){var keyRange,hasLower=typeof options.lower!="undefined",hasUpper=typeof options.upper!="undefined",isOnly=typeof options.only!="undefined";switch(true){case isOnly:keyRange=this.keyRange.only(options.only);break;case hasLower&&hasUpper:keyRange=this.keyRange.bound(options.lower,options.upper,options.excludeLower,options.excludeUpper);break;case hasLower:keyRange=this.keyRange.lowerBound(options.lower,options.excludeLower);break;case hasUpper:keyRange=this.keyRange.upperBound(options.upper,options.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return keyRange}};var noop=function(){};var empty={};var mixin=function(target,source){var name,s;for(name in source){s=source[name];if(s!==empty[name]&&s!==target[name]){target[name]=s}}return target};IDBStore.version=IDBStore.prototype.version;return IDBStore},this)},{}],80:[function(require,module,exports){var Buffer=require("buffer").Buffer;module.exports=isBuffer;function isBuffer(o){return Buffer.isBuffer(o)||/\[object (.+Array|Array.+)\]/.test(Object.prototype.toString.call(o))}},{buffer:3}],81:[function(require,module,exports){(function(Buffer){exports.compare=function(a,b){if(Buffer.isBuffer(a)){var l=Math.min(a.length,b.length);for(var i=0;i<l;i++){var cmp=a[i]-b[i];if(cmp)return cmp}return a.length-b.length}return a<b?-1:a>b?1:0};function has(obj,key){return Object.hasOwnProperty.call(obj,key)}function isDef(val){return val!==undefined&&val!==""}function has(range,name){return Object.hasOwnProperty.call(range,name)}function hasKey(range,name){return Object.hasOwnProperty.call(range,name)&&name}var lowerBoundKey=exports.lowerBoundKey=function(range){return hasKey(range,"gt")||hasKey(range,"gte")||hasKey(range,"min")||(range.reverse?hasKey(range,"end"):hasKey(range,"start"))||undefined};var lowerBound=exports.lowerBound=function(range){var k=lowerBoundKey(range);return k&&range[k];return has(range,"gt")?range.gt:has(range,"gte")?range.gte:has(range,"min")?range.min:has(range,"start")&&!range.reverse?range.start:has(range,"end")&&range.reverse?range.end:undefined};exports.lowerBoundInclusive=function(range){return has(range,"gt")?false:true};exports.upperBoundInclusive=function(range){return has(range,"lt")||!range.minEx?false:true};var lowerBoundExclusive=exports.lowerBoundExclusive=function(range){return has(range,"gt")||range.minEx?true:false};var upperBoundExclusive=exports.upperBoundExclusive=function(range){return has(range,"lt")?true:false};var upperBoundKey=exports.upperBoundKey=function(range){return hasKey(range,"lt")||hasKey(range,"lte")||hasKey(range,"max")||(range.reverse?hasKey(range,"start"):hasKey(range,"end"))||undefined};var upperBound=exports.upperBound=function(range){var k=upperBoundKey(range);return k&&range[k]};function id(e){return e}exports.toLtgt=function(range,_range,map,lower,upper){_range=_range||{};map=map||id;var defaults=arguments.length>3;var lb=exports.lowerBoundKey(range);var ub=exports.upperBoundKey(range);if(lb){if(lb==="gt")_range.gt=map(range.gt);else _range.gte=map(range[lb])}else if(defaults)_range.gte=lower;if(ub){if(ub==="lt")_range.lt=map(range.lt);else _range.lte=map(range[ub])}else if(defaults)_range.lte=upper;_range.reverse=!!range.reverse;return _range};exports.contains=function(range,key,compare){compare=compare||exports.compare;var lb=lowerBound(range);if(isDef(lb)){var cmp=compare(key,lb);if(cmp<0||cmp===0&&lowerBoundExclusive(range))return false}var ub=upperBound(range);if(isDef(ub)){var cmp=compare(key,ub);if(cmp>0||cmp===0&&upperBoundExclusive(range))return false}return true};exports.filter=function(range,compare){return function(key){return exports.contains(range,key,compare)}}}).call(this,require("buffer").Buffer)},{buffer:3}],82:[function(require,module,exports){(function(Buffer){module.exports=function(arr){if(typeof Buffer._augment==="function"&&Buffer.TYPED_ARRAY_SUPPORT){return Buffer._augment(arr)}else{return new Buffer(arr)}}}).call(this,require("buffer").Buffer)},{buffer:3}],83:[function(require,module,exports){module.exports=hasKeys;function hasKeys(source){return source!==null&&(typeof source==="object"||typeof source==="function")}},{}],84:[function(require,module,exports){var Keys=require("object-keys");var hasKeys=require("./has-keys");module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];if(!hasKeys(source)){continue}var keys=Keys(source);for(var j=0;j<keys.length;j++){var name=keys[j];target[name]=source[name]}}return target}},{"./has-keys":83,"object-keys":86}],85:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;var toString=Object.prototype.toString;var isFunction=function(fn){var isFunc=typeof fn==="function"&&!(fn instanceof RegExp)||toString.call(fn)==="[object Function]";if(!isFunc&&typeof window!=="undefined"){isFunc=fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt}return isFunc};module.exports=function forEach(obj,fn){if(!isFunction(fn)){throw new TypeError("iterator must be a function")}var i,k,isString=typeof obj==="string",l=obj.length,context=arguments.length>2?arguments[2]:null;if(l===+l){for(i=0;i<l;i++){if(context===null){fn(isString?obj.charAt(i):obj[i],i,obj)}else{fn.call(context,isString?obj.charAt(i):obj[i],i,obj)}}}else{for(k in obj){if(hasOwn.call(obj,k)){if(context===null){fn(obj[k],k,obj)}else{fn.call(context,obj[k],k,obj)}}}}}},{}],86:[function(require,module,exports){module.exports=Object.keys||require("./shim")},{"./shim":88}],87:[function(require,module,exports){var toString=Object.prototype.toString;module.exports=function isArguments(value){var str=toString.call(value);var isArguments=str==="[object Arguments]";if(!isArguments){isArguments=str!=="[object Array]"&&value!==null&&typeof value==="object"&&typeof value.length==="number"&&value.length>=0&&toString.call(value.callee)==="[object Function]"}return isArguments}},{}],88:[function(require,module,exports){(function(){"use strict";var has=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,forEach=require("./foreach"),isArgs=require("./isArguments"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],keysShim;keysShim=function keys(object){var isObject=object!==null&&typeof object==="object",isFunction=toString.call(object)==="[object Function]",isArguments=isArgs(object),theKeys=[];if(!isObject&&!isFunction&&!isArguments){throw new TypeError("Object.keys called on a non-object")}if(isArguments){forEach(object,function(value){theKeys.push(value)})}else{var name,skipProto=hasProtoEnumBug&&isFunction;for(name in object){if(!(skipProto&&name==="prototype")&&has.call(object,name)){theKeys.push(name)}}}if(hasDontEnumBug){var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object;forEach(dontEnums,function(dontEnum){if(!(skipConstructor&&dontEnum==="constructor")&&has.call(object,dontEnum)){theKeys.push(dontEnum)}})}return theKeys};module.exports=keysShim})()},{"./foreach":85,"./isArguments":87}],89:[function(require,module,exports){var util=require("./util"),WriteError=require("./errors").WriteError,getOptions=util.getOptions,dispatchError=util.dispatchError;function Batch(levelup,codec){this._levelup=levelup;this._codec=codec;this.batch=levelup.db.batch();this.ops=[]}Batch.prototype.put=function(key_,value_,options){options=getOptions(this._levelup,options);var key=this._codec.encodeKey(key_,options),value=this._codec.encodeValue(value_,options);try{this.batch.put(key,value)}catch(e){throw new WriteError(e)}this.ops.push({type:"put",key:key,value:value});return this};Batch.prototype.del=function(key_,options){options=getOptions(this._levelup,options);var key=this._codec.encodeKey(key_,options);try{this.batch.del(key)}catch(err){throw new WriteError(err)}this.ops.push({type:"del",key:key});return this};Batch.prototype.clear=function(){try{this.batch.clear()}catch(err){throw new WriteError(err)}this.ops=[];return this};Batch.prototype.write=function(callback){var levelup=this._levelup,ops=this.ops;try{this.batch.write(function(err){if(err)return dispatchError(levelup,new WriteError(err),callback);levelup.emit("batch",ops);if(callback)callback()})}catch(err){throw new WriteError(err)}};module.exports=Batch},{"./errors":92,"./util":95}],90:[function(require,module,exports){var encodings=require("./encodings");function getKeyEncoder(options,op){var type=op&&op.keyEncoding||options.keyEncoding||"utf8";return encodings[type]||type}function getValueEncoder(options,op){var type=op&&(op.valueEncoding||op.encoding)||options.valueEncoding||options.encoding||"utf8";return encodings[type]||type}function encodeKey(key,options,op){return getKeyEncoder(options,op).encode(key)}function encodeValue(value,options,op){return getValueEncoder(options,op).encode(value)}function decodeKey(key,options){return getKeyEncoder(options).decode(key)}function decodeValue(value,options){return getValueEncoder(options).decode(value)}function isValueAsBuffer(options,op){return getValueEncoder(options,op).buffer}function isKeyAsBuffer(options,op){return getKeyEncoder(options,op).buffer}module.exports={encodeKey:encodeKey,encodeValue:encodeValue,isValueAsBuffer:isValueAsBuffer,isKeyAsBuffer:isKeyAsBuffer,decodeValue:decodeValue,decodeKey:decodeKey}},{"./encodings":91}],91:[function(require,module,exports){(function(Buffer){var encodingNames=["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le"];module.exports=function(){function isBinary(data){return data===undefined||data===null||Buffer.isBuffer(data)}var encodings={};encodings.utf8=encodings["utf-8"]={encode:function(data){return isBinary(data)?data:String(data)},decode:function(data){return data},buffer:false,type:"utf8"};encodings.json={encode:JSON.stringify,decode:JSON.parse,buffer:false,type:"json"};encodings.binary={encode:function(data){return isBinary(data)?data:new Buffer(data)},decode:function(data){return data},buffer:true,type:"binary"};encodingNames.forEach(function(type){if(encodings[type])return;encodings[type]={encode:function(data){return isBinary(data)?data:new Buffer(data,type)},decode:function(buffer){return buffer.toString(type)},buffer:true,type:type}});return encodings}()}).call(this,require("buffer").Buffer)},{buffer:3}],92:[function(require,module,exports){var createError=require("errno").create,LevelUPError=createError("LevelUPError"),NotFoundError=createError("NotFoundError",LevelUPError);NotFoundError.prototype.notFound=true;NotFoundError.prototype.status=404;module.exports={LevelUPError:LevelUPError,InitializationError:createError("InitializationError",LevelUPError),OpenError:createError("OpenError",LevelUPError),ReadError:createError("ReadError",LevelUPError),WriteError:createError("WriteError",LevelUPError),NotFoundError:NotFoundError,EncodingError:createError("EncodingError",LevelUPError)}},{errno:103}],93:[function(require,module,exports){(function(process){var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits,extend=require("xtend"),prr=require("prr"),DeferredLevelDOWN=require("deferred-leveldown"),WriteError=require("./errors").WriteError,ReadError=require("./errors").ReadError,NotFoundError=require("./errors").NotFoundError,OpenError=require("./errors").OpenError,EncodingError=require("./errors").EncodingError,InitializationError=require("./errors").InitializationError,ReadStream=require("./read-stream"),WriteStream=require("./write-stream"),util=require("./util"),Batch=require("./batch"),codec=require("./codec"),getOptions=util.getOptions,defaultOptions=util.defaultOptions,getLevelDOWN=util.getLevelDOWN,dispatchError=util.dispatchError,isDefined=util.isDefined;function getCallback(options,callback){return typeof options=="function"?options:callback}function LevelUP(location,options,callback){if(!(this instanceof LevelUP))return new LevelUP(location,options,callback);var error;EventEmitter.call(this);this.setMaxListeners(Infinity);if(typeof location=="function"){options=typeof options=="object"?options:{};options.db=location;location=null}else if(typeof location=="object"&&typeof location.db=="function"){options=location;location=null}if(typeof options=="function"){callback=options;options={}}if((!options||typeof options.db!="function")&&typeof location!="string"){error=new InitializationError("Must provide a location for the database");if(callback){return process.nextTick(function(){callback(error)})}throw error}options=getOptions(this,options);this.options=extend(defaultOptions,options);this._codec=options.codec||codec;this._status="new";prr(this,"location",location,"e");this.open(callback)}inherits(LevelUP,EventEmitter);LevelUP.prototype.open=function(callback){var self=this,dbFactory,db;if(this.isOpen()){if(callback)process.nextTick(function(){callback(null,self)});return this}if(this._isOpening()){return callback&&this.once("open",function(){callback(null,self)})}this.emit("opening");this._status="opening";this.db=new DeferredLevelDOWN(this.location);dbFactory=this.options.db||getLevelDOWN();db=dbFactory(this.location);db.open(this.options,function(err){if(err){return dispatchError(self,new OpenError(err),callback)}else{self.db.setDb(db);self.db=db;self._status="open";if(callback)callback(null,self);self.emit("open");self.emit("ready")}})};LevelUP.prototype.close=function(callback){var self=this;if(this.isOpen()){this._status="closing";this.db.close(function(){self._status="closed";self.emit("closed");if(callback)callback.apply(null,arguments)});this.emit("closing");this.db=null}else if(this._status=="closed"&&callback){return process.nextTick(callback)}else if(this._status=="closing"&&callback){this.once("closed",callback)}else if(this._isOpening()){this.once("open",function(){self.close(callback)})}};LevelUP.prototype.isOpen=function(){return this._status=="open"};LevelUP.prototype._isOpening=function(){return this._status=="opening"};LevelUP.prototype.isClosed=function(){return/^clos/.test(this._status)};function maybeError(db,options,callback){if(!db._isOpening()&&!db.isOpen()){dispatchError(db,new ReadError("Database is not open"),callback);return true}}function writeError(db,message,callback){dispatchError(db,new WriteError(message),callback)}function readError(db,message,callback){dispatchError(db,new ReadError(message),callback);return true}LevelUP.prototype.get=function(key_,options,callback){var self=this,key;callback=getCallback(options,callback);if(maybeError(this,options,callback))return;if(key_===null||key_===undefined||"function"!==typeof callback)return readError(this,"get() requires key and callback arguments",callback);options=util.getOptions(this,options);key=this._codec.encodeKey(key_,options);options.asBuffer=this._codec.isValueAsBuffer(options);this.db.get(key,options,function(err,value){if(err){if(/notfound/i.test(err)){err=new NotFoundError("Key not found in database ["+key_+"]",err)}else{err=new ReadError(err)}return dispatchError(self,err,callback)}if(callback){try{value=self._codec.decodeValue(value,options)}catch(e){return callback(new EncodingError(e))}callback(null,value)}})};LevelUP.prototype.put=function(key_,value_,options,callback){var self=this,key,value;callback=getCallback(options,callback);if(key_===null||key_===undefined||value_===null||value_===undefined)return writeError(this,"put() requires key and value arguments",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);key=this._codec.encodeKey(key_,options);value=this._codec.encodeValue(value_,options);this.db.put(key,value,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("put",key_,value_);if(callback)callback()}})};LevelUP.prototype.del=function(key_,options,callback){var self=this,key;callback=getCallback(options,callback);if(key_===null||key_===undefined)return writeError(this,"del() requires a key argument",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);key=this._codec.encodeKey(key_,options);this.db.del(key,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("del",key_);if(callback)callback()}})};LevelUP.prototype.batch=function(arr_,options,callback){var self=this,keyEnc,valueEnc,arr;if(!arguments.length)return new Batch(this,codec);callback=getCallback(options,callback);if(!Array.isArray(arr_))return writeError(this,"batch() requires an array argument",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);keyEnc=options.keyEncoding;valueEnc=options.valueEncoding;arr=arr_.map(function(e){if(e.type===undefined||e.key===undefined)return{};var kEnc=e.keyEncoding||keyEnc,vEnc=e.valueEncoding||e.encoding||valueEnc,o;if(kEnc!="utf8"&&kEnc!="binary"||vEnc!="utf8"&&vEnc!="binary"){o={type:e.type,key:self._codec.encodeKey(e.key,options,e)};if(e.value!==undefined)o.value=self._codec.encodeValue(e.value,options,e);return o}else{return e}});this.db.batch(arr,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("batch",arr_);if(callback)callback()}})};LevelUP.prototype.approximateSize=function(start_,end_,options,callback){var self=this,start,end;callback=getCallback(options,callback);options=getOptions(options,callback);if(start_===null||start_===undefined||end_===null||end_===undefined||"function"!==typeof callback)return readError(this,"approximateSize() requires start, end and callback arguments",callback);start=this._codec.encodeKey(start_,this.options);end=this._codec.encodeKey(end_,this.options);this.db.approximateSize(start,end,function(err,size){if(err){return dispatchError(self,new OpenError(err),callback)}else if(callback){callback(null,size)}})};LevelUP.prototype.readStream=LevelUP.prototype.createReadStream=function(options){var self=this;options=extend({keys:true,values:true},this.options,options);options.keyEncoding=options.keyEncoding||options.encoding;options.valueEncoding=options.valueEncoding||options.encoding;if(isDefined(options.start))options.start=this._codec.encodeKey(options.start,options);if(isDefined(options.end))options.end=this._codec.encodeKey(options.end,options);if(isDefined(options.gte))options.gte=this._codec.encodeKey(options.gte,options);if(isDefined(options.gt))options.gt=this._codec.encodeKey(options.gt,options);if(isDefined(options.lte))options.lte=this._codec.encodeKey(options.lte,options);if(isDefined(options.lt))options.lt=this._codec.encodeKey(options.lt,options);if("number"!==typeof options.limit)options.limit=-1;options.keyAsBuffer=this._codec.isKeyAsBuffer(options);options.valueAsBuffer=this._codec.isValueAsBuffer(options);var makeData=options.keys&&options.values?function(key,value){return{key:self._codec.decodeKey(key,options),value:self._codec.decodeValue(value,options)}}:options.keys?function(key){return self._codec.decodeKey(key,options)}:options.values?function(_,value){return self._codec.decodeValue(value,options)}:function(){};var stream=new ReadStream(options,makeData);if(this.isOpen()){stream.setIterator(self.db.iterator(options))}else{this.once("ready",function(){stream.setIterator(self.db.iterator(options))})}return stream};LevelUP.prototype.keyStream=LevelUP.prototype.createKeyStream=function(options){return this.createReadStream(extend(options,{keys:true,values:false}))};LevelUP.prototype.valueStream=LevelUP.prototype.createValueStream=function(options){return this.createReadStream(extend(options,{keys:false,values:true}))};LevelUP.prototype.writeStream=LevelUP.prototype.createWriteStream=function(options){return new WriteStream(extend(options),this)};LevelUP.prototype.toString=function(){return"LevelUP"};function utilStatic(name){return function(location,callback){getLevelDOWN()[name](location,callback||function(){})}}module.exports=LevelUP;module.exports.copy=util.copy;module.exports.destroy=utilStatic("destroy");module.exports.repair=utilStatic("repair")}).call(this,require("_process"))},{"./batch":89,"./codec":90,"./errors":92,"./read-stream":94,"./util":95,"./write-stream":96,_process:24,"deferred-leveldown":98,events:19,prr:104,util:39,xtend:115}],94:[function(require,module,exports){var Readable=require("readable-stream").Readable,inherits=require("util").inherits,extend=require("xtend"),EncodingError=require("./errors").EncodingError,util=require("./util");function ReadStream(options,makeData){if(!(this instanceof ReadStream))return new ReadStream(options,makeData);Readable.call(this,{objectMode:true,highWaterMark:options.highWaterMark});this._waiting=false;this._options=options;this._makeData=makeData}inherits(ReadStream,Readable);ReadStream.prototype.setIterator=function(it){var self=this;this._iterator=it;if(this._destroyed)return it.end(function(){});if(this._waiting){this._waiting=false;return this._read()}return this};ReadStream.prototype._read=function read(){var self=this;if(self._destroyed)return;if(!self._iterator)return this._waiting=true;self._iterator.next(function(err,key,value){if(err||key===undefined&&value===undefined){if(!err&&!self._destroyed)self.push(null);return self._cleanup(err)}try{value=self._makeData(key,value)}catch(e){return self._cleanup(new EncodingError(e))}if(!self._destroyed)self.push(value)})};ReadStream.prototype._cleanup=function(err){if(this._destroyed)return;this._destroyed=true;var self=this;if(err)self.emit("error",err);if(self._iterator){self._iterator.end(function(){self._iterator=null;self.emit("close")})}else{self.emit("close")}};ReadStream.prototype.destroy=function(){this._cleanup()};ReadStream.prototype.toString=function(){return"LevelUP.ReadStream"};module.exports=ReadStream},{"./errors":92,"./util":95,"readable-stream":114,util:39,xtend:115}],95:[function(require,module,exports){var extend=require("xtend"),LevelUPError=require("./errors").LevelUPError,encodings=require("./encodings"),defaultOptions={createIfMissing:true,errorIfExists:false,keyEncoding:"utf8",valueEncoding:"utf8",compression:true},leveldown,encodingOpts=function(){var eo={};for(var e in encodings)eo[e]={valueEncoding:encodings[e]};return eo}();function copy(srcdb,dstdb,callback){srcdb.readStream().pipe(dstdb.writeStream()).on("close",callback?callback:function(){}).on("error",callback?callback:function(err){throw err})}function getOptions(levelup,options){var s=typeof options=="string";if(!s&&options&&options.encoding&&!options.valueEncoding)options.valueEncoding=options.encoding;return extend(levelup&&levelup.options||{},s?encodingOpts[options]||encodingOpts[defaultOptions.valueEncoding]:options)}function getLevelDOWN(){if(leveldown)return leveldown;var requiredVersion=require("../package.json").devDependencies.leveldown,missingLevelDOWNError="Could not locate LevelDOWN, try `npm install leveldown`",leveldownVersion;try{leveldownVersion=require("leveldown/package").version}catch(e){throw new LevelUPError(missingLevelDOWNError)}if(!require("semver").satisfies(leveldownVersion,requiredVersion)){throw new LevelUPError("Installed version of LevelDOWN ("+leveldownVersion+") does not match required version ("+requiredVersion+")")}try{return leveldown=require("leveldown")}catch(e){throw new LevelUPError(missingLevelDOWNError)}}function dispatchError(levelup,error,callback){return typeof callback=="function"?callback(error):levelup.emit("error",error)}function isDefined(v){return typeof v!=="undefined"}module.exports={defaultOptions:defaultOptions,copy:copy,getOptions:getOptions,getLevelDOWN:getLevelDOWN,dispatchError:dispatchError,isDefined:isDefined}},{"../package.json":116,"./encodings":91,"./errors":92,leveldown:2,"leveldown/package":2,semver:2,xtend:115}],96:[function(require,module,exports){(function(process,global){var Stream=require("stream").Stream,inherits=require("util").inherits,extend=require("xtend"),bl=require("bl"),setImmediate=global.setImmediate||process.nextTick,getOptions=require("./util").getOptions,defaultOptions={type:"put"};function WriteStream(options,db){if(!(this instanceof WriteStream))return new WriteStream(options,db);Stream.call(this);this._options=extend(defaultOptions,getOptions(db,options));this._db=db;this._buffer=[];this._status="init";this._end=false;this.writable=true;this.readable=false;var self=this,ready=function(){if(!self.writable)return;self._status="ready";self.emit("ready");self._process()};if(db.isOpen())setImmediate(ready);else db.once("ready",ready)}inherits(WriteStream,Stream);WriteStream.prototype.write=function(data){if(!this.writable)return false;this._buffer.push(data);if(this._status!="init")this._processDelayed();if(this._options.maxBufferLength&&this._buffer.length>this._options.maxBufferLength){this._writeBlock=true;return false}return true};WriteStream.prototype.end=function(data){var self=this;if(data)this.write(data);setImmediate(function(){self._end=true;self._process()})};WriteStream.prototype.destroy=function(){this.writable=false;this.end()};WriteStream.prototype.destroySoon=function(){this.end()};WriteStream.prototype.add=function(entry){if(!entry.props)return;if(entry.props.Directory)entry.pipe(this._db.writeStream(this._options));else if(entry.props.File||entry.File||entry.type=="File")this._write(entry);return true};WriteStream.prototype._processDelayed=function(){var self=this;setImmediate(function(){self._process()})};WriteStream.prototype._process=function(){var buffer,self=this,cb=function(err){if(!self.writable)return;if(self._status!="closed")self._status="ready";if(err){self.writable=false;return self.emit("error",err)}self._process()};if(self._status!="ready"&&self.writable){if(self._buffer.length&&self._status!="closed")self._processDelayed();return}if(self._buffer.length&&self.writable){self._status="writing";buffer=self._buffer;self._buffer=[];self._db.batch(buffer.map(function(d){return{type:d.type||self._options.type,key:d.key,value:d.value,keyEncoding:d.keyEncoding||self._options.keyEncoding,valueEncoding:d.valueEncoding||d.encoding||self._options.valueEncoding}}),cb);if(self._writeBlock){self._writeBlock=false;self.emit("drain")}return}if(self._end&&self._status!="closed"){self._status="closed";self.writable=false;self.emit("close")}};WriteStream.prototype._write=function(entry){var key=entry.path||entry.props.path,self=this;if(!key)return;entry.pipe(bl(function(err,data){if(err){self.writable=false;return self.emit("error",err)}if(self._options.fstreamRoot&&key.indexOf(self._options.fstreamRoot)>-1)key=key.substr(self._options.fstreamRoot.length+1);self.write({key:key,value:data.slice(0)})}))};WriteStream.prototype.toString=function(){return"LevelUP.WriteStream"};module.exports=WriteStream}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./util":95,_process:24,bl:97,stream:37,util:39,xtend:115}],97:[function(require,module,exports){(function(Buffer){var DuplexStream=require("readable-stream").Duplex,util=require("util");function BufferList(callback){if(!(this instanceof BufferList))return new BufferList(callback);this._bufs=[];this.length=0;if(typeof callback=="function"){this._callback=callback;var piper=function(err){if(this._callback){this._callback(err);this._callback=null}}.bind(this);this.on("pipe",function(src){src.on("error",piper)});this.on("unpipe",function(src){src.removeListener("error",piper)})}else if(Buffer.isBuffer(callback))this.append(callback);else if(Array.isArray(callback)){callback.forEach(function(b){Buffer.isBuffer(b)&&this.append(b)}.bind(this))}DuplexStream.call(this)}util.inherits(BufferList,DuplexStream);BufferList.prototype._offset=function(offset){var tot=0,i=0,_t;
for(;i<this._bufs.length;i++){_t=tot+this._bufs[i].length;if(offset<_t)return[i,offset-tot];tot=_t}};BufferList.prototype.append=function(buf){this._bufs.push(Buffer.isBuffer(buf)?buf:new Buffer(buf));this.length+=buf.length;return this};BufferList.prototype._write=function(buf,encoding,callback){this.append(buf);if(callback)callback()};BufferList.prototype._read=function(size){if(!this.length)return this.push(null);size=Math.min(size,this.length);this.push(this.slice(0,size));this.consume(size)};BufferList.prototype.end=function(chunk){DuplexStream.prototype.end.call(this,chunk);if(this._callback){this._callback(null,this.slice());this._callback=null}};BufferList.prototype.get=function(index){return this.slice(index,index+1)[0]};BufferList.prototype.slice=function(start,end){return this.copy(null,0,start,end)};BufferList.prototype.copy=function(dst,dstStart,srcStart,srcEnd){if(typeof srcStart!="number"||srcStart<0)srcStart=0;if(typeof srcEnd!="number"||srcEnd>this.length)srcEnd=this.length;if(srcStart>=this.length)return dst||new Buffer(0);if(srcEnd<=0)return dst||new Buffer(0);var copy=!!dst,off=this._offset(srcStart),len=srcEnd-srcStart,bytes=len,bufoff=copy&&dstStart||0,start=off[1],l,i;if(srcStart===0&&srcEnd==this.length){if(!copy)return Buffer.concat(this._bufs);for(i=0;i<this._bufs.length;i++){this._bufs[i].copy(dst,bufoff);bufoff+=this._bufs[i].length}return dst}if(bytes<=this._bufs[off[0]].length-start){return copy?this._bufs[off[0]].copy(dst,dstStart,start,start+bytes):this._bufs[off[0]].slice(start,start+bytes)}if(!copy)dst=new Buffer(len);for(i=off[0];i<this._bufs.length;i++){l=this._bufs[i].length-start;if(bytes>l){this._bufs[i].copy(dst,bufoff,start)}else{this._bufs[i].copy(dst,bufoff,start,start+bytes);break}bufoff+=l;bytes-=l;if(start)start=0}return dst};BufferList.prototype.toString=function(encoding,start,end){return this.slice(start,end).toString(encoding)};BufferList.prototype.consume=function(bytes){while(this._bufs.length){if(bytes>this._bufs[0].length){bytes-=this._bufs[0].length;this.length-=this._bufs[0].length;this._bufs.shift()}else{this._bufs[0]=this._bufs[0].slice(bytes);this.length-=bytes;break}}return this};BufferList.prototype.duplicate=function(){var i=0,copy=new BufferList;for(;i<this._bufs.length;i++)copy.append(this._bufs[i]);return copy};BufferList.prototype.destroy=function(){this._bufs.length=0;this.length=0;this.push(null)};(function(){var methods={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var m in methods){(function(m){BufferList.prototype[m]=function(offset){return this.slice(offset,offset+methods[m])[m](0)}})(m)}})();module.exports=BufferList}).call(this,require("buffer").Buffer)},{buffer:3,"readable-stream":114,util:39}],98:[function(require,module,exports){(function(process,Buffer){var util=require("util"),AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN;function DeferredLevelDOWN(location){AbstractLevelDOWN.call(this,typeof location=="string"?location:"");this._db=undefined;this._operations=[]}util.inherits(DeferredLevelDOWN,AbstractLevelDOWN);DeferredLevelDOWN.prototype.setDb=function(db){this._db=db;this._operations.forEach(function(op){db[op.method].apply(db,op.args)})};DeferredLevelDOWN.prototype._open=function(options,callback){return process.nextTick(callback)};DeferredLevelDOWN.prototype._operation=function(method,args){if(this._db)return this._db[method].apply(this._db,args);this._operations.push({method:method,args:args})};"put get del batch approximateSize".split(" ").forEach(function(m){DeferredLevelDOWN.prototype["_"+m]=function(){this._operation(m,arguments)}});DeferredLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};DeferredLevelDOWN.prototype._iterator=function(){throw new TypeError("not implemented")};module.exports=DeferredLevelDOWN}).call(this,require("_process"),require("buffer").Buffer)},{_process:24,"abstract-leveldown":101,buffer:3,util:39}],99:[function(require,module,exports){module.exports=require(75)},{_process:24}],100:[function(require,module,exports){module.exports=require(76)},{_process:24}],101:[function(require,module,exports){module.exports=require(77)},{"./abstract-chained-batch":99,"./abstract-iterator":100,_process:24,buffer:3,xtend:115}],102:[function(require,module,exports){var prr=require("prr");function init(type,message,cause){prr(this,{type:type,name:type,cause:typeof message!="string"?message:cause,message:!!message&&typeof message!="string"?message.message:message},"ewr")}function CustomError(message,cause){Error.call(this);if(Error.captureStackTrace)Error.captureStackTrace(this,arguments.callee);init.call(this,"CustomError",message,cause)}CustomError.prototype=new Error;function createError(errno,type,proto){var err=function(message,cause){init.call(this,type,message,cause);if(type=="FilesystemError"){this.code=this.cause.code;this.path=this.cause.path;this.errno=this.cause.errno;this.message=(errno.errno[this.cause.errno]?errno.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")}Error.call(this);if(Error.captureStackTrace)Error.captureStackTrace(this,arguments.callee)};err.prototype=!!proto?new proto:new CustomError;return err}module.exports=function(errno){var ce=function(type,proto){return createError(errno,type,proto)};return{CustomError:CustomError,FilesystemError:ce("FilesystemError"),createError:ce}}},{prr:104}],103:[function(require,module,exports){var all=module.exports.all=[{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];module.exports.errno={"-1":all[0],0:all[1],1:all[2],2:all[3],3:all[4],4:all[5],5:all[6],6:all[7],7:all[8],8:all[9],9:all[10],10:all[11],11:all[12],12:all[13],13:all[14],14:all[15],15:all[16],16:all[17],17:all[18],18:all[19],19:all[20],20:all[21],21:all[22],22:all[23],23:all[24],24:all[25],25:all[26],26:all[27],27:all[28],28:all[29],29:all[30],31:all[31],32:all[32],33:all[33],34:all[34],35:all[35],36:all[36],37:all[37],38:all[38],39:all[39],40:all[40],41:all[41],42:all[42],44:all[43],45:all[44],46:all[45],47:all[46],48:all[47],49:all[48],50:all[49],51:all[50],52:all[51],53:all[52],54:all[53],55:all[54],56:all[55],57:all[56],58:all[57],59:all[58]};module.exports.code={UNKNOWN:all[0],OK:all[1],EOF:all[2],EADDRINFO:all[3],EACCES:all[4],EAGAIN:all[5],EADDRINUSE:all[6],EADDRNOTAVAIL:all[7],EAFNOSUPPORT:all[8],EALREADY:all[9],EBADF:all[10],EBUSY:all[11],ECONNABORTED:all[12],ECONNREFUSED:all[13],ECONNRESET:all[14],EDESTADDRREQ:all[15],EFAULT:all[16],EHOSTUNREACH:all[17],EINTR:all[18],EINVAL:all[19],EISCONN:all[20],EMFILE:all[21],EMSGSIZE:all[22],ENETDOWN:all[23],ENETUNREACH:all[24],ENFILE:all[25],ENOBUFS:all[26],ENOMEM:all[27],ENOTDIR:all[28],EISDIR:all[29],ENONET:all[30],ENOTCONN:all[31],ENOTSOCK:all[32],ENOTSUP:all[33],ENOENT:all[34],ENOSYS:all[35],EPIPE:all[36],EPROTO:all[37],EPROTONOSUPPORT:all[38],EPROTOTYPE:all[39],ETIMEDOUT:all[40],ECHARSET:all[41],EAIFAMNOSUPPORT:all[42],EAISERVICE:all[43],EAISOCKTYPE:all[44],ESHUTDOWN:all[45],EEXIST:all[46],ESRCH:all[47],ENAMETOOLONG:all[48],EPERM:all[49],ELOOP:all[50],EXDEV:all[51],ENOTEMPTY:all[52],ENOSPC:all[53],EIO:all[54],EROFS:all[55],ENODEV:all[56],ESPIPE:all[57],ECANCELED:all[58]};module.exports.custom=require("./custom")(module.exports);module.exports.create=module.exports.custom.createError},{"./custom":102}],104:[function(require,module,exports){(function(name,context,definition){if(typeof module!="undefined"&&module.exports)module.exports=definition();else context[name]=definition()})("prr",this,function(){var setProperty=typeof Object.defineProperty=="function"?function(obj,key,options){Object.defineProperty(obj,key,options);return obj}:function(obj,key,options){obj[key]=options.value;return obj},makeOptions=function(value,options){var oo=typeof options=="object",os=!oo&&typeof options=="string",op=function(p){return oo?!!options[p]:os?options.indexOf(p[0])>-1:false};return{enumerable:op("enumerable"),configurable:op("configurable"),writable:op("writable"),value:value}},prr=function(obj,key,value,options){var k;options=makeOptions(value,options);if(typeof key=="object"){for(k in key){if(Object.hasOwnProperty.call(key,k)){options.value=key[k];setProperty(obj,k,options)}}return obj}return setProperty(obj,key,options)};return prr})},{}],105:[function(require,module,exports){module.exports=require(26)},{"./_stream_readable":107,"./_stream_writable":109,_process:24,"core-util-is":110,inherits:111}],106:[function(require,module,exports){module.exports=require(27)},{"./_stream_transform":108,"core-util-is":110,inherits:111}],107:[function(require,module,exports){module.exports=require(28)},{_process:24,buffer:3,"core-util-is":110,events:19,inherits:111,isarray:112,stream:37,"string_decoder/":113}],108:[function(require,module,exports){module.exports=require(29)},{"./_stream_duplex":105,"core-util-is":110,inherits:111}],109:[function(require,module,exports){module.exports=require(30)},{"./_stream_duplex":105,_process:24,buffer:3,"core-util-is":110,inherits:111,stream:37}],110:[function(require,module,exports){module.exports=require(31)},{buffer:3}],111:[function(require,module,exports){module.exports=require(20)},{}],112:[function(require,module,exports){module.exports=require(21)},{}],113:[function(require,module,exports){module.exports=require(32)},{buffer:3}],114:[function(require,module,exports){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":105,"./lib/_stream_passthrough.js":106,"./lib/_stream_readable.js":107,"./lib/_stream_transform.js":108,"./lib/_stream_writable.js":109,stream:37}],115:[function(require,module,exports){module.exports=require(78)},{}],116:[function(require,module,exports){module.exports={name:"levelup",description:"Fast & simple storage - a Node.js-style LevelDB wrapper",version:"0.19.0",contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"lars.magnus.skog@gmail.com",url:"https://github.com/ralphtheninja"},{name:"David Björklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/hij1nx"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"},{name:"James Halliday",email:"mail@substack.net",url:"https://github.com/substack"}],repository:{type:"git",url:"https://github.com/rvagg/node-levelup.git"},homepage:"https://github.com/rvagg/node-levelup",keywords:["leveldb","stream","database","db","store","storage","json"],main:"lib/levelup.js",dependencies:{bl:"~0.8.1","deferred-leveldown":"~0.2.0",errno:"~0.1.1",prr:"~0.0.0","readable-stream":"~1.0.26",semver:"~2.3.1",xtend:"~3.0.0"},devDependencies:{leveldown:"~0.10.0",bustermove:"*",tap:"*",referee:"*",rimraf:"*",async:"*",fstream:"*",tar:"*",mkfiletree:"*",readfiletree:"*","slow-stream":">=0.0.4",delayed:"*",boganipsum:"*",du:"*",memdown:"*","msgpack-js":"*"},browser:{leveldown:false,"leveldown/package":false,semver:false},scripts:{test:"tap test/*-test.js --stderr",functionaltests:"node ./test/functional/fstream-test.js && node ./test/functional/binary-data-test.js && node ./test/functional/compat-test.js",alltests:"npm test && npm run-script functionaltests"},license:"MIT",readme:"LevelUP\n=======\n\n![LevelDB Logo](https://0.gravatar.com/avatar/a498b122aecb7678490a38bb593cc12d)\n\n**Fast & simple storage - a Node.js-style LevelDB wrapper**\n\n[![Build Status](https://secure.travis-ci.org/rvagg/node-levelup.png)](http://travis-ci.org/rvagg/node-levelup)\n\n[![NPM](https://nodei.co/npm/levelup.png?stars&downloads&downloadRank)](https://nodei.co/npm/levelup/) [![NPM](https://nodei.co/npm-dl/levelup.png?months=6&height=3)](https://nodei.co/npm/levelup/)\n\n\n  * <a href=\"#intro\">Introduction</a>\n  * <a href=\"#leveldown\">Relationship to LevelDOWN</a>\n  * <a href=\"#platforms\">Tested &amp; supported platforms</a>\n  * <a href=\"#basic\">Basic usage</a>\n  * <a href=\"#api\">API</a>\n  * <a href=\"#events\">Events</a>\n  * <a href=\"#json\">JSON data</a>\n  * <a href=\"#custom_encodings\">Custom encodings</a>\n  * <a href=\"#extending\">Extending LevelUP</a>\n  * <a href=\"#multiproc\">Multi-process access</a>\n  * <a href=\"#support\">Getting support</a>\n  * <a href=\"#contributing\">Contributing</a>\n  * <a href=\"#licence\">Licence &amp; copyright</a>\n\n<a name=\"intro\"></a>\nIntroduction\n------------\n\n**[LevelDB](http://code.google.com/p/leveldb/)** is a simple key/value data store built by Google, inspired by BigTable. It's used in Google Chrome and many other products. LevelDB supports arbitrary byte arrays as both keys and values, singular *get*, *put* and *delete* operations, *batched put and delete*, bi-directional iterators and simple compression using the very fast [Snappy](http://code.google.com/p/snappy/) algorithm.\n\n**LevelUP** aims to expose the features of LevelDB in a **Node.js-friendly way**. All standard `Buffer` encoding types are supported, as is a special JSON encoding. LevelDB's iterators are exposed as a Node.js-style **readable stream** a matching **writeable stream** converts writes to *batch* operations.\n\nLevelDB stores entries **sorted lexicographically by keys**. This makes LevelUP's <a href=\"#createReadStream\"><code>ReadStream</code></a> interface a very powerful query mechanism.\n\n**LevelUP** is an **OPEN Open Source Project**, see the <a href=\"#contributing\">Contributing</a> section to find out what this means.\n\n<a name=\"leveldown\"></a>\nRelationship to LevelDOWN\n-------------------------\n\nLevelUP is designed to be backed by **[LevelDOWN](https://github.com/rvagg/node-leveldown/)** which provides a pure C++ binding to LevelDB and can be used as a stand-alone package if required.\n\n**As of version 0.9, LevelUP no longer requires LevelDOWN as a dependency so you must `npm install leveldown` when you install LevelUP.**\n\nLevelDOWN is now optional because LevelUP can be used with alternative backends, such as **[level.js](https://github.com/maxogden/level.js)** in the browser or [MemDOWN](https://github.com/rvagg/node-memdown) for a pure in-memory store.\n\nLevelUP will look for LevelDOWN and throw an error if it can't find it in its Node `require()` path. It will also tell you if the installed version of LevelDOWN is incompatible.\n\n**The [level](https://github.com/level/level) package is available as an alternative installation mechanism.** Install it instead to automatically get both LevelUP & LevelDOWN. It exposes LevelUP on its export (i.e. you can `var leveldb = require('level')`).\n\n\n<a name=\"platforms\"></a>\nTested & supported platforms\n----------------------------\n\n  * **Linux**: including ARM platforms such as Raspberry Pi *and Kindle!*\n  * **Mac OS**\n  * **Solaris**: including Joyent's SmartOS & Nodejitsu\n  * **Windows**: Node 0.10 and above only. See installation instructions for *node-gyp's* dependencies [here](https://github.com/TooTallNate/node-gyp#installation), you'll need these (free) components from Microsoft to compile and run any native Node add-on in Windows.\n\n<a name=\"basic\"></a>\nBasic usage\n-----------\n\nFirst you need to install LevelUP!\n\n```sh\n$ npm install levelup leveldown\n```\n\nOr\n\n```sh\n$ npm install level\n```\n\n*(this second option requires you to use LevelUP by calling `var levelup = require('level')`)*\n\n\nAll operations are asynchronous although they don't necessarily require a callback if you don't need to know when the operation was performed.\n\n```js\nvar levelup = require('levelup')\n\n// 1) Create our database, supply location and options.\n//    This will create or open the underlying LevelDB store.\nvar db = levelup('./mydb')\n\n// 2) put a key & value\ndb.put('name', 'LevelUP', function (err) {\n  if (err) return console.log('Ooops!', err) // some kind of I/O error\n\n  // 3) fetch by key\n  db.get('name', function (err, value) {\n    if (err) return console.log('Ooops!', err) // likely the key was not found\n\n    // ta da!\n    console.log('name=' + value)\n  })\n})\n```\n\n<a name=\"api\"></a>\n## API\n\n  * <a href=\"#ctor\"><code><b>levelup()</b></code></a>\n  * <a href=\"#open\"><code>db.<b>open()</b></code></a>\n  * <a href=\"#close\"><code>db.<b>close()</b></code></a>\n  * <a href=\"#put\"><code>db.<b>put()</b></code></a>\n  * <a href=\"#get\"><code>db.<b>get()</b></code></a>\n  * <a href=\"#del\"><code>db.<b>del()</b></code></a>\n  * <a href=\"#batch\"><code>db.<b>batch()</b></code> *(array form)*</a>\n  * <a href=\"#batch_chained\"><code>db.<b>batch()</b></code> *(chained form)*</a>\n  * <a href=\"#isOpen\"><code>db.<b>isOpen()</b></code></a>\n  * <a href=\"#isClosed\"><code>db.<b>isClosed()</b></code></a>\n  * <a href=\"#createReadStream\"><code>db.<b>createReadStream()</b></code></a>\n  * <a href=\"#createKeyStream\"><code>db.<b>createKeyStream()</b></code></a>\n  * <a href=\"#createValueStream\"><code>db.<b>createValueStream()</b></code></a>\n  * <a href=\"#createWriteStream\"><code>db.<b>createWriteStream()</b></code></a>\n\n### Special operations exposed by LevelDOWN\n\n  * <a href=\"#approximateSize\"><code>db.db.<b>approximateSize()</b></code></a>\n  * <a href=\"#getProperty\"><code>db.db.<b>getProperty()</b></code></a>\n  * <a href=\"#destroy\"><code><b>leveldown.destroy()</b></code></a>\n  * <a href=\"#repair\"><code><b>leveldown.repair()</b></code></a>\n\n\n--------------------------------------------------------\n<a name=\"ctor\"></a>\n### levelup(location[, options[, callback]])\n### levelup(options[, callback ])\n### levelup(db[, callback ])\n<code>levelup()</code> is the main entry point for creating a new LevelUP instance and opening the underlying store with LevelDB.\n\nThis function returns a new instance of LevelUP and will also initiate an <a href=\"#open\"><code>open()</code></a> operation. Opening the database is an asynchronous operation which will trigger your callback if you provide one. The callback should take the form: `function (err, db) {}` where the `db` is the LevelUP instance. If you don't provide a callback, any read & write operations are simply queued internally until the database is fully opened.\n\nThis leads to two alternative ways of managing a new LevelUP instance:\n\n```js\nlevelup(location, options, function (err, db) {\n  if (err) throw err\n  db.get('foo', function (err, value) {\n    if (err) return console.log('foo does not exist')\n    console.log('got foo =', value)\n  })\n})\n\n// vs the equivalent:\n\nvar db = levelup(location, options) // will throw if an error occurs\ndb.get('foo', function (err, value) {\n  if (err) return console.log('foo does not exist')\n  console.log('got foo =', value)\n})\n```\n\nThe `location` argument is available as a read-only property on the returned LevelUP instance.\n\nThe `levelup(options, callback)` form (with optional `callback`) is only available where you provide a valid `'db'` property on the options object (see below). Only for back-ends that don't require a `location` argument, such as [MemDOWN](https://github.com/rvagg/memdown).\n\nFor example:\n\n```js\nvar levelup = require('levelup')\nvar memdown = require('memdown')\nvar db = levelup({ db: memdown })\n```\n\nThe `levelup(db, callback)` form (with optional `callback`) is only available where `db` is a factory function, as would be provided as a `'db'` property on an `options` object (see below). Only for back-ends that don't require a `location` argument, such as [MemDOWN](https://github.com/rvagg/memdown).\n\nFor example:\n\n```js\nvar levelup = require('levelup')\nvar memdown = require('memdown')\nvar db = levelup(memdown)\n```\n\n#### `options`\n\n`levelup()` takes an optional options object as its second argument; the following properties are accepted:\n\n* `'createIfMissing'` *(boolean, default: `true`)*: If `true`, will initialise an empty database at the specified location if one doesn't already exist. If `false` and a database doesn't exist you will receive an error in your `open()` callback and your database won't open.\n\n* `'errorIfExists'` *(boolean, default: `false`)*: If `true`, you will receive an error in your `open()` callback if the database exists at the specified location.\n\n* `'compression'` *(boolean, default: `true`)*: If `true`, all *compressible* data will be run through the Snappy compression algorithm before being stored. Snappy is very fast and shouldn't gain much speed by disabling so leave this on unless you have good reason to turn it off.\n\n* `'cacheSize'` *(number, default: `8 * 1024 * 1024`)*: The size (in bytes) of the in-memory [LRU](http://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used) cache with frequently used uncompressed block contents. \n\n* `'keyEncoding'` and `'valueEncoding'` *(string, default: `'utf8'`)*: The encoding of the keys and values passed through Node.js' `Buffer` implementation (see [Buffer#toString()](http://nodejs.org/docs/latest/api/buffer.html#buffer_buf_tostring_encoding_start_end)).\n  <p><code>'utf8'</code> is the default encoding for both keys and values so you can simply pass in strings and expect strings from your <code>get()</code> operations. You can also pass <code>Buffer</code> objects as keys and/or values and conversion will be performed.</p>\n  <p>Supported encodings are: hex, utf8, ascii, binary, base64, ucs2, utf16le.</p>\n  <p><code>'json'</code> encoding is also supported, see below.</p>\n\n* `'db'` *(object, default: LevelDOWN)*: LevelUP is backed by [LevelDOWN](https://github.com/rvagg/node-leveldown/) to provide an interface to LevelDB. You can completely replace the use of LevelDOWN by providing a \"factory\" function that will return a LevelDOWN API compatible object given a `location` argument. For further information, see [MemDOWN](https://github.com/rvagg/node-memdown/), a fully LevelDOWN API compatible replacement that uses a memory store rather than LevelDB. Also see [Abstract LevelDOWN](http://github.com/rvagg/node-abstract-leveldown), a partial implementation of the LevelDOWN API that can be used as a base prototype for a LevelDOWN substitute.\n\nAdditionally, each of the main interface methods accept an optional options object that can be used to override `'keyEncoding'` and `'valueEncoding'`.\n\n--------------------------------------------------------\n<a name=\"open\"></a>\n### db.open([callback])\n<code>open()</code> opens the underlying LevelDB store. In general **you should never need to call this method directly** as it's automatically called by <a href=\"#ctor\"><code>levelup()</code></a>.\n\nHowever, it is possible to *reopen* a database after it has been closed with <a href=\"#close\"><code>close()</code></a>, although this is not generally advised.\n\n--------------------------------------------------------\n<a name=\"close\"></a>\n### db.close([callback])\n<code>close()</code> closes the underlying LevelDB store. The callback will receive any error encountered during closing as the first argument.\n\nYou should always clean up your LevelUP instance by calling `close()` when you no longer need it to free up resources. A LevelDB store cannot be opened by multiple instances of LevelDB/LevelUP simultaneously.\n\n--------------------------------------------------------\n<a name=\"put\"></a>\n### db.put(key, value[, options][, callback])\n<code>put()</code> is the primary method for inserting data into the store. Both the `key` and `value` can be arbitrary data objects.\n\nThe callback argument is optional but if you don't provide one and an error occurs then expect the error to be thrown.\n\n#### `options`\n\nEncoding of the `key` and `value` objects will adhere to `'keyEncoding'` and `'valueEncoding'` options provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `put()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nIf you provide a `'sync'` value of `true` in your `options` object, LevelDB will perform a synchronous write of the data; although the operation will be asynchronous as far as Node is concerned. Normally, LevelDB passes the data to the operating system for writing and returns immediately, however a synchronous write will use `fsync()` or equivalent so your callback won't be triggered until the data is actually on disk. Synchronous filesystem writes are **significantly** slower than asynchronous writes but if you want to be absolutely sure that the data is flushed then you can use `'sync': true`.\n\n--------------------------------------------------------\n<a name=\"get\"></a>\n### db.get(key[, options][, callback])\n<code>get()</code> is the primary method for fetching data from the store. The `key` can be an arbitrary data object. If it doesn't exist in the store then the callback will receive an error as its first argument. A not-found err object will be of type `'NotFoundError'` so you can `err.type == 'NotFoundError'` or you can perform a truthy test on the property `err.notFound`.\n\n```js\ndb.get('foo', function (err, value) {\n  if (err) {\n    if (err.notFound) {\n      // handle a 'NotFoundError' here\n      return\n    }\n    // I/O or other error, pass it up the callback chain\n    return callback(err)\n  }\n\n  // .. handle `value` here\n})\n```\n\n#### `options`\n\nEncoding of the `key` object will adhere to the `'keyEncoding'` option provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `get()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nLevelDB will by default fill the in-memory LRU Cache with data from a call to get. Disabling this is done by setting `fillCache` to `false`. \n\n--------------------------------------------------------\n<a name=\"del\"></a>\n### db.del(key[, options][, callback])\n<code>del()</code> is the primary method for removing data from the store.\n\n#### `options`\n\nEncoding of the `key` object will adhere to the `'keyEncoding'` option provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `del()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nA `'sync'` option can also be passed, see <a href=\"#put\"><code>put()</code></a> for details on how this works.\n\n--------------------------------------------------------\n<a name=\"batch\"></a>\n### db.batch(array[, options][, callback]) *(array form)*\n<code>batch()</code> can be used for very fast bulk-write operations (both *put* and *delete*). The `array` argument should contain a list of operations to be executed sequentially, although as a whole they are performed as an atomic operation inside LevelDB. Each operation is contained in an object having the following properties: `type`, `key`, `value`, where the *type* is either `'put'` or `'del'`. In the case of `'del'` the `'value'` property is ignored. Any entries with a `'key'` of `null` or `undefined` will cause an error to be returned on the `callback` and any `'type': 'put'` entry with a `'value'` of `null` or `undefined` will return an error.\n\n```js\nvar ops = [\n    { type: 'del', key: 'father' }\n  , { type: 'put', key: 'name', value: 'Yuri Irsenovich Kim' }\n  , { type: 'put', key: 'dob', value: '16 February 1941' }\n  , { type: 'put', key: 'spouse', value: 'Kim Young-sook' }\n  , { type: 'put', key: 'occupation', value: 'Clown' }\n]\n\ndb.batch(ops, function (err) {\n  if (err) return console.log('Ooops!', err)\n  console.log('Great success dear leader!')\n})\n```\n\n#### `options`\n\nSee <a href=\"#put\"><code>put()</code></a> for a discussion on the `options` object. You can overwrite default `'keyEncoding'` and `'valueEncoding'` and also specify the use of `sync` filesystem operations.\n\nIn addition to encoding options for the whole batch you can also overwrite the encoding per operation, like:\n\n```js\nvar ops = [{\n    type          : 'put'\n  , key           : new Buffer([1, 2, 3])\n  , value         : { some: 'json' }\n  , keyEncoding   : 'binary'\n  , valueEncoding : 'json'\n}]\n```\n\n--------------------------------------------------------\n<a name=\"batch_chained\"></a>\n### db.batch() *(chained form)*\n<code>batch()</code>, when called with no arguments will return a `Batch` object which can be used to build, and eventually commit, an atomic LevelDB batch operation. Depending on how it's used, it is possible to obtain greater performance when using the chained form of `batch()` over the array form.\n\n```js\ndb.batch()\n  .del('father')\n  .put('name', 'Yuri Irsenovich Kim')\n  .put('dob', '16 February 1941')\n  .put('spouse', 'Kim Young-sook')\n  .put('occupation', 'Clown')\n  .write(function () { console.log('Done!') })\n```\n\n<b><code>batch.put(key, value[, options])</code></b>\n\nQueue a *put* operation on the current batch, not committed until a `write()` is called on the batch.\n\nThe optional `options` argument can be used to override the default `'keyEncoding'` and/or `'valueEncoding'`.\n\nThis method may `throw` a `WriteError` if there is a problem with your put (such as the `value` being `null` or `undefined`).\n\n<b><code>batch.del(key[, options])</code></b>\n\nQueue a *del* operation on the current batch, not committed until a `write()` is called on the batch.\n\nThe optional `options` argument can be used to override the default `'keyEncoding'`.\n\nThis method may `throw` a `WriteError` if there is a problem with your delete.\n\n<b><code>batch.clear()</code></b>\n\nClear all queued operations on the current batch, any previous operations will be discarded.\n\n<b><code>batch.write([callback])</code></b>\n\nCommit the queued operations for this batch. All operations not *cleared* will be written to the database atomically, that is, they will either all succeed or fail with no partial commits. The optional `callback` will be called when the operation has completed with an *error* argument if an error has occurred; if no `callback` is supplied and an error occurs then this method will `throw` a `WriteError`.\n\n\n--------------------------------------------------------\n<a name=\"isOpen\"></a>\n### db.isOpen()\n\nA LevelUP object can be in one of the following states:\n\n  * *\"new\"*     - newly created, not opened or closed\n  * *\"opening\"* - waiting for the database to be opened\n  * *\"open\"*    - successfully opened the database, available for use\n  * *\"closing\"* - waiting for the database to be closed\n  * *\"closed\"*  - database has been successfully closed, should not be used\n\n`isOpen()` will return `true` only when the state is \"open\".\n\n--------------------------------------------------------\n<a name=\"isClosed\"></a>\n### db.isClosed()\n\n*See <a href=\"#put\"><code>isOpen()</code></a>*\n\n`isClosed()` will return `true` only when the state is \"closing\" *or* \"closed\", it can be useful for determining if read and write operations are permissible.\n\n--------------------------------------------------------\n<a name=\"createReadStream\"></a>\n### db.createReadStream([options])\n\nYou can obtain a **ReadStream** of the full database by calling the `createReadStream()` method. The resulting stream is a complete Node.js-style [Readable Stream](http://nodejs.org/docs/latest/api/stream.html#stream_readable_stream) where `'data'` events emit objects with `'key'` and `'value'` pairs. You can also use the `gt`, `lt` and `limit` options to control the range of keys that are streamed.\n\n```js\ndb.createReadStream()\n  .on('data', function (data) {\n    console.log(data.key, '=', data.value)\n  })\n  .on('error', function (err) {\n    console.log('Oh my!', err)\n  })\n  .on('close', function () {\n    console.log('Stream closed')\n  })\n  .on('end', function () {\n    console.log('Stream closed')\n  })\n```\n\nThe standard `pause()`, `resume()` and `destroy()` methods are implemented on the ReadStream, as is `pipe()` (see below). `'data'`, '`error'`, `'end'` and `'close'` events are emitted.\n\nAdditionally, you can supply an options object as the first parameter to `createReadStream()` with the following options:\n\n* `'gt'` (greater than), `'gte'` (greater than or equal) define the lower bound of the range to be streamed. Only records where the key is greater than (or equal to) this option will be included in the range. When `reverse=true` the order will be reversed, but the records streamed will be the same.\n\n* `'lt'` (less than), `'lte'` (less than or equal) define the higher bound of the range to be streamed. Only key/value pairs where the key is less than (or equal to) this option will be included in the range. When `reverse=true` the order will be reversed, but the records streamed will be the same.\n\n* `'start', 'end'` legacy ranges - instead use `'gte', 'lte'`\n\n* `'reverse'` *(boolean, default: `false`)*: a boolean, set true and the stream output will be reversed. Beware that due to the way LevelDB works, a reverse seek will be slower than a forward seek.\n\n* `'keys'` *(boolean, default: `true`)*: whether the `'data'` event should contain keys. If set to `true` and `'values'` set to `false` then `'data'` events will simply be keys, rather than objects with a `'key'` property. Used internally by the `createKeyStream()` method.\n\n* `'values'` *(boolean, default: `true`)*: whether the `'data'` event should contain values. If set to `true` and `'keys'` set to `false` then `'data'` events will simply be values, rather than objects with a `'value'` property. Used internally by the `createValueStream()` method.\n\n* `'limit'` *(number, default: `-1`)*: limit the number of results collected by this stream. This number represents a *maximum* number of results and may not be reached if you get to the end of the data first. A value of `-1` means there is no limit. When `reverse=true` the highest keys will be returned instead of the lowest keys.\n\n* `'fillCache'` *(boolean, default: `false`)*: wheather LevelDB's LRU-cache should be filled with data read.\n\n* `'keyEncoding'` / `'valueEncoding'` *(string)*: the encoding applied to each read piece of data.\n\n--------------------------------------------------------\n<a name=\"createKeyStream\"></a>\n### db.createKeyStream([options])\n\nA **KeyStream** is a **ReadStream** where the `'data'` events are simply the keys from the database so it can be used like a traditional stream rather than an object stream.\n\nYou can obtain a KeyStream either by calling the `createKeyStream()` method on a LevelUP object or by passing passing an options object to `createReadStream()` with `keys` set to `true` and `values` set to `false`.\n\n```js\ndb.createKeyStream()\n  .on('data', function (data) {\n    console.log('key=', data)\n  })\n\n// same as:\ndb.createReadStream({ keys: true, values: false })\n  .on('data', function (data) {\n    console.log('key=', data)\n  })\n```\n\n--------------------------------------------------------\n<a name=\"createValueStream\"></a>\n### db.createValueStream([options])\n\nA **ValueStream** is a **ReadStream** where the `'data'` events are simply the values from the database so it can be used like a traditional stream rather than an object stream.\n\nYou can obtain a ValueStream either by calling the `createValueStream()` method on a LevelUP object or by passing passing an options object to `createReadStream()` with `values` set to `true` and `keys` set to `false`.\n\n```js\ndb.createValueStream()\n  .on('data', function (data) {\n    console.log('value=', data)\n  })\n\n// same as:\ndb.createReadStream({ keys: false, values: true })\n  .on('data', function (data) {\n    console.log('value=', data)\n  })\n```\n\n--------------------------------------------------------\n<a name=\"createWriteStream\"></a>\n### db.createWriteStream([options])\n\nA **WriteStream** can be obtained by calling the `createWriteStream()` method. The resulting stream is a complete Node.js-style [Writable Stream](http://nodejs.org/docs/latest/api/stream.html#stream_writable_stream) which accepts objects with `'key'` and `'value'` pairs on its `write()` method.\n\nThe WriteStream will buffer writes and submit them as a `batch()` operations where writes occur *within the same tick*.\n\n```js\nvar ws = db.createWriteStream()\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ key: 'name', value: 'Yuri Irsenovich Kim' })\nws.write({ key: 'dob', value: '16 February 1941' })\nws.write({ key: 'spouse', value: 'Kim Young-sook' })\nws.write({ key: 'occupation', value: 'Clown' })\nws.end()\n```\n\nThe standard `write()`, `end()`, `destroy()` and `destroySoon()` methods are implemented on the WriteStream. `'drain'`, `'error'`, `'close'` and `'pipe'` events are emitted.\n\nYou can specify encodings both for the whole stream and individual entries:\n\nTo set the encoding for the whole stream, provide an options object as the first parameter to `createWriteStream()` with `'keyEncoding'` and/or `'valueEncoding'`.\n\nTo set the encoding for an individual entry:\n\n```js\nwriteStream.write({\n    key           : new Buffer([1, 2, 3])\n  , value         : { some: 'json' }\n  , keyEncoding   : 'binary'\n  , valueEncoding : 'json'\n})\n```\n\n#### write({ type: 'put' })\n\nIf individual `write()` operations are performed with a `'type'` property of `'del'`, they will be passed on as `'del'` operations to the batch.\n\n```js\nvar ws = db.createWriteStream()\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ type: 'del', key: 'name' })\nws.write({ type: 'del', key: 'dob' })\nws.write({ type: 'put', key: 'spouse' })\nws.write({ type: 'del', key: 'occupation' })\nws.end()\n```\n\n#### db.createWriteStream({ type: 'del' })\n\nIf the *WriteStream* is created with a `'type'` option of `'del'`, all `write()` operations will be interpreted as `'del'`, unless explicitly specified as `'put'`.\n\n```js\nvar ws = db.createWriteStream({ type: 'del' })\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ key: 'name' })\nws.write({ key: 'dob' })\n// but it can be overridden\nws.write({ type: 'put', key: 'spouse', value: 'Ri Sol-ju' })\nws.write({ key: 'occupation' })\nws.end()\n```\n\n#### Pipes and Node Stream compatibility\n\nA ReadStream can be piped directly to a WriteStream, allowing for easy copying of an entire database. A simple `copy()` operation is included in LevelUP that performs exactly this on two open databases:\n\n```js\nfunction copy (srcdb, dstdb, callback) {\n  srcdb.createReadStream().pipe(dstdb.createWriteStream()).on('close', callback)\n}\n```\n\nThe ReadStream is also [fstream](https://github.com/isaacs/fstream)-compatible which means you should be able to pipe to and from fstreams. So you can serialize and deserialize an entire database to a directory where keys are filenames and values are their contents, or even into a *tar* file using [node-tar](https://github.com/isaacs/node-tar). See the [fstream functional test](https://github.com/rvagg/node-levelup/blob/master/test/functional/fstream-test.js) for an example. *(Note: I'm not really sure there's a great use-case for this but it's a fun example and it helps to harden the stream implementations.)*\n\nKeyStreams and ValueStreams can be treated like standard streams of raw data. If `'keyEncoding'` or `'valueEncoding'` is set to `'binary'` the `'data'` events will simply be standard Node `Buffer` objects straight out of the data store.\n\n\n--------------------------------------------------------\n<a name='approximateSize'></a>\n### db.db.approximateSize(start, end, callback)\n<code>approximateSize()</code> can used to get the approximate number of bytes of file system space used by the range `[start..end)`. The result may not include recently written data.\n\n```js\nvar db = require('level')('./huge.db')\n\ndb.db.approximateSize('a', 'c', function (err, size) {\n  if (err) return console.error('Ooops!', err)\n  console.log('Approximate size of range is %d', size)\n})\n```\n\n**Note:** `approximateSize()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/), which by default is accessible as the `db` property of your LevelUP instance. This is a specific LevelDB operation and is not likely to be available where you replace LevelDOWN with an alternative back-end via the `'db'` option.\n\n\n--------------------------------------------------------\n<a name='getProperty'></a>\n### db.db.getProperty(property)\n<code>getProperty</code> can be used to get internal details from LevelDB. When issued with a valid property string, a readable string will be returned (this method is synchronous).\n\nCurrently, the only valid properties are:\n\n* <b><code>'leveldb.num-files-at-levelN'</code></b>: returns the number of files at level *N*, where N is an integer representing a valid level (e.g. \"0\").\n\n* <b><code>'leveldb.stats'</code></b>: returns a multi-line string describing statistics about LevelDB's internal operation.\n\n* <b><code>'leveldb.sstables'</code></b>: returns a multi-line string describing all of the *sstables* that make up contents of the current database.\n\n\n```js\nvar db = require('level')('./huge.db')\nconsole.log(db.db.getProperty('leveldb.num-files-at-level3'))\n// → '243'\n```\n\n**Note:** `getProperty()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/), which by default is accessible as the `db` property of your LevelUP instance. This is a specific LevelDB operation and is not likely to be available where you replace LevelDOWN with an alternative back-end via the `'db'` option.\n\n\n--------------------------------------------------------\n<a name=\"destroy\"></a>\n### leveldown.destroy(location, callback)\n<code>destroy()</code> is used to completely remove an existing LevelDB database directory. You can use this function in place of a full directory *rm* if you want to be sure to only remove LevelDB-related files. If the directory only contains LevelDB files, the directory itself will be removed as well. If there are additional, non-LevelDB files in the directory, those files, and the directory, will be left alone.\n\nThe callback will be called when the destroy operation is complete, with a possible `error` argument.\n\n**Note:** `destroy()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/) which you will have to install seperately, e.g.:\n\n```js\nrequire('leveldown').destroy('./huge.db', function (err) { console.log('done!') })\n```\n\n--------------------------------------------------------\n<a name=\"repair\"></a>\n### leveldown.repair(location, callback)\n<code>repair()</code> can be used to attempt a restoration of a damaged LevelDB store. From the LevelDB documentation:\n\n> If a DB cannot be opened, you may attempt to call this method to resurrect as much of the contents of the database as possible. Some data may be lost, so be careful when calling this function on a database that contains important information.\n\nYou will find information on the *repair* operation in the *LOG* file inside the store directory. \n\nA `repair()` can also be used to perform a compaction of the LevelDB log into table files.\n\nThe callback will be called when the repair operation is complete, with a possible `error` argument.\n\n**Note:** `repair()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/) which you will have to install seperately, e.g.:\n\n```js\nrequire('leveldown').repair('./huge.db', function (err) { console.log('done!') })\n```\n\n--------------------------------------------------------\n\n<a name=\"events\"></a>\nEvents\n------\n\nLevelUP emits events when the callbacks to the corresponding methods are called.\n\n* `db.emit('put', key, value)` emitted when a new value is `'put'`\n* `db.emit('del', key)` emitted when a value is deleted\n* `db.emit('batch', ary)` emitted when a batch operation has executed\n* `db.emit('ready')` emitted when the database has opened (`'open'` is synonym)\n* `db.emit('closed')` emitted when the database has closed\n* `db.emit('opening')` emitted when the database is opening\n* `db.emit('closing')` emitted when the database is closing\n\nIf you do not pass a callback to an async function, and there is an error, LevelUP will `emit('error', err)` instead.\n\n<a name=\"json\"></a>\nJSON data\n---------\n\nYou specify `'json'` encoding for both keys and/or values, you can then supply JavaScript objects to LevelUP and receive them from all fetch operations, including ReadStreams. LevelUP will automatically *stringify* your objects and store them as *utf8* and parse the strings back into objects before passing them back to you.\n\n<a name=\"custom_encodings\"></a>\nCustom encodings\n----------------\n\nA custom encoding may be provided by passing in an object as an value for `keyEncoding` or `valueEncoding` (wherever accepted), it must have the following properties:\n\n```js\n{\n    encode : function (val) { ... }\n  , decode : function (val) { ... }\n  , buffer : boolean // encode returns a buffer and decode accepts a buffer\n  , type   : String  // name of this encoding type.\n}\n```\n\n<a name=\"extending\"></a>\nExtending LevelUP\n-----------------\n\nA list of <a href=\"https://github.com/rvagg/node-levelup/wiki/Modules\"><b>Node.js LevelDB modules and projects</b></a> can be found in the wiki.\n\nWhen attempting to extend the functionality of LevelUP, it is recommended that you consider using [level-hooks](https://github.com/dominictarr/level-hooks) and/or [level-sublevel](https://github.com/dominictarr/level-sublevel). **level-sublevel** is particularly helpful for keeping additional, extension-specific, data in a LevelDB store. It allows you to partition a LevelUP instance into multiple sub-instances that each correspond to discrete namespaced key ranges.\n\n<a name=\"multiproc\"></a>\nMulti-process access\n--------------------\n\nLevelDB is thread-safe but is **not** suitable for accessing with multiple processes. You should only ever have a LevelDB database open from a single Node.js process. Node.js clusters are made up of multiple processes so a LevelUP instance cannot be shared between them either.\n\nSee the <a href=\"https://github.com/rvagg/node-levelup/wiki/Modules\"><b>wiki</b></a> for some LevelUP extensions, including [multilevel](https://github.com/juliangruber/multilevel), that may help if you require a single data store to be shared across processes.\n\n<a name=\"support\"></a>\nGetting support\n---------------\n\nThere are multiple ways you can find help in using LevelDB in Node.js:\n\n * **IRC:** you'll find an active group of LevelUP users in the **##leveldb** channel on Freenode, including most of the contributors to this project.\n * **Mailing list:** there is an active [Node.js LevelDB](https://groups.google.com/forum/#!forum/node-levelup) Google Group.\n * **GitHub:** you're welcome to open an issue here on this GitHub repository if you have a question.\n\n<a name=\"contributing\"></a>\nContributing\n------------\n\nLevelUP is an **OPEN Open Source Project**. This means that:\n\n> Individuals making significant and valuable contributions are given commit-access to the project to contribute as they see fit. This project is more like an open wiki than a standard guarded open source project.\n\nSee the [CONTRIBUTING.md](https://github.com/rvagg/node-levelup/blob/master/CONTRIBUTING.md) file for more details.\n\n### Contributors\n\nLevelUP is only possible due to the excellent work of the following contributors:\n\n<table><tbody>\n<tr><th align=\"left\">Rod Vagg</th><td><a href=\"https://github.com/rvagg\">GitHub/rvagg</a></td><td><a href=\"http://twitter.com/rvagg\">Twitter/@rvagg</a></td></tr>\n<tr><th align=\"left\">John Chesley</th><td><a href=\"https://github.com/chesles/\">GitHub/chesles</a></td><td><a href=\"http://twitter.com/chesles\">Twitter/@chesles</a></td></tr>\n<tr><th align=\"left\">Jake Verbaten</th><td><a href=\"https://github.com/raynos\">GitHub/raynos</a></td><td><a href=\"http://twitter.com/raynos2\">Twitter/@raynos2</a></td></tr>\n<tr><th align=\"left\">Dominic Tarr</th><td><a href=\"https://github.com/dominictarr\">GitHub/dominictarr</a></td><td><a href=\"http://twitter.com/dominictarr\">Twitter/@dominictarr</a></td></tr>\n<tr><th align=\"left\">Max Ogden</th><td><a href=\"https://github.com/maxogden\">GitHub/maxogden</a></td><td><a href=\"http://twitter.com/maxogden\">Twitter/@maxogden</a></td></tr>\n<tr><th align=\"left\">Lars-Magnus Skog</th><td><a href=\"https://github.com/ralphtheninja\">GitHub/ralphtheninja</a></td><td><a href=\"http://twitter.com/ralphtheninja\">Twitter/@ralphtheninja</a></td></tr>\n<tr><th align=\"left\">David Björklund</th><td><a href=\"https://github.com/kesla\">GitHub/kesla</a></td><td><a href=\"http://twitter.com/david_bjorklund\">Twitter/@david_bjorklund</a></td></tr>\n<tr><th align=\"left\">Julian Gruber</th><td><a href=\"https://github.com/juliangruber\">GitHub/juliangruber</a></td><td><a href=\"http://twitter.com/juliangruber\">Twitter/@juliangruber</a></td></tr>\n<tr><th align=\"left\">Paolo Fragomeni</th><td><a href=\"https://github.com/hij1nx\">GitHub/hij1nx</a></td><td><a href=\"http://twitter.com/hij1nx\">Twitter/@hij1nx</a></td></tr>\n<tr><th align=\"left\">Anton Whalley</th><td><a href=\"https://github.com/No9\">GitHub/No9</a></td><td><a href=\"https://twitter.com/antonwhalley\">Twitter/@antonwhalley</a></td></tr>\n<tr><th align=\"left\">Matteo Collina</th><td><a href=\"https://github.com/mcollina\">GitHub/mcollina</a></td><td><a href=\"https://twitter.com/matteocollina\">Twitter/@matteocollina</a></td></tr>\n<tr><th align=\"left\">Pedro Teixeira</th><td><a href=\"https://github.com/pgte\">GitHub/pgte</a></td><td><a href=\"https://twitter.com/pgte\">Twitter/@pgte</a></td></tr>\n<tr><th align=\"left\">James Halliday</th><td><a href=\"https://github.com/substack\">GitHub/substack</a></td><td><a href=\"https://twitter.com/substack\">Twitter/@substack</a></td></tr>\n</tbody></table>\n\n### Windows\n\nA large portion of the Windows support comes from code by [Krzysztof Kowalczyk](http://blog.kowalczyk.info/) [@kjk](https://twitter.com/kjk), see his Windows LevelDB port [here](http://code.google.com/r/kkowalczyk-leveldb/). If you're using LevelUP on Windows, you should give him your thanks!\n\n\n<a name=\"license\"></a>\nLicense &amp; copyright\n-------------------\n\nCopyright (c) 2012-2014 LevelUP contributors (listed above).\n\nLevelUP is licensed under the MIT license. All rights not explicitly granted in the MIT license are reserved. See the included LICENSE.md file for more details.\n\n=======\n*LevelUP builds on the excellent work of the LevelDB and Snappy teams from Google and additional contributors. LevelDB and Snappy are both issued under the [New BSD Licence](http://opensource.org/licenses/BSD-3-Clause).*\n",readmeFilename:"README.md",bugs:{url:"https://github.com/rvagg/node-levelup/issues"},_id:"levelup@0.19.0",_from:"levelup@*"}
},{}],117:[function(require,module,exports){(function(){if(typeof module==="object"&&module.exports){module.exports=LRUCache}else{this.LRUCache=LRUCache}function hOP(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function naiveLength(){return 1}function LRUCache(options){if(!(this instanceof LRUCache))return new LRUCache(options);if(typeof options==="number")options={max:options};if(!options)options={};this._max=options.max;if(!this._max||!(typeof this._max==="number")||this._max<=0)this._max=Infinity;this._lengthCalculator=options.length||naiveLength;if(typeof this._lengthCalculator!=="function")this._lengthCalculator=naiveLength;this._allowStale=options.stale||false;this._maxAge=options.maxAge||null;this._dispose=options.dispose;this.reset()}Object.defineProperty(LRUCache.prototype,"max",{set:function(mL){if(!mL||!(typeof mL==="number")||mL<=0)mL=Infinity;this._max=mL;if(this._length>this._max)trim(this)},get:function(){return this._max},enumerable:true});Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(lC){if(typeof lC!=="function"){this._lengthCalculator=naiveLength;this._length=this._itemCount;for(var key in this._cache){this._cache[key].length=1}}else{this._lengthCalculator=lC;this._length=0;for(var key in this._cache){this._cache[key].length=this._lengthCalculator(this._cache[key].value);this._length+=this._cache[key].length}}if(this._length>this._max)trim(this)},get:function(){return this._lengthCalculator},enumerable:true});Object.defineProperty(LRUCache.prototype,"length",{get:function(){return this._length},enumerable:true});Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:true});LRUCache.prototype.forEach=function(fn,thisp){thisp=thisp||this;var i=0;for(var k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){i++;var hit=this._lruList[k];if(this._maxAge&&Date.now()-hit.now>this._maxAge){del(this,hit);if(!this._allowStale)hit=undefined}if(hit){fn.call(thisp,hit.value,hit.key,this)}}};LRUCache.prototype.keys=function(){var keys=new Array(this._itemCount);var i=0;for(var k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){var hit=this._lruList[k];keys[i++]=hit.key}return keys};LRUCache.prototype.values=function(){var values=new Array(this._itemCount);var i=0;for(var k=this._mru-1;k>=0&&i<this._itemCount;k--)if(this._lruList[k]){var hit=this._lruList[k];values[i++]=hit.value}return values};LRUCache.prototype.reset=function(){if(this._dispose&&this._cache){for(var k in this._cache){this._dispose(k,this._cache[k].value)}}this._cache=Object.create(null);this._lruList=Object.create(null);this._mru=0;this._lru=0;this._length=0;this._itemCount=0};LRUCache.prototype.dump=function(){return this._cache};LRUCache.prototype.dumpLru=function(){return this._lruList};LRUCache.prototype.set=function(key,value){if(hOP(this._cache,key)){if(this._dispose)this._dispose(key,this._cache[key].value);if(this._maxAge)this._cache[key].now=Date.now();this._cache[key].value=value;this.get(key);return true}var len=this._lengthCalculator(value);var age=this._maxAge?Date.now():0;var hit=new Entry(key,value,this._mru++,len,age);if(hit.length>this._max){if(this._dispose)this._dispose(key,value);return false}this._length+=hit.length;this._lruList[hit.lu]=this._cache[key]=hit;this._itemCount++;if(this._length>this._max)trim(this);return true};LRUCache.prototype.has=function(key){if(!hOP(this._cache,key))return false;var hit=this._cache[key];if(this._maxAge&&Date.now()-hit.now>this._maxAge){return false}return true};LRUCache.prototype.get=function(key){return get(this,key,true)};LRUCache.prototype.peek=function(key){return get(this,key,false)};LRUCache.prototype.pop=function(){var hit=this._lruList[this._lru];del(this,hit);return hit||null};LRUCache.prototype.del=function(key){del(this,this._cache[key])};function get(self,key,doUse){var hit=self._cache[key];if(hit){if(self._maxAge&&Date.now()-hit.now>self._maxAge){del(self,hit);if(!self._allowStale)hit=undefined}else{if(doUse)use(self,hit)}if(hit)hit=hit.value}return hit}function use(self,hit){shiftLU(self,hit);hit.lu=self._mru++;self._lruList[hit.lu]=hit}function trim(self){while(self._lru<self._mru&&self._length>self._max)del(self,self._lruList[self._lru])}function shiftLU(self,hit){delete self._lruList[hit.lu];while(self._lru<self._mru&&!self._lruList[self._lru])self._lru++}function del(self,hit){if(hit){if(self._dispose)self._dispose(hit.key,hit.value);self._length-=hit.length;self._itemCount--;delete self._cache[hit.key];shiftLU(self,hit)}}function Entry(key,value,lu,length,now){this.key=key;this.value=value;this.lu=lu;this.length=length;this.now=now}})()},{}],118:[function(require,module,exports){var intShim=require("jsbn");var BigInteger=intShim.BigInteger?intShim.BigInteger:intShim;function parseBigInt(str,r){return new BigInteger(str,r)}function _asnhex_getByteLengthOfL_AtObj(s,pos){if(s.substring(pos+2,pos+3)!="8")return 1;var i=parseInt(s.substring(pos+3,pos+4));if(i==0)return-1;if(0<i&&i<10)return i+1;return-2}function _asnhex_getHexOfL_AtObj(s,pos){var len=_asnhex_getByteLengthOfL_AtObj(s,pos);if(len<1)return"";return s.substring(pos+2,pos+2+len*2)}function _asnhex_getIntOfL_AtObj(s,pos){var hLength=_asnhex_getHexOfL_AtObj(s,pos);if(hLength=="")return-1;var bi;if(parseInt(hLength.substring(0,1))<8){bi=parseBigInt(hLength,16)}else{bi=parseBigInt(hLength.substring(2),16)}return bi.intValue()}function _asnhex_getStartPosOfV_AtObj(s,pos){var l_len=_asnhex_getByteLengthOfL_AtObj(s,pos);if(l_len<0)return l_len;return pos+(l_len+1)*2}function _asnhex_getHexOfV_AtObj(s,pos){var pos1=_asnhex_getStartPosOfV_AtObj(s,pos);var len=_asnhex_getIntOfL_AtObj(s,pos);return s.substring(pos1,pos1+len*2)}function _asnhex_getHexOfTLV_AtObj(s,pos){var hT=s.substr(pos,2);var hL=_asnhex_getHexOfL_AtObj(s,pos);var hV=_asnhex_getHexOfV_AtObj(s,pos);return hT+hL+hV}function _asnhex_getPosOfNextSibling_AtObj(s,pos){var pos1=_asnhex_getStartPosOfV_AtObj(s,pos);var len=_asnhex_getIntOfL_AtObj(s,pos);return pos1+len*2}function _asnhex_getPosArrayOfChildren_AtObj(h,pos){var a=new Array;var p0=_asnhex_getStartPosOfV_AtObj(h,pos);a.push(p0);var len=_asnhex_getIntOfL_AtObj(h,pos);var p=p0;var k=0;while(1){var pNext=_asnhex_getPosOfNextSibling_AtObj(h,p);if(pNext==null||pNext-p0>=len*2)break;if(k>=200)break;a.push(pNext);p=pNext;k++}return a}function _asnhex_getNthChildIndex_AtObj(h,idx,nth){var a=_asnhex_getPosArrayOfChildren_AtObj(h,idx);return a[nth]}function _asnhex_getDecendantIndexByNthList(h,currentIndex,nthList){if(nthList.length==0){return currentIndex}var firstNth=nthList.shift();var a=_asnhex_getPosArrayOfChildren_AtObj(h,currentIndex);return _asnhex_getDecendantIndexByNthList(h,a[firstNth],nthList)}function _asnhex_getDecendantHexTLVByNthList(h,currentIndex,nthList){var idx=_asnhex_getDecendantIndexByNthList(h,currentIndex,nthList);return _asnhex_getHexOfTLV_AtObj(h,idx)}function _asnhex_getDecendantHexVByNthList(h,currentIndex,nthList){var idx=_asnhex_getDecendantIndexByNthList(h,currentIndex,nthList);return _asnhex_getHexOfV_AtObj(h,idx)}var ASN1HEX=function ASN1HEX(){return ASN1HEX};ASN1HEX.getByteLengthOfL_AtObj=_asnhex_getByteLengthOfL_AtObj;ASN1HEX.getHexOfL_AtObj=_asnhex_getHexOfL_AtObj;ASN1HEX.getIntOfL_AtObj=_asnhex_getIntOfL_AtObj;ASN1HEX.getStartPosOfV_AtObj=_asnhex_getStartPosOfV_AtObj;ASN1HEX.getHexOfV_AtObj=_asnhex_getHexOfV_AtObj;ASN1HEX.getHexOfTLV_AtObj=_asnhex_getHexOfTLV_AtObj;ASN1HEX.getPosOfNextSibling_AtObj=_asnhex_getPosOfNextSibling_AtObj;ASN1HEX.getPosArrayOfChildren_AtObj=_asnhex_getPosArrayOfChildren_AtObj;ASN1HEX.getNthChildIndex_AtObj=_asnhex_getNthChildIndex_AtObj;ASN1HEX.getDecendantIndexByNthList=_asnhex_getDecendantIndexByNthList;ASN1HEX.getDecendantHexVByNthList=_asnhex_getDecendantHexVByNthList;ASN1HEX.getDecendantHexTLVByNthList=_asnhex_getDecendantHexTLVByNthList;exports.ASN1HEX=ASN1HEX;module.exports=exports},{jsbn:192}],119:[function(require,module,exports){var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";function int2char(n){return BI_RM.charAt(n)}function hex2b64(h){var i;var c;var ret="";for(i=0;i+3<=h.length;i+=3){c=parseInt(h.substring(i,i+3),16);ret+=b64map.charAt(c>>6)+b64map.charAt(c&63)}if(i+1==h.length){c=parseInt(h.substring(i,i+1),16);ret+=b64map.charAt(c<<2)}else if(i+2==h.length){c=parseInt(h.substring(i,i+2),16);ret+=b64map.charAt(c>>2)+b64map.charAt((c&3)<<4)}if(b64pad)while((ret.length&3)>0)ret+=b64pad;return ret}function b64tohex(s){var ret="";var i;var k=0;var slop;for(i=0;i<s.length;++i){if(s.charAt(i)==b64pad)break;v=b64map.indexOf(s.charAt(i));if(v<0)continue;if(k==0){ret+=int2char(v>>2);slop=v&3;k=1}else if(k==1){ret+=int2char(slop<<2|v>>4);slop=v&15;k=2}else if(k==2){ret+=int2char(slop);ret+=int2char(v>>2);slop=v&3;k=3}else{ret+=int2char(slop<<2|v>>4);ret+=int2char(v&15);k=0}}if(k==1)ret+=int2char(slop<<2);return ret}function b64toBA(s){var h=b64tohex(s);var i;var a=new Array;for(i=0;2*i<h.length;++i){a[i]=parseInt(h.substring(2*i,2*i+2),16)}return a}exports.b64tohex=b64tohex;exports.b64toBA=b64toBA;exports.hex2b64=hex2b64;module.exports=exports},{}],120:[function(require,module,exports){var CryptoJS=CryptoJS||function(Math,undefined){var C={};var C_lib=C.lib={};var Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;if(overrides){subtype.mixIn(overrides)}if(!subtype.hasOwnProperty("init")){subtype.init=function(){subtype.$super.init.apply(this,arguments)}}subtype.init.prototype=subtype;subtype.$super=this;return subtype},create:function(){var instance=this.extend();instance.init.apply(instance,arguments);return instance},init:function(){},mixIn:function(properties){for(var propertyName in properties){if(properties.hasOwnProperty(propertyName)){this[propertyName]=properties[propertyName]}}if(properties.hasOwnProperty("toString")){this.toString=properties.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes}else{this.sigBytes=words.length*4}},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words;var thatWords=wordArray.words;var thisSigBytes=this.sigBytes;var thatSigBytes=wordArray.sigBytes;this.clamp();if(thisSigBytes%4){for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}}else if(thatWords.length>65535){for(var i=0;i<thatSigBytes;i+=4){thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2]}}else{thisWords.push.apply(thisWords,thatWords)}this.sigBytes+=thatSigBytes;return this},clamp:function(){var words=this.words;var sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8;words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);clone.words=this.words.slice(0);return clone},random:function(nBytes){var words=[];for(var i=0;i<nBytes;i+=4){words.push(Math.random()*4294967296|0)}return new WordArray.init(words,nBytes)}});var C_enc=C.enc={};var Hex=C_enc.Hex={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var hexChars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16));hexChars.push((bite&15).toString(16))}return hexChars.join("")},parse:function(hexStr){var hexStrLength=hexStr.length;var words=[];for(var i=0;i<hexStrLength;i+=2){words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4}return new WordArray.init(words,hexStrLength/2)}};var Latin1=C_enc.Latin1={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var latin1Chars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){var latin1StrLength=latin1Str.length;var words=[];for(var i=0;i<latin1StrLength;i++){words[i>>>2]|=(latin1Str.charCodeAt(i)&255)<<24-i%4*8}return new WordArray.init(words,latin1StrLength)}};var Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}};var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init;this._nDataBytes=0},_append:function(data){if(typeof data=="string"){data=Utf8.parse(data)}this._data.concat(data);this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data;var dataWords=data.words;var dataSigBytes=data.sigBytes;var blockSize=this.blockSize;var blockSizeBytes=blockSize*4;var nBlocksReady=dataSigBytes/blockSizeBytes;if(doFlush){nBlocksReady=Math.ceil(nBlocksReady)}else{nBlocksReady=Math.max((nBlocksReady|0)-this._minBufferSize,0)}var nWordsReady=nBlocksReady*blockSize;var nBytesReady=Math.min(nWordsReady*4,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize){this._doProcessBlock(dataWords,offset)}var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);clone._data=this._data.clone();return clone},_minBufferSize:0});var Hasher=C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg);this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset()},update:function(messageUpdate){this._append(messageUpdate);this._process();return this},finalize:function(messageUpdate){if(messageUpdate){this._append(messageUpdate)}var hash=this._doFinalize();return hash},blockSize:512/32,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}});var C_algo=C.algo={};return C}(Math);exports.CryptoJS=CryptoJS;module.exports=exports},{}],121:[function(require,module,exports){var CryptoJS=require("./sha256.js").CryptoJS,intShim=require("jsbn");var BigInteger=intShim.BigInteger?intShim.BigInteger:intShim;function parseBigInt(str,r){return new BigInteger(str,r)}if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"};this.getDigestInfoHex=function(hHash,alg){if(typeof this.DIGESTINFOHEAD[alg]=="undefined")throw"alg not supported in Util.DIGESTINFOHEAD: "+alg;return this.DIGESTINFOHEAD[alg]+hHash};this.getPaddedDigestInfoHex=function(hHash,alg,keySize){var hDigestInfo=this.getDigestInfoHex(hHash,alg);var pmStrLen=keySize/4;if(hDigestInfo.length+22>pmStrLen)throw"key is too short for SigAlg: keylen="+keySize+","+alg;var hHead="0001";var hTail="00"+hDigestInfo;var hMid="";var fLen=pmStrLen-hHead.length-hTail.length;for(var i=0;i<fLen;i+=2){hMid+="ff"}var hPaddedMessage=hHead+hMid+hTail;return hPaddedMessage};this.sha1=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return md.digestString(s)};this.sha256=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestString(s)};this.sha512=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestString(s)};this.md5=function(s){var md=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return md.digestString(s)};this.ripemd160=function(s){var md=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return md.digestString(s)}};KJUR.crypto.MessageDigest=function(params){var md=null;var algName=null;var provName=null;var _CryptoJSMdName={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"};this.setAlgAndProvider=function(alg,prov){if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)!=-1&&prov=="cryptojs"){try{this.md=eval(_CryptoJSMdName[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)};this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.md.update(wHex)};this.digest=function(){var hash=this.md.finalize();return hash.toString(CryptoJS.enc.Hex)};this.digestString=function(str){this.updateString(str);return this.digest()};this.digestHex=function(hex){this.updateHex(hex);return this.digest()}}if(":sha256:".indexOf(alg)!=-1&&prov=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)};this.updateHex=function(hex){var baHex=sjcl.codec.hex.toBits(hex);this.md.update(baHex)};this.digest=function(){var hash=this.md.finalize();return sjcl.codec.hex.fromBits(hash)};this.digestString=function(str){this.updateString(str);return this.digest()};this.digestHex=function(hex){this.updateHex(hex);return this.digest()}}};this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digestString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digestHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName};if(typeof params!="undefined"){if(typeof params["alg"]!="undefined"){this.algName=params["alg"];this.provName=params["prov"];this.setAlgAndProvider(params["alg"],params["prov"])}}};KJUR.crypto.Signature=function(params){var prvKey=null;var pubKey=null;var md=null;var sig=null;var algName=null;var provName=null;var algProvName=null;var mdAlgName=null;var pubkeyAlgName=null;var state=null;var sHashHex=null;var hDigestInfo=null;var hPaddedDigestInfo=null;var hSign=null;this._setAlgNames=function(){if(this.algName.match(/^(.+)with(.+)$/)){this.mdAlgName=RegExp.$1.toLowerCase();this.pubkeyAlgName=RegExp.$2.toLowerCase()}};this._zeroPaddingOfSignature=function(hex,bitLength){var s="";var nZero=bitLength/4-hex.length;for(var i=0;i<nZero;i++){s=s+"0"}return s+hex};this.setAlgAndProvider=function(alg,prov){this._setAlgNames();if(prov!="cryptojs/jsrsa")throw"provider not supported: "+prov;if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName,prov:"cryptojs"})}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+ex}this.initSign=function(prvKey){this.prvKey=prvKey;this.state="SIGN"};this.initVerifyByPublicKey=function(rsaPubKey){this.pubKey=rsaPubKey;this.state="VERIFY"};this.initVerifyByCertificatePEM=function(certPEM){var x509=new X509;x509.readCertPEM(certPEM);this.pubKey=x509.subjectPublicKeyRSA;this.state="VERIFY"};this.updateString=function(str){this.md.updateString(str)};this.updateHex=function(hex){this.md.updateHex(hex)};this.sign=function(){var util=KJUR.crypto.Util;var keyLen=this.prvKey.n.bitLength();this.sHashHex=this.md.digest();this.hDigestInfo=util.getDigestInfoHex(this.sHashHex,this.mdAlgName);this.hPaddedDigestInfo=util.getPaddedDigestInfoHex(this.sHashHex,this.mdAlgName,keyLen);var biPaddedDigestInfo=parseBigInt(this.hPaddedDigestInfo,16);this.hoge=biPaddedDigestInfo.toString(16);var biSign=this.prvKey.doPrivate(biPaddedDigestInfo);this.hSign=this._zeroPaddingOfSignature(biSign.toString(16),keyLen);return this.hSign};this.signString=function(str){this.updateString(str);this.sign()};this.signHex=function(hex){this.updateHex(hex);this.sign()};this.verify=function(hSigVal){var util=KJUR.crypto.Util;var keyLen=this.pubKey.n.bitLength();this.sHashHex=this.md.digest();var biSigVal=parseBigInt(hSigVal,16);var biPaddedDigestInfo=this.pubKey.doPublic(biSigVal);this.hPaddedDigestInfo=biPaddedDigestInfo.toString(16);var s=this.hPaddedDigestInfo;s=s.replace(/^1ff+00/,"");var hDIHEAD=KJUR.crypto.Util.DIGESTINFOHEAD[this.mdAlgName];if(s.indexOf(hDIHEAD)!=0){return false}var hHashFromDI=s.substr(hDIHEAD.length);return hHashFromDI==this.sHashHex}}};this.initVerifyByPublicKey=function(rsaPubKey){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName};this.initVerifyByCertificatePEM=function(certPEM){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName};this.initSign=function(prvKey){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName};this.updateString=function(str){throw"updateString(str) not supported for this alg:prov="+this.algProvName};this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName};this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName};this.signString=function(str){throw"digestString(str) not supported for this alg:prov="+this.algProvName};this.signHex=function(hex){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName};this.verify=function(hSigVal){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName};if(typeof params!="undefined"){if(typeof params["alg"]!="undefined"){this.algName=params["alg"];this.provName=params["prov"];this.algProvName=params["alg"]+":"+params["prov"];this.setAlgAndProvider(params["alg"],params["prov"]);this._setAlgNames()}if(typeof params["prvkeypem"]!="undefined"){if(typeof params["prvkeypas"]!="undefined"){throw"both prvkeypem and prvkeypas parameters not supported"}else{try{var prvKey=new RSAKey;prvKey.readPrivateKeyFromPEMString(params["prvkeypem"]);this.initSign(prvKey)}catch(ex){throw"fatal error to load pem private key: "+ex}}}}};exports.KJUR=KJUR;module.exports=exports},{"./sha256.js":126,jsbn:192}],122:[function(require,module,exports){var intShim=require("jsbn");var BigInteger=intShim.BigInteger?intShim.BigInteger:intShim;function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){var ret="";var i=0;while(i+n<s.length){ret+=s.substring(i,i+n)+"\n";i+=n}return ret+s.substring(i,s.length)}function byte2Hex(b){if(b<16)return"0"+b.toString(16);else return b.toString(16)}function pkcs1pad2(s,n){if(n<s.length+11){alert("Message too long for RSA");return null}var ba=new Array;var i=s.length-1;while(i>=0&&n>0){var c=s.charCodeAt(i--);if(c<128){ba[--n]=c}else if(c>127&&c<2048){ba[--n]=c&63|128;ba[--n]=c>>6|192}else{ba[--n]=c&63|128;ba[--n]=c>>6&63|128;ba[--n]=c>>12|224}}ba[--n]=0;var rng=new SecureRandom;var x=new Array;while(n>2){x[0]=0;while(x[0]==0)rng.nextBytes(x);ba[--n]=x[0]}ba[--n]=2;ba[--n]=0;return new BigInteger(ba)}function oaep_mgf1_arr(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hash(String.fromCharCode.apply(String,seed.concat([(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])));i+=1}return mask}var SHA1_SIZE=20;function oaep_pad(s,n,hash){if(s.length+2*SHA1_SIZE+2>n){throw"Message too long for RSA"}var PS="",i;for(i=0;i<n-s.length-2*SHA1_SIZE-2;i+=1){PS+="\x00"}var DB=rstr_sha1("")+PS+""+s;var seed=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(seed);var dbMask=oaep_mgf1_arr(seed,DB.length,hash||rstr_sha1);var maskedDB=[];for(i=0;i<DB.length;i+=1){maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i)}var seedMask=oaep_mgf1_arr(maskedDB,seed.length,rstr_sha1);var maskedSeed=[0];for(i=0;i<seed.length;i+=1){maskedSeed[i+1]=seed[i]^seedMask.charCodeAt(i)}return new BigInteger(maskedSeed.concat(maskedDB))}var RSAKey=function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null};function RSASetPublic(N,E){if(typeof N!=="string"){this.n=N;this.e=E}else if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16)}else alert("Invalid RSA public key")}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,this.n.bitLength()+7>>3);if(m==null)return null;var c=this.doPublic(m);if(c==null)return null;var h=c.toString(16);if((h.length&1)==0)return h;else return"0"+h}function RSAEncryptOAEP(text,hash){var m=oaep_pad(text,this.n.bitLength()+7>>3,hash);if(m==null)return null;var c=this.doPublic(m);if(c==null)return null;var h=c.toString(16);if((h.length&1)==0)return h;else return"0"+h}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;RSAKey.prototype.encryptOAEP=RSAEncryptOAEP;exports.RSAKey=RSAKey;module.exports=exports},{jsbn:192}],123:[function(require,module,exports){var intShim=require("jsbn");var BigInteger=intShim.BigInteger?intShim.BigInteger:intShim;var RSAKey=require("./rsa.js").RSAKey;function parseBigInt(str,r){return new BigInteger(str,r)}function pkcs1unpad2(d,n){var b=d.toByteArray();var i=0;while(i<b.length&&b[i]==0)++i;if(b.length-i!=n-1||b[i]!=2)return null;++i;while(b[i]!=0)if(++i>=b.length)return null;var ret="";while(++i<b.length){var c=b[i]&255;if(c<128){ret+=String.fromCharCode(c)}else if(c>191&&c<224){ret+=String.fromCharCode((c&31)<<6|b[i+1]&63);++i}else{ret+=String.fromCharCode((c&15)<<12|(b[i+1]&63)<<6|b[i+2]&63);i+=2}}return ret}function oaep_mgf1_str(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hash(seed+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255]));i+=1}return mask}var SHA1_SIZE=20;function oaep_unpad(d,n,hash){d=d.toByteArray();var i;for(i=0;i<d.length;i+=1){d[i]&=255}while(d.length<n){d.unshift(0)}d=String.fromCharCode.apply(String,d);if(d.length<2*SHA1_SIZE+2){throw"Cipher too short"}var maskedSeed=d.substr(1,SHA1_SIZE);var maskedDB=d.substr(SHA1_SIZE+1);var seedMask=oaep_mgf1_str(maskedDB,SHA1_SIZE,hash||rstr_sha1);var seed=[],i;for(i=0;i<maskedSeed.length;i+=1){seed[i]=maskedSeed.charCodeAt(i)^seedMask.charCodeAt(i)}var dbMask=oaep_mgf1_str(String.fromCharCode.apply(String,seed),d.length-SHA1_SIZE,rstr_sha1);var DB=[];for(i=0;i<maskedDB.length;i+=1){DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i)}DB=String.fromCharCode.apply(String,DB);if(DB.substr(0,SHA1_SIZE)!==rstr_sha1("")){throw"Hash mismatch"}DB=DB.substr(SHA1_SIZE);var first_one=DB.indexOf("");var last_zero=first_one!=-1?DB.substr(0,first_one).lastIndexOf("\x00"):-1;if(last_zero+1!=first_one){throw"Malformed data"}return DB.substr(first_one+1)}function RSASetPrivate(N,E,D){if(typeof N!=="string"){this.n=N;this.e=E;this.d=D}else if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16);this.d=parseBigInt(D,16)}else alert("Invalid RSA private key")}function RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C){if(N==null)throw"RSASetPrivateEx N == null";if(E==null)throw"RSASetPrivateEx E == null";if(N.length==0)throw"RSASetPrivateEx N.length == 0";if(E.length==0)throw"RSASetPrivateEx E.length == 0";if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16);this.d=parseBigInt(D,16);this.p=parseBigInt(P,16);this.q=parseBigInt(Q,16);this.dmp1=parseBigInt(DP,16);this.dmq1=parseBigInt(DQ,16);this.coeff=parseBigInt(C,16)}else{alert("Invalid RSA private key in RSASetPrivateEx")}}function RSAGenerate(B,E){var rng=new SecureRandom;var qs=B>>1;this.e=parseInt(E,16);var ee=new BigInteger(E,16);for(;;){for(;;){this.p=new BigInteger(B-qs,1,rng);if(this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10))break}for(;;){this.q=new BigInteger(qs,1,rng);if(this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10))break}if(this.p.compareTo(this.q)<=0){var t=this.p;this.p=this.q;this.q=t}var p1=this.p.subtract(BigInteger.ONE);var q1=this.q.subtract(BigInteger.ONE);var phi=p1.multiply(q1);if(phi.gcd(ee).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q);this.d=ee.modInverse(phi);this.dmp1=this.d.mod(p1);this.dmq1=this.d.mod(q1);this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(x){if(this.p==null||this.q==null)return x.modPow(this.d,this.n);var xp=x.mod(this.p).modPow(this.dmp1,this.p);var xq=x.mod(this.q).modPow(this.dmq1,this.q);while(xp.compareTo(xq)<0)xp=xp.add(this.p);return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq)}function RSADecrypt(ctext){var c=parseBigInt(ctext,16);var m=this.doPrivate(c);if(m==null)return null;return pkcs1unpad2(m,this.n.bitLength()+7>>3)}function RSADecryptOAEP(ctext,hash){var c=parseBigInt(ctext,16);var m=this.doPrivate(c);if(m==null)return null;return oaep_unpad(m,this.n.bitLength()+7>>3,hash)}RSAKey.prototype.doPrivate=RSADoPrivate;RSAKey.prototype.setPrivate=RSASetPrivate;RSAKey.prototype.setPrivateEx=RSASetPrivateEx;RSAKey.prototype.generate=RSAGenerate;RSAKey.prototype.decrypt=RSADecrypt;RSAKey.prototype.decryptOAEP=RSADecryptOAEP;exports.RSAKey=RSAKey;module.exports=exports},{"./rsa.js":122,jsbn:192}],124:[function(require,module,exports){var ASN1HEX=require("./asn1hex-1.1.js").ASN1HEX;var b64tohex=require("./base64.js").b64tohex;var RSAKey=require("./rsa2.js").RSAKey;function _rsapem_pemToBase64(sPEMPrivateKey){var s=sPEMPrivateKey;s=s.replace("-----BEGIN RSA PRIVATE KEY-----","");s=s.replace("-----END RSA PRIVATE KEY-----","");s=s.replace(/[ \n]+/g,"");return s}function _rsapem_getPosArrayOfChildrenFromHex(hPrivateKey){var a=new Array;var v1=ASN1HEX.getStartPosOfV_AtObj(hPrivateKey,0);var n1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,v1);var e1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,n1);var d1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,e1);var p1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,d1);var q1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,p1);var dp1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,q1);var dq1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dp1);var co1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dq1);a.push(v1,n1,e1,d1,p1,q1,dp1,dq1,co1);return a}function _rsapem_getHexValueArrayOfChildrenFromHex(hPrivateKey){var posArray=_rsapem_getPosArrayOfChildrenFromHex(hPrivateKey);var v=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[0]);var n=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[1]);var e=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[2]);var d=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[3]);var p=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[4]);var q=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[5]);var dp=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[6]);var dq=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[7]);var co=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[8]);var a=new Array;a.push(v,n,e,d,p,q,dp,dq,co);return a}function _rsapem_readPrivateKeyFromASN1HexString(keyHex){var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsapem_readPrivateKeyFromPEMString(keyPEM){var keyB64=_rsapem_pemToBase64(keyPEM);var keyHex=b64tohex(keyB64);var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString;RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;exports.RSAKey=RSAKey;module.exports=exports},{"./asn1hex-1.1.js":118,"./base64.js":119,"./rsa2.js":123}],125:[function(require,module,exports){var intShim=require("jsbn");
var BigInteger=intShim.BigInteger?intShim.BigInteger:intShim;var RSAKey=require("./rsapem-1.1.js").RSAKey;function parseBigInt(str,r){return new BigInteger(str,r)}var _RSASIGN_DIHEAD=[];_RSASIGN_DIHEAD["sha1"]="3021300906052b0e03021a05000414";_RSASIGN_DIHEAD["sha256"]="3031300d060960864801650304020105000420";_RSASIGN_DIHEAD["sha384"]="3041300d060960864801650304020205000430";_RSASIGN_DIHEAD["sha512"]="3051300d060960864801650304020305000440";_RSASIGN_DIHEAD["md2"]="3020300c06082a864886f70d020205000410";_RSASIGN_DIHEAD["md5"]="3020300c06082a864886f70d020505000410";_RSASIGN_DIHEAD["ripemd160"]="3021300906052b2403020105000414";var _RSASIGN_HASHHEXFUNC=[];_RSASIGN_HASHHEXFUNC["sha1"]=function(s){return KJUR.crypto.Util.sha1(s)};_RSASIGN_HASHHEXFUNC["sha256"]=function(s){return KJUR.crypto.Util.sha256(s)};_RSASIGN_HASHHEXFUNC["sha512"]=function(s){return KJUR.crypto.Util.sha512(s)};_RSASIGN_HASHHEXFUNC["md5"]=function(s){return KJUR.crypto.Util.md5(s)};_RSASIGN_HASHHEXFUNC["ripemd160"]=function(s){return KJUR.crypto.Util.ripemd160(s)};var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi");function _rsasign_getHexPaddedDigestInfoForString(s,keySize,hashAlg){var pmStrLen=keySize/4;var hashFunc=_RSASIGN_HASHHEXFUNC[hashAlg];var sHashHex=hashFunc(s);var sHead="0001";var sTail="00"+_RSASIGN_DIHEAD[hashAlg]+sHashHex;var sMid="";var fLen=pmStrLen-sHead.length-sTail.length;for(var i=0;i<fLen;i+=2){sMid+="ff"}sPaddedMessageHex=sHead+sMid+sTail;return sPaddedMessageHex}function _zeroPaddingOfSignature(hex,bitLength){var s="";var nZero=bitLength/4-hex.length;for(var i=0;i<nZero;i++){s=s+"0"}return s+hex}function _rsasign_signString(s,hashAlg){var hPM=_rsasign_getHexPaddedDigestInfoForString(s,this.n.bitLength(),hashAlg);var biPaddedMessage=parseBigInt(hPM,16);var biSign=this.doPrivate(biPaddedMessage);var hexSign=biSign.toString(16);return _zeroPaddingOfSignature(hexSign,this.n.bitLength())}function _rsasign_signStringWithSHA1(s){return _rsasign_signString.call(this,s,"sha1")}function _rsasign_signStringWithSHA256(s){return _rsasign_signString.call(this,s,"sha256")}function pss_mgf1_str(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hash(seed+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255]));i+=1}return mask}function _rsasign_signStringPSS(s,hashAlg,sLen){var hashFunc=_RSASIGN_HASHRAWFUNC[hashAlg];var mHash=hashFunc(s);var hLen=mHash.length;var emBits=this.n.bitLength()-1;var emLen=Math.ceil(emBits/8);var i;if(sLen===-1){sLen=hLen}else if(sLen===-2||sLen===undefined){sLen=emLen-hLen-2}else if(sLen<-2){throw"invalid salt length"}if(emLen<hLen+sLen+2){throw"data too long"}var salt="";if(sLen>0){salt=new Array(sLen);(new SecureRandom).nextBytes(salt);salt=String.fromCharCode.apply(String,salt)}var H=hashFunc("\x00\x00\x00\x00\x00\x00\x00\x00"+mHash+salt);var PS=[];for(i=0;i<emLen-sLen-hLen-2;i+=1){PS[i]=0}var DB=String.fromCharCode.apply(String,PS)+""+salt;var dbMask=pss_mgf1_str(H,DB.length,hashFunc);var maskedDB=[];for(i=0;i<DB.length;i+=1){maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i)}var mask=65280>>8*emLen-emBits&255;maskedDB[0]&=~mask;for(i=0;i<hLen;i++){maskedDB.push(H.charCodeAt(i))}maskedDB.push(188);return _zeroPaddingOfSignature(this.doPrivate(new BigInteger(maskedDB)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(biSig,hN,hE){var rsa=new RSAKey;rsa.setPublic(hN,hE);var biDecryptedSig=rsa.doPublic(biSig);return biDecryptedSig}function _rsasign_getHexDigestInfoFromSig(biSig,hN,hE){var biDecryptedSig=_rsasign_getDecryptSignatureBI(biSig,hN,hE);var hDigestInfo=biDecryptedSig.toString(16).replace(/^1f+00/,"");return hDigestInfo}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo){for(var algName in _RSASIGN_DIHEAD){var head=_RSASIGN_DIHEAD[algName];var len=head.length;if(hDigestInfo.substring(0,len)==head){var a=[algName,hDigestInfo.substring(len)];return a}}return[]}function _rsasign_verifySignatureWithArgs(sMsg,biSig,hN,hE){var hDigestInfo=_rsasign_getHexDigestInfoFromSig(biSig,hN,hE);var digestInfoAry=_rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);if(digestInfoAry.length==0)return false;var algName=digestInfoAry[0];var diHashValue=digestInfoAry[1];var ff=_RSASIGN_HASHHEXFUNC[algName];var msgHashValue=ff(sMsg);return diHashValue==msgHashValue}function _rsasign_verifyHexSignatureForMessage(hSig,sMsg){var biSig=parseBigInt(hSig,16);var result=_rsasign_verifySignatureWithArgs(sMsg,biSig,this.n.toString(16),this.e.toString(16));return result}function _rsasign_verifyString(sMsg,hSig){hSig=hSig.replace(_RE_HEXDECONLY,"");if(hSig.length!=this.n.bitLength()/4)return 0;hSig=hSig.replace(/[ \n]+/g,"");var biSig=parseBigInt(hSig,16);var biDecryptedSig=this.doPublic(biSig);var hDigestInfo=biDecryptedSig.toString(16).replace(/^1f+00/,"");var digestInfoAry=_rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);if(digestInfoAry.length==0)return false;var algName=digestInfoAry[0];var diHashValue=digestInfoAry[1];var ff=_RSASIGN_HASHHEXFUNC[algName];var msgHashValue=ff(sMsg);return diHashValue==msgHashValue}function _rsasign_verifyStringPSS(sMsg,hSig,hashAlg,sLen){if(hSig.length!==this.n.bitLength()/4){return false}var hashFunc=_RSASIGN_HASHRAWFUNC[hashAlg];var mHash=hashFunc(sMsg);var hLen=mHash.length;var emBits=this.n.bitLength()-1;var emLen=Math.ceil(emBits/8);var i;if(sLen===-1){sLen=hLen}else if(sLen===-2||sLen===undefined){sLen=emLen-hLen-2}else if(sLen<-2){throw"invalid salt length"}if(emLen<hLen+sLen+2){throw"data too long"}var em=this.doPublic(parseBigInt(hSig,16)).toByteArray();for(i=0;i<em.length;i+=1){em[i]&=255}while(em.length<emLen){em.unshift(0)}if(em[emLen-1]!==188){throw"encoded message does not end in 0xbc"}em=String.fromCharCode.apply(String,em);var maskedDB=em.substr(0,emLen-hLen-1);var H=em.substr(maskedDB.length,hLen);var mask=65280>>8*emLen-emBits&255;if((maskedDB.charCodeAt(0)&mask)!==0){throw"bits beyond keysize not zero"}var dbMask=pss_mgf1_str(H,maskedDB.length,hashFunc);var DB=[];for(i=0;i<maskedDB.length;i+=1){DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i)}DB[0]&=~mask;var checkLen=emLen-hLen-sLen-2;for(i=0;i<checkLen;i+=1){if(DB[i]!==0){throw"leftmost octets not zero"}}if(DB[checkLen]!==1){throw"0x01 marker not found"}return H===hashFunc("\x00\x00\x00\x00\x00\x00\x00\x00"+mHash+String.fromCharCode.apply(String,DB.slice(-sLen)))}RSAKey.prototype.signString=_rsasign_signString;RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1;RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256;RSAKey.prototype.sign=_rsasign_signString;RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1;RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256;RSAKey.prototype.signStringPSS=_rsasign_signStringPSS;RSAKey.prototype.signPSS=_rsasign_signStringPSS;RSAKey.SALT_LEN_HLEN=-1;RSAKey.SALT_LEN_MAX=-2;RSAKey.prototype.verifyString=_rsasign_verifyString;RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage;RSAKey.prototype.verify=_rsasign_verifyString;RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage;RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS;RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS;RSAKey.SALT_LEN_RECOVER=-2;exports.RSAKey=RSAKey;module.exports=exports},{"./rsapem-1.1.js":124,jsbn:192}],126:[function(require,module,exports){var C=require("./core.js").CryptoJS;(function(Math){var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var H=[];var K=[];(function(){function isPrime(n){var sqrtN=Math.sqrt(n);for(var factor=2;factor<=sqrtN;factor++){if(!(n%factor)){return false}}return true}function getFractionalBits(n){return(n-(n|0))*4294967296|0}var n=2;var nPrime=0;while(nPrime<64){if(isPrime(n)){if(nPrime<8){H[nPrime]=getFractionalBits(Math.pow(n,1/2))}K[nPrime]=getFractionalBits(Math.pow(n,1/3));nPrime++}n++}})();var W=[];var SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];var f=H[5];var g=H[6];var h=H[7];for(var i=0;i<64;i++){if(i<16){W[i]=M[offset+i]|0}else{var gamma0x=W[i-15];var gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3;var gamma1x=W[i-2];var gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g;var maj=a&b^a&c^b&c;var sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22);var sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25);var t1=h+sigma1+ch+K[i]+W[i];var t2=sigma0+maj;h=g;g=f;f=e;e=d+t1|0;d=c;c=b;b=a;a=t1+t2|0}H[0]=H[0]+a|0;H[1]=H[1]+b|0;H[2]=H[2]+c|0;H[3]=H[3]+d|0;H[4]=H[4]+e|0;H[5]=H[5]+f|0;H[6]=H[6]+g|0;H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296);dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();return this._hash},clone:function(){var clone=Hasher.clone.call(this);clone._hash=this._hash.clone();return clone}});C.SHA256=Hasher._createHelper(SHA256);C.HmacSHA256=Hasher._createHmacHelper(SHA256)})(Math);exports.CryptoJS=C;module.exports=exports},{"./core.js":120}],127:[function(require,module,exports){exports.Face=require("./js/face.js").Face;exports.NDN=require("./js/face.js").NDN;exports.Closure=require("./js/closure.js").Closure;exports.Name=require("./js/name.js").Name;exports.ForwardingFlags=require("./js/forwarding-flags.js").ForwardingFlags;exports.Interest=require("./js/interest.js").Interest;exports.Exclude=require("./js/exclude.js").Exclude;exports.Data=require("./js/data.js").Data;exports.ContentObject=require("./js/data.js").ContentObject;exports.ContentType=require("./js/meta-info.js").ContentType;exports.MetaInfo=require("./js/meta-info.js").MetaInfo;exports.SignedInfo=require("./js/meta-info.js").SignedInfo;exports.Sha256WithRsaSignature=require("./js/sha256-with-rsa-signature.js").Sha256WithRsaSignature;exports.Signature=require("./js/sha256-with-rsa-signature.js").Signature;exports.Key=require("./js/key.js").Key;exports.KeyLocator=require("./js/key-locator.js").KeyLocator;exports.KeyName=require("./js/key-locator.js").KeyName;exports.KeyLocatorType=require("./js/key-locator.js").KeyLocatorType;exports.PublisherPublicKeyDigest=require("./js/publisher-public-key-digest.js").PublisherPublicKeyDigest;exports.WireFormat=require("./js/encoding/wire-format.js").WireFormat;exports.BinaryXmlWireFormat=require("./js/encoding/binary-xml-wire-format.js").BinaryXmlWireFormat;exports.TlvWireFormat=require("./js/encoding/tlv-wire-format.js").TlvWireFormat;exports.TcpTransport=require("./js/transport/tcp-transport.js").TcpTransport;exports.UnixTransport=require("./js/transport/unix-transport.js").UnixTransport;exports.DataUtils=require("./js/encoding/data-utils.js").DataUtils;exports.EncodingUtils=require("./js/encoding/encoding-utils.js").EncodingUtils;exports.ProtobufTlv=require("./js/encoding/protobuf-tlv.js").ProtobufTlv;exports.Blob=require("./js/util/blob.js").Blob;exports.NameEnumeration=require("./js/util/name-enumeration.js").NameEnumeration;exports.MemoryContentCache=require("./js/util/memory-content-cache.js").MemoryContentCache;exports.NDNTime=require("./js/util/ndn-time.js").NDNTime;exports.globalKeyManager=require("./js/security/key-manager.js").globalKeyManager;exports.SecurityException=require("./js/security/security-exception.js").SecurityException;exports.KeyType=require("./js/security/security-types.js").KeyType;exports.KeyClass=require("./js/security/security-types.js").KeyClass;exports.DigestAlgorithm=require("./js/security/security-types.js").DigestAlgorithm;exports.EncryptMode=require("./js/security/security-types.js").EncryptMode;exports.IdentityStorage=require("./js/security/identity/identity-storage.js").IdentityStorage;exports.MemoryIdentityStorage=require("./js/security/identity/memory-identity-storage.js").MemoryIdentityStorage;exports.MemoryPrivateKeyStorage=require("./js/security/identity/memory-private-key-storage.js").MemoryPrivateKeyStorage;exports.IdentityManager=require("./js/security/identity/identity-manager.js").IdentityManager;exports.ValidationRequest=require("./js/security/policy/validation-request.js").ValidationRequest;exports.PolicyManager=require("./js/security/policy/policy-manager.js").PolicyManager;exports.NoVerifyPolicyManager=require("./js/security/policy/no-verify-policy-manager.js").NoVerifyPolicyManager;exports.SelfVerifyPolicyManager=require("./js/security/policy/self-verify-policy-manager.js").SelfVerifyPolicyManager;exports.KeyChain=require("./js/security/key-chain.js").KeyChain;exports.ChronoSync2013=require("./js/sync/chrono-sync2013.js").ChronoSync2013},{"./js/closure.js":130,"./js/data.js":132,"./js/encoding/binary-xml-wire-format.js":136,"./js/encoding/data-utils.js":137,"./js/encoding/encoding-utils.js":140,"./js/encoding/protobuf-tlv.js":141,"./js/encoding/tlv-wire-format.js":143,"./js/encoding/wire-format.js":148,"./js/exclude.js":149,"./js/face.js":151,"./js/forwarding-flags.js":153,"./js/interest.js":154,"./js/key-locator.js":155,"./js/key.js":156,"./js/meta-info.js":158,"./js/name.js":159,"./js/publisher-public-key-digest.js":161,"./js/security/identity/identity-manager.js":164,"./js/security/identity/identity-storage.js":165,"./js/security/identity/memory-identity-storage.js":166,"./js/security/identity/memory-private-key-storage.js":167,"./js/security/key-chain.js":169,"./js/security/key-manager.js":170,"./js/security/policy/no-verify-policy-manager.js":171,"./js/security/policy/policy-manager.js":172,"./js/security/policy/self-verify-policy-manager.js":173,"./js/security/policy/validation-request.js":174,"./js/security/security-exception.js":175,"./js/security/security-types.js":176,"./js/sha256-with-rsa-signature.js":177,"./js/sync/chrono-sync2013.js":178,"./js/transport/tcp-transport.js":128,"./js/transport/unix-transport.js":182,"./js/util/blob.js":184,"./js/util/memory-content-cache.js":187,"./js/util/name-enumeration.js":188,"./js/util/ndn-time.js":190}],128:[function(require,module,exports){exports.TcpTransport=require("./transport/web-socket-transport").WebSocketTransport},{"./transport/web-socket-transport":183}],129:[function(require,module,exports){(function(Buffer){var ASN1HEX=require("../contrib/securityLib/asn1hex-1.1.js").ASN1HEX;var KJUR=require("../contrib/securityLib/crypto-1.0.js").KJUR;var RSAKey=require("../contrib/securityLib/rsasign-1.2.js").RSAKey;var b64tohex=require("../contrib/securityLib/base64.js").b64tohex;var ndn=ndn||{};ndn.Key=require("./key.js").Key;var exports=ndn;exports.createHash=function(alg){if(alg!="sha256")throw new Error("createHash: unsupported algorithm.");var obj={};obj.md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});obj.update=function(buf){this.md.updateHex(buf.toString("hex"))};obj.digest=function(){return new Buffer(this.md.digest(),"hex")};return obj};exports.createSign=function(alg){if(alg!="RSA-SHA256")throw new Error("createSign: unsupported algorithm.");var obj={};obj.arr=[];obj.update=function(buf){this.arr.push(buf)};obj.sign=function(keypem){var rsa=new RSAKey;rsa.readPrivateKeyFromPEMString(keypem);var signer=new KJUR.crypto.Signature({alg:"SHA256withRSA",prov:"cryptojs/jsrsa"});signer.initSign(rsa);for(var i=0;i<this.arr.length;++i)signer.updateHex(this.arr[i].toString("hex"));return new Buffer(signer.sign(),"hex")};return obj};exports.createVerify=function(alg){if(alg!="RSA-SHA256")throw new Error("createSign: unsupported algorithm.");var obj={};obj.arr=[];obj.update=function(buf){this.arr.push(buf)};var getSubjectPublicKeyPosFromHex=function(hPub){var a=ASN1HEX.getPosArrayOfChildren_AtObj(hPub,0);if(a.length!=2)return-1;var pBitString=a[1];if(hPub.substring(pBitString,pBitString+2)!="03")return-1;var pBitStringV=ASN1HEX.getStartPosOfV_AtObj(hPub,pBitString);if(hPub.substring(pBitStringV,pBitStringV+2)!="00")return-1;return pBitStringV+2};var readPublicDER=function(pub_der){var hex=pub_der.toString("hex");var p=getSubjectPublicKeyPosFromHex(hex);var a=ASN1HEX.getPosArrayOfChildren_AtObj(hex,p);if(a.length!=2)return null;var hN=ASN1HEX.getHexOfV_AtObj(hex,a[0]);var hE=ASN1HEX.getHexOfV_AtObj(hex,a[1]);var rsaKey=new RSAKey;rsaKey.setPublic(hN,hE);return rsaKey};obj.verify=function(keypem,sig){var key=new ndn.Key;key.fromPemString(keypem);var rsa=readPublicDER(key.publicToDER());var signer=new KJUR.crypto.Signature({alg:"SHA256withRSA",prov:"cryptojs/jsrsa"});signer.initVerifyByPublicKey(rsa);for(var i=0;i<this.arr.length;i++)signer.updateHex(this.arr[i].toString("hex"));var hSig=sig.toString("hex");return signer.verify(hSig)};return obj};exports.randomBytes=function(size){var result=new Buffer(size);for(var i=0;i<size;++i)result[i]=Math.floor(Math.random()*256);return result};exports.toByteArray=function(str){var hex=b64tohex(str);var result=[];hex.replace(/(..)/g,function(ss){result.push(parseInt(ss,16))});return result};module.exports=exports}).call(this,require("buffer").Buffer)},{"../contrib/securityLib/asn1hex-1.1.js":118,"../contrib/securityLib/base64.js":119,"../contrib/securityLib/crypto-1.0.js":121,"../contrib/securityLib/rsasign-1.2.js":125,"./key.js":156,buffer:3}],130:[function(require,module,exports){var Closure=function Closure(){this.ndn_data=null;this.ndn_data_dirty=false};exports.Closure=Closure;Closure.RESULT_ERR=-1;Closure.RESULT_OK=0;Closure.RESULT_REEXPRESS=1;Closure.RESULT_INTEREST_CONSUMED=2;Closure.RESULT_VERIFY=3;Closure.RESULT_FETCHKEY=4;Closure.UPCALL_FINAL=0;Closure.UPCALL_INTEREST=1;Closure.UPCALL_CONSUMED_INTEREST=2;Closure.UPCALL_CONTENT=3;Closure.UPCALL_INTEREST_TIMED_OUT=4;Closure.UPCALL_CONTENT_UNVERIFIED=5;Closure.UPCALL_CONTENT_BAD=6;Closure.prototype.upcall=function(kind,upcallInfo){return Closure.RESULT_OK};var UpcallInfo=function UpcallInfo(face,interest,matchedComps,data){this.face=face;this.ndn=face;this.interest=interest;this.matchedComps=matchedComps;this.data=data;this.contentObject=data};UpcallInfo.prototype.toString=function(){var ret="face = "+this.face;ret+="\nInterest = "+this.interest;ret+="\nmatchedComps = "+this.matchedComps;ret+="\nData: "+this.data;return ret};exports.UpcallInfo=UpcallInfo},{}],131:[function(require,module,exports){var ForwardingFlags=require("./forwarding-flags.js").ForwardingFlags;var Name=require("./name.js").Name;var WireFormat=require("./encoding/wire-format.js").WireFormat;var ControlParameters=function ControlParameters(){this.name=new Name;this.faceId=null;this.localControlFeature=null;this.origin=null;this.cost=null;this.forwardingFlags=new ForwardingFlags;this.expirationPeriod=null};exports.ControlParameters=ControlParameters;ControlParameters.prototype.wireEncode=function(wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();return wireFormat.encodeControlParameters(this)};ControlParameters.prototype.wireDecode=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var decodeBuffer=typeof input==="object"&&input instanceof Blob?input.buf():input;wireFormat.decodeControlParameters(this,decodeBuffer)};ControlParameters.prototype.getName=function(){return this.name};ControlParameters.prototype.getFaceId=function(){return this.faceId};ControlParameters.prototype.getLocalControlFeature=function(){return this.localControlFeature};ControlParameters.prototype.getOrigin=function(){return this.origin};ControlParameters.prototype.getCost=function(){return this.cost};ControlParameters.prototype.getForwardingFlags=function(){return this.forwardingFlags};ControlParameters.prototype.getExpirationPeriod=function(){return this.expirationPeriod};ControlParameters.prototype.setName=function(name){this.name=typeof name==="object"&&name instanceof Name?new Name(name):new Name};ControlParameters.prototype.setFaceId=function(faceId){this.faceId=faceId};ControlParameters.prototype.setLocalControlFeature=function(localControlFeature){this.localControlFeature=localControlFeature};ControlParameters.prototype.setOrigin=function(origin){this.origin=origin};ControlParameters.prototype.setCost=function(cost){this.cost=cost};ControlParameters.prototype.setForwardingFlags=function(forwardingFlags){this.forwardingFlags=typeof forwardingFlags==="object"&&forwardingFlags instanceof ForwardingFlags?new ForwardingFlags(forwardingFlags):new ForwardingFlags};ControlParameters.prototype.setExpirationPeriod=function(expirationPeriod){this.expirationPeriod=expirationPeriod}},{"./encoding/wire-format.js":148,"./forwarding-flags.js":153,"./name.js":159}],132:[function(require,module,exports){(function(Buffer){var Crypto=require("./crypto.js");var Blob=require("./util/blob.js").Blob;var SignedBlob=require("./util/signed-blob.js").SignedBlob;var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var DataUtils=require("./encoding/data-utils.js").DataUtils;var Name=require("./name.js").Name;var Sha256WithRsaSignature=require("./sha256-with-rsa-signature.js").Sha256WithRsaSignature;var MetaInfo=require("./meta-info.js").MetaInfo;var KeyLocator=require("./key-locator.js").KeyLocator;var globalKeyManager=require("./security/key-manager.js").globalKeyManager;var WireFormat=require("./encoding/wire-format.js").WireFormat;var Data=function Data(name,metaInfoOrContent,arg3){if(typeof name==="string")this.name=new Name(name);else this.name=typeof name==="object"&&name instanceof Name?new Name(name):new Name;var metaInfo;var content;if(typeof metaInfoOrContent==="object"&&metaInfoOrContent instanceof MetaInfo){metaInfo=metaInfoOrContent;content=arg3}else{metaInfo=null;content=metaInfoOrContent}this.signedInfo=typeof metaInfo==="object"&&metaInfo instanceof MetaInfo?new MetaInfo(metaInfo):new MetaInfo;if(typeof content==="string")this.content=DataUtils.toNumbersFromString(content);else if(typeof content==="object"&&content instanceof Blob)this.content=content.buf();else this.content=content;this.signature=new Sha256WithRsaSignature;this.wireEncoding=new SignedBlob};exports.Data=Data;Data.prototype.getName=function(){return this.name};Data.prototype.getMetaInfo=function(){return this.signedInfo};Data.prototype.getSignature=function(){return this.signature};Data.prototype.getContent=function(){return new Blob(this.content,false)};Data.prototype.getContentAsBuffer=function(){return this.content};Data.prototype.setName=function(name){this.name=typeof name==="object"&&name instanceof Name?new Name(name):new Name;this.wireEncoding=new SignedBlob;return this};Data.prototype.setMetaInfo=function(metaInfo){this.signedInfo=typeof metaInfo==="object"&&metaInfo instanceof MetaInfo?new MetaInfo(metaInfo):new MetaInfo;this.wireEncoding=new SignedBlob;return this};Data.prototype.setSignature=function(signature){this.signature=typeof signature==="object"&&signature instanceof Sha256WithRsaSignature?signature.clone():new Sha256WithRsaSignature;this.wireEncoding=new SignedBlob;return this};Data.prototype.setContent=function(content){if(typeof content==="string")this.content=DataUtils.toNumbersFromString(content);else if(typeof content==="object"&&content instanceof Blob)this.content=content.buf();else this.content=new Buffer(content);this.wireEncoding=new SignedBlob;return this};Data.prototype.sign=function(wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();if(this.getSignatureOrMetaInfoKeyLocator()==null||this.getSignatureOrMetaInfoKeyLocator().getType()==null)this.getMetaInfo().setFields();if(this.wireEncoding==null||this.wireEncoding.isNull()){this.getSignature().setSignature(new Buffer(128));this.wireEncode(wireFormat)}var rsa=Crypto.createSign("RSA-SHA256");rsa.update(this.wireEncoding.signedBuf());var sig=new Buffer(DataUtils.toNumbersIfString(rsa.sign(globalKeyManager.privateKey)));this.signature.setSignature(sig)};Data.verifyUsesString=null;Data.prototype.verify=function(key){if(key==null||key.publicKeyPem==null)throw new Error("Cannot verify Data without a public key.");if(Data.verifyUsesString==null){var hashResult=Crypto.createHash("sha256").digest();Data.verifyUsesString=typeof hashResult==="string"}if(this.wireEncoding==null||this.wireEncoding.isNull())this.wireEncode();var verifier=Crypto.createVerify("RSA-SHA256");verifier.update(this.wireEncoding.signedBuf());var signatureBytes=Data.verifyUsesString?DataUtils.toString(this.signature.getSignature().buf()):this.signature.getSignature().buf();return verifier.verify(key.publicKeyPem,signatureBytes)};Data.prototype.getElementLabel=function(){return NDNProtocolDTags.Data};Data.prototype.wireEncode=function(wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var result=wireFormat.encodeData(this);this.wireEncoding=new SignedBlob(result.encoding,result.signedPortionBeginOffset,result.signedPortionEndOffset);return this.wireEncoding};Data.prototype.wireDecode=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var decodeBuffer=typeof input==="object"&&input instanceof Blob?input.buf():input;var result=wireFormat.decodeData(this,decodeBuffer);this.wireEncoding=new SignedBlob(new Blob(input,true),result.signedPortionBeginOffset,result.signedPortionEndOffset)};Data.prototype.getSignatureOrMetaInfoKeyLocator=function(){if(this.signature!=null&&this.signature.getKeyLocator()!=null&&this.signature.getKeyLocator().getType()!=null&&this.signature.getKeyLocator().getType()>=0)return this.signature.getKeyLocator();if(this.signedInfo!=null&&this.signedInfo.locator!=null&&this.signedInfo.locator.getType()!=null&&this.signedInfo.locator.getType()>=0){return this.signedInfo.locator}if(this.signature!=null&&this.signature.getKeyLocator()!=null)return this.signature.getKeyLocator();else return new KeyLocator};var BinaryXmlWireFormat=require("./encoding/binary-xml-wire-format.js").BinaryXmlWireFormat;Data.prototype.from_ndnb=function(decoder){BinaryXmlWireFormat.decodeData(this,decoder)};Data.prototype.to_ndnb=function(encoder){BinaryXmlWireFormat.encodeData(this,encoder)};Data.prototype.encode=function(wireFormat){wireFormat=wireFormat||BinaryXmlWireFormat.get();return wireFormat.encodeData(this).buf()};Data.prototype.decode=function(input,wireFormat){wireFormat=wireFormat||BinaryXmlWireFormat.get();wireFormat.decodeData(this,input)};var ContentObject=function ContentObject(name,signedInfo,content){Data.call(this,name,signedInfo,content)};ContentObject.prototype=new Data;exports.ContentObject=ContentObject}).call(this,require("buffer").Buffer)},{"./crypto.js":129,"./encoding/binary-xml-encoder.js":134,"./encoding/binary-xml-wire-format.js":136,"./encoding/data-utils.js":137,"./encoding/wire-format.js":148,"./key-locator.js":155,"./meta-info.js":158,"./name.js":159,"./security/key-manager.js":170,"./sha256-with-rsa-signature.js":177,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189,"./util/signed-blob.js":191,buffer:3}],133:[function(require,module,exports){(function(Buffer){var NDNProtocolDTags=require("../util/ndn-protoco-id-tags.js").NDNProtocolDTags;var NDNTime=require("../util/ndn-time.js").NDNTime;var DataUtils=require("./data-utils.js").DataUtils;var DecodingException=require("./decoding-exception.js").DecodingException;var LOG=require("../log.js").Log.LOG;var XML_EXT=0;var XML_TAG=1;var XML_DTAG=2;var XML_ATTR=3;var XML_DATTR=4;var XML_BLOB=5;var XML_UDATA=6;var XML_CLOSE=0;var XML_SUBTYPE_PROCESSING_INSTRUCTIONS=16;var XML_TT_BITS=3;var XML_TT_MASK=(1<<XML_TT_BITS)-1;var XML_TT_VAL_BITS=XML_TT_BITS+1;var XML_TT_VAL_MASK=(1<<XML_TT_VAL_BITS)-1;var XML_REG_VAL_BITS=7;var XML_REG_VAL_MASK=(1<<XML_REG_VAL_BITS)-1;var XML_TT_NO_MORE=1<<XML_REG_VAL_BITS;var BYTE_MASK=255;var LONG_BYTES=8;var LONG_BITS=64;var bits_11=2047;var bits_18=262143;var bits_32=4294967295;tagToString=function(tagVal){if(tagVal>=0&&tagVal<NDNProtocolDTagsStrings.length){return NDNProtocolDTagsStrings[tagVal]}else if(tagVal==NDNProtocolDTags.NDNProtocolDataUnit){return NDNProtocolDTags.NDNPROTOCOL_DATA_UNIT}return null};stringToTag=function(tagName){for(var i=0;i<NDNProtocolDTagsStrings.length;++i){if(null!=NDNProtocolDTagsStrings[i]&&NDNProtocolDTagsStrings[i]==tagName)return i}if(NDNProtocolDTags.NDNPROTOCOL_DATA_UNIT==tagName){return NDNProtocolDTags.NDNProtocolDataUnit}return null};var BinaryXMLDecoder=function BinaryXMLDecoder(input){var MARK_LEN=512;var DEBUG_MAX_LEN=32768;this.input=input;this.offset=0;this.previouslyPeekedDTagStartOffset=-1};exports.BinaryXMLDecoder=BinaryXMLDecoder;BinaryXMLDecoder.prototype.readElementStartDTag=function(expectedTag){if(this.offset==this.previouslyPeekedDTagStartOffset){if(this.previouslyPeekedDTag!=expectedTag)throw new DecodingException(new Error("Did not get the expected DTAG "+expectedTag+", got "+this.previouslyPeekedDTag));this.offset=this.previouslyPeekedDTagEndOffset}else{var typeAndValue=this.decodeTypeAndVal();if(typeAndValue==null||typeAndValue.type()!=XML_DTAG)throw new DecodingException(new Error("Header type is not a DTAG"));if(typeAndValue.val()!=expectedTag)throw new DecodingException(new Error("Expected start element: "+expectedTag+" got: "+typeAndValue.val()))}};BinaryXMLDecoder.prototype.readStartElement=function(startTag,attributes){var tv=this.decodeTypeAndVal();if(null==tv)throw new DecodingException(new Error("Expected start element: "+startTag+" got something not a tag."));var decodedTag=null;if(tv.type()==XML_TAG){var valval;if(typeof tv.val()=="string")valval=parseInt(tv.val())+1;else valval=tv.val()+1;decodedTag=this.decodeUString(valval)}else if(tv.type()==XML_DTAG)decodedTag=tv.val();if(null==decodedTag||decodedTag!=startTag){console.log("expecting "+startTag+" but got "+decodedTag);throw new DecodingException(new Error("Expected start element: "+startTag+" got: "+decodedTag+"("+tv.val()+")"))}if(null!=attributes)readAttributes(attributes)};BinaryXMLDecoder.prototype.readAttributes=function(attributes){if(null==attributes)return;try{var nextTV=this.peekTypeAndVal();while(null!=nextTV&&(XML_ATTR==nextTV.type()||XML_DATTR==nextTV.type())){var thisTV=this.decodeTypeAndVal();var attributeName=null;if(XML_ATTR==thisTV.type()){var valval;if(typeof thisTV.val()=="string")valval=parseInt(thisTV.val())+1;else valval=thisTV.val()+1;attributeName=this.decodeUString(valval)}else if(XML_DATTR==thisTV.type()){attributeName=tagToString(thisTV.val());if(null==attributeName)throw new DecodingException(new Error("Unknown DATTR value"+thisTV.val()))}var attributeValue=this.decodeUString();attributes.push([attributeName,attributeValue]);nextTV=this.peekTypeAndVal()}}catch(e){throw new DecodingException(new Error("readStartElement",e))}};BinaryXMLDecoder.prototype.peekStartElementAsString=function(){var decodedTag=null;var previousOffset=this.offset;try{var tv=this.decodeTypeAndVal();if(null!=tv){if(tv.type()==XML_TAG){var valval;if(typeof tv.val()=="string")valval=parseInt(tv.val())+1;else valval=tv.val()+1;decodedTag=this.decodeUString(valval)}else if(tv.type()==XML_DTAG)decodedTag=tagToString(tv.val())}}catch(e){}finally{try{this.offset=previousOffset}catch(e){Log.logStackTrace(Log.FAC_ENCODING,Level.WARNING,e);throw new DecodingException(new Error("Cannot reset stream! "+e.getMessage(),e))}}return decodedTag};BinaryXMLDecoder.prototype.peekDTag=function(expectedTag){if(this.offset==this.previouslyPeekedDTagStartOffset)return this.previouslyPeekedDTag==expectedTag;else{if(this.input[this.offset]==XML_CLOSE)return false;var saveOffset=this.offset;var typeAndValue=this.decodeTypeAndVal();this.previouslyPeekedDTagEndOffset=this.offset;this.offset=saveOffset;if(typeAndValue!=null&&typeAndValue.type()==XML_DTAG){this.previouslyPeekedDTagStartOffset=saveOffset;this.previouslyPeekedDTag=typeAndValue.val();return typeAndValue.val()==expectedTag}else return false
}};BinaryXMLDecoder.prototype.peekStartElement=function(startTag){if(typeof startTag=="string"){var decodedTag=this.peekStartElementAsString();if(null!=decodedTag&&decodedTag==startTag)return true;return false}else if(typeof startTag=="number"){var decodedTag=this.peekStartElementAsLong();if(null!=decodedTag&&decodedTag==startTag)return true;return false}else throw new DecodingException(new Error("SHOULD BE STRING OR NUMBER"))};BinaryXMLDecoder.prototype.peekStartElementAsLong=function(){var decodedTag=null;var previousOffset=this.offset;try{var tv=this.decodeTypeAndVal();if(null!=tv){if(tv.type()==XML_TAG){if(tv.val()+1>DEBUG_MAX_LEN)throw new DecodingException(new Error("Decoding error: length "+tv.val()+1+" longer than expected maximum length!"));var valval;if(typeof tv.val()=="string")valval=parseInt(tv.val())+1;else valval=tv.val()+1;var strTag=this.decodeUString(valval);decodedTag=stringToTag(strTag)}else if(tv.type()==XML_DTAG)decodedTag=tv.val()}}catch(e){}finally{try{this.offset=previousOffset}catch(e){Log.logStackTrace(Log.FAC_ENCODING,Level.WARNING,e);throw new Error("Cannot reset stream! "+e.getMessage(),e)}}return decodedTag};BinaryXMLDecoder.prototype.readBinaryDTagElement=function(expectedTag,allowNull){this.readElementStartDTag(expectedTag);return this.readBlob(allowNull)};BinaryXMLDecoder.prototype.readBinaryElement=function(startTag,attributes,allowNull){this.readStartElement(startTag,attributes);return this.readBlob(allowNull)};BinaryXMLDecoder.prototype.readElementClose=function(){var next=this.input[this.offset++];if(next!=XML_CLOSE)throw new DecodingException(new Error("Expected end element, got: "+next))};BinaryXMLDecoder.prototype.readEndElement=function(){if(LOG>4)console.log("this.offset is "+this.offset);var next=this.input[this.offset];this.offset++;if(LOG>4)console.log("XML_CLOSE IS "+XML_CLOSE);if(LOG>4)console.log("next is "+next);if(next!=XML_CLOSE){console.log("Expected end element, got: "+next);throw new DecodingException(new Error("Expected end element, got: "+next))}};BinaryXMLDecoder.prototype.readUString=function(){var ustring=this.decodeUString();this.readElementClose();return ustring};BinaryXMLDecoder.prototype.readBlob=function(allowNull){if(this.input[this.offset]==XML_CLOSE&&allowNull){this.readElementClose();return null}var blob=this.decodeBlob();this.readElementClose();return blob};BinaryXMLDecoder.prototype.readDateTimeDTagElement=function(expectedTag){var byteTimestamp=this.readBinaryDTagElement(expectedTag);byteTimestamp=DataUtils.toHex(byteTimestamp);byteTimestamp=parseInt(byteTimestamp,16);var lontimestamp=byteTimestamp/4096*1e3;var timestamp=new NDNTime(lontimestamp);if(null==timestamp)throw new DecodingException(new Error("Cannot parse timestamp: "+DataUtils.printHexBytes(byteTimestamp)));return timestamp};BinaryXMLDecoder.prototype.readDateTime=function(startTag){var byteTimestamp=this.readBinaryElement(startTag);byteTimestamp=DataUtils.toHex(byteTimestamp);byteTimestamp=parseInt(byteTimestamp,16);var lontimestamp=byteTimestamp/4096*1e3;if(LOG>4)console.log("DECODED DATE WITH VALUE");if(LOG>4)console.log(lontimestamp);var timestamp=new NDNTime(lontimestamp);if(null==timestamp)throw new DecodingException(new Error("Cannot parse timestamp: "+DataUtils.printHexBytes(byteTimestamp)));return timestamp};BinaryXMLDecoder.prototype.decodeTypeAndVal=function(){var type=-1;var val=0;var more=true;do{var next=this.input[this.offset];if(next==null)return null;if(next<0)return null;if(0==next&&0==val)return null;more=0==(next&XML_TT_NO_MORE);if(more){val=val<<XML_REG_VAL_BITS;val|=next&XML_REG_VAL_MASK}else{type=next&XML_TT_MASK;val=val<<XML_TT_VAL_BITS;val|=next>>>XML_TT_BITS&XML_TT_VAL_MASK}this.offset++}while(more);if(LOG>4)console.log("TYPE is "+type+" VAL is "+val);return new TypeAndVal(type,val)};BinaryXMLDecoder.prototype.peekTypeAndVal=function(){var tv=null;var previousOffset=this.offset;try{tv=this.decodeTypeAndVal()}finally{this.offset=previousOffset}return tv};BinaryXMLDecoder.prototype.decodeBlob=function(blobLength){if(null==blobLength){var tv=this.decodeTypeAndVal();var valval;if(typeof tv.val()=="string")valval=parseInt(tv.val());else valval=tv.val();return this.decodeBlob(valval)}var bytes=new Buffer(this.input.slice(this.offset,this.offset+blobLength));this.offset+=blobLength;return bytes};BinaryXMLDecoder.prototype.decodeUString=function(byteLength){if(null==byteLength){var tempStreamPosition=this.offset;var tv=this.decodeTypeAndVal();if(LOG>4)console.log("TV is "+tv);if(LOG>4)console.log(tv);if(LOG>4)console.log("Type of TV is "+typeof tv);if(null==tv||XML_UDATA!=tv.type()){this.offset=tempStreamPosition;return""}return this.decodeUString(tv.val())}else{var stringBytes=this.decodeBlob(byteLength);return DataUtils.toString(stringBytes)}};var TypeAndVal=function TypeAndVal(_type,_val){this.t=_type;this.v=_val};TypeAndVal.prototype.type=function(){return this.t};TypeAndVal.prototype.val=function(){return this.v};BinaryXMLDecoder.prototype.readIntegerDTagElement=function(expectedTag){return parseInt(this.readUTF8DTagElement(expectedTag))};BinaryXMLDecoder.prototype.readIntegerElement=function(startTag){if(LOG>4)console.log("READING INTEGER "+startTag);if(LOG>4)console.log("TYPE OF "+typeof startTag);var strVal=this.readUTF8Element(startTag);return parseInt(strVal)};BinaryXMLDecoder.prototype.readUTF8DTagElement=function(expectedTag){this.readElementStartDTag(expectedTag);return this.readUString()};BinaryXMLDecoder.prototype.readUTF8Element=function(startTag,attributes){this.readStartElement(startTag,attributes);var strElementText=this.readUString();return strElementText};BinaryXMLDecoder.prototype.seek=function(offset){this.offset=offset}}).call(this,require("buffer").Buffer)},{"../log.js":157,"../util/ndn-protoco-id-tags.js":189,"../util/ndn-time.js":190,"./data-utils.js":137,"./decoding-exception.js":138,buffer:3}],134:[function(require,module,exports){var LOG=require("../log.js").Log.LOG;var NDNProtocolDTags=require("../util/ndn-protoco-id-tags.js").NDNProtocolDTags;var DynamicBuffer=require("../util/dynamic-buffer.js").DynamicBuffer;var DataUtils=require("./data-utils.js").DataUtils;var LOG=require("../log.js").Log.LOG;var XML_EXT=0;var XML_TAG=1;var XML_DTAG=2;var XML_ATTR=3;var XML_DATTR=4;var XML_BLOB=5;var XML_UDATA=6;var XML_CLOSE=0;var XML_SUBTYPE_PROCESSING_INSTRUCTIONS=16;var XML_TT_BITS=3;var XML_TT_MASK=(1<<XML_TT_BITS)-1;var XML_TT_VAL_BITS=XML_TT_BITS+1;var XML_TT_VAL_MASK=(1<<XML_TT_VAL_BITS)-1;var XML_REG_VAL_BITS=7;var XML_REG_VAL_MASK=(1<<XML_REG_VAL_BITS)-1;var XML_TT_NO_MORE=1<<XML_REG_VAL_BITS;var BYTE_MASK=255;var LONG_BYTES=8;var LONG_BITS=64;var bits_11=2047;var bits_18=262143;var bits_32=4294967295;var BinaryXMLEncoder=function BinaryXMLEncoder(initiaLength){if(!initiaLength)initiaLength=16;this.ostream=new DynamicBuffer(initiaLength);this.offset=0;this.CODEC_NAME="Binary"};exports.BinaryXMLEncoder=BinaryXMLEncoder;BinaryXMLEncoder.prototype.writeUString=function(utf8Content){this.encodeUString(utf8Content,XML_UDATA)};BinaryXMLEncoder.prototype.writeBlob=function(binaryContent){if(LOG>3)console.log(binaryContent);this.encodeBlob(binaryContent,binaryContent.length)};BinaryXMLEncoder.prototype.writeElementStartDTag=function(tag){this.encodeTypeAndVal(XML_DTAG,tag)};BinaryXMLEncoder.prototype.writeStartElement=function(tag,attributes){var dictionaryVal=tag;if(null==dictionaryVal)this.encodeUString(tag,XML_TAG);else this.encodeTypeAndVal(XML_DTAG,dictionaryVal);if(null!=attributes)this.writeAttributes(attributes)};BinaryXMLEncoder.prototype.writeElementClose=function(){this.ostream.ensureLength(this.offset+1);this.ostream.array[this.offset]=XML_CLOSE;this.offset+=1};BinaryXMLEncoder.prototype.writeEndElement=function(){this.writeElementClose()};BinaryXMLEncoder.prototype.writeAttributes=function(attributes){if(null==attributes)return;for(var i=0;i<attributes.length;i++){var strAttr=attributes[i].k;var strValue=attributes[i].v;var dictionaryAttr=stringToTag(strAttr);if(null==dictionaryAttr)this.encodeUString(strAttr,XML_ATTR);else this.encodeTypeAndVal(XML_DATTR,dictionaryAttr);this.encodeUString(strValue)}};stringToTag=function(tagVal){if(tagVal>=0&&tagVal<NDNProtocolDTagsStrings.length)return NDNProtocolDTagsStrings[tagVal];else if(tagVal==NDNProtocolDTags.NDNProtocolDataUnit)return NDNProtocolDTags.NDNPROTOCOL_DATA_UNIT;return null};tagToString=function(tagName){for(var i=0;i<NDNProtocolDTagsStrings.length;++i){if(null!=NDNProtocolDTagsStrings[i]&&NDNProtocolDTagsStrings[i]==tagName)return i}if(NDNProtocolDTags.NDNPROTOCOL_DATA_UNIT==tagName)return NDNProtocolDTags.NDNProtocolDataUnit;return null};BinaryXMLEncoder.prototype.writeDTagElement=function(tag,content){this.writeElementStartDTag(tag);if(typeof content==="number")this.writeUString(content.toString());else if(typeof content==="string")this.writeUString(content);else this.writeBlob(content);this.writeElementClose()};BinaryXMLEncoder.prototype.writeElement=function(tag,Content,attributes){this.writeStartElement(tag,attributes);if(typeof Content==="number"){if(LOG>4)console.log("GOING TO WRITE THE NUMBER .charCodeAt(0) "+Content.toString().charCodeAt(0));if(LOG>4)console.log("GOING TO WRITE THE NUMBER "+Content.toString());if(LOG>4)console.log("type of number is "+typeof Content.toString());this.writeUString(Content.toString())}else if(typeof Content==="string"){if(LOG>4)console.log("GOING TO WRITE THE STRING  "+Content);if(LOG>4)console.log("type of STRING is "+typeof Content);this.writeUString(Content)}else{if(LOG>4)console.log("GOING TO WRITE A BLOB  "+Content);this.writeBlob(Content)}this.writeElementClose()};var TypeAndVal=function TypeAndVal(_type,_val){this.type=_type;this.val=_val};BinaryXMLEncoder.prototype.encodeTypeAndVal=function(type,val){if(LOG>4)console.log("Encoding type "+type+" and value "+val);if(LOG>4)console.log("OFFSET IS "+this.offset);if(type>XML_UDATA||type<0||val<0)throw new Error("Tag and value must be positive, and tag valid.");var numEncodingBytes=this.numEncodingBytes(val);this.ostream.ensureLength(this.offset+numEncodingBytes);this.ostream.array[this.offset+numEncodingBytes-1]=BYTE_MASK&(XML_TT_MASK&type|(XML_TT_VAL_MASK&val)<<XML_TT_BITS)|XML_TT_NO_MORE;val=val>>>XML_TT_VAL_BITS;var i=this.offset+numEncodingBytes-2;while(0!=val&&i>=this.offset){this.ostream.array[i]=BYTE_MASK&(val&XML_REG_VAL_MASK);val=val>>>XML_REG_VAL_BITS;--i}if(val!=0)throw new Error("This should not happen: miscalculated encoding");this.offset+=numEncodingBytes;return numEncodingBytes};BinaryXMLEncoder.prototype.encodeUString=function(ustring,type){if(null==ustring)return;if(type==XML_TAG||type==XML_ATTR&&ustring.length==0)return;if(LOG>3)console.log("The string to write is ");if(LOG>3)console.log(ustring);var strBytes=DataUtils.stringToUtf8Array(ustring);this.encodeTypeAndVal(type,type==XML_TAG||type==XML_ATTR?strBytes.length-1:strBytes.length);if(LOG>3)console.log("THE string to write is ");if(LOG>3)console.log(strBytes);this.writeString(strBytes);this.offset+=strBytes.length};BinaryXMLEncoder.prototype.encodeBlob=function(blob,length){if(null==blob)return;if(LOG>4)console.log("LENGTH OF XML_BLOB IS "+length);this.encodeTypeAndVal(XML_BLOB,length);this.writeBlobArray(blob);this.offset+=length};var ENCODING_LIMIT_1_BYTE=(1<<XML_TT_VAL_BITS)-1;var ENCODING_LIMIT_2_BYTES=(1<<XML_TT_VAL_BITS+XML_REG_VAL_BITS)-1;var ENCODING_LIMIT_3_BYTES=(1<<XML_TT_VAL_BITS+2*XML_REG_VAL_BITS)-1;BinaryXMLEncoder.prototype.numEncodingBytes=function(x){if(x<=ENCODING_LIMIT_1_BYTE)return 1;if(x<=ENCODING_LIMIT_2_BYTES)return 2;if(x<=ENCODING_LIMIT_3_BYTES)return 3;var numbytes=1;x=x>>>XML_TT_VAL_BITS;while(x!=0){numbytes++;x=x>>>XML_REG_VAL_BITS}return numbytes};BinaryXMLEncoder.prototype.writeDateTimeDTagElement=function(tag,dateTime){var binarydate=Math.round(dateTime.msec/1e3*4096).toString(16);if(binarydate.length%2==1)binarydate="0"+binarydate;this.writeDTagElement(tag,DataUtils.toNumbers(binarydate))};BinaryXMLEncoder.prototype.writeDateTime=function(tag,dateTime){var binarydate=Math.round(dateTime.msec/1e3*4096).toString(16);if(binarydate.length%2==1)binarydate="0"+binarydate;this.writeElement(tag,DataUtils.toNumbers(binarydate))};BinaryXMLEncoder.prototype.writeString=function(input){if(typeof input==="string"){if(LOG>4)console.log("GOING TO WRITE A STRING");if(LOG>4)console.log(input);this.ostream.ensureLength(this.offset+input.length);for(var i=0;i<input.length;i++){if(LOG>4)console.log("input.charCodeAt(i)="+input.charCodeAt(i));this.ostream.array[this.offset+i]=input.charCodeAt(i)}}else{if(LOG>4)console.log("GOING TO WRITE A STRING IN BINARY FORM");if(LOG>4)console.log(input);this.writeBlobArray(input)}};BinaryXMLEncoder.prototype.writeBlobArray=function(blob){if(LOG>4)console.log("GOING TO WRITE A BLOB");this.ostream.copy(blob,this.offset)};BinaryXMLEncoder.prototype.getReducedOstream=function(){return this.ostream.slice(0,this.offset)}},{"../log.js":157,"../util/dynamic-buffer.js":186,"../util/ndn-protoco-id-tags.js":189,"./data-utils.js":137}],135:[function(require,module,exports){var BinaryXMLDecoder=require("./binary-xml-decoder.js").BinaryXMLDecoder;var DynamicBuffer=require("../util/dynamic-buffer.js").DynamicBuffer;var XML_EXT=0;var XML_TAG=1;var XML_DTAG=2;var XML_ATTR=3;var XML_DATTR=4;var XML_BLOB=5;var XML_UDATA=6;var XML_CLOSE=0;var XML_SUBTYPE_PROCESSING_INSTRUCTIONS=16;var XML_TT_BITS=3;var XML_TT_MASK=(1<<XML_TT_BITS)-1;var XML_TT_VAL_BITS=XML_TT_BITS+1;var XML_TT_VAL_MASK=(1<<XML_TT_VAL_BITS)-1;var XML_REG_VAL_BITS=7;var XML_REG_VAL_MASK=(1<<XML_REG_VAL_BITS)-1;var XML_TT_NO_MORE=1<<XML_REG_VAL_BITS;var BinaryXMLStructureDecoder=function BinaryXMLDecoder(){this.gotElementEnd=false;this.offset=0;this.level=0;this.state=BinaryXMLStructureDecoder.READ_HEADER_OR_CLOSE;this.headerLength=0;this.useHeaderBuffer=false;this.headerBuffer=new DynamicBuffer(5);this.nBytesToRead=0};exports.BinaryXMLStructureDecoder=BinaryXMLStructureDecoder;BinaryXMLStructureDecoder.READ_HEADER_OR_CLOSE=0;BinaryXMLStructureDecoder.READ_BYTES=1;BinaryXMLStructureDecoder.prototype.findElementEnd=function(input){if(this.gotElementEnd)return true;var decoder=new BinaryXMLDecoder(input);while(true){if(this.offset>=input.length)return false;switch(this.state){case BinaryXMLStructureDecoder.READ_HEADER_OR_CLOSE:if(this.headerLength==0&&input[this.offset]==XML_CLOSE){++this.offset;--this.level;if(this.level==0){this.gotElementEnd=true;return true}if(this.level<0)throw new Error("BinaryXMLStructureDecoder: Unexpected close tag at offset "+(this.offset-1));this.startHeader();break}var startingHeaderLength=this.headerLength;while(true){if(this.offset>=input.length){this.useHeaderBuffer=true;var nNewBytes=this.headerLength-startingHeaderLength;this.headerBuffer.copy(input.slice(this.offset-nNewBytes,nNewBytes),startingHeaderLength);return false}var headerByte=input[this.offset++];++this.headerLength;if(headerByte&XML_TT_NO_MORE)break}var typeAndVal;if(this.useHeaderBuffer){nNewBytes=this.headerLength-startingHeaderLength;this.headerBuffer.copy(input.slice(this.offset-nNewBytes,nNewBytes),startingHeaderLength);typeAndVal=new BinaryXMLDecoder(this.headerBuffer.array).decodeTypeAndVal()}else{decoder.seek(this.offset-this.headerLength);typeAndVal=decoder.decodeTypeAndVal()}if(typeAndVal==null)throw new Error("BinaryXMLStructureDecoder: Can't read header starting at offset "+(this.offset-this.headerLength));var type=typeAndVal.t;if(type==XML_DATTR)this.startHeader();else if(type==XML_DTAG||type==XML_EXT){++this.level;this.startHeader()}else if(type==XML_TAG||type==XML_ATTR){if(type==XML_TAG)++this.level;this.nBytesToRead=typeAndVal.v+1;this.state=BinaryXMLStructureDecoder.READ_BYTES}else if(type==XML_BLOB||type==XML_UDATA){this.nBytesToRead=typeAndVal.v;this.state=BinaryXMLStructureDecoder.READ_BYTES}else throw new Error("BinaryXMLStructureDecoder: Unrecognized header type "+type);break;case BinaryXMLStructureDecoder.READ_BYTES:var nRemainingBytes=input.length-this.offset;if(nRemainingBytes<this.nBytesToRead){this.offset+=nRemainingBytes;this.nBytesToRead-=nRemainingBytes;return false}this.offset+=this.nBytesToRead;this.startHeader();break;default:throw new Error("BinaryXMLStructureDecoder: Unrecognized state "+this.state)}}};BinaryXMLStructureDecoder.prototype.startHeader=function(){this.headerLength=0;this.useHeaderBuffer=false;this.state=BinaryXMLStructureDecoder.READ_HEADER_OR_CLOSE};BinaryXMLStructureDecoder.prototype.seek=function(offset){this.offset=offset}},{"../util/dynamic-buffer.js":186,"./binary-xml-decoder.js":133}],136:[function(require,module,exports){var Blob=require("../util/blob.js").Blob;var NDNProtocolDTags=require("../util/ndn-protoco-id-tags.js").NDNProtocolDTags;var BinaryXMLEncoder=require("./binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./binary-xml-decoder.js").BinaryXMLDecoder;var WireFormat=require("./wire-format.js").WireFormat;var Name=require("../name.js").Name;var Exclude=require("../exclude.js").Exclude;var Sha256WithRsaSignature=require("../sha256-with-rsa-signature.js").Sha256WithRsaSignature;var MetaInfo=require("../meta-info.js").MetaInfo;var PublisherPublicKeyDigest=require("../publisher-public-key-digest.js").PublisherPublicKeyDigest;var DataUtils=require("./data-utils.js").DataUtils;var KeyLocatorType=require("../key-locator.js").KeyLocatorType;var BinaryXmlWireFormat=function BinaryXmlWireFormat(){WireFormat.call(this)};exports.BinaryXmlWireFormat=BinaryXmlWireFormat;BinaryXmlWireFormat.instance=null;BinaryXmlWireFormat.prototype.encodeName=function(name){var encoder=new BinaryXMLEncoder;name.to_ndnb(encoder);return new Blob(encoder.getReducedOstream(),false)};BinaryXmlWireFormat.prototype.decodeName=function(name,input){var decoder=new BinaryXMLDecoder(input);name.from_ndnb(decoder)};BinaryXmlWireFormat.prototype.encodeInterest=function(interest){var encoder=new BinaryXMLEncoder;var offsets=BinaryXmlWireFormat.encodeInterest(interest,encoder);return{encoding:new Blob(encoder.getReducedOstream(),false),signedPortionBeginOffset:offsets.signedPortionBeginOffset,signedPortionEndOffset:offsets.signedPortionEndOffset}};BinaryXmlWireFormat.prototype.decodeInterest=function(interest,input){var decoder=new BinaryXMLDecoder(input);return BinaryXmlWireFormat.decodeInterest(interest,decoder)};BinaryXmlWireFormat.prototype.encodeData=function(data){var encoder=new BinaryXMLEncoder(1500);var result=BinaryXmlWireFormat.encodeData(data,encoder);result.encoding=new Blob(encoder.getReducedOstream(),false);return result};BinaryXmlWireFormat.prototype.encodeContentObject=function(data){return this.encodeData(data)};BinaryXmlWireFormat.prototype.decodeData=function(data,input){var decoder=new BinaryXMLDecoder(input);return BinaryXmlWireFormat.decodeData(data,decoder)};BinaryXmlWireFormat.prototype.decodeContentObject=function(data,input){this.decodeData(data,input)};BinaryXmlWireFormat.get=function(){if(BinaryXmlWireFormat.instance===null)BinaryXmlWireFormat.instance=new BinaryXmlWireFormat;return BinaryXmlWireFormat.instance};BinaryXmlWireFormat.encodeInterest=function(interest,encoder){encoder.writeElementStartDTag(NDNProtocolDTags.Interest);var offsets=interest.getName().to_ndnb(encoder);if(null!=interest.getMinSuffixComponents())encoder.writeDTagElement(NDNProtocolDTags.MinSuffixComponents,interest.getMinSuffixComponents());if(null!=interest.getMaxSuffixComponents())encoder.writeDTagElement(NDNProtocolDTags.MaxSuffixComponents,interest.getMaxSuffixComponents());if(interest.getKeyLocator().getType()==KeyLocatorType.KEY_LOCATOR_DIGEST&&!interest.getKeyLocator().getKeyData().isNull()&&interest.getKeyLocator().getKeyData().size()>0)encoder.writeDTagElement(NDNProtocolDTags.PublisherPublicKeyDigest,interest.getKeyLocator().getKeyData());else{if(null!=interest.publisherPublicKeyDigest)interest.publisherPublicKeyDigest.to_ndnb(encoder)}if(null!=interest.getExclude())interest.getExclude().to_ndnb(encoder);if(null!=interest.getChildSelector())encoder.writeDTagElement(NDNProtocolDTags.ChildSelector,interest.getChildSelector());if(interest.DEFAULT_ANSWER_ORIGIN_KIND!=interest.setAnswerOriginKind()&&interest.setAnswerOriginKind()!=null)encoder.writeDTagElement(NDNProtocolDTags.AnswerOriginKind,interest.setAnswerOriginKind());if(null!=interest.setScope())encoder.writeDTagElement(NDNProtocolDTags.Scope,interest.setScope());if(null!=interest.getInterestLifetimeMilliseconds())encoder.writeDTagElement(NDNProtocolDTags.InterestLifetime,DataUtils.nonNegativeIntToBigEndian(interest.getInterestLifetimeMilliseconds()/1e3*4096));if(interest.getNonce().size()>0)encoder.writeDTagElement(NDNProtocolDTags.Nonce,interest.getNonce());encoder.writeElementClose();return offsets};BinaryXmlWireFormat.decodeInterest=function(interest,decoder){decoder.readElementStartDTag(NDNProtocolDTags.Interest);interest.setName(new Name);var offsets=interest.getName().from_ndnb(decoder);if(decoder.peekDTag(NDNProtocolDTags.MinSuffixComponents))interest.setMinSuffixComponents(decoder.readIntegerDTagElement(NDNProtocolDTags.MinSuffixComponents));else interest.setMinSuffixComponents(null);if(decoder.peekDTag(NDNProtocolDTags.MaxSuffixComponents))interest.setMaxSuffixComponents(decoder.readIntegerDTagElement(NDNProtocolDTags.MaxSuffixComponents));else interest.setMaxSuffixComponents(null);interest.getKeyLocator().clear();if(decoder.peekDTag(NDNProtocolDTags.PublisherPublicKeyDigest)){interest.publisherPublicKeyDigest=new PublisherPublicKeyDigest;interest.publisherPublicKeyDigest.from_ndnb(decoder)}else interest.publisherPublicKeyDigest=null;if(interest.publisherPublicKeyDigest!=null&&interest.publisherPublicKeyDigest.publisherPublicKeyDigest!=null&&interest.publisherPublicKeyDigest.publisherPublicKeyDigest.length>0){interest.getKeyLocator().setType(KeyLocatorType.KEY_LOCATOR_DIGEST);interest.getKeyLocator().setKeyData(interest.publisherPublicKeyDigest.publisherPublicKeyDigest)}if(decoder.peekDTag(NDNProtocolDTags.Exclude)){interest.setExclude(new Exclude);interest.getExclude().from_ndnb(decoder)}else interest.setExclude(new Exclude);if(decoder.peekDTag(NDNProtocolDTags.ChildSelector))interest.setChildSelector(decoder.readIntegerDTagElement(NDNProtocolDTags.ChildSelector));else interest.setChildSelector(null);if(decoder.peekDTag(NDNProtocolDTags.AnswerOriginKind))interest.setAnswerOriginKind(decoder.readIntegerDTagElement(NDNProtocolDTags.AnswerOriginKind));else interest.setAnswerOriginKind(null);if(decoder.peekDTag(NDNProtocolDTags.Scope))interest.setScope(decoder.readIntegerDTagElement(NDNProtocolDTags.Scope));else interest.setScope(null);if(decoder.peekDTag(NDNProtocolDTags.InterestLifetime))interest.setInterestLifetimeMilliseconds(1e3*DataUtils.bigEndianToUnsignedInt(decoder.readBinaryDTagElement(NDNProtocolDTags.InterestLifetime))/4096);else interest.setInterestLifetimeMilliseconds(null);if(decoder.peekDTag(NDNProtocolDTags.Nonce))interest.setNonce(decoder.readBinaryDTagElement(NDNProtocolDTags.Nonce));else interest.setNonce(null);decoder.readElementClose();return offsets};BinaryXmlWireFormat.encodeData=function(data,encoder){encoder.writeElementStartDTag(data.getElementLabel());if(null!=data.getSignature())data.getSignature().to_ndnb(encoder);var signedPortionBeginOffset=encoder.offset;if(null!=data.getName())data.getName().to_ndnb(encoder);if(null!=data.getMetaInfo())data.getMetaInfo().to_ndnb(encoder,data.getSignatureOrMetaInfoKeyLocator());encoder.writeDTagElement(NDNProtocolDTags.Content,data.getContent().buf());var signedPortionEndOffset=encoder.offset;encoder.writeElementClose();return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};BinaryXmlWireFormat.decodeData=function(data,decoder){decoder.readElementStartDTag(data.getElementLabel());if(decoder.peekDTag(NDNProtocolDTags.Signature)){data.setSignature(new Sha256WithRsaSignature);data.getSignature().from_ndnb(decoder)}else data.setSignature(new Sha256WithRsaSignature);var signedPortionBeginOffset=decoder.offset;data.setName(new Name);data.getName().from_ndnb(decoder);if(decoder.peekDTag(NDNProtocolDTags.SignedInfo)){data.setMetaInfo(new MetaInfo);data.getMetaInfo().from_ndnb(decoder);if(data.getMetaInfo().locator!=null&&data.getSignature()!=null)data.getSignature().setKeyLocator(data.getMetaInfo().locator)}else data.setMetaInfo(new MetaInfo);data.setContent(decoder.readBinaryDTagElement(NDNProtocolDTags.Content,true));var signedPortionEndOffset=decoder.offset;decoder.readElementClose();return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}}},{"../exclude.js":149,"../key-locator.js":155,"../meta-info.js":158,"../name.js":159,"../publisher-public-key-digest.js":161,"../sha256-with-rsa-signature.js":177,"../util/blob.js":184,"../util/ndn-protoco-id-tags.js":189,"./binary-xml-decoder.js":133,"./binary-xml-encoder.js":134,"./data-utils.js":137,"./wire-format.js":148}],137:[function(require,module,exports){(function(Buffer){var DataUtils={};exports.DataUtils=DataUtils;DataUtils.keyStr="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";DataUtils.stringtoBase64=function stringtoBase64(input){var output="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;do{chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2))enc3=enc4=64;else if(isNaN(chr3))enc4=64;output=output+DataUtils.keyStr.charAt(enc1)+DataUtils.keyStr.charAt(enc2)+DataUtils.keyStr.charAt(enc3)+DataUtils.keyStr.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4=""}while(i<input.length);return output};DataUtils.base64toString=function base64toString(input){var output="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;var base64test=/[^A-Za-z0-9\+\/\=]/g;if(base64test.exec(input)){alert("There were invalid base64 characters in the input text.\n"+"Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n"+"Expect errors in decoding.")}input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{enc1=DataUtils.keyStr.indexOf(input.charAt(i++));enc2=DataUtils.keyStr.indexOf(input.charAt(i++));enc3=DataUtils.keyStr.indexOf(input.charAt(i++));enc4=DataUtils.keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64)output=output+String.fromCharCode(chr2);if(enc4!=64)output=output+String.fromCharCode(chr3);chr1=chr2=chr3="";enc1=enc2=enc3=enc4=""}while(i<input.length);return output};DataUtils.toHex=function(buffer){return buffer.toString("hex")};DataUtils.stringToHex=function(args){var ret="";for(var i=0;i<args.length;++i){var value=args.charCodeAt(i);ret+=(value<16?"0":"")+value.toString(16)}return ret};DataUtils.toString=function(buffer){return buffer.toString("binary")};DataUtils.toNumbers=function(str){return new Buffer(str,"hex")};DataUtils.hexToRawString=function(str){if(typeof str=="string"){var ret="";str.replace(/(..)/g,function(s){ret+=String.fromCharCode(parseInt(s,16))});return ret}};DataUtils.toNumbersFromString=function(str){return new Buffer(str,"binary")};DataUtils.toNumbersIfString=function(value){if(typeof value==="string")return new Buffer(value,"binary");else return value};DataUtils.stringToUtf8Array=function(str){return new Buffer(str,"utf8")};DataUtils.concatArrays=function(arrays){return Buffer.concat(arrays)};DataUtils.decodeUtf8=function(utftext){var string="";var i=0;var c=0;var c1=0;var c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);var c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string};DataUtils.arraysEqual=function(a1,a2){if(!a1.slice)throw new Error("DataUtils.arraysEqual: a1 is not an array");if(!a2.slice)throw new Error("DataUtils.arraysEqual: a2 is not an array");if(a1.length!=a2.length)return false;for(var i=0;i<a1.length;++i){if(a1[i]!=a2[i])return false}return true};DataUtils.bigEndianToUnsignedInt=function(bytes){var result=0;for(var i=0;i<bytes.length;++i){result*=256;result+=bytes[i]}return result};DataUtils.nonNegativeIntToBigEndian=function(value){value=Math.round(value);if(value<=0)return new Buffer(0);var size=8;var result=new Buffer(size);var i=0;while(value!=0){++i;result[size-i]=value&255;value=Math.floor(value/256)}return result.slice(size-i,size)};DataUtils.shuffle=function(array){for(var i=array.length-1;i>=1;--i){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}}}).call(this,require("buffer").Buffer)},{buffer:3}],138:[function(require,module,exports){function DecodingException(error){this.message=error.message;for(var prop in error)this[prop]=error[prop]}DecodingException.prototype=new Error;DecodingException.prototype.name="DecodingException";exports.DecodingException=DecodingException},{}],139:[function(require,module,exports){var DataUtils=require("./data-utils.js").DataUtils;var BinaryXMLStructureDecoder=require("./binary-xml-structure-decoder.js").BinaryXMLStructureDecoder;var Tlv=require("./tlv/tlv.js").Tlv;var TlvStructureDecoder=require("./tlv/tlv-structure-decoder.js").TlvStructureDecoder;var LOG=require("../log.js").Log.LOG;var ElementReader=function ElementReader(elementListener){this.elementListener=elementListener;this.dataParts=[];this.binaryXmlStructureDecoder=new BinaryXMLStructureDecoder;this.tlvStructureDecoder=new TlvStructureDecoder;this.useTlv=null};exports.ElementReader=ElementReader;ElementReader.prototype.onReceivedData=function(data){while(true){if(this.dataParts.length==0){if(data.length<=0)return;if(data[0]==Tlv.Interest||data[0]==Tlv.Data||data[0]==128)this.useTlv=true;else this.useTlv=false}var gotElementEnd;var offset;if(this.useTlv){this.tlvStructureDecoder.seek(0);gotElementEnd=this.tlvStructureDecoder.findElementEnd(data);offset=this.tlvStructureDecoder.getOffset()}else{this.binaryXmlStructureDecoder.seek(0);gotElementEnd=this.binaryXmlStructureDecoder.findElementEnd(data);offset=this.binaryXmlStructureDecoder.offset}if(gotElementEnd){this.dataParts.push(data.slice(0,offset));var element=DataUtils.concatArrays(this.dataParts);this.dataParts=[];try{this.elementListener.onReceivedElement(element)}catch(ex){console.log("ElementReader: ignoring exception from onReceivedElement: "+ex)}data=data.slice(offset,data.length);this.binaryXmlStructureDecoder=new BinaryXMLStructureDecoder;this.tlvStructureDecoder=new TlvStructureDecoder;if(data.length==0)return}else{this.dataParts.push(data);if(LOG>3)console.log("Incomplete packet received. Length "+data.length+". Wait for more input.");return}}}},{"../log.js":157,"./binary-xml-structure-decoder.js":135,"./data-utils.js":137,"./tlv/tlv-structure-decoder.js":146,"./tlv/tlv.js":147}],140:[function(require,module,exports){var DataUtils=require("./data-utils.js").DataUtils;var BinaryXMLEncoder=require("./binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./binary-xml-decoder.js").BinaryXMLDecoder;var Key=require("../key.js").Key;var KeyLocatorType=require("../key-locator.js").KeyLocatorType;var Interest=require("../interest.js").Interest;var Data=require("../data.js").Data;var FaceInstance=require("../face-instance.js").FaceInstance;var ForwardingEntry=require("../forwarding-entry.js").ForwardingEntry;var WireFormat=require("./wire-format.js").WireFormat;var LOG=require("../log.js").Log.LOG;var EncodingUtils=function EncodingUtils(){};exports.EncodingUtils=EncodingUtils;EncodingUtils.encodeToHexInterest=function(interest,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();return DataUtils.toHex(interest.wireEncode(wireFormat).buf())};EncodingUtils.encodeToHexData=function(data,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();return DataUtils.toHex(data.wireEncode(wireFormat).buf())};EncodingUtils.encodeToHexContentObject=function(data,wireFormat){return EncodingUtils.encodeToHexData(data,wireFormat)
};EncodingUtils.encodeForwardingEntry=function(data){var enc=new BinaryXMLEncoder;data.to_ndnb(enc);var bytes=enc.getReducedOstream();return bytes};EncodingUtils.decodeHexFaceInstance=function(result){var numbers=DataUtils.toNumbers(result);var decoder=new BinaryXMLDecoder(numbers);if(LOG>3)console.log("DECODING HEX FACE INSTANCE  \n"+numbers);var faceInstance=new FaceInstance;faceInstance.from_ndnb(decoder);return faceInstance};EncodingUtils.decodeHexInterest=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var interest=new Interest;interest.wireDecode(DataUtils.toNumbers(input),wireFormat);return interest};EncodingUtils.decodeHexData=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var data=new Data;data.wireDecode(DataUtils.toNumbers(input),wireFormat);return data};EncodingUtils.decodeHexContentObject=function(input,wireFormat){return EncodingUtils.decodeHexData(input,wireFormat)};EncodingUtils.decodeHexForwardingEntry=function(result){var numbers=DataUtils.toNumbers(result);var decoder=new BinaryXMLDecoder(numbers);if(LOG>3)console.log("DECODED HEX FORWARDING ENTRY \n"+numbers);var forwardingEntry=new ForwardingEntry;forwardingEntry.from_ndnb(decoder);return forwardingEntry};EncodingUtils.decodeSubjectPublicKeyInfo=function(array){var hex=DataUtils.toHex(array).toLowerCase();var a=_x509_getPublicKeyHexArrayFromCertHex(hex,_x509_getSubjectPublicKeyPosFromCertHex(hex,0));var rsaKey=new RSAKey;rsaKey.setPublic(a[0],a[1]);return rsaKey};EncodingUtils.dataToHtml=function(data){var output="";if(data==-1)output+="NO CONTENT FOUND";else if(data==-2)output+="CONTENT NAME IS EMPTY";else{if(data.getName()!=null){output+="NAME: "+data.getName().toUri();output+="<br />";output+="<br />"}if(!data.getContent().isNull()){output+="CONTENT(ASCII): "+DataUtils.toString(data.getContent().buf());output+="<br />";output+="<br />"}if(!data.getContent().isNull()){output+="CONTENT(hex): "+data.getContent().toHex();output+="<br />";output+="<br />"}if(data.getSignature()!=null&&data.getSignature().digestAlgorithm!=null){output+="DigestAlgorithm (hex): "+DataUtils.toHex(data.getSignature().digestAlgorithm);output+="<br />";output+="<br />"}if(data.getSignature()!=null&&data.getSignature().witness!=null){output+="Witness (hex): "+DataUtils.toHex(data.getSignature().witness);output+="<br />";output+="<br />"}if(data.getSignature()!=null&&data.getSignature().getSignature()!=null){output+="Signature(hex): "+data.getSignature().getSignature().toHex();output+="<br />";output+="<br />"}if(data.getMetaInfo()!=null&&data.getMetaInfo().publisher!=null&&data.getMetaInfo().publisher.publisherPublicKeyDigest!=null){output+="Publisher Public Key Digest(hex): "+DataUtils.toHex(data.getMetaInfo().publisher.publisherPublicKeyDigest);output+="<br />";output+="<br />"}if(data.getMetaInfo()!=null&&data.getMetaInfo().timestamp!=null){var d=new Date;d.setTime(data.getMetaInfo().timestamp.msec);var bytes=[217,185,12,225,217,185,12,225];output+="TimeStamp: "+d;output+="<br />";output+="TimeStamp(number): "+data.getMetaInfo().timestamp.msec;output+="<br />"}if(data.getMetaInfo()!=null&&data.getMetaInfo().getFinalBlockId().getValue().size()>0){output+="FinalBlockId: "+data.getMetaInfo().getFinalBlockId().getValue().toHex();output+="<br />"}if(data.getMetaInfo()!=null&&data.getMetaInfo().locator!=null&&data.getMetaInfo().locator.getType()){output+="keyLocator: ";if(data.getMetaInfo().locator.getType()==KeyLocatorType.KEY)output+="Key: "+DataUtils.toHex(data.getMetaInfo().locator.publicKey).toLowerCase()+"<br />";else if(data.getMetaInfo().locator.getType()==KeyLocatorType.KEY_LOCATOR_DIGEST)output+="KeyLocatorDigest: "+DataUtils.toHex(data.getMetaInfo().locator.getKeyData().buf()).toLowerCase()+"<br />";else if(data.getMetaInfo().locator.getType()==KeyLocatorType.CERTIFICATE)output+="Certificate: "+DataUtils.toHex(data.getMetaInfo().locator.certificate).toLowerCase()+"<br />";else if(data.getMetaInfo().locator.getType()==KeyLocatorType.KEYNAME)output+="KeyName: "+data.getMetaInfo().locator.keyName.contentName.to_uri()+"<br />";else output+="[unrecognized ndn_KeyLocatorType "+data.getMetaInfo().locator.getType()+"]<br />"}}return output};EncodingUtils.contentObjectToHtml=function(data){return EncodingUtils.dataToHtml(data)};var encodeToHexInterest=function(interest){return EncodingUtils.encodeToHexInterest(interest)};var encodeToHexContentObject=function(data){return EncodingUtils.encodeToHexData(data)};var encodeForwardingEntry=function(data){return EncodingUtils.encodeForwardingEntry(data)};var decodeHexFaceInstance=function(input){return EncodingUtils.decodeHexFaceInstance(input)};var decodeHexInterest=function(input){return EncodingUtils.decodeHexInterest(input)};var decodeHexContentObject=function(input){return EncodingUtils.decodeHexData(input)};var decodeHexForwardingEntry=function(input){return EncodingUtils.decodeHexForwardingEntry(input)};var decodeSubjectPublicKeyInfo=function(input){return EncodingUtils.decodeSubjectPublicKeyInfo(input)};var contentObjectToHtml=function(data){return EncodingUtils.dataToHtml(data)};function encodeToBinaryInterest(interest){return interest.wireEncode().buf()}function encodeToBinaryContentObject(data){return data.wireEncode().buf()}},{"../data.js":132,"../face-instance.js":150,"../forwarding-entry.js":152,"../interest.js":154,"../key-locator.js":155,"../key.js":156,"../log.js":157,"./binary-xml-decoder.js":133,"./binary-xml-encoder.js":134,"./data-utils.js":137,"./wire-format.js":148}],141:[function(require,module,exports){var TlvEncoder=require("./tlv/tlv-encoder.js").TlvEncoder;var TlvDecoder=require("./tlv/tlv-decoder.js").TlvDecoder;var Blob=require("../util/blob.js").Blob;var ProtobufTlv=function ProtobufTlv(){};exports.ProtobufTlv=ProtobufTlv;ProtobufTlv._Field=null;ProtobufTlv.establishField=function(){if(ProtobufTlv._Field===null){try{ProtobufTlv._Field=dcodeIO.ProtoBuf.Reflect.Message.Field}catch(ex){ProtobufTlv._Field=require("protobufjs/dist/ProtoBuf.js").Reflect.Message.Field}}};ProtobufTlv.encode=function(message,descriptor){ProtobufTlv.establishField();message.encodeAB();var encoder=new TlvEncoder;ProtobufTlv._encodeMessageValue(message,descriptor,encoder);return new Blob(encoder.getOutput(),false)};ProtobufTlv.decode=function(message,descriptor,input){ProtobufTlv.establishField();if(ProtobufTlv._Field===null){if(dcodeIO)ProtobufTlv._Field=dcodeIO.ProtoBuf.Reflect.Message.Field;else ProtobufTlv._Field=require("protobufjs/dist/ProtoBuf.js").Reflect.Message.Field}var decodeBuffer=typeof input==="object"&&input instanceof Blob?input.buf():input;var decoder=new TlvDecoder(decodeBuffer);ProtobufTlv._decodeMessageValue(message,descriptor,decoder,decodeBuffer.length)};ProtobufTlv._encodeMessageValue=function(message,descriptor,encoder){var fields=descriptor.getChildren(ProtobufTlv._Field);for(var iField=fields.length-1;iField>=0;--iField){var field=fields[iField];var tlvType=field.id;var values;if(field.repeated)values=message[field.name];else{if(message[field.name]!=null)values=[message[field.name]];else continue}for(var iValue=values.length-1;iValue>=0;--iValue){var value=values[iValue];if(field.type.name=="message"){var saveLength=encoder.getLength();ProtobufTlv._encodeMessageValue(value,field.resolvedType,encoder);encoder.writeTypeAndLength(tlvType,encoder.getLength()-saveLength)}else if(field.type.name=="uint32"||field.type.name=="uint64")encoder.writeNonNegativeIntegerTlv(tlvType,value);else if(field.type.name=="enum"){if(value<0)throw new Error("ProtobufTlv::encode: ENUM value may not be negative");encoder.writeNonNegativeIntegerTlv(tlvType,value)}else if(field.type.name=="bytes")encoder.writeBlobTlv(tlvType,value.toBinary());else if(field.type.name=="string")encoder.writeBlobTlv(tlvType,new Blob(value,false).buf());else if(field.type.name=="bool"){if(value)encoder.writeTypeAndLength(tlvType,0)}else throw new Error("ProtobufTlv::encode: Unknown field type")}}};ProtobufTlv._decodeMessageValue=function(message,descriptor,decoder,endOffset){var fields=descriptor.getChildren(ProtobufTlv._Field);for(var iField=0;iField<fields.length;++iField){var field=fields[iField];var tlvType=field.id;if(!field.required&&!decoder.peekType(tlvType,endOffset))continue;if(field.repeated){while(decoder.peekType(tlvType,endOffset)){if(field.type.name=="message"){var innerEndOffset=decoder.readNestedTlvsStart(tlvType);var value=new(field.resolvedType.build());message.add(field.name,value);ProtobufTlv._decodeMessageValue(value,field.resolvedType,decoder,innerEndOffset);decoder.finishNestedTlvs(innerEndOffset)}else message.add(field.name,ProtobufTlv._decodeFieldValue(field,tlvType,decoder,endOffset))}}else{if(field.type.name=="message"){var innerEndOffset=decoder.readNestedTlvsStart(tlvType);var value=new(field.resolvedType.build());message.set(field.name,value);ProtobufTlv._decodeMessageValue(value,field.resolvedType,decoder,innerEndOffset);decoder.finishNestedTlvs(innerEndOffset)}else message.set(field.name,ProtobufTlv._decodeFieldValue(field,tlvType,decoder,endOffset))}}};ProtobufTlv._decodeFieldValue=function(field,tlvType,decoder,endOffset){if(field.type.name=="uint32"||field.type.name=="uint64"||field.type.name=="enum")return decoder.readNonNegativeIntegerTlv(tlvType);else if(field.type.name=="bytes")return decoder.readBlobTlv(tlvType);else if(field.type.name=="string")return decoder.readBlobTlv(tlvType).toString();else if(field.type.name=="bool")return decoder.readBooleanTlv(tlvType,endOffset);else throw new Error("ProtobufTlv.decode: Unknown field type")}},{"../util/blob.js":184,"./tlv/tlv-decoder.js":144,"./tlv/tlv-encoder.js":145,"protobufjs/dist/ProtoBuf.js":193}],142:[function(require,module,exports){(function(Buffer){var Crypto=require("../crypto.js");var Blob=require("../util/blob.js").Blob;var Tlv=require("./tlv/tlv.js").Tlv;var TlvEncoder=require("./tlv/tlv-encoder.js").TlvEncoder;var TlvDecoder=require("./tlv/tlv-decoder.js").TlvDecoder;var WireFormat=require("./wire-format.js").WireFormat;var Exclude=require("../exclude.js").Exclude;var ContentType=require("../meta-info.js").ContentType;var KeyLocatorType=require("../key-locator.js").KeyLocatorType;var Sha256WithRsaSignature=require("../sha256-with-rsa-signature.js").Sha256WithRsaSignature;var ForwardingFlags=require("../forwarding-flags.js").ForwardingFlags;var PublisherPublicKeyDigest=require("../publisher-public-key-digest.js").PublisherPublicKeyDigest;var DecodingException=require("./decoding-exception.js").DecodingException;var Tlv0_1WireFormat=function Tlv0_1WireFormat(){WireFormat.call(this)};Tlv0_1WireFormat.prototype=new WireFormat;Tlv0_1WireFormat.prototype.name="Tlv0_1WireFormat";exports.Tlv0_1WireFormat=Tlv0_1WireFormat;Tlv0_1WireFormat.instance=null;Tlv0_1WireFormat.prototype.encodeName=function(name){var encoder=new TlvEncoder;Tlv0_1WireFormat.encodeName(name,encoder);return new Blob(encoder.getOutput(),false)};Tlv0_1WireFormat.prototype.decodeName=function(name,input){var decoder=new TlvDecoder(input);Tlv0_1WireFormat.decodeName(name,decoder)};Tlv0_1WireFormat.prototype.encodeInterest=function(interest){var encoder=new TlvEncoder(256);var saveLength=encoder.getLength();encoder.writeOptionalNonNegativeIntegerTlv(Tlv.InterestLifetime,interest.getInterestLifetimeMilliseconds());encoder.writeOptionalNonNegativeIntegerTlv(Tlv.Scope,interest.getScope());if(interest.getNonce().isNull()||interest.getNonce().size()==0)encoder.writeBlobTlv(Tlv.Nonce,Crypto.randomBytes(4));else if(interest.getNonce().size()<4){var nonce=Buffer(4);interest.getNonce().buf().copy(nonce);for(var i=interest.getNonce().size();i<4;++i)nonce[i]=Crypto.randomBytes(1)[0];encoder.writeBlobTlv(Tlv.Nonce,nonce)}else if(interest.getNonce().size()==4)encoder.writeBlobTlv(Tlv.Nonce,interest.getNonce().buf());else encoder.writeBlobTlv(Tlv.Nonce,interest.getNonce().buf().slice(0,4));Tlv0_1WireFormat.encodeSelectors(interest,encoder);var tempOffsets=Tlv0_1WireFormat.encodeName(interest.getName(),encoder);var signedPortionBeginOffsetFromBack=encoder.getLength()-tempOffsets.signedPortionBeginOffset;var signedPortionEndOffsetFromBack=encoder.getLength()-tempOffsets.signedPortionEndOffset;encoder.writeTypeAndLength(Tlv.Interest,encoder.getLength()-saveLength);var signedPortionBeginOffset=encoder.getLength()-signedPortionBeginOffsetFromBack;var signedPortionEndOffset=encoder.getLength()-signedPortionEndOffsetFromBack;return{encoding:new Blob(encoder.getOutput(),false),signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Tlv0_1WireFormat.prototype.decodeInterest=function(interest,input){var decoder=new TlvDecoder(input);var endOffset=decoder.readNestedTlvsStart(Tlv.Interest);var offsets=Tlv0_1WireFormat.decodeName(interest.getName(),decoder);if(decoder.peekType(Tlv.Selectors,endOffset))Tlv0_1WireFormat.decodeSelectors(interest,decoder);var nonce=decoder.readBlobTlv(Tlv.Nonce);interest.setScope(decoder.readOptionalNonNegativeIntegerTlv(Tlv.Scope,endOffset));interest.setInterestLifetimeMilliseconds(decoder.readOptionalNonNegativeIntegerTlv(Tlv.InterestLifetime,endOffset));interest.setNonce(nonce);decoder.finishNestedTlvs(endOffset);return offsets};Tlv0_1WireFormat.prototype.encodeData=function(data){var encoder=new TlvEncoder(1500);var saveLength=encoder.getLength();encoder.writeBlobTlv(Tlv.SignatureValue,data.getSignature().getSignature().buf());var signedPortionEndOffsetFromBack=encoder.getLength();Tlv0_1WireFormat.encodeSignatureSha256WithRsaValue(data.getSignature(),encoder,data.getSignatureOrMetaInfoKeyLocator());encoder.writeBlobTlv(Tlv.Content,data.getContent().buf());Tlv0_1WireFormat.encodeMetaInfo(data.getMetaInfo(),encoder);Tlv0_1WireFormat.encodeName(data.getName(),encoder);var signedPortionBeginOffsetFromBack=encoder.getLength();encoder.writeTypeAndLength(Tlv.Data,encoder.getLength()-saveLength);var signedPortionBeginOffset=encoder.getLength()-signedPortionBeginOffsetFromBack;var signedPortionEndOffset=encoder.getLength()-signedPortionEndOffsetFromBack;return{encoding:new Blob(encoder.getOutput(),false),signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Tlv0_1WireFormat.prototype.decodeData=function(data,input){var decoder=new TlvDecoder(input);var endOffset=decoder.readNestedTlvsStart(Tlv.Data);var signedPortionBeginOffset=decoder.getOffset();Tlv0_1WireFormat.decodeName(data.getName(),decoder);Tlv0_1WireFormat.decodeMetaInfo(data.getMetaInfo(),decoder);data.setContent(decoder.readBlobTlv(Tlv.Content));Tlv0_1WireFormat.decodeSignatureInfo(data,decoder);if(data.getSignature()!=null&&data.getSignature().getKeyLocator()!=null&&data.getMetaInfo()!=null)data.getMetaInfo().locator=data.getSignature().getKeyLocator();var signedPortionEndOffset=decoder.getOffset();data.getSignature().setSignature(new Blob(decoder.readBlobTlv(Tlv.SignatureValue),true));decoder.finishNestedTlvs(endOffset);return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Tlv0_1WireFormat.prototype.encodeControlParameters=function(controlParameters){var encoder=new TlvEncoder(256);var saveLength=encoder.getLength();encoder.writeOptionalNonNegativeIntegerTlv(Tlv.ControlParameters_ExpirationPeriod,controlParameters.getExpirationPeriod());var flags=controlParameters.getForwardingFlags().getNfdForwardingFlags();if(flags!=(new ForwardingFlags).getNfdForwardingFlags())encoder.writeNonNegativeIntegerTlv(Tlv.ControlParameters_Flags,flags);encoder.writeOptionalNonNegativeIntegerTlv(Tlv.ControlParameters_Cost,controlParameters.getCost());encoder.writeOptionalNonNegativeIntegerTlv(Tlv.ControlParameters_Origin,controlParameters.getOrigin());encoder.writeOptionalNonNegativeIntegerTlv(Tlv.ControlParameters_LocalControlFeature,controlParameters.getLocalControlFeature());encoder.writeOptionalNonNegativeIntegerTlv(Tlv.FaceID,controlParameters.getFaceId());Tlv0_1WireFormat.encodeName(controlParameters.getName(),encoder);encoder.writeTypeAndLength(Tlv.ControlParameters_ControlParameters,encoder.getLength()-saveLength);return new Blob(encoder.getOutput(),false)};Tlv0_1WireFormat.prototype.encodeSignatureInfo=function(signature){var encoder=new TlvEncoder(256);Tlv0_1WireFormat.encodeSignatureSha256WithRsaValue(signature,encoder,signature.getKeyLocator());return new Blob(encoder.getOutput(),false)};Tlv0_1WireFormat.SignatureHolder=function Tlv0_1WireFormatSignatureHolder(){};Tlv0_1WireFormat.SignatureHolder.prototype.setSignature=function(signature){this.signature=signature};Tlv0_1WireFormat.SignatureHolder.prototype.getSignature=function(){return this.signature};Tlv0_1WireFormat.prototype.decodeSignatureInfoAndValue=function(signatureInfo,signatureValue){var signatureHolder=new Tlv0_1WireFormat.SignatureHolder;var decoder=new TlvDecoder(signatureInfo);Tlv0_1WireFormat.decodeSignatureInfo(signatureHolder,decoder);decoder=new TlvDecoder(signatureValue);signatureHolder.getSignature().setSignature(new Blob(decoder.readBlobTlv(Tlv.SignatureValue),true));return signatureHolder.getSignature()};Tlv0_1WireFormat.prototype.encodeSignatureValue=function(signature){var encoder=new TlvEncoder(256);encoder.writeBlobTlv(Tlv.SignatureValue,signature.getSignature().buf());return new Blob(encoder.getOutput(),false)};Tlv0_1WireFormat.get=function(){if(Tlv0_1WireFormat.instance===null)Tlv0_1WireFormat.instance=new Tlv0_1WireFormat;return Tlv0_1WireFormat.instance};Tlv0_1WireFormat.encodeName=function(name,encoder){var saveLength=encoder.getLength();var signedPortionEndOffsetFromBack;for(var i=name.size()-1;i>=0;--i){encoder.writeBlobTlv(Tlv.NameComponent,name.get(i).getValue().buf());if(i==name.size()-1)signedPortionEndOffsetFromBack=encoder.getLength()}var signedPortionBeginOffsetFromBack=encoder.getLength();encoder.writeTypeAndLength(Tlv.Name,encoder.getLength()-saveLength);var signedPortionBeginOffset=encoder.getLength()-signedPortionBeginOffsetFromBack;var signedPortionEndOffset;if(name.size()==0)signedPortionEndOffset=signedPortionBeginOffset;else signedPortionEndOffset=encoder.getLength()-signedPortionEndOffsetFromBack;return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Tlv0_1WireFormat.decodeName=function(name,decoder){name.clear();var endOffset=decoder.readNestedTlvsStart(Tlv.Name);var signedPortionBeginOffset=decoder.getOffset();var signedPortionEndOffset=signedPortionBeginOffset;while(decoder.getOffset()<endOffset){signedPortionEndOffset=decoder.getOffset();name.append(decoder.readBlobTlv(Tlv.NameComponent))}decoder.finishNestedTlvs(endOffset);return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Tlv0_1WireFormat.encodeSelectors=function(interest,encoder){var saveLength=encoder.getLength();if(interest.getMustBeFresh())encoder.writeTypeAndLength(Tlv.MustBeFresh,0);encoder.writeOptionalNonNegativeIntegerTlv(Tlv.ChildSelector,interest.getChildSelector());if(interest.getExclude().size()>0)Tlv0_1WireFormat.encodeExclude(interest.getExclude(),encoder);if(interest.getKeyLocator().getType()!=null)Tlv0_1WireFormat.encodeKeyLocator(Tlv.PublisherPublicKeyLocator,interest.getKeyLocator(),encoder);else{if(null!=interest.publisherPublicKeyDigest){var savePublisherPublicKeyDigestLength=encoder.getLength();encoder.writeBlobTlv(Tlv.KeyLocatorDigest,interest.publisherPublicKeyDigest.publisherPublicKeyDigest);encoder.writeTypeAndLength(Tlv.PublisherPublicKeyLocator,encoder.getLength()-savePublisherPublicKeyDigestLength)}}encoder.writeOptionalNonNegativeIntegerTlv(Tlv.MaxSuffixComponents,interest.getMaxSuffixComponents());encoder.writeOptionalNonNegativeIntegerTlv(Tlv.MinSuffixComponents,interest.getMinSuffixComponents());if(encoder.getLength()!=saveLength)encoder.writeTypeAndLength(Tlv.Selectors,encoder.getLength()-saveLength)};Tlv0_1WireFormat.decodeSelectors=function(interest,decoder){var endOffset=decoder.readNestedTlvsStart(Tlv.Selectors);interest.setMinSuffixComponents(decoder.readOptionalNonNegativeIntegerTlv(Tlv.MinSuffixComponents,endOffset));interest.setMaxSuffixComponents(decoder.readOptionalNonNegativeIntegerTlv(Tlv.MaxSuffixComponents,endOffset));interest.publisherPublicKeyDigest=null;if(decoder.peekType(Tlv.PublisherPublicKeyLocator,endOffset)){Tlv0_1WireFormat.decodeKeyLocator(Tlv.PublisherPublicKeyLocator,interest.getKeyLocator(),decoder);if(interest.getKeyLocator().getType()==KeyLocatorType.KEY_LOCATOR_DIGEST){interest.publisherPublicKeyDigest=new PublisherPublicKeyDigest;interest.publisherPublicKeyDigest.publisherPublicKeyDigest=interest.getKeyLocator().getKeyData().buf()}}else interest.getKeyLocator().clear();if(decoder.peekType(Tlv.Exclude,endOffset))Tlv0_1WireFormat.decodeExclude(interest.getExclude(),decoder);else interest.getExclude().clear();interest.setChildSelector(decoder.readOptionalNonNegativeIntegerTlv(Tlv.ChildSelector,endOffset));interest.setMustBeFresh(decoder.readBooleanTlv(Tlv.MustBeFresh,endOffset));decoder.finishNestedTlvs(endOffset)};Tlv0_1WireFormat.encodeExclude=function(exclude,encoder){var saveLength=encoder.getLength();for(var i=exclude.size()-1;i>=0;--i){var entry=exclude.get(i);if(entry==Exclude.ANY)encoder.writeTypeAndLength(Tlv.Any,0);else encoder.writeBlobTlv(Tlv.NameComponent,entry.getValue().buf())}encoder.writeTypeAndLength(Tlv.Exclude,encoder.getLength()-saveLength)};Tlv0_1WireFormat.decodeExclude=function(exclude,decoder){var endOffset=decoder.readNestedTlvsStart(Tlv.Exclude);exclude.clear();while(true){if(decoder.peekType(Tlv.NameComponent,endOffset))exclude.appendComponent(decoder.readBlobTlv(Tlv.NameComponent));else if(decoder.readBooleanTlv(Tlv.Any,endOffset))exclude.appendAny();else break}decoder.finishNestedTlvs(endOffset)};Tlv0_1WireFormat.encodeKeyLocator=function(type,keyLocator,encoder){var saveLength=encoder.getLength();if(keyLocator.getType()!=null){if(keyLocator.getType()==KeyLocatorType.KEYNAME)Tlv0_1WireFormat.encodeName(keyLocator.getKeyName(),encoder);else if(keyLocator.getType()==KeyLocatorType.KEY_LOCATOR_DIGEST&&keyLocator.getKeyData().size()>0)encoder.writeBlobTlv(Tlv.KeyLocatorDigest,keyLocator.getKeyData().buf());else throw new Error("Unrecognized KeyLocatorType "+keyLocator.getType())}encoder.writeTypeAndLength(type,encoder.getLength()-saveLength)};Tlv0_1WireFormat.decodeKeyLocator=function(expectedType,keyLocator,decoder){var endOffset=decoder.readNestedTlvsStart(expectedType);keyLocator.clear();if(decoder.getOffset()==endOffset)return;if(decoder.peekType(Tlv.Name,endOffset)){keyLocator.setType(KeyLocatorType.KEYNAME);Tlv0_1WireFormat.decodeName(keyLocator.getKeyName(),decoder)}else if(decoder.peekType(Tlv.KeyLocatorDigest,endOffset)){keyLocator.setType(KeyLocatorType.KEY_LOCATOR_DIGEST);keyLocator.setKeyData(decoder.readBlobTlv(Tlv.KeyLocatorDigest))}else throw new DecodingException("decodeKeyLocator: Unrecognized key locator type");decoder.finishNestedTlvs(endOffset)};Tlv0_1WireFormat.encodeSignatureSha256WithRsaValue=function(signature,encoder,keyLocator){var saveLength=encoder.getLength();Tlv0_1WireFormat.encodeKeyLocator(Tlv.KeyLocator,keyLocator,encoder);encoder.writeNonNegativeIntegerTlv(Tlv.SignatureType,Tlv.SignatureType_SignatureSha256WithRsa);encoder.writeTypeAndLength(Tlv.SignatureInfo,encoder.getLength()-saveLength)};Tlv0_1WireFormat.decodeSignatureInfo=function(data,decoder){var endOffset=decoder.readNestedTlvsStart(Tlv.SignatureInfo);var signatureType=decoder.readNonNegativeIntegerTlv(Tlv.SignatureType);if(signatureType==Tlv.SignatureType_SignatureSha256WithRsa){data.setSignature(new Sha256WithRsaSignature);var signatureInfo=data.getSignature();Tlv0_1WireFormat.decodeKeyLocator(Tlv.KeyLocator,signatureInfo.getKeyLocator(),decoder)}else throw new DecodingException("decodeSignatureInfo: unrecognized SignatureInfo type"+signatureType);decoder.finishNestedTlvs(endOffset)};Tlv0_1WireFormat.encodeMetaInfo=function(metaInfo,encoder){var saveLength=encoder.getLength();var finalBlockIdBuf=metaInfo.getFinalBlockId().getValue().buf();if(finalBlockIdBuf!=null&&finalBlockIdBuf.length>0){var finalBlockIdSaveLength=encoder.getLength();encoder.writeBlobTlv(Tlv.NameComponent,finalBlockIdBuf);encoder.writeTypeAndLength(Tlv.FinalBlockId,encoder.getLength()-finalBlockIdSaveLength)}encoder.writeOptionalNonNegativeIntegerTlv(Tlv.FreshnessPeriod,metaInfo.getFreshnessPeriod());if(metaInfo.getType()!=ContentType.BLOB){if(metaInfo.getType()==ContentType.LINK||metaInfo.getType()==ContentType.KEY)encoder.writeNonNegativeIntegerTlv(Tlv.ContentType,metaInfo.getType());else throw new Error("unrecognized TLV ContentType")}encoder.writeTypeAndLength(Tlv.MetaInfo,encoder.getLength()-saveLength)};Tlv0_1WireFormat.decodeMetaInfo=function(metaInfo,decoder){var endOffset=decoder.readNestedTlvsStart(Tlv.MetaInfo);metaInfo.setType(decoder.readOptionalNonNegativeIntegerTlv(Tlv.ContentType,endOffset));metaInfo.setFreshnessPeriod(decoder.readOptionalNonNegativeIntegerTlv(Tlv.FreshnessPeriod,endOffset));if(decoder.peekType(Tlv.FinalBlockId,endOffset)){var finalBlockIdEndOffset=decoder.readNestedTlvsStart(Tlv.FinalBlockId);metaInfo.setFinalBlockId(decoder.readBlobTlv(Tlv.NameComponent));decoder.finishNestedTlvs(finalBlockIdEndOffset)}else metaInfo.setFinalBlockId(null);decoder.finishNestedTlvs(endOffset)}}).call(this,require("buffer").Buffer)},{"../crypto.js":129,"../exclude.js":149,"../forwarding-flags.js":153,"../key-locator.js":155,"../meta-info.js":158,"../publisher-public-key-digest.js":161,"../sha256-with-rsa-signature.js":177,"../util/blob.js":184,"./decoding-exception.js":138,"./tlv/tlv-decoder.js":144,"./tlv/tlv-encoder.js":145,"./tlv/tlv.js":147,"./wire-format.js":148,buffer:3}],143:[function(require,module,exports){var WireFormat=require("./wire-format.js").WireFormat;var Tlv0_1WireFormat=require("./tlv-0_1-wire-format.js").Tlv0_1WireFormat;var TlvWireFormat=function TlvWireFormat(){Tlv0_1WireFormat.call(this)};TlvWireFormat.prototype=new Tlv0_1WireFormat;TlvWireFormat.prototype.name="TlvWireFormat";exports.TlvWireFormat=TlvWireFormat;TlvWireFormat.instance=null;TlvWireFormat.get=function(){if(TlvWireFormat.instance===null)TlvWireFormat.instance=new TlvWireFormat;return TlvWireFormat.instance};WireFormat.setDefaultWireFormat(TlvWireFormat.get())},{"./tlv-0_1-wire-format.js":142,"./wire-format.js":148}],144:[function(require,module,exports){var DecodingException=require("../decoding-exception.js").DecodingException;var TlvDecoder=function TlvDecoder(input){this.input=input;this.offset=0};exports.TlvDecoder=TlvDecoder;TlvDecoder.prototype.readVarNumber=function(){var firstOctet=this.input[this.offset];this.offset+=1;if(firstOctet<253)return firstOctet;else return this.readExtendedVarNumber(firstOctet)};TlvDecoder.prototype.readExtendedVarNumber=function(firstOctet){var result;if(firstOctet==253){result=(this.input[this.offset]<<8)+this.input[this.offset+1];this.offset+=2}else if(firstOctet==254){result=Math.abs(this.input[this.offset]<<24)+(this.input[this.offset+1]<<16)+(this.input[this.offset+2]<<8)+this.input[this.offset+3];this.offset+=4}else{var highByte=Math.abs(this.input[this.offset]<<24)+(this.input[this.offset+1]<<16)+(this.input[this.offset+2]<<8)+this.input[this.offset+3];result=highByte*4294967296+(this.input[this.offset+4]<<24)+(this.input[this.offset+5]<<16)+(this.input[this.offset+6]<<8)+this.input[this.offset+7];this.offset+=8}return result};TlvDecoder.prototype.readTypeAndLength=function(expectedType){var type=this.readVarNumber();if(type!=expectedType)throw new DecodingException("Did not get the expected TLV type");var length=this.readVarNumber();if(this.offset+length>this.input.length)throw new DecodingException("TLV length exceeds the buffer length");return length};TlvDecoder.prototype.readNestedTlvsStart=function(expectedType){return this.readTypeAndLength(expectedType)+this.offset};TlvDecoder.prototype.finishNestedTlvs=function(endOffset){if(this.offset==endOffset)return;while(this.offset<endOffset){this.readVarNumber();var length=this.readVarNumber();this.offset+=length;if(this.offset>this.input.length)throw new DecodingException("TLV length exceeds the buffer length")}if(this.offset!=endOffset)throw new DecodingException("TLV length does not equal the total length of the nested TLVs")};TlvDecoder.prototype.peekType=function(expectedType,endOffset){if(this.offset>=endOffset)return false;else{var saveOffset=this.offset;var type=this.readVarNumber();this.offset=saveOffset;return type==expectedType}};TlvDecoder.prototype.readNonNegativeInteger=function(length){var result;if(length==1)result=this.input[this.offset];else if(length==2)result=(this.input[this.offset]<<8)+this.input[this.offset+1];else if(length==4)result=Math.abs(this.input[this.offset]<<24)+(this.input[this.offset+1]<<16)+(this.input[this.offset+2]<<8)+this.input[this.offset+3];else if(length==8){var highByte=Math.abs(this.input[this.offset]<<24)+(this.input[this.offset+1]<<16)+(this.input[this.offset+2]<<8)+this.input[this.offset+3];result=highByte*4294967296+Math.abs(this.input[this.offset+4]<<24)+(this.input[this.offset+5]<<16)+(this.input[this.offset+6]<<8)+this.input[this.offset+7]}else throw new DecodingException("Invalid length for a TLV nonNegativeInteger");this.offset+=length;return result};TlvDecoder.prototype.readNonNegativeIntegerTlv=function(expectedType){var length=this.readTypeAndLength(expectedType);return this.readNonNegativeInteger(length)};TlvDecoder.prototype.readOptionalNonNegativeIntegerTlv=function(expectedType,endOffset){if(this.peekType(expectedType,endOffset))return this.readNonNegativeIntegerTlv(expectedType);else return null};TlvDecoder.prototype.readBlobTlv=function(expectedType){var length=this.readTypeAndLength(expectedType);var result=this.input.slice(this.offset,this.offset+length);this.offset+=length;return result};TlvDecoder.prototype.readOptionalBlobTlv=function(expectedType,endOffset){if(this.peekType(expectedType,endOffset))return this.readBlobTlv(expectedType);else return null};TlvDecoder.prototype.readBooleanTlv=function(expectedType,endOffset){if(this.peekType(expectedType,endOffset)){var length=this.readTypeAndLength(expectedType);this.offset+=length;return true}else return false};TlvDecoder.prototype.getOffset=function(){return this.offset};TlvDecoder.prototype.seek=function(offset){this.offset=offset}},{"../decoding-exception.js":138}],145:[function(require,module,exports){var DynamicBuffer=require("../../util/dynamic-buffer.js").DynamicBuffer;var Tlv=require("./tlv.js").Tlv;var TlvEncoder=function TlvEncoder(initialCapacity){initialCapacity=initialCapacity||16;this.output=new DynamicBuffer(initialCapacity);this.length=0};exports.TlvEncoder=TlvEncoder;TlvEncoder.prototype.getLength=function(){return this.length};TlvEncoder.prototype.writeVarNumber=function(varNumber){if(varNumber<253){this.length+=1;this.output.ensureLengthFromBack(this.length);this.output.array[this.output.array.length-this.length]=varNumber&255}else if(varNumber<=65535){this.length+=3;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;this.output.array[offset]=253;this.output.array[offset+1]=varNumber>>8&255;this.output.array[offset+2]=varNumber&255}else if(varNumber<=4294967295){this.length+=5;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;this.output.array[offset]=254;this.output.array[offset+1]=varNumber>>24&255;this.output.array[offset+2]=varNumber>>16&255;this.output.array[offset+3]=varNumber>>8&255;this.output.array[offset+4]=varNumber&255}else{this.length+=9;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;this.output.array[offset]=255;var highBytes=Tlv.getHighBytes(varNumber);this.output.array[offset+1]=highBytes>>24&255;this.output.array[offset+2]=highBytes>>16&255;this.output.array[offset+3]=highBytes>>8&255;this.output.array[offset+4]=highBytes&255;this.output.array[offset+5]=varNumber>>24&255;this.output.array[offset+6]=varNumber>>16&255;this.output.array[offset+7]=varNumber>>8&255;
this.output.array[offset+8]=varNumber&255}};TlvEncoder.prototype.writeTypeAndLength=function(type,length){this.writeVarNumber(length);this.writeVarNumber(type)};TlvEncoder.prototype.writeNonNegativeInteger=function(value){if(value<0)throw new Error("TLV integer value may not be negative");value=Math.round(value);if(value<=255){this.length+=1;this.output.ensureLengthFromBack(this.length);this.output.array[this.output.array.length-this.length]=value&255}else if(value<=65535){this.length+=2;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;this.output.array[offset]=value>>8&255;this.output.array[offset+1]=value&255}else if(value<=4294967295){this.length+=4;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;this.output.array[offset]=value>>24&255;this.output.array[offset+1]=value>>16&255;this.output.array[offset+2]=value>>8&255;this.output.array[offset+3]=value&255}else{this.length+=8;this.output.ensureLengthFromBack(this.length);var offset=this.output.array.length-this.length;var highBytes=Tlv.getHighBytes(value);this.output.array[offset]=highBytes>>24&255;this.output.array[offset+1]=highBytes>>16&255;this.output.array[offset+2]=highBytes>>8&255;this.output.array[offset+3]=highBytes&255;this.output.array[offset+4]=value>>24&255;this.output.array[offset+5]=value>>16&255;this.output.array[offset+6]=value>>8&255;this.output.array[offset+7]=value&255}};TlvEncoder.prototype.writeNonNegativeIntegerTlv=function(type,value){var saveNBytes=this.length;this.writeNonNegativeInteger(value);this.writeTypeAndLength(type,this.length-saveNBytes)};TlvEncoder.prototype.writeOptionalNonNegativeIntegerTlv=function(type,value){if(value!=null&&value>=0)this.writeNonNegativeIntegerTlv(type,value)};TlvEncoder.prototype.writeBlobTlv=function(type,value){if(value==null){this.writeTypeAndLength(type,0);return}this.length+=value.length;this.output.copyFromBack(value,this.length);this.writeTypeAndLength(type,value.length)};TlvEncoder.prototype.writeOptionalBlobTlv=function(type,value){if(value!=null&&value.length>0)this.writeBlobTlv(type,value)};TlvEncoder.prototype.getOutput=function(){return this.output.array.slice(this.output.array.length-this.length)}},{"../../util/dynamic-buffer.js":186,"./tlv.js":147}],146:[function(require,module,exports){(function(Buffer){var TlvDecoder=require("./tlv-decoder.js").TlvDecoder;var TlvStructureDecoder=function TlvStructureDecoder(){this.gotElementEnd=false;this.offset=0;this.state=TlvStructureDecoder.READ_TYPE;this.headerLength=0;this.useHeaderBuffer=false;this.headerBuffer=new Buffer(8);this.nBytesToRead=0};exports.TlvStructureDecoder=TlvStructureDecoder;TlvStructureDecoder.READ_TYPE=0;TlvStructureDecoder.READ_TYPE_BYTES=1;TlvStructureDecoder.READ_LENGTH=2;TlvStructureDecoder.READ_LENGTH_BYTES=3;TlvStructureDecoder.READ_VALUE_BYTES=4;TlvStructureDecoder.prototype.findElementEnd=function(input){if(this.gotElementEnd)return true;var decoder=new TlvDecoder(input);while(true){if(this.offset>=input.length)return false;if(this.state==TlvStructureDecoder.READ_TYPE){var firstOctet=input[this.offset];this.offset+=1;if(firstOctet<253)this.state=TlvStructureDecoder.READ_LENGTH;else{if(firstOctet==253)this.nBytesToRead=2;else if(firstOctet==254)this.nBytesToRead=4;else this.nBytesToRead=8;this.state=TlvStructureDecoder.READ_TYPE_BYTES}}else if(this.state==TlvStructureDecoder.READ_TYPE_BYTES){var nRemainingBytes=input.length-this.offset;if(nRemainingBytes<this.nBytesToRead){this.offset+=nRemainingBytes;this.nBytesToRead-=nRemainingBytes;return false}this.offset+=this.nBytesToRead;this.state=TlvStructureDecoder.READ_LENGTH}else if(this.state==TlvStructureDecoder.READ_LENGTH){var firstOctet=input[this.offset];this.offset+=1;if(firstOctet<253){this.nBytesToRead=firstOctet;if(this.nBytesToRead==0){this.gotElementEnd=true;return true}this.state=TlvStructureDecoder.READ_VALUE_BYTES}else{if(firstOctet==253)this.nBytesToRead=2;else if(firstOctet==254)this.nBytesToRead=4;else this.nBytesToRead=8;this.firstOctet=firstOctet;this.state=TlvStructureDecoder.READ_LENGTH_BYTES}}else if(this.state==TlvStructureDecoder.READ_LENGTH_BYTES){var nRemainingBytes=input.length-this.offset;if(!this.useHeaderBuffer&&nRemainingBytes>=this.nBytesToRead){decoder.seek(this.offset);this.nBytesToRead=decoder.readExtendedVarNumber(this.firstOctet);this.offset=decoder.getOffset()}else{this.useHeaderBuffer=true;var nNeededBytes=this.nBytesToRead-this.headerLength;if(nNeededBytes>nRemainingBytes){if(this.headerLength+nRemainingBytes>this.headerBuffer.length)throw new Error("Cannot store more header bytes than the size of headerBuffer");input.slice(this.offset,this.offset+nRemainingBytes).copy(this.headerBuffer,this.headerLength);this.offset+=nRemainingBytes;this.headerLength+=nRemainingBytes;return false}if(this.headerLength+nNeededBytes>this.headerBuffer.length)throw new Error("Cannot store more header bytes than the size of headerBuffer");input.slice(this.offset,this.offset+nNeededBytes).copy(this.headerBuffer,this.headerLength);this.offset+=nNeededBytes;var bufferDecoder=new TlvDecoder(this.headerBuffer);this.nBytesToRead=bufferDecoder.readExtendedVarNumber(this.firstOctet)}if(this.nBytesToRead==0){this.gotElementEnd=true;return true}this.state=TlvStructureDecoder.READ_VALUE_BYTES}else if(this.state==TlvStructureDecoder.READ_VALUE_BYTES){nRemainingBytes=input.length-this.offset;if(nRemainingBytes<this.nBytesToRead){this.offset+=nRemainingBytes;this.nBytesToRead-=nRemainingBytes;return false}this.offset+=this.nBytesToRead;this.gotElementEnd=true;return true}else throw new Error("findElementEnd: unrecognized state")}};TlvStructureDecoder.prototype.getOffset=function(){return this.offset};TlvStructureDecoder.prototype.seek=function(offset){this.offset=offset}}).call(this,require("buffer").Buffer)},{"./tlv-decoder.js":144,buffer:3}],147:[function(require,module,exports){var Tlv=function Tlv(){};exports.Tlv=Tlv;Tlv.Interest=5;Tlv.Data=6;Tlv.Name=7;Tlv.NameComponent=8;Tlv.Selectors=9;Tlv.Nonce=10;Tlv.Scope=11;Tlv.InterestLifetime=12;Tlv.MinSuffixComponents=13;Tlv.MaxSuffixComponents=14;Tlv.PublisherPublicKeyLocator=15;Tlv.Exclude=16;Tlv.ChildSelector=17;Tlv.MustBeFresh=18;Tlv.Any=19;Tlv.MetaInfo=20;Tlv.Content=21;Tlv.SignatureInfo=22;Tlv.SignatureValue=23;Tlv.ContentType=24;Tlv.FreshnessPeriod=25;Tlv.FinalBlockId=26;Tlv.SignatureType=27;Tlv.KeyLocator=28;Tlv.KeyLocatorDigest=29;Tlv.FaceInstance=128;Tlv.ForwardingEntry=129;Tlv.StatusResponse=130;Tlv.Action=131;Tlv.FaceID=132;Tlv.IPProto=133;Tlv.Host=134;Tlv.Port=135;Tlv.MulticastInterface=136;Tlv.MulticastTTL=137;Tlv.ForwardingFlags=138;Tlv.StatusCode=139;Tlv.StatusText=140;Tlv.SignatureType_DigestSha256=0;Tlv.SignatureType_SignatureSha256WithRsa=1;Tlv.ContentType_Default=0;Tlv.ContentType_Link=1;Tlv.ContentType_Key=2;Tlv.NfdCommand_ControlResponse=101;Tlv.NfdCommand_StatusCode=102;Tlv.NfdCommand_StatusText=103;Tlv.ControlParameters_ControlParameters=104;Tlv.ControlParameters_FaceId=105;Tlv.ControlParameters_Uri=114;Tlv.ControlParameters_LocalControlFeature=110;Tlv.ControlParameters_Origin=111;Tlv.ControlParameters_Cost=106;Tlv.ControlParameters_Flags=108;Tlv.ControlParameters_Strategy=107;Tlv.ControlParameters_ExpirationPeriod=109;Tlv.getHighBytes=function(x){return(x-x%4294967296)/4294967296}},{}],148:[function(require,module,exports){var WireFormat=function WireFormat(){};exports.WireFormat=WireFormat;WireFormat.prototype.encodeName=function(name){throw new Error("encodeName is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.decodeName=function(name,input){throw new Error("decodeName is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.encodeInterest=function(interest){throw new Error("encodeInterest is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.decodeInterest=function(interest,input){throw new Error("decodeInterest is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.encodeData=function(data){throw new Error("encodeData is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.decodeData=function(data,input){throw new Error("decodeData is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.encodeControlParameters=function(controlParameters){throw new Error("encodeControlParameters is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.decodeControlParameters=function(controlParameters,input){throw new Error("decodeControlParameters is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.encodeSignatureInfo=function(signature){throw new Error("encodeSignatureInfo is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.decodeSignatureInfoAndValue=function(signatureInfo,signatureValue){throw new Error("decodeSignatureInfoAndValue is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.prototype.encodeSignatureValue=function(signature){throw new Error("encodeSignatureValue is unimplemented in the base WireFormat class.  You should use a derived class.")};WireFormat.setDefaultWireFormat=function(wireFormat){WireFormat.defaultWireFormat=wireFormat};WireFormat.getDefaultWireFormat=function(){return WireFormat.defaultWireFormat};var TlvWireFormat=require("./tlv-wire-format.js").TlvWireFormat},{"./tlv-wire-format.js":143}],149:[function(require,module,exports){var Name=require("./name.js").Name;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./encoding/binary-xml-decoder.js").BinaryXMLDecoder;var DataUtils=require("./encoding/data-utils.js").DataUtils;var Blob=require("./util/blob.js").Blob;var Exclude=function Exclude(values){this.values=[];if(typeof values==="object"&&values instanceof Exclude)this.values=values.values.slice(0);else if(values){this.changeCount=0;for(var i=0;i<values.length;++i){if(values[i]==Exclude.ANY)this.appendAny();else this.appendComponent(values[i])}}this.changeCount=0};exports.Exclude=Exclude;Exclude.ANY="*";Exclude.prototype.size=function(){return this.values.length};Exclude.prototype.get=function(i){return this.values[i]};Exclude.prototype.appendAny=function(){this.values.push(Exclude.ANY);++this.changeCount;return this};Exclude.prototype.appendComponent=function(component){this.values.push(new Name.Component(component));++this.changeCount;return this};Exclude.prototype.clear=function(){++this.changeCount;this.values=[]};Exclude.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(NDNProtocolDTags.Exclude);while(true){if(decoder.peekDTag(NDNProtocolDTags.Component))this.appendComponent(decoder.readBinaryDTagElement(NDNProtocolDTags.Component));else if(decoder.peekDTag(NDNProtocolDTags.Any)){decoder.readElementStartDTag(NDNProtocolDTags.Any);decoder.readElementClose();this.appendAny()}else if(decoder.peekDTag(NDNProtocolDTags.Bloom)){decoder.readBinaryDTagElement(NDNProtocolDTags.Bloom);this.appendAny()}else break}decoder.readElementClose()};Exclude.prototype.to_ndnb=function(encoder){if(this.values==null||this.values.length==0)return;encoder.writeElementStartDTag(NDNProtocolDTags.Exclude);for(var i=0;i<this.values.length;++i){if(this.values[i]==Exclude.ANY){encoder.writeElementStartDTag(NDNProtocolDTags.Any);encoder.writeElementClose()}else encoder.writeDTagElement(NDNProtocolDTags.Component,this.values[i].getValue().buf())}encoder.writeElementClose()};Exclude.prototype.toUri=function(){if(this.values==null||this.values.length==0)return"";var result="";for(var i=0;i<this.values.length;++i){if(i>0)result+=",";if(this.values[i]==Exclude.ANY)result+="*";else result+=Name.toEscapedString(this.values[i].getValue().buf())}return result};Exclude.prototype.matches=function(component){if(typeof component=="object"&&component instanceof Name.Component)component=component.getValue().buf();else if(typeof component==="object"&&component instanceof Blob)component=component.buf();for(var i=0;i<this.values.length;++i){if(this.values[i]==Exclude.ANY){var lowerBound=null;if(i>0)lowerBound=this.values[i-1];var iUpperBound;var upperBound=null;for(iUpperBound=i+1;iUpperBound<this.values.length;++iUpperBound){if(this.values[iUpperBound]!=Exclude.ANY){upperBound=this.values[iUpperBound];break}}if(upperBound!=null){if(lowerBound!=null){if(Exclude.compareComponents(component,lowerBound)>0&&Exclude.compareComponents(component,upperBound)<0)return true}else{if(Exclude.compareComponents(component,upperBound)<0)return true}i=iUpperBound-1}else{if(lowerBound!=null){if(Exclude.compareComponents(component,lowerBound)>0)return true}else return true}}else{if(DataUtils.arraysEqual(component,this.values[i].getValue().buf()))return true}}return false};Exclude.compareComponents=function(component1,component2){if(typeof component1=="object"&&component1 instanceof Name.Component)component1=component1.getValue().buf();if(typeof component2=="object"&&component2 instanceof Name.Component)component2=component2.getValue().buf();return Name.Component.compareBuffers(component1,component2)};Exclude.prototype.getChangeCount=function(){return this.changeCount}},{"./encoding/binary-xml-decoder.js":133,"./encoding/binary-xml-encoder.js":134,"./encoding/data-utils.js":137,"./name.js":159,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189}],150:[function(require,module,exports){var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var PublisherPublicKeyDigest=require("./publisher-public-key-digest.js").PublisherPublicKeyDigest;var FaceInstance=function FaceInstance(action,publisherPublicKeyDigest,faceID,ipProto,host,port,multicastInterface,multicastTTL,freshnessSeconds){this.action=action;this.publisherPublicKeyDigest=publisherPublicKeyDigest;this.faceID=faceID;this.ipProto=ipProto;this.host=host;this.Port=port;this.multicastInterface=multicastInterface;this.multicastTTL=multicastTTL;this.freshnessSeconds=freshnessSeconds};exports.FaceInstance=FaceInstance;FaceInstance.NetworkProtocol={TCP:6,UDP:17};FaceInstance.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());if(decoder.peekDTag(NDNProtocolDTags.Action))this.action=decoder.readUTF8DTagElement(NDNProtocolDTags.Action);if(decoder.peekDTag(NDNProtocolDTags.PublisherPublicKeyDigest)){this.publisherPublicKeyDigest=new PublisherPublicKeyDigest;this.publisherPublicKeyDigest.from_ndnb(decoder)}if(decoder.peekDTag(NDNProtocolDTags.FaceID))this.faceID=decoder.readIntegerDTagElement(NDNProtocolDTags.FaceID);if(decoder.peekDTag(NDNProtocolDTags.IPProto)){var pI=decoder.readIntegerDTagElement(NDNProtocolDTags.IPProto);this.ipProto=null;if(FaceInstance.NetworkProtocol.TCP==pI)this.ipProto=FaceInstance.NetworkProtocol.TCP;else if(FaceInstance.NetworkProtocol.UDP==pI)this.ipProto=FaceInstance.NetworkProtocol.UDP;else throw new Error("FaceInstance.decoder.  Invalid NDNProtocolDTags.IPProto field: "+pI)}if(decoder.peekDTag(NDNProtocolDTags.Host))this.host=decoder.readUTF8DTagElement(NDNProtocolDTags.Host);if(decoder.peekDTag(NDNProtocolDTags.Port))this.Port=decoder.readIntegerDTagElement(NDNProtocolDTags.Port);if(decoder.peekDTag(NDNProtocolDTags.MulticastInterface))this.multicastInterface=decoder.readUTF8DTagElement(NDNProtocolDTags.MulticastInterface);if(decoder.peekDTag(NDNProtocolDTags.MulticastTTL))this.multicastTTL=decoder.readIntegerDTagElement(NDNProtocolDTags.MulticastTTL);if(decoder.peekDTag(NDNProtocolDTags.FreshnessSeconds))this.freshnessSeconds=decoder.readIntegerDTagElement(NDNProtocolDTags.FreshnessSeconds);decoder.readElementClose()};FaceInstance.prototype.to_ndnb=function(encoder){encoder.writeElementStartDTag(this.getElementLabel());if(null!=this.action&&this.action.length!=0)encoder.writeDTagElement(NDNProtocolDTags.Action,this.action);if(null!=this.publisherPublicKeyDigest)this.publisherPublicKeyDigest.to_ndnb(encoder);if(null!=this.faceID)encoder.writeDTagElement(NDNProtocolDTags.FaceID,this.faceID);if(null!=this.ipProto)encoder.writeDTagElement(NDNProtocolDTags.IPProto,this.ipProto);if(null!=this.host&&this.host.length!=0)encoder.writeDTagElement(NDNProtocolDTags.Host,this.host);if(null!=this.Port)encoder.writeDTagElement(NDNProtocolDTags.Port,this.Port);if(null!=this.multicastInterface&&this.multicastInterface.length!=0)encoder.writeDTagElement(NDNProtocolDTags.MulticastInterface,this.multicastInterface);if(null!=this.multicastTTL)encoder.writeDTagElement(NDNProtocolDTags.MulticastTTL,this.multicastTTL);if(null!=this.freshnessSeconds)encoder.writeDTagElement(NDNProtocolDTags.FreshnessSeconds,this.freshnessSeconds);encoder.writeElementClose()};FaceInstance.prototype.getElementLabel=function(){return NDNProtocolDTags.FaceInstance}},{"./publisher-public-key-digest.js":161,"./util/ndn-protoco-id-tags.js":189}],151:[function(require,module,exports){(function(Buffer){var crypto=require("crypto");var DataUtils=require("./encoding/data-utils.js").DataUtils;var Name=require("./name.js").Name;var Interest=require("./interest.js").Interest;var Data=require("./data.js").Data;var MetaInfo=require("./meta-info.js").MetaInfo;var ForwardingEntry=require("./forwarding-entry.js").ForwardingEntry;var ControlParameters=require("./control-parameters.js").ControlParameters;var WireFormat=require("./encoding/wire-format.js").WireFormat;var TlvWireFormat=require("./encoding/tlv-wire-format.js").TlvWireFormat;var BinaryXmlWireFormat=require("./encoding/binary-xml-wire-format.js").BinaryXmlWireFormat;var Tlv=require("./encoding/tlv/tlv.js").Tlv;var TlvDecoder=require("./encoding/tlv/tlv-decoder.js").TlvDecoder;var BinaryXMLDecoder=require("./encoding/binary-xml-decoder.js").BinaryXMLDecoder;var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var Key=require("./key.js").Key;var KeyLocatorType=require("./key-locator.js").KeyLocatorType;var globalKeyManager=require("./security/key-manager.js").globalKeyManager;var ForwardingFlags=require("./forwarding-flags.js").ForwardingFlags;var Closure=require("./closure.js").Closure;var UpcallInfo=require("./closure.js").UpcallInfo;var Transport=require("./transport/transport.js").Transport;var TcpTransport=require("./transport/tcp-transport.js").TcpTransport;var UnixTransport=require("./transport/unix-transport.js").UnixTransport;var CommandInterestGenerator=require("./util/command-interest-generator.js").CommandInterestGenerator;var fs=require("fs");var LOG=require("./log.js").Log.LOG;var Face=function Face(transportOrSettings,connectionInfo){if(!Face.supported)throw new Error("The necessary JavaScript support is not available on this platform.");var settings;if(typeof transportOrSettings=="object"&&transportOrSettings instanceof Transport){this.getConnectionInfo=null;this.transport=transportOrSettings;this.connectionInfo=connectionInfo||null;settings={};if(this.connectionInfo==null){if(this.transport&&this.transport.__proto__&&this.transport.__proto__.name=="UnixTransport"){var filePath=Face.getUnixSocketFilePathForLocalhost();if(filePath!=null)this.connectionInfo=new UnixTransport.ConnectionInfo(filePath);else console.log("Face constructor: Cannot determine the default Unix socket file path for UnixTransport");console.log("Using "+this.connectionInfo.toString())}}}else{settings=transportOrSettings||{};var getTransport=settings.getTransport||function(){return new TcpTransport};this.transport=getTransport();this.getConnectionInfo=settings.getConnectionInfo||this.transport.defaultGetConnectionInfo;this.connectionInfo=settings.connectionInfo||null;if(this.connectionInfo==null){var host=settings.host!==undefined?settings.host:null;if(this.transport&&this.transport.__proto__&&this.transport.__proto__.name=="UnixTransport"){if(host!=null)this.connectionInfo=new UnixTransport.ConnectionInfo(host);else{if(this.getConnectionInfo==null){var filePath=Face.getUnixSocketFilePathForLocalhost();if(filePath!=null)this.connectionInfo=new UnixTransport.ConnectionInfo(filePath);else console.log("Face constructor: Cannot determine the default Unix socket file path for UnixTransport")}}}else{if(host!=null){if(typeof WebSocketTransport!="undefined")this.connectionInfo=new WebSocketTransport.ConnectionInfo(host,settings.port||9696);else this.connectionInfo=new TcpTransport.ConnectionInfo(host,settings.port||6363)}}}}if(this.connectionInfo==null){this.host=null;this.host=null}else{this.host=this.connectionInfo.host;this.host=this.connectionInfo.port}this.readyStatus=Face.UNOPEN;this.verify=settings.verify!==undefined?settings.verify:false;this.onopen=settings.onopen||function(){if(LOG>3)console.log("Face connection established.")};this.onclose=settings.onclose||function(){if(LOG>3)console.log("Face connection closed.")};this.ndndid=null;this.onConnectedCallbacks=[];this.commandKeyChain=null;this.commandCertificateName=new Name;this.commandInterestGenerator=new CommandInterestGenerator;this.timeoutPrefix=new Name("/local/timeout")};exports.Face=Face;Face.UNOPEN=0;Face.OPEN_REQUESTED=1;Face.OPENED=2;Face.CLOSED=3;TcpTransport.importFace(Face);Face.getUnixSocketFilePathForLocalhost=function(){var filePath="/var/run/nfd.sock";if(fs.existsSync(filePath))return filePath;else{filePath="/tmp/.ndnd.sock";if(fs.existsSync(filePath))return filePath;else return""}};Face.getSupported=function(){try{var dummy=new Buffer(1).slice(0,1)}catch(ex){console.log("NDN not available: Buffer not supported. "+ex);return false}return true};Face.supported=Face.getSupported();Face.ndndIdFetcher=new Name("/%C1.M.S.localhost/%C1.M.SRV/ndnd/KEY");Face.prototype.createRoute=function(hostOrConnectionInfo,port){if(hostOrConnectionInfo instanceof Transport.ConnectionInfo)this.connectionInfo=hostOrConnectionInfo;else this.connectionInfo=new TcpTransport.ConnectionInfo(hostOrConnectionInfo,port);this.host=this.connectionInfo.host;this.host=this.connectionInfo.port};Face.KeyStore=new Array;var KeyStoreEntry=function KeyStoreEntry(name,rsa,time){this.keyName=name;this.rsaKey=rsa;this.timeStamp=time};Face.addKeyEntry=function(keyEntry){var result=Face.getKeyByName(keyEntry.keyName);if(result==null)Face.KeyStore.push(keyEntry);else result=keyEntry};Face.getKeyByName=function(name){var result=null;for(var i=0;i<Face.KeyStore.length;i++){if(Face.KeyStore[i].keyName.contentName.match(name.contentName)){if(result==null||Face.KeyStore[i].keyName.contentName.size()>result.keyName.contentName.size())result=Face.KeyStore[i]}}return result};Face.prototype.close=function(){if(this.readyStatus!=Face.OPENED)return;this.readyStatus=Face.CLOSED;this.transport.close()};Face.PITTable=new Array;Face.PITTableRemoveRequests=new Array;var PITEntry=function PITEntry(pendingInterestId,interest,closure){this.pendingInterestId=pendingInterestId;this.interest=interest;this.closure=closure;this.timerID=-1};PITEntry.lastPendingInterestId=0;PITEntry.getNextPendingInterestId=function(){++PITEntry.lastPendingInterestId;return PITEntry.lastPendingInterestId};Face.extractEntriesForExpressedInterest=function(name){var result=[];for(var i=Face.PITTable.length-1;i>=0;--i){var entry=Face.PITTable[i];if(entry.interest.matchesName(name)){clearTimeout(entry.timerID);result.push(entry);Face.PITTable.splice(i,1)}}return result};Face.registeredPrefixTable=new Array;Face.registeredPrefixRemoveRequests=new Array;var RegisteredPrefix=function RegisteredPrefix(registeredPrefixId,prefix,closure){this.registeredPrefixId=registeredPrefixId;this.prefix=prefix;this.closure=closure};RegisteredPrefix.lastRegisteredPrefixId=0;RegisteredPrefix.getNextRegisteredPrefixId=function(){++RegisteredPrefix.lastRegisteredPrefixId;return RegisteredPrefix.lastRegisteredPrefixId};function getEntryForRegisteredPrefix(name){var iResult=-1;for(var i=0;i<Face.registeredPrefixTable.length;i++){if(LOG>3)console.log("Registered prefix "+i+": checking if "+Face.registeredPrefixTable[i].prefix+" matches "+name);if(Face.registeredPrefixTable[i].prefix.match(name)){if(iResult<0||Face.registeredPrefixTable[i].prefix.size()>Face.registeredPrefixTable[iResult].prefix.size())iResult=i}}if(iResult>=0)return Face.registeredPrefixTable[iResult];else return null}Face.makeShuffledHostGetConnectionInfo=function(hostList,port,makeConnectionInfo){hostList=hostList.slice(0,hostList.length);DataUtils.shuffle(hostList);return function(){if(hostList.length==0)return null;return makeConnectionInfo(hostList.splice(0,1)[0],port)}};Face.prototype.expressInterest=function(interestOrName,arg2,arg3,arg4){var interest;if(arg2&&arg2.upcall&&typeof arg2.upcall=="function"){interest=new Interest(interestOrName);if(arg3){var template=arg3;interest.setMinSuffixComponents(template.getMinSuffixComponents());interest.setMaxSuffixComponents(template.getMaxSuffixComponents());interest.publisherPublicKeyDigest=template.publisherPublicKeyDigest;interest.setExclude(template.getExclude());interest.setChildSelector(template.getChildSelector());interest.getAnswerOriginKind(template.getAnswerOriginKind());interest.setScope(template.getScope());interest.setInterestLifetimeMilliseconds(template.getInterestLifetimeMilliseconds())}else interest.setInterestLifetimeMilliseconds(4e3);return this.expressInterestWithClosure(interest,arg2)}var onData;var onTimeout;if(typeof interestOrName=="object"&&interestOrName instanceof Interest){interest=new Interest(interestOrName);onData=arg2;onTimeout=arg3?arg3:function(){}}else{interest=new Interest(interestOrName);if(arg2&&typeof arg2=="object"&&arg2 instanceof Interest){var template=arg2;interest.setMinSuffixComponents(template.getMinSuffixComponents());interest.setMaxSuffixComponents(template.getMaxSuffixComponents());interest.publisherPublicKeyDigest=template.publisherPublicKeyDigest;interest.setExclude(template.getExclude());interest.setChildSelector(template.getChildSelector());interest.getAnswerOriginKind(template.getAnswerOriginKind());interest.setScope(template.getScope());interest.setInterestLifetimeMilliseconds(template.getInterestLifetimeMilliseconds());onData=arg3;onTimeout=arg4?arg4:function(){}}else{interest.setInterestLifetimeMilliseconds(4e3);onData=arg2;onTimeout=arg3?arg3:function(){}}}return this.expressInterestWithClosure(interest,new Face.CallbackClosure(onData,onTimeout))};Face.CallbackClosure=function FaceCallbackClosure(onData,onTimeout,onInterest,prefix,transport){Closure.call(this);this.onData=onData;this.onTimeout=onTimeout;this.onInterest=onInterest;this.prefix=prefix;this.transport=transport};Face.CallbackClosure.prototype.upcall=function(kind,upcallInfo){if(kind==Closure.UPCALL_CONTENT||kind==Closure.UPCALL_CONTENT_UNVERIFIED)this.onData(upcallInfo.interest,upcallInfo.data);else if(kind==Closure.UPCALL_INTEREST_TIMED_OUT)this.onTimeout(upcallInfo.interest);else if(kind==Closure.UPCALL_INTEREST)this.onInterest(this.prefix,upcallInfo.interest,this.transport);return Closure.RESULT_OK};Face.prototype.expressInterestWithClosure=function(interest,closure){var pendingInterestId=PITEntry.getNextPendingInterestId();if(this.connectionInfo==null){if(this.getConnectionInfo==null)console.log("ERROR: connectionInfo is NOT SET");else{var thisFace=this;this.connectAndExecute(function(){thisFace.reconnectAndExpressInterest(pendingInterestId,interest,closure)})}}else this.reconnectAndExpressInterest(pendingInterestId,interest,closure);return pendingInterestId};Face.prototype.reconnectAndExpressInterest=function(pendingInterestId,interest,closure){var thisFace=this;if(!this.connectionInfo.equals(this.transport.connectionInfo)||this.readyStatus===Face.UNOPEN){this.readyStatus=Face.OPEN_REQUESTED;this.onConnectedCallbacks.push(function(){thisFace.expressInterestHelper(pendingInterestId,interest,closure)});this.transport.connect(this.connectionInfo,this,function(){thisFace.readyStatus=Face.OPENED;while(thisFace.onConnectedCallbacks.length>0){try{thisFace.onConnectedCallbacks.shift()()}catch(ex){console.log("Face.reconnectAndExpressInterest: ignoring exception from onConnectedCallbacks: "+ex)}}if(thisFace.onopen)thisFace.onopen()},function(){thisFace.closeByTransport()})}else{if(this.readyStatus===Face.OPEN_REQUESTED)this.onConnectedCallbacks.push(function(){thisFace.expressInterestHelper(pendingInterestId,interest,closure)});else if(this.readyStatus===Face.OPENED)this.expressInterestHelper(pendingInterestId,interest,closure);else throw new Error("reconnectAndExpressInterest: unexpected connection is not opened")}};Face.prototype.expressInterestHelper=function(pendingInterestId,interest,closure){var binaryInterest=interest.wireEncode();var thisFace=this;if(closure!=null){var removeRequestIndex=-1;if(removeRequestIndex!=null)removeRequestIndex=Face.PITTableRemoveRequests.indexOf(pendingInterestId);if(removeRequestIndex>=0)Face.PITTableRemoveRequests.splice(removeRequestIndex,1);else{var pitEntry=new PITEntry(pendingInterestId,interest,closure);Face.PITTable.push(pitEntry);closure.pitEntry=pitEntry;var timeoutMilliseconds=interest.getInterestLifetimeMilliseconds()||4e3;var timeoutCallback=function(){if(LOG>1)console.log("Interest time out: "+interest.getName().toUri());var index=Face.PITTable.indexOf(pitEntry);if(index>=0)Face.PITTable.splice(index,1);if(closure.upcall(Closure.UPCALL_INTEREST_TIMED_OUT,new UpcallInfo(thisFace,interest,0,null))==Closure.RESULT_REEXPRESS){if(LOG>1)console.log("Re-express interest: "+interest.getName().toUri());pitEntry.timerID=setTimeout(timeoutCallback,timeoutMilliseconds);Face.PITTable.push(pitEntry);thisFace.transport.send(binaryInterest.buf())}};pitEntry.timerID=setTimeout(timeoutCallback,timeoutMilliseconds)}}if(!this.timeoutPrefix.match(interest.getName()))this.transport.send(binaryInterest.buf())};Face.prototype.removePendingInterest=function(pendingInterestId){if(pendingInterestId==null)return;var count=0;for(var i=Face.PITTable.length-1;i>=0;--i){var entry=Face.PITTable[i];if(entry.pendingInterestId==pendingInterestId){clearTimeout(entry.timerID);Face.PITTable.splice(i,1);++count}}if(count==0){if(Face.PITTableRemoveRequests.indexOf(pendingInterestId)<0)Face.PITTableRemoveRequests.push(pendingInterestId)}};Face.prototype.setCommandSigningInfo=function(keyChain,certificateName){this.commandKeyChain=keyChain;this.commandCertificateName=new Name(certificateName)};Face.prototype.setCommandCertificateName=function(certificateName){this.commandCertificateName=new Name(certificateName)};Face.prototype.makeCommandInterest=function(interest,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();this.nodeMakeCommandInterest(interest,this.commandKeyChain,this.commandCertificateName,wireFormat)};Face.prototype.nodeMakeCommandInterest=function(interest,keyChain,certificateName,wireFormat){this.commandInterestGenerator.generate(interest,keyChain,certificateName,wireFormat)};Face.prototype.registerPrefix=function(prefix,arg2,arg3,arg4){if(arg2&&arg2.upcall&&typeof arg2.upcall=="function"){if(arg3){var flags;if(typeof flags==="number"){flags=new ForwardingFlags;flags.setForwardingEntryFlags(arg3)}else flags=arg3;return this.registerPrefixWithClosure(prefix,arg2,flags)}else return this.registerPrefixWithClosure(prefix,arg2,new ForwardingFlags)}var onInterest=arg2;var onRegisterFailed=arg3?arg3:function(){};var flags=arg4?arg4:new ForwardingFlags;return this.registerPrefixWithClosure(prefix,new Face.CallbackClosure(null,null,onInterest,prefix,this.transport),flags,onRegisterFailed)};Face.prototype.registerPrefixWithClosure=function(prefix,closure,flags,onRegisterFailed){var registeredPrefixId=RegisteredPrefix.getNextRegisteredPrefixId();var thisFace=this;var onConnected=function(){if(thisFace.ndndid!=null||thisFace.commandKeyChain==null){if(thisFace.ndndid==null){var interest=new Interest(Face.ndndIdFetcher);
interest.setInterestLifetimeMilliseconds(4e3);if(LOG>3)console.log("Expressing interest for ndndid from ndnd.");thisFace.reconnectAndExpressInterest(null,interest,new Face.FetchNdndidClosure(thisFace,registeredPrefixId,prefix,closure,flags,onRegisterFailed))}else thisFace.registerPrefixHelper(registeredPrefixId,prefix,closure,flags,onRegisterFailed)}else thisFace.nfdRegisterPrefix(registeredPrefixId,prefix,closure,flags,onRegisterFailed,thisFace.commandKeyChain,thisFace.commandCertificateName)};if(this.connectionInfo==null){if(this.getConnectionInfo==null)console.log("ERROR: connectionInfo is NOT SET");else this.connectAndExecute(onConnected)}else onConnected();return registeredPrefixId};Face.FetchNdndidClosure=function FetchNdndidClosure(face,registeredPrefixId,prefix,callerClosure,flags,onRegisterFailed){Closure.call(this);this.face=face;this.registeredPrefixId=registeredPrefixId;this.prefix=prefix;this.callerClosure=callerClosure;this.flags=flags;this.onRegisterFailed=onRegisterFailed};Face.FetchNdndidClosure.prototype.upcall=function(kind,upcallInfo){if(kind==Closure.UPCALL_INTEREST_TIMED_OUT){console.log("Timeout while requesting the ndndid.  Cannot registerPrefix for "+this.prefix.toUri()+" .");if(this.onRegisterFailed)this.onRegisterFailed(this.prefix);return Closure.RESULT_OK}if(!(kind==Closure.UPCALL_CONTENT||kind==Closure.UPCALL_CONTENT_UNVERIFIED))return Closure.RESULT_ERR;if(LOG>3)console.log("Got ndndid from ndnd.");var hash=require("crypto").createHash("sha256");hash.update(upcallInfo.data.getContent().buf());this.face.ndndid=new Buffer(DataUtils.toNumbersIfString(hash.digest()));if(LOG>3)console.log(this.face.ndndid);this.face.registerPrefixHelper(this.registeredPrefixId,this.prefix,this.callerClosure,this.flags,this.onRegisterFailed);return Closure.RESULT_OK};Face.RegisterResponseClosure=function RegisterResponseClosure(face,prefix,callerClosure,onRegisterFailed,flags,wireFormat,isNfdCommand){Closure.call(this);this.face=face;this.prefix=prefix;this.callerClosure=callerClosure;this.onRegisterFailed=onRegisterFailed;this.flags=flags;this.wireFormat=wireFormat;this.isNfdCommand=isNfdCommand};Face.RegisterResponseClosure.prototype.upcall=function(kind,upcallInfo){if(kind==Closure.UPCALL_INTEREST_TIMED_OUT){if(this.isNfdCommand){if(this.face.ndndid==null){var interest=new Interest(Face.ndndIdFetcher);interest.setInterestLifetimeMilliseconds(4e3);this.face.reconnectAndExpressInterest(null,interest,new Face.FetchNdndidClosure(this.face,0,this.prefix,this.closure,this.flags,this.onRegisterFailed))}else this.face.registerPrefixHelper(0,this.prefix,this.closure,this.flags,this.onRegisterFailed)}else{if(this.onRegisterFailed)this.onRegisterFailed(this.prefix)}return Closure.RESULT_OK}if(!(kind==Closure.UPCALL_CONTENT||kind==Closure.UPCALL_CONTENT_UNVERIFIED))return Closure.RESULT_ERR;if(this.isNfdCommand){var statusCode;try{var decoder=new TlvDecoder(upcallInfo.data.getContent().buf());decoder.readNestedTlvsStart(Tlv.NfdCommand_ControlResponse);statusCode=decoder.readNonNegativeIntegerTlv(Tlv.NfdCommand_StatusCode)}catch(e){if(this.onRegisterFailed)this.onRegisterFailed(this.prefix);return Closure.RESULT_OK}if(statusCode!=200){if(this.onRegisterFailed)this.onRegisterFailed(this.prefix)}}else{var expectedName=new Name("/ndnx/.../selfreg");if(upcallInfo.data.getName().size()<4||!upcallInfo.data.getName().get(0).equals(expectedName.get(0))||!upcallInfo.data.getName().get(2).equals(expectedName.get(2))){this.onRegisterFailed(this.prefix);return Closure.RESULT_OK}}return Closure.RESULT_OK};Face.prototype.registerPrefixHelper=function(registeredPrefixId,prefix,closure,flags,onRegisterFailed){var removeRequestIndex=-1;if(removeRequestIndex!=null)removeRequestIndex=Face.registeredPrefixRemoveRequests.indexOf(registeredPrefixId);if(removeRequestIndex>=0){Face.registeredPrefixRemoveRequests.splice(removeRequestIndex,1);return}var fe=new ForwardingEntry("selfreg",prefix,null,null,flags.getForwardingEntryFlags(),null);var encoder=new BinaryXMLEncoder;fe.to_ndnb(encoder);var bytes=encoder.getReducedOstream();var metaInfo=new MetaInfo;metaInfo.setFields();metaInfo.locator.setType(KeyLocatorType.KEY);metaInfo.locator.setKeyData(globalKeyManager.getKey().publicToDER());var data=new Data(new Name,metaInfo,bytes);data.sign(BinaryXmlWireFormat.get());var coBinary=data.wireEncode(BinaryXmlWireFormat.get());var nodename=this.ndndid;var interestName=new Name(["ndnx",nodename,"selfreg",coBinary]);var interest=new Interest(interestName);interest.setInterestLifetimeMilliseconds(4e3);interest.setScope(1);if(LOG>3)console.log("Send Interest registration packet.");if(registeredPrefixId!=0)Face.registeredPrefixTable.push(new RegisteredPrefix(registeredPrefixId,prefix,closure));this.reconnectAndExpressInterest(null,interest,new Face.RegisterResponseClosure(this,prefix,closure,onRegisterFailed,flags,BinaryXmlWireFormat.get(),false))};Face.prototype.nfdRegisterPrefix=function(registeredPrefixId,prefix,closure,flags,onRegisterFailed,commandKeyChain,commandCertificateName){var removeRequestIndex=-1;if(removeRequestIndex!=null)removeRequestIndex=Face.registeredPrefixRemoveRequests.indexOf(registeredPrefixId);if(removeRequestIndex>=0){Face.registeredPrefixRemoveRequests.splice(removeRequestIndex,1);return}if(commandKeyChain==null)throw new Error("registerPrefix: The command KeyChain has not been set. You must call setCommandSigningInfo.");if(commandCertificateName.size()==0)throw new Error("registerPrefix: The command certificate name has not been set. You must call setCommandSigningInfo.");var controlParameters=new ControlParameters;controlParameters.setName(prefix);var commandInterest=new Interest(new Name("/localhost/nfd/rib/register"));commandInterest.getName().append(controlParameters.wireEncode(TlvWireFormat.get()));this.nodeMakeCommandInterest(commandInterest,commandKeyChain,commandCertificateName,TlvWireFormat.get());commandInterest.setInterestLifetimeMilliseconds(2e3);if(registeredPrefixId!=0)Face.registeredPrefixTable.push(new RegisteredPrefix(registeredPrefixId,prefix,closure));this.reconnectAndExpressInterest(null,commandInterest,new Face.RegisterResponseClosure(this,prefix,closure,onRegisterFailed,flags,TlvWireFormat.get(),true))};Face.prototype.removeRegisteredPrefix=function(registeredPrefixId){var count=0;for(var i=Face.registeredPrefixTable.length-1;i>=0;--i){var entry=Face.registeredPrefixTable[i];if(entry.registeredPrefixId==registeredPrefixId){Face.registeredPrefixTable.splice(i,1);++count}}if(count==0){if(Face.registeredPrefixRemoveRequests.indexOf(registeredPrefixId)<0)Face.registeredPrefixRemoveRequests.push(registeredPrefixId)}};Face.prototype.onReceivedElement=function(element){if(LOG>3)console.log("Complete element received. Length "+element.length+". Start decoding.");var interest=null;var data=null;if(element[0]==Tlv.Interest||element[0]==Tlv.Data){var decoder=new TlvDecoder(element);if(decoder.peekType(Tlv.Interest,element.length)){interest=new Interest;interest.wireDecode(element,TlvWireFormat.get())}else if(decoder.peekType(Tlv.Data,element.length)){data=new Data;data.wireDecode(element,TlvWireFormat.get())}}else{var decoder=new BinaryXMLDecoder(element);if(decoder.peekDTag(NDNProtocolDTags.Interest)){interest=new Interest;interest.wireDecode(element,BinaryXmlWireFormat.get())}else if(decoder.peekDTag(NDNProtocolDTags.Data)){data=new Data;data.wireDecode(element,BinaryXmlWireFormat.get())}}if(interest!==null){if(LOG>3)console.log("Interest packet received.");var entry=getEntryForRegisteredPrefix(interest.getName());if(entry!=null){if(LOG>3)console.log("Found registered prefix for "+interest.getName().toUri());var info=new UpcallInfo(this,interest,0,null);var ret=entry.closure.upcall(Closure.UPCALL_INTEREST,info);if(ret==Closure.RESULT_INTEREST_CONSUMED&&info.data!=null)this.transport.send(info.data.wireEncode().buf())}}else if(data!==null){if(LOG>3)console.log("Data packet received.");var pendingInterests=Face.extractEntriesForExpressedInterest(data.getName());for(var i=0;i<pendingInterests.length;++i){var pitEntry=pendingInterests[i];var currentClosure=pitEntry.closure;if(this.verify==false){currentClosure.upcall(Closure.UPCALL_CONTENT_UNVERIFIED,new UpcallInfo(this,pitEntry.interest,0,data));continue}var KeyFetchClosure=function KeyFetchClosure(content,closure,key,sig,wit){this.data=content;this.closure=closure;this.keyName=key;Closure.call(this)};var thisFace=this;KeyFetchClosure.prototype.upcall=function(kind,upcallInfo){if(kind==Closure.UPCALL_INTEREST_TIMED_OUT){console.log("In KeyFetchClosure.upcall: interest time out.");console.log(this.keyName.contentName.toUri())}else if(kind==Closure.UPCALL_CONTENT){var rsakey=new Key;rsakey.readDerPublicKey(upcallInfo.data.getContent().buf());var verified=data.verify(rsakey);var flag=verified==true?Closure.UPCALL_CONTENT:Closure.UPCALL_CONTENT_BAD;this.closure.upcall(flag,new UpcallInfo(thisFace,null,0,this.data));var keyEntry=new KeyStoreEntry(keylocator.keyName,rsakey,(new Date).getTime());Face.addKeyEntry(keyEntry)}else if(kind==Closure.UPCALL_CONTENT_BAD)console.log("In KeyFetchClosure.upcall: signature verification failed")};if(data.getMetaInfo()&&data.getMetaInfo().locator&&data.getSignature()){if(LOG>3)console.log("Key verification...");var sigHex=data.getSignature().getSignature().toHex();var wit=null;if(data.getSignature().witness!=null)currentClosure.upcall(Closure.UPCALL_CONTENT_BAD,new UpcallInfo(this,pitEntry.interest,0,data));var keylocator=data.getMetaInfo().locator;if(keylocator.getType()==KeyLocatorType.KEYNAME){if(LOG>3)console.log("KeyLocator contains KEYNAME");if(keylocator.keyName.contentName.match(data.getName())){if(LOG>3)console.log("Content is key itself");var rsakey=new Key;rsakey.readDerPublicKey(data.getContent().buf());var verified=data.verify(rsakey);var flag=verified==true?Closure.UPCALL_CONTENT:Closure.UPCALL_CONTENT_BAD;currentClosure.upcall(flag,new UpcallInfo(this,pitEntry.interest,0,data))}else{var keyEntry=Face.getKeyByName(keylocator.keyName);if(keyEntry){if(LOG>3)console.log("Local key cache hit");var rsakey=keyEntry.rsaKey;var verified=data.verify(rsakey);var flag=verified==true?Closure.UPCALL_CONTENT:Closure.UPCALL_CONTENT_BAD;currentClosure.upcall(flag,new UpcallInfo(this,pitEntry.interest,0,data))}else{if(LOG>3)console.log("Fetch key according to keylocator");var nextClosure=new KeyFetchClosure(data,currentClosure,keylocator.keyName,sigHex,wit);this.expressInterest(keylocator.keyName.contentName.getPrefix(4),nextClosure)}}}else if(keylocator.getType()==KeyLocatorType.KEY){if(LOG>3)console.log("Keylocator contains KEY");var rsakey=new Key;rsakey.readDerPublicKey(keylocator.publicKey);var verified=data.verify(rsakey);var flag=verified==true?Closure.UPCALL_CONTENT:Closure.UPCALL_CONTENT_BAD;currentClosure.upcall(Closure.UPCALL_CONTENT,new UpcallInfo(this,pitEntry.interest,0,data))}else{var cert=keylocator.certificate;console.log("KeyLocator contains CERT");console.log(cert)}}}}};Face.prototype.connectAndExecute=function(onConnected){var connectionInfo=this.getConnectionInfo();if(connectionInfo==null){console.log("ERROR: No more connectionInfo from getConnectionInfo");this.connectionInfo=null;this.host=null;this.host=null;return}if(connectionInfo.equals(this.connectionInfo)){console.log("ERROR: The host returned by getConnectionInfo is not alive: "+this.connectionInfo.toString());return}this.connectionInfo=connectionInfo;if(LOG>0)console.log("connectAndExecute: trying host from getConnectionInfo: "+this.connectionInfo.toString());this.host=this.connectionInfo.host;this.host=this.connectionInfo.port;var interest=new Interest(new Name("/"));interest.setInterestLifetimeMilliseconds(4e3);var thisFace=this;var timerID=setTimeout(function(){if(LOG>0)console.log("connectAndExecute: timeout waiting for host "+thisFace.host);thisFace.connectAndExecute(onConnected)},3e3);this.reconnectAndExpressInterest(null,interest,new Face.ConnectClosure(this,onConnected,timerID))};Face.prototype.closeByTransport=function(){this.readyStatus=Face.CLOSED;this.onclose()};Face.ConnectClosure=function ConnectClosure(face,onConnected,timerID){Closure.call(this);this.face=face;this.onConnected=onConnected;this.timerID=timerID};Face.ConnectClosure.prototype.upcall=function(kind,upcallInfo){if(!(kind==Closure.UPCALL_CONTENT||kind==Closure.UPCALL_CONTENT_UNVERIFIED))return Closure.RESULT_ERR;clearTimeout(this.timerID);if(LOG>0)console.log("connectAndExecute: connected to host "+this.face.host);this.onConnected();return Closure.RESULT_OK};var NDN=function NDN(settings){Face.call(this,settings)};NDN.prototype=new Face({getTransport:function(){},getConnectionInfo:function(){}});exports.NDN=NDN;NDN.supported=Face.supported;NDN.UNOPEN=Face.UNOPEN;NDN.OPEN_REQUESTED=Face.OPEN_REQUESTED;NDN.OPENED=Face.OPENED;NDN.CLOSED=Face.CLOSED}).call(this,require("buffer").Buffer)},{"./closure.js":130,"./control-parameters.js":131,"./data.js":132,"./encoding/binary-xml-decoder.js":133,"./encoding/binary-xml-encoder.js":134,"./encoding/binary-xml-wire-format.js":136,"./encoding/data-utils.js":137,"./encoding/tlv-wire-format.js":143,"./encoding/tlv/tlv-decoder.js":144,"./encoding/tlv/tlv.js":147,"./encoding/wire-format.js":148,"./forwarding-entry.js":152,"./forwarding-flags.js":153,"./interest.js":154,"./key-locator.js":155,"./key.js":156,"./log.js":157,"./meta-info.js":158,"./name.js":159,"./security/key-manager.js":170,"./transport/tcp-transport.js":128,"./transport/transport.js":181,"./transport/unix-transport.js":182,"./util/command-interest-generator.js":185,"./util/ndn-protoco-id-tags.js":189,buffer:3,crypto:9,fs:1}],152:[function(require,module,exports){var ForwardingFlags=require("./forwarding-flags.js").ForwardingFlags;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var PublisherPublicKeyDigest=require("./publisher-public-key-digest.js").PublisherPublicKeyDigest;var Name=require("./name.js").Name;var ForwardingEntry=function ForwardingEntry(action,prefixName,ndndId,faceID,flags,lifetime){this.action=action;this.prefixName=prefixName;this.ndndID=ndndId;this.faceID=faceID;this.flags=flags;this.lifetime=lifetime};exports.ForwardingEntry=ForwardingEntry;ForwardingEntry.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());if(decoder.peekDTag(NDNProtocolDTags.Action))this.action=decoder.readUTF8DTagElement(NDNProtocolDTags.Action);if(decoder.peekDTag(NDNProtocolDTags.Name)){this.prefixName=new Name;this.prefixName.from_ndnb(decoder)}if(decoder.peekDTag(NDNProtocolDTags.PublisherPublicKeyDigest)){this.NdndId=new PublisherPublicKeyDigest;this.NdndId.from_ndnb(decoder)}if(decoder.peekDTag(NDNProtocolDTags.FaceID))this.faceID=decoder.readIntegerDTagElement(NDNProtocolDTags.FaceID);if(decoder.peekDTag(NDNProtocolDTags.ForwardingFlags))this.flags=decoder.readIntegerDTagElement(NDNProtocolDTags.ForwardingFlags);if(decoder.peekDTag(NDNProtocolDTags.FreshnessSeconds))this.lifetime=decoder.readIntegerDTagElement(NDNProtocolDTags.FreshnessSeconds);decoder.readElementClose()};ForwardingEntry.prototype.to_ndnb=function(encoder){encoder.writeElementStartDTag(this.getElementLabel());if(null!=this.action&&this.action.length!=0)encoder.writeDTagElement(NDNProtocolDTags.Action,this.action);if(null!=this.prefixName)this.prefixName.to_ndnb(encoder);if(null!=this.NdndId)this.NdndId.to_ndnb(encoder);if(null!=this.faceID)encoder.writeDTagElement(NDNProtocolDTags.FaceID,this.faceID);if(null!=this.flags)encoder.writeDTagElement(NDNProtocolDTags.ForwardingFlags,this.flags);if(null!=this.lifetime)encoder.writeDTagElement(NDNProtocolDTags.FreshnessSeconds,this.lifetime);encoder.writeElementClose()};ForwardingEntry.prototype.getElementLabel=function(){return NDNProtocolDTags.ForwardingEntry}},{"./forwarding-flags.js":153,"./name.js":159,"./publisher-public-key-digest.js":161,"./util/ndn-protoco-id-tags.js":189}],153:[function(require,module,exports){var ForwardingFlags=function ForwardingFlags(){this.active=true;this.childInherit=true;this.advertise=false;this.last=false;this.capture=false;this.local=false;this.tap=false;this.captureOk=false};exports.ForwardingFlags=ForwardingFlags;ForwardingFlags.ForwardingEntryFlags_ACTIVE=1;ForwardingFlags.ForwardingEntryFlags_CHILD_INHERIT=2;ForwardingFlags.ForwardingEntryFlags_ADVERTISE=4;ForwardingFlags.ForwardingEntryFlags_LAST=8;ForwardingFlags.ForwardingEntryFlags_CAPTURE=16;ForwardingFlags.ForwardingEntryFlags_LOCAL=32;ForwardingFlags.ForwardingEntryFlags_TAP=64;ForwardingFlags.ForwardingEntryFlags_CAPTURE_OK=128;ForwardingFlags.NfdForwardingFlags_CHILD_INHERIT=1;ForwardingFlags.NfdForwardingFlags_CAPTURE=2;ForwardingFlags.prototype.getForwardingEntryFlags=function(){var result=0;if(this.active)result|=ForwardingFlags.ForwardingEntryFlags_ACTIVE;if(this.childInherit)result|=ForwardingFlags.ForwardingEntryFlags_CHILD_INHERIT;if(this.advertise)result|=ForwardingFlags.ForwardingEntryFlags_ADVERTISE;if(this.last)result|=ForwardingFlags.ForwardingEntryFlags_LAST;if(this.capture)result|=ForwardingFlags.ForwardingEntryFlags_CAPTURE;if(this.local)result|=ForwardingFlags.ForwardingEntryFlags_LOCAL;if(this.tap)result|=ForwardingFlags.ForwardingEntryFlags_TAP;if(this.captureOk)result|=ForwardingFlags.ForwardingEntryFlags_CAPTURE_OK;return result};ForwardingFlags.prototype.setForwardingEntryFlags=function(forwardingEntryFlags){this.active=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_ACTIVE)!=0;this.childInherit=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_CHILD_INHERIT)!=0;this.advertise=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_ADVERTISE)!=0;this.last=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_LAST)!=0;this.capture=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_CAPTURE)!=0;this.local=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_LOCAL)!=0;this.tap=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_TAP)!=0;this.captureOk=(forwardingEntryFlags&ForwardingFlags.ForwardingEntryFlags_CAPTURE_OK)!=0};ForwardingFlags.prototype.getNfdForwardingFlags=function(){var result=0;if(this.childInherit)result|=ForwardingFlags.NfdForwardingFlags_CHILD_INHERIT;if(this.capture)result|=ForwardingFlags.NfdForwardingFlags_CAPTURE;return result};ForwardingFlags.prototype.setNfdForwardingFlags=function(nfdForwardingFlags){this.childInherit=(nfdForwardingFlags&ForwardingFlags.NfdForwardingFlags_CHILD_INHERIT)!=0;this.capture=(nfdForwardingFlags&ForwardingFlags.NfdForwardingFlags_CAPTURE)!=0};ForwardingFlags.prototype.getActive=function(){return this.active};ForwardingFlags.prototype.getChildInherit=function(){return this.childInherit};ForwardingFlags.prototype.getAdvertise=function(){return this.advertise};ForwardingFlags.prototype.getLast=function(){return this.last};ForwardingFlags.prototype.getCapture=function(){return this.capture};ForwardingFlags.prototype.getLocal=function(){return this.local};ForwardingFlags.prototype.getTap=function(){return this.tap};ForwardingFlags.prototype.getCaptureOk=function(){return this.captureOk};ForwardingFlags.prototype.setActive=function(value){this.active=value};ForwardingFlags.prototype.setChildInherit=function(value){this.childInherit=value};ForwardingFlags.prototype.setAdvertise=function(value){this.advertise=value};ForwardingFlags.prototype.setLast=function(value){this.last=value};ForwardingFlags.prototype.setCapture=function(value){this.capture=value};ForwardingFlags.prototype.setLocal=function(value){this.local=value};ForwardingFlags.prototype.setTap=function(value){this.tap=value};ForwardingFlags.prototype.setCaptureOk=function(value){this.captureOk=value}},{}],154:[function(require,module,exports){(function(Buffer){var Blob=require("./util/blob.js").Blob;var SignedBlob=require("./util/signed-blob.js").SignedBlob;var Name=require("./name.js").Name;var Exclude=require("./exclude.js").Exclude;var PublisherPublicKeyDigest=require("./publisher-public-key-digest.js").PublisherPublicKeyDigest;var KeyLocator=require("./key-locator.js").KeyLocator;var WireFormat=require("./encoding/wire-format.js").WireFormat;var Interest=function Interest(nameOrInterest,minSuffixComponents,maxSuffixComponents,publisherPublicKeyDigest,exclude,childSelector,answerOriginKind,scope,interestLifetimeMilliseconds,nonce){if(typeof nameOrInterest==="object"&&nameOrInterest instanceof Interest){var interest=nameOrInterest;if(interest.name)this.name=new Name(interest.name);this.maxSuffixComponents=interest.maxSuffixComponents;this.minSuffixComponents=interest.minSuffixComponents;this.publisherPublicKeyDigest=interest.publisherPublicKeyDigest;this.keyLocator=new KeyLocator(interest.keyLocator);this.exclude=new Exclude(interest.exclude);this.childSelector=interest.childSelector;this.answerOriginKind=interest.answerOriginKind;this.scope=interest.scope;this.interestLifetime=interest.interestLifetime;if(interest.nonce)this.nonce=new Buffer(interest.nonce)}else{this.name=typeof nameOrInterest==="object"&&nameOrInterest instanceof Name?new Name(nameOrInterest):new Name;this.maxSuffixComponents=maxSuffixComponents;this.minSuffixComponents=minSuffixComponents;this.publisherPublicKeyDigest=publisherPublicKeyDigest;this.keyLocator=new KeyLocator;this.exclude=typeof exclude==="object"&&exclude instanceof Exclude?new Exclude(exclude):new Exclude;this.childSelector=childSelector;this.answerOriginKind=answerOriginKind;this.scope=scope;this.interestLifetime=interestLifetimeMilliseconds;if(nonce)this.nonce=new Buffer(nonce)}this.wireEncoding=new SignedBlob};exports.Interest=Interest;Interest.RECURSIVE_POSTFIX="*";Interest.CHILD_SELECTOR_LEFT=0;Interest.CHILD_SELECTOR_RIGHT=1;Interest.ANSWER_NO_CONTENT_STORE=0;Interest.ANSWER_CONTENT_STORE=1;Interest.ANSWER_GENERATED=2;Interest.ANSWER_STALE=4;Interest.MARK_STALE=16;Interest.DEFAULT_ANSWER_ORIGIN_KIND=Interest.ANSWER_CONTENT_STORE|Interest.ANSWER_GENERATED;Interest.prototype.matchesName=function(name){if(!this.name.match(name))return false;if(this.minSuffixComponents!=null&&!(name.size()+1-this.name.size()>=this.minSuffixComponents))return false;if(this.maxSuffixComponents!=null&&!(name.size()+1-this.name.size()<=this.maxSuffixComponents))return false;if(this.exclude!=null&&name.size()>this.name.size()&&this.exclude.matches(name.get(this.name.size())))return false;return true};Interest.prototype.matches_name=function(name){return this.matchesName(name)};Interest.prototype.clone=function(){return new Interest(this.name,this.minSuffixComponents,this.maxSuffixComponents,this.publisherPublicKeyDigest,this.exclude,this.childSelector,this.answerOriginKind,this.scope,this.interestLifetime,this.nonce)};Interest.prototype.getName=function(){return this.name};Interest.prototype.getMinSuffixComponents=function(){return this.minSuffixComponents};Interest.prototype.getMaxSuffixComponents=function(){return this.maxSuffixComponents};Interest.prototype.getKeyLocator=function(){return this.keyLocator};Interest.prototype.getExclude=function(){return this.exclude};Interest.prototype.getChildSelector=function(){return this.childSelector};Interest.prototype.getAnswerOriginKind=function(){return this.answerOriginKind};Interest.prototype.getMustBeFresh=function(){if(this.answerOriginKind==null||this.answerOriginKind<0)return true;else return(this.answerOriginKind&Interest.ANSWER_STALE)==0};Interest.prototype.getNonce=function(){return new Blob(this.nonce,false)};Interest.prototype.getNonceAsBuffer=function(){return this.nonce};Interest.prototype.getScope=function(){return this.scope};Interest.prototype.getInterestLifetimeMilliseconds=function(){return this.interestLifetime};Interest.prototype.setName=function(name){this.nonce=null;this.wireEncoding=new SignedBlob;this.name=typeof name==="object"&&name instanceof Name?new Name(name):new Name};Interest.prototype.setMinSuffixComponents=function(minSuffixComponents){this.nonce=null;this.wireEncoding=new SignedBlob;this.minSuffixComponents=minSuffixComponents};Interest.prototype.setMaxSuffixComponents=function(maxSuffixComponents){this.nonce=null;this.wireEncoding=new SignedBlob;this.maxSuffixComponents=maxSuffixComponents};Interest.prototype.setExclude=function(exclude){this.nonce=null;this.wireEncoding=new SignedBlob;this.exclude=typeof exclude==="object"&&exclude instanceof Exclude?new Exclude(exclude):new Exclude};Interest.prototype.setChildSelector=function(childSelector){this.nonce=null;this.wireEncoding=new SignedBlob;this.childSelector=childSelector};Interest.prototype.setAnswerOriginKind=function(answerOriginKind){this.nonce=null;this.wireEncoding=new SignedBlob;this.answerOriginKind=answerOriginKind};Interest.prototype.setMustBeFresh=function(mustBeFresh){this.nonce=null;this.wireEncoding=new SignedBlob;if(this.answerOriginKind==null||this.answerOriginKind<0){if(!mustBeFresh)this.answerOriginKind=Interest.ANSWER_STALE}else{if(mustBeFresh)this.answerOriginKind&=~Interest.ANSWER_STALE;else this.answerOriginKind|=Interest.ANSWER_STALE}};Interest.prototype.setScope=function(scope){this.nonce=null;this.wireEncoding=new SignedBlob;this.scope=scope};Interest.prototype.setInterestLifetimeMilliseconds=function(interestLifetimeMilliseconds){this.nonce=null;this.wireEncoding=new SignedBlob;this.interestLifetime=interestLifetimeMilliseconds};Interest.prototype.setNonce=function(nonce){this.wireEncoding=new SignedBlob;if(nonce){if(typeof nonce==="object"&&nonce instanceof Blob)this.nonce=nonce.buf();else this.nonce=new Buffer(nonce)}else this.nonce=null};Interest.prototype.toUri=function(){var selectors="";if(this.minSuffixComponents!=null)selectors+="&ndn.MinSuffixComponents="+this.minSuffixComponents;if(this.maxSuffixComponents!=null)selectors+="&ndn.MaxSuffixComponents="+this.maxSuffixComponents;if(this.childSelector!=null)selectors+="&ndn.ChildSelector="+this.childSelector;if(this.answerOriginKind!=null)selectors+="&ndn.AnswerOriginKind="+this.answerOriginKind;if(this.scope!=null)selectors+="&ndn.Scope="+this.scope;if(this.interestLifetime!=null)selectors+="&ndn.InterestLifetime="+this.interestLifetime;if(this.publisherPublicKeyDigest!=null)selectors+="&ndn.PublisherPublicKeyDigest="+Name.toEscapedString(this.publisherPublicKeyDigest.publisherPublicKeyDigest);if(this.nonce!=null)selectors+="&ndn.Nonce="+Name.toEscapedString(this.nonce);if(this.exclude!=null&&this.exclude.size()>0)selectors+="&ndn.Exclude="+this.exclude.toUri();var result=this.name.toUri();if(selectors!="")result+="?"+selectors.substr(1);return result};Interest.prototype.wireEncode=function(wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var result=wireFormat.encodeInterest(this);this.wireEncoding=new SignedBlob(result.encoding,result.signedPortionBeginOffset,result.signedPortionEndOffset);return this.wireEncoding};Interest.prototype.wireDecode=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var decodeBuffer=typeof input==="object"&&input instanceof Blob?input.buf():input;var result=wireFormat.decodeInterest(this,decodeBuffer);this.wireEncoding=new SignedBlob(new Blob(input,true),result.signedPortionBeginOffset,result.signedPortionEndOffset)};var BinaryXmlWireFormat=require("./encoding/binary-xml-wire-format.js").BinaryXmlWireFormat;Interest.prototype.from_ndnb=function(decoder){BinaryXmlWireFormat.decodeInterest(this,decoder)};Interest.prototype.to_ndnb=function(encoder){BinaryXmlWireFormat.encodeInterest(this,encoder)};Interest.prototype.encode=function(wireFormat){return this.wireEncode(BinaryXmlWireFormat.get()).buf()};Interest.prototype.decode=function(input,wireFormat){this.wireDecode(input,BinaryXmlWireFormat.get())}}).call(this,require("buffer").Buffer)},{"./encoding/binary-xml-wire-format.js":136,"./encoding/wire-format.js":148,"./exclude.js":149,"./key-locator.js":155,"./name.js":159,"./publisher-public-key-digest.js":161,"./util/blob.js":184,"./util/signed-blob.js":191,buffer:3}],155:[function(require,module,exports){(function(Buffer){var Blob=require("./util/blob.js").Blob;var Name=require("./name.js").Name;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var PublisherID=require("./publisher-id.js").PublisherID;var LOG=require("./log.js").Log.LOG;var KeyLocatorType={KEYNAME:1,KEY_LOCATOR_DIGEST:2,KEY:3,CERTIFICATE:4};exports.KeyLocatorType=KeyLocatorType;var KeyLocator=function KeyLocator(input,type){if(typeof input==="object"&&input instanceof KeyLocator){this.type=input.type;this.keyName=new KeyName;if(input.keyName!=null){this.keyName.contentName=input.keyName.contentName==null?null:new Name(input.keyName.contentName);this.keyName.publisherID=input.keyName.publisherID}this.keyData=input.keyData==null?null:new Buffer(input.keyData);this.publicKey=input.publicKey==null?null:new Buffer(input.publicKey);this.certificate=input.certificate==null?null:new Buffer(input.certificate)}else{this.type=type;this.keyName=new KeyName;if(type==KeyLocatorType.KEYNAME)this.keyName=input;else if(type==KeyLocatorType.KEY_LOCATOR_DIGEST)this.keyData=new Buffer(input);else if(type==KeyLocatorType.KEY){this.keyData=new Buffer(input);this.publicKey=this.keyData}else if(type==KeyLocatorType.CERTIFICATE){this.keyData=new Buffer(input);this.certificate=this.keyData}}};exports.KeyLocator=KeyLocator;KeyLocator.prototype.getType=function(){return this.type};KeyLocator.prototype.getKeyName=function(){if(this.keyName==null)this.keyName=new KeyName;if(this.keyName.contentName==null)this.keyName.contentName=new Name;return this.keyName.contentName};KeyLocator.prototype.getKeyData=function(){return new Blob(this.getKeyDataAsBuffer(),false)};KeyLocator.prototype.getKeyDataAsBuffer=function(){if(this.type==KeyLocatorType.KEY)return this.publicKey;else if(this.type==KeyLocatorType.CERTIFICATE)return this.certificate;else return this.keyData};KeyLocator.prototype.setType=function(type){this.type=type};KeyLocator.prototype.setKeyName=function(name){if(this.keyName==null)this.keyName=new KeyName;this.keyName.contentName=typeof name==="object"&&name instanceof Name?new Name(name):new Name};KeyLocator.prototype.setKeyData=function(keyData){var value=keyData;if(value!=null){if(typeof value==="object"&&value instanceof Blob)value=new Buffer(value.buf());else value=new Buffer(value)}this.keyData=value;this.publicKey=value;this.certificate=value};KeyLocator.prototype.clear=function(){this.type=null;this.keyName=null;this.keyData=null;this.publicKey=null;this.certificate=null};KeyLocator.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());if(decoder.peekDTag(NDNProtocolDTags.Key)){try{var encodedKey=decoder.readBinaryDTagElement(NDNProtocolDTags.Key);this.publicKey=encodedKey;this.type=KeyLocatorType.KEY;if(LOG>4)console.log("PUBLIC KEY FOUND: "+this.publicKey)}catch(e){throw new Error("Cannot parse key: ",e)}if(null==this.publicKey)throw new Error("Cannot parse key: ")}else if(decoder.peekDTag(NDNProtocolDTags.Certificate)){try{var encodedCert=decoder.readBinaryDTagElement(NDNProtocolDTags.Certificate);this.certificate=encodedCert;this.type=KeyLocatorType.CERTIFICATE;if(LOG>4)console.log("CERTIFICATE FOUND: "+this.certificate)}catch(e){throw new Error("Cannot decode certificate: "+e)}if(null==this.certificate)throw new Error("Cannot parse certificate! ")}else{this.type=KeyLocatorType.KEYNAME;this.keyName=new KeyName;this.keyName.from_ndnb(decoder)}decoder.readElementClose()};KeyLocator.prototype.to_ndnb=function(encoder){if(LOG>4)console.log("type is is "+this.type);if(this.type==KeyLocatorType.KEY_LOCATOR_DIGEST)return;encoder.writeElementStartDTag(this.getElementLabel());if(this.type==KeyLocatorType.KEY){if(LOG>5)console.log("About to encode a public key"+this.publicKey);encoder.writeDTagElement(NDNProtocolDTags.Key,this.publicKey)}else if(this.type==KeyLocatorType.CERTIFICATE){try{encoder.writeDTagElement(NDNProtocolDTags.Certificate,this.certificate)}catch(e){throw new Error("CertificateEncodingException attempting to write key locator: "+e)}}else if(this.type==KeyLocatorType.KEYNAME)this.keyName.to_ndnb(encoder);
encoder.writeElementClose()};KeyLocator.prototype.getElementLabel=function(){return NDNProtocolDTags.KeyLocator};var KeyName=function KeyName(){this.contentName=new Name;this.publisherID=this.publisherID};exports.KeyName=KeyName;KeyName.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());this.contentName=new Name;this.contentName.from_ndnb(decoder);if(LOG>4)console.log("KEY NAME FOUND: ");if(PublisherID.peek(decoder)){this.publisherID=new PublisherID;this.publisherID.from_ndnb(decoder)}decoder.readElementClose()};KeyName.prototype.to_ndnb=function(encoder){encoder.writeElementStartDTag(this.getElementLabel());this.contentName.to_ndnb(encoder);if(null!=this.publisherID)this.publisherID.to_ndnb(encoder);encoder.writeElementClose()};KeyName.prototype.getElementLabel=function(){return NDNProtocolDTags.KeyName}}).call(this,require("buffer").Buffer)},{"./log.js":157,"./name.js":159,"./publisher-id.js":160,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189,buffer:3}],156:[function(require,module,exports){(function(Buffer){var DataUtils=require("./encoding/data-utils.js").DataUtils;var LOG=require("./log.js").Log.LOG;var Key=function Key(){this.publicKeyDer=null;this.publicKeyDigest=null;this.publicKeyPem=null;this.privateKeyPem=null};exports.Key=Key;Key.prototype.publicToDER=function(){return this.publicKeyDer};Key.prototype.privateToDER=function(){var lines=this.privateKeyPem.split("\n");priKey="";for(var i=1;i<lines.length-1;i++)priKey+=lines[i];return new Buffer(priKey,"base64")};Key.prototype.publicToPEM=function(){return this.publicKeyPem};Key.prototype.privateToPEM=function(){return this.privateKeyPem};Key.prototype.getKeyID=function(){return this.publicKeyDigest};exports.Key=Key;Key.prototype.readDerPublicKey=function(pub_der){if(LOG>4)console.log("Encode DER public key:\n"+pub_der.toString("hex"));this.publicKeyDer=pub_der;var hash=require("crypto").createHash("sha256");hash.update(this.publicKeyDer);this.publicKeyDigest=new Buffer(DataUtils.toNumbersIfString(hash.digest()));var keyStr=pub_der.toString("base64");var keyPem="-----BEGIN PUBLIC KEY-----\n";for(var i=0;i<keyStr.length;i+=64)keyPem+=keyStr.substr(i,64)+"\n";keyPem+="-----END PUBLIC KEY-----";this.publicKeyPem=keyPem;if(LOG>4)console.log("Convert public key to PEM format:\n"+this.publicKeyPem)};Key.prototype.fromPemString=function(pub,pri){if(pub==null&&pri==null)throw new Error("Cannot create Key object if both public and private PEM string is empty.");if(pub!=null){this.publicKeyPem=pub;if(LOG>4)console.log("Key.publicKeyPem: \n"+this.publicKeyPem);var lines=pub.split("\n");pub="";for(var i=1;i<lines.length-1;i++)pub+=lines[i];this.publicKeyDer=new Buffer(pub,"base64");if(LOG>4)console.log("Key.publicKeyDer: \n"+this.publicKeyDer.toString("hex"));var hash=require("crypto").createHash("sha256");hash.update(this.publicKeyDer);this.publicKeyDigest=new Buffer(DataUtils.toNumbersIfString(hash.digest()));if(LOG>4)console.log("Key.publicKeyDigest: \n"+this.publicKeyDigest.toString("hex"))}if(pri!=null){this.privateKeyPem=pri;if(LOG>4)console.log("Key.privateKeyPem: \n"+this.privateKeyPem)}};Key.prototype.fromPem=Key.prototype.fromPemString;Key.createFromPEM=function(obj){var key=new Key;key.fromPemString(obj.pub,obj.pri);return key}}).call(this,require("buffer").Buffer)},{"./encoding/data-utils.js":137,"./log.js":157,buffer:3,crypto:9}],157:[function(require,module,exports){var Log=function Log(){};exports.Log=Log;Log.LOG=0},{}],158:[function(require,module,exports){(function(Buffer){var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./encoding/binary-xml-decoder.js").BinaryXMLDecoder;var Blob=require("./util/blob.js").Blob;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var KeyLocator=require("./key-locator.js").KeyLocator;var KeyLocatorType=require("./key-locator.js").KeyLocatorType;var Name=require("./name.js").Name;var PublisherPublicKeyDigest=require("./publisher-public-key-digest.js").PublisherPublicKeyDigest;var NDNTime=require("./util/ndn-time.js").NDNTime;var globalKeyManager=require("./security/key-manager.js").globalKeyManager;var LOG=require("./log.js").Log.LOG;var ContentType={BLOB:0,DATA:0,LINK:1,KEY:2,ENCR:3,GONE:4,NACK:5};exports.ContentType=ContentType;var MetaInfo=function MetaInfo(publisherOrMetaInfo,timestamp,type,locator,freshnessSeconds,finalBlockId,skipSetFields){if(typeof publisherOrMetaInfo==="object"&&publisherOrMetaInfo instanceof MetaInfo){var metaInfo=publisherOrMetaInfo;this.publisher=metaInfo.publisher;this.timestamp=metaInfo.timestamp;this.type=metaInfo.type;this.locator=metaInfo.locator==null?new KeyLocator:new KeyLocator(metaInfo.locator);this.freshnessSeconds=metaInfo.freshnessSeconds;this.finalBlockID=metaInfo.finalBlockID}else{this.publisher=publisherOrMetaInfo;this.timestamp=timestamp;this.type=type==null||type<0?ContentType.BLOB:type;this.locator=locator==null?new KeyLocator:new KeyLocator(locator);this.freshnessSeconds=freshnessSeconds;this.finalBlockID=finalBlockId;if(!skipSetFields)this.setFields()}this.changeCount=0};exports.MetaInfo=MetaInfo;MetaInfo.prototype.getType=function(){return this.type};MetaInfo.prototype.getFreshnessPeriod=function(){if(this.freshnessSeconds==null||this.freshnessSeconds<0)return null;else return this.freshnessSeconds*1e3};MetaInfo.prototype.getFinalBlockId=function(){return new Name.Component(new Blob(this.finalBlockID,true))};MetaInfo.prototype.getFinalBlockID=function(){return this.getFinalBlockId()};MetaInfo.prototype.getFinalBlockIDAsBuffer=function(){return this.finalBlockID};MetaInfo.prototype.setType=function(type){this.type=type==null||type<0?ContentType.BLOB:type;++this.changeCount};MetaInfo.prototype.setFreshnessPeriod=function(freshnessPeriod){if(freshnessPeriod==null||freshnessPeriod<0)this.freshnessSeconds=null;else this.freshnessSeconds=freshnessPeriod/1e3;++this.changeCount};MetaInfo.prototype.setFinalBlockId=function(finalBlockId){if(finalBlockId==null)this.finalBlockID=null;else if(typeof finalBlockId==="object"&&finalBlockId instanceof Blob)this.finalBlockID=finalBlockId.buf();else if(typeof finalBlockId==="object"&&finalBlockId instanceof Name.Component)this.finalBlockID=finalBlockId.getValue().buf();else this.finalBlockID=new Buffer(finalBlockId);++this.changeCount};MetaInfo.prototype.setFinalBlockID=function(finalBlockId){this.setFinalBlockId(finalBlockId)};MetaInfo.prototype.setFields=function(){var key=globalKeyManager.getKey();this.publisher=new PublisherPublicKeyDigest(key.getKeyID());var d=new Date;var time=d.getTime();this.timestamp=new NDNTime(time);if(LOG>4)console.log("TIME msec is");if(LOG>4)console.log(this.timestamp.msec);this.type=ContentType.BLOB;if(LOG>4)console.log("PUBLIC KEY TO WRITE TO DATA PACKET IS ");if(LOG>4)console.log(key.publicToDER().toString("hex"));this.locator=new KeyLocator(key.getKeyID(),KeyLocatorType.KEY_LOCATOR_DIGEST);++this.changeCount};MetaInfo.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());if(decoder.peekDTag(NDNProtocolDTags.PublisherPublicKeyDigest)){if(LOG>4)console.log("DECODING PUBLISHER KEY");this.publisher=new PublisherPublicKeyDigest;this.publisher.from_ndnb(decoder)}if(decoder.peekDTag(NDNProtocolDTags.Timestamp)){if(LOG>4)console.log("DECODING TIMESTAMP");this.timestamp=decoder.readDateTimeDTagElement(NDNProtocolDTags.Timestamp)}if(decoder.peekDTag(NDNProtocolDTags.Type)){var binType=decoder.readBinaryDTagElement(NDNProtocolDTags.Type);if(LOG>4)console.log("Binary Type of of Signed Info is "+binType);this.type=binType;if(null==this.type)throw new Error("Cannot parse signedInfo type: bytes.")}else this.type=ContentType.DATA;if(decoder.peekDTag(NDNProtocolDTags.FreshnessSeconds)){this.freshnessSeconds=decoder.readIntegerDTagElement(NDNProtocolDTags.FreshnessSeconds);if(LOG>4)console.log("FRESHNESS IN SECONDS IS "+this.freshnessSeconds)}if(decoder.peekDTag(NDNProtocolDTags.FinalBlockID)){if(LOG>4)console.log("DECODING FINAL BLOCKID");this.finalBlockID=decoder.readBinaryDTagElement(NDNProtocolDTags.FinalBlockID)}if(decoder.peekDTag(NDNProtocolDTags.KeyLocator)){if(LOG>4)console.log("DECODING KEY LOCATOR");this.locator=new KeyLocator;this.locator.from_ndnb(decoder)}decoder.readElementClose();++this.changeCount};MetaInfo.prototype.to_ndnb=function(encoder,keyLocator){if(!this.validate())throw new Error("Cannot encode : field values missing.");encoder.writeElementStartDTag(this.getElementLabel());if(null!=this.publisher){if(LOG>3)console.log("ENCODING PUBLISHER KEY"+this.publisher.publisherPublicKeyDigest);this.publisher.to_ndnb(encoder)}else{if(null!=keyLocator&&keyLocator.getType()==KeyLocatorType.KEY_LOCATOR_DIGEST&&!keyLocator.getKeyData().isNull()&&keyLocator.getKeyData().size()>0)encoder.writeDTagElement(NDNProtocolDTags.PublisherPublicKeyDigest,keyLocator.getKeyData().buf())}if(null!=this.timestamp)encoder.writeDateTimeDTagElement(NDNProtocolDTags.Timestamp,this.timestamp);if(null!=this.type&&this.type!=0)encoder.writeDTagElement(NDNProtocolDTags.type,this.type);if(null!=this.freshnessSeconds)encoder.writeDTagElement(NDNProtocolDTags.FreshnessSeconds,this.freshnessSeconds);if(null!=this.finalBlockID)encoder.writeDTagElement(NDNProtocolDTags.FinalBlockID,this.finalBlockID);if(null!=keyLocator)keyLocator.to_ndnb(encoder);encoder.writeElementClose()};MetaInfo.prototype.valueToType=function(){return null};MetaInfo.prototype.getElementLabel=function(){return NDNProtocolDTags.SignedInfo};MetaInfo.prototype.validate=function(){if(null==this.timestamp)return false;return true};MetaInfo.prototype.getChangeCount=function(){return this.changeCount};var SignedInfo=function SignedInfo(publisherOrMetaInfo,timestamp,type,locator,freshnessSeconds,finalBlockId){MetaInfo.call(this,publisherOrMetaInfo,timestamp,type,locator,freshnessSeconds,finalBlockId)};SignedInfo.prototype=new MetaInfo(null,null,null,null,null,null,true);exports.SignedInfo=SignedInfo}).call(this,require("buffer").Buffer)},{"./encoding/binary-xml-decoder.js":133,"./encoding/binary-xml-encoder.js":134,"./key-locator.js":155,"./log.js":157,"./name.js":159,"./publisher-public-key-digest.js":161,"./security/key-manager.js":170,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189,"./util/ndn-time.js":190,buffer:3}],159:[function(require,module,exports){(function(Buffer){var Blob=require("./util/blob.js").Blob;var DataUtils=require("./encoding/data-utils.js").DataUtils;var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./encoding/binary-xml-decoder.js").BinaryXMLDecoder;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var LOG=require("./log.js").Log.LOG;var Name=function Name(components){if(typeof components=="string"){if(LOG>3)console.log("Content Name String "+components);this.components=Name.createNameArray(components)}else if(typeof components==="object"){this.components=[];if(components instanceof Name)this.append(components);else{for(var i=0;i<components.length;++i)this.append(components[i])}}else if(components==null)this.components=[];else if(LOG>1)console.log("NO CONTENT NAME GIVEN");this.changeCount=0};exports.Name=Name;Name.Component=function NameComponent(value){if(typeof value==="string")this.value=DataUtils.stringToUtf8Array(value);else if(typeof value==="object"&&value instanceof Name.Component)this.value=new Buffer(value.value);else if(typeof value==="object"&&value instanceof Blob){if(value.isNull())this.value=new Buffer(0);else this.value=new Buffer(value.buf())}else if(Buffer.isBuffer(value))this.value=new Buffer(value);else if(typeof value==="object"&&typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer)this.value=new Buffer(new Uint8Array(value));else if(typeof value==="object")this.value=new Buffer(value);else if(!value)this.value=new Buffer(0);else throw new Error("Name.Component constructor: Invalid type")};Name.Component.prototype.getValue=function(){return new Blob(this.value,false)};Name.Component.prototype.getValueAsBuffer=function(){return this.value};Name.Component.prototype.toEscapedString=function(){return Name.toEscapedString(this.value)};Name.Component.prototype.toNumber=function(){return DataUtils.bigEndianToUnsignedInt(this.value)};Name.Component.prototype.toNumberWithMarker=function(marker){if(this.value.length==0||this.value[0]!=marker)throw new Error("Name component does not begin with the expected marker");return DataUtils.bigEndianToUnsignedInt(this.value.slice(1))};Name.Component.prototype.toSegment=function(){return this.toNumberWithMarker(0)};Name.Component.prototype.toSegmentOffset=function(){return this.toNumberWithMarker(251)};Name.Component.prototype.toVersion=function(){return this.toNumberWithMarker(253)};Name.Component.prototype.toTimestamp=function(){return this.toNumberWithMarker(252)};Name.Component.prototype.toSequenceNumber=function(){return this.toNumberWithMarker(254)};Name.Component.fromNumber=function(number){var encoder=new TlvEncoder(8);encoder.writeNonNegativeInteger(number);return new Name.Component(new Blob(encoder.getOutput(),false))};Name.Component.fromNumberWithMarker=function(number,marker){var encoder=new TlvEncoder(9);encoder.writeNonNegativeInteger(number);encoder.writeNonNegativeInteger(marker);return new Name.Component(new Blob(encoder.getOutput(),false))};Name.Component.prototype.equals=function(other){return DataUtils.arraysEqual(this.value,other.value)};Name.Component.prototype.compare=function(other){return Name.Component.compareBuffers(this.value,other.value)};Name.Component.compareBuffers=function(component1,component2){if(component1.length<component2.length)return-1;if(component1.length>component2.length)return 1;for(var i=0;i<component1.length;++i){if(component1[i]<component2[i])return-1;if(component1[i]>component2[i])return 1}return 0};Name.prototype.getName=function(){return this.toUri()};Name.createNameArray=function(uri){uri=uri.trim();if(uri.length<=0)return[];var iColon=uri.indexOf(":");if(iColon>=0){var iFirstSlash=uri.indexOf("/");if(iFirstSlash<0||iColon<iFirstSlash)uri=uri.substr(iColon+1,uri.length-iColon-1).trim()}if(uri[0]=="/"){if(uri.length>=2&&uri[1]=="/"){var iAfterAuthority=uri.indexOf("/",2);if(iAfterAuthority<0)return[];else uri=uri.substr(iAfterAuthority+1,uri.length-iAfterAuthority-1).trim()}else uri=uri.substr(1,uri.length-1).trim()}var array=uri.split("/");for(var i=0;i<array.length;++i){var value=Name.fromEscapedString(array[i]);if(value.isNull()){array.splice(i,1);--i;continue}else array[i]=new Name.Component(value)}return array};Name.prototype.set=function(uri){this.components=Name.createNameArray(uri);++this.changeCount};Name.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());var signedPortionBeginOffset=decoder.offset;var signedPortionEndOffset=signedPortionBeginOffset;this.components=[];while(decoder.peekDTag(NDNProtocolDTags.Component)){signedPortionEndOffset=decoder.offset;this.append(decoder.readBinaryDTagElement(NDNProtocolDTags.Component))}decoder.readElementClose();++this.changeCount;return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Name.prototype.to_ndnb=function(encoder){if(this.components==null)throw new Error("CANNOT ENCODE EMPTY CONTENT NAME");encoder.writeElementStartDTag(this.getElementLabel());var signedPortionBeginOffset=encoder.offset;var signedPortionEndOffset;var count=this.size();if(count==0)signedPortionEndOffset=signedPortionBeginOffset;else{for(var i=0;i<count;i++){if(i==count-1)signedPortionEndOffset=encoder.offset;encoder.writeDTagElement(NDNProtocolDTags.Component,this.components[i].getValue().buf())}}encoder.writeElementClose();return{signedPortionBeginOffset:signedPortionBeginOffset,signedPortionEndOffset:signedPortionEndOffset}};Name.prototype.getElementLabel=function(){return NDNProtocolDTags.Name};Name.prototype.append=function(component){if(typeof component=="object"&&component instanceof Name){var components;if(component==this)components=this.components.slice(0,this.components.length);else components=component.components;for(var i=0;i<components.length;++i)this.components.push(new Name.Component(components[i]))}else this.components.push(new Name.Component(component));++this.changeCount;return this};Name.prototype.add=function(component){return this.append(component)};Name.prototype.clear=function(){this.components=[];++this.changeCount};Name.prototype.toUri=function(){if(this.size()==0)return"/";var result="";for(var i=0;i<this.size();++i)result+="/"+Name.toEscapedString(this.components[i].getValue().buf());return result};Name.prototype.to_uri=function(){return this.toUri()};Name.prototype.appendSegment=function(segment){return this.append(Name.Component.fromNumberWithMarker(segment,0))};Name.prototype.appendSegmentOffset=function(segmentOffset){return this.append(Name.Component.fromNumberWithMarker(segmentOffset,251))};Name.prototype.appendVersion=function(version){return this.append(Name.Component.fromNumberWithMarker(version,253))};Name.prototype.appendTimestamp=function(timestamp){return this.append(Name.Component.fromNumberWithMarker(timestamp,252))};Name.prototype.appendSequenceNumber=function(sequenceNumber){return this.append(Name.Component.fromNumberWithMarker(sequenceNumber,254))};Name.prototype.addSegment=function(number){return this.appendSegment(number)};Name.prototype.getSubName=function(iStartComponent,nComponents){if(iStartComponent<0)iStartComponent=this.components.length- -iStartComponent;if(nComponents==undefined)nComponents=this.components.length-iStartComponent;var result=new Name;var iEnd=iStartComponent+nComponents;for(var i=iStartComponent;i<iEnd&&i<this.components.length;++i)result.components.push(this.components[i]);return result};Name.prototype.getPrefix=function(nComponents){if(nComponents<0)return this.getSubName(0,this.components.length+nComponents);else return this.getSubName(0,nComponents)};Name.prototype.cut=function(nComponents){return new Name(this.components.slice(0,this.components.length-nComponents))};Name.prototype.size=function(){return this.components.length};Name.prototype.get=function(i){if(i>=0){if(i>=this.components.length)throw new Error("Name.get: Index is out of bounds");return new Name.Component(this.components[i])}else{if(i<-this.components.length)throw new Error("Name.get: Index is out of bounds");return new Name.Component(this.components[this.components.length- -i])}};Name.prototype.getComponentCount=function(){return this.components.length};Name.prototype.getComponent=function(i){return new Buffer(this.components[i].getValue().buf())};Name.prototype.indexOfFileName=function(){for(var i=this.size()-1;i>=0;--i){var component=this.components[i].getValue().buf();if(component.length<=0)continue;if(component[0]==0||component[0]==192||component[0]==193||component[0]>=245&&component[0]<=255)continue;return i}return-1};Name.prototype.wireEncode=function(wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();return wireFormat.encodeName(this)};Name.prototype.wireDecode=function(input,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var decodeBuffer=typeof input==="object"&&input instanceof Blob?input.buf():input;wireFormat.decodeName(this,decodeBuffer)};Name.prototype.compare=function(other){for(var i=0;i<this.size()&&i<other.size();++i){var comparison=this.components[i].compare(other.components[i]);if(comparison==0)continue;return comparison}if(this.size()<other.size())return-1;else if(this.size()>other.size())return 1;else return 0};Name.prototype.equals=function(name){if(this.components.length!=name.components.length)return false;for(var i=this.components.length-1;i>=0;--i){if(!this.components[i].equals(name.components[i]))return false}return true};Name.prototype.equalsName=function(name){return this.equals(name)};Name.prototype.getContentDigestValue=function(){for(var i=this.size()-1;i>=0;--i){var digestValue=Name.getComponentContentDigestValue(this.components[i]);if(digestValue!=null)return digestValue}return null};Name.getComponentContentDigestValue=function(component){if(typeof component=="object"&&component instanceof Name.Component)component=component.getValue().buf();var digestComponentLength=Name.ContentDigestPrefix.length+32+Name.ContentDigestSuffix.length;if(component.length==digestComponentLength&&DataUtils.arraysEqual(component.slice(0,Name.ContentDigestPrefix.length),Name.ContentDigestPrefix)&&DataUtils.arraysEqual(component.slice(component.length-Name.ContentDigestSuffix.length,component.length),Name.ContentDigestSuffix))return component.slice(Name.ContentDigestPrefix.length,Name.ContentDigestPrefix.length+32);else return null};Name.ContentDigestPrefix=new Buffer([193,46,77,46,71,193,1,170,2,133]);Name.ContentDigestSuffix=new Buffer([0]);Name.toEscapedString=function(value){if(typeof value=="object"&&value instanceof Name.Component)value=value.getValue().buf();else if(typeof value==="object"&&value instanceof Blob)value=value.buf();var result="";var gotNonDot=false;for(var i=0;i<value.length;++i){if(value[i]!=46){gotNonDot=true;break}}if(!gotNonDot){result="...";for(var i=0;i<value.length;++i)result+="."}else{for(var i=0;i<value.length;++i){var x=value[i];if(x>=48&&x<=57||x>=65&&x<=90||x>=97&&x<=122||x==43||x==45||x==46||x==95)result+=String.fromCharCode(x);else result+="%"+(x<16?"0":"")+x.toString(16).toUpperCase()}}return result};Name.fromEscapedString=function(escapedString){var value=unescape(escapedString.trim());if(value.match(/[^.]/)==null){if(value.length<=2)return new Blob;else return new Blob(DataUtils.toNumbersFromString(value.substr(3,value.length-3)),false)}else return new Blob(DataUtils.toNumbersFromString(value),false)};Name.fromEscapedStringAsBuffer=function(escapedString){return Name.fromEscapedString(escapedString).buf()};Name.prototype.match=function(name){var i_name=this.components;var o_name=name.components;if(i_name.length>o_name.length)return false;for(var i=0;i<i_name.length;++i){if(!i_name[i].equals(o_name[i]))return false}return true};Name.prototype.getChangeCount=function(){return this.changeCount};var TlvEncoder=require("./encoding/tlv/tlv-encoder.js").TlvEncoder;var WireFormat=require("./encoding/wire-format.js").WireFormat}).call(this,require("buffer").Buffer)},{"./encoding/binary-xml-decoder.js":133,"./encoding/binary-xml-encoder.js":134,"./encoding/data-utils.js":137,"./encoding/tlv/tlv-encoder.js":145,"./encoding/wire-format.js":148,"./log.js":157,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189,buffer:3}],160:[function(require,module,exports){var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var NDNProtocolDTagsStrings=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTagsStrings;var DecodingException=require("./encoding/decoding-exception.js").DecodingException;var PublisherType=function PublisherType(tag){this.KEY=NDNProtocolDTags.PublisherPublicKeyDigest;this.CERTIFICATE=NDNProtocolDTags.PublisherCertificateDigest;this.ISSUER_KEY=NDNProtocolDTags.PublisherIssuerKeyDigest;this.ISSUER_CERTIFICATE=NDNProtocolDTags.PublisherIssuerCertificateDigest;this.Tag=tag};var PublisherID=function PublisherID(){this.PUBLISHER_ID_DIGEST_ALGORITHM="SHA-256";this.PUBLISHER_ID_LEN=256/8;this.publisherID=null;this.publisherType=null;this.changeCount=0};exports.PublisherID=PublisherID;PublisherID.prototype.from_ndnb=function(decoder){var nextTag=PublisherID.peekAndGetNextDTag(decoder);this.publisherType=new PublisherType(nextTag);if(nextTag<0)throw new Error("Invalid publisher ID, got unexpected type");this.publisherID=decoder.readBinaryDTagElement(nextTag);if(null==this.publisherID)throw new DecodingException(new Error("Cannot parse publisher ID of type : "+nextTag+"."));++this.changeCount};PublisherID.prototype.to_ndnb=function(encoder){if(!this.validate())throw new Error("Cannot encode "+this.getClass().getName()+": field values missing.");encoder.writeDTagElement(this.getElementLabel(),this.publisherID)};PublisherID.peekAndGetNextDTag=function(decoder){if(decoder.peekDTag(NDNProtocolDTags.PublisherPublicKeyDigest))return NDNProtocolDTags.PublisherPublicKeyDigest;if(decoder.peekDTag(NDNProtocolDTags.PublisherCertificateDigest))return NDNProtocolDTags.PublisherCertificateDigest;if(decoder.peekDTag(NDNProtocolDTags.PublisherIssuerKeyDigest))return NDNProtocolDTags.PublisherIssuerKeyDigest;if(decoder.peekDTag(NDNProtocolDTags.PublisherIssuerCertificateDigest))return NDNProtocolDTags.PublisherIssuerCertificateDigest;return-1};PublisherID.peek=function(decoder){return PublisherID.peekAndGetNextDTag(decoder)>=0};PublisherID.prototype.getElementLabel=function(){return this.publisherType.Tag};PublisherID.prototype.validate=function(){return null!=id()&&null!=type()};PublisherID.prototype.getChangeCount=function(){return this.changeCount}},{"./encoding/decoding-exception.js":138,"./util/ndn-protoco-id-tags.js":189}],161:[function(require,module,exports){var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var LOG=require("./log.js").Log.LOG;var PublisherPublicKeyDigest=function PublisherPublicKeyDigest(pkd){this.PUBLISHER_ID_LEN=512/8;this.publisherPublicKeyDigest=pkd;this.changeCount=0};exports.PublisherPublicKeyDigest=PublisherPublicKeyDigest;PublisherPublicKeyDigest.prototype.from_ndnb=function(decoder){this.publisherPublicKeyDigest=decoder.readBinaryDTagElement(this.getElementLabel());if(LOG>4)console.log("Publisher public key digest is "+this.publisherPublicKeyDigest);if(null==this.publisherPublicKeyDigest)throw new Error("Cannot parse publisher key digest.");if(this.publisherPublicKeyDigest.length!=this.PUBLISHER_ID_LEN){if(LOG>0)console.log("LENGTH OF PUBLISHER ID IS WRONG! Expected "+this.PUBLISHER_ID_LEN+", got "+this.publisherPublicKeyDigest.length)}++this.changeCount};PublisherPublicKeyDigest.prototype.to_ndnb=function(encoder){if(!this.validate())throw new Error("Cannot encode : field values missing.");if(LOG>3)console.log("PUBLISHER KEY DIGEST IS"+this.publisherPublicKeyDigest);encoder.writeDTagElement(this.getElementLabel(),this.publisherPublicKeyDigest)};PublisherPublicKeyDigest.prototype.getElementLabel=function(){return NDNProtocolDTags.PublisherPublicKeyDigest};PublisherPublicKeyDigest.prototype.validate=function(){return null!=this.publisherPublicKeyDigest};PublisherPublicKeyDigest.prototype.getChangeCount=function(){return this.changeCount}},{"./log.js":157,"./util/ndn-protoco-id-tags.js":189}],162:[function(require,module,exports){var IdentityCertificate=function IdentityCertificate(){};exports.IdentityCertificate=IdentityCertificate;IdentityCertificate.certificateNameToPublicKeyName=function(certificateName){var i=certificateName.size()-1;var idString="ID-CERT";while(i>=0){if(certificateName.get(i).toEscapedString()==idString)break;i-=1}var tmpName=certificateName.getSubName(0,i);var keyString="KEY";for(var i=0;i<tmpName.size();++i){if(tmpName.get(i).toEscapedString()==keyString)break}return tmpName.getSubName(0,i).append(tmpName.getSubName(i+1,tmpName.size()-i-1))}},{}],163:[function(require,module,exports){var SecurityException=require("../security-exception.js").SecurityException;var KeyType=require("../security-types.js").KeyType;var PublicKey=function PublicKey(keyType,keyDer){this.keyType=keyType;this.keyDer=keyDer};exports.PublicKey=PublicKey;PublicKey.prototype.toDer=function(){throw new Error("PublicKey.toDer is not implemented")};PublicKey.fromDer=function(keyType,keyDer){if(keyType==KeyType.RSA){}else throw new SecurityException(new Error("PublicKey::fromDer: Unrecognized keyType"));return new PublicKey(keyType,keyDer)};PublicKey.prototype.getDigest=function(digestAlgorithm){throw new Error("PublicKey.getDigest is not implemented")};PublicKey.prototype.getKeyType=function(){return this.keyType};PublicKey.prototype.getKeyDer=function(){return this.keyDer}},{"../security-exception.js":175,"../security-types.js":176}],164:[function(require,module,exports){(function(Buffer){var Name=require("../../name.js").Name;var Data=require("../../data.js").Data;var Sha256WithRsaSignature=require("../../sha256-with-rsa-signature.js").Sha256WithRsaSignature;var KeyLocatorType=require("../../key-locator.js").KeyLocatorType;var WireFormat=require("../../encoding/wire-format.js").WireFormat;var SecurityException=require("../security-exception.js").SecurityException;var IdentityManager=function IdentityManager(identityStorage,privateKeyStorage){this.identityStorage=identityStorage;this.privateKeyStorage=privateKeyStorage};exports.IdentityManager=IdentityManager;IdentityManager.prototype.createIdentity=function(identityName){throw new Error("IdentityManager.createIdentity is not implemented")};IdentityManager.prototype.getDefaultIdentity=function(){return this.identityStorage.getDefaultIdentity()};IdentityManager.prototype.generateRSAKeyPair=function(identityName,isKsk,keySize){throw new Error("IdentityManager.generateRSAKeyPair is not implemented")};IdentityManager.prototype.setDefaultKeyForIdentity=function(keyName,identityName){if(identityName==null)identityName=new Name;this.identityStorage.setDefaultKeyNameForIdentity(keyName,identityName)};IdentityManager.prototype.getDefaultKeyNameForIdentity=function(identityName){return this.identityStorage.getDefaultKeyNameForIdentity(identityName)};IdentityManager.prototype.generateRSAKeyPairAsDefault=function(identityName,isKsk,keySize){throw new Error("IdentityManager.generateRSAKeyPairAsDefault is not implemented")};IdentityManager.prototype.getPublicKey=function(keyName){return PublicKey.fromDer(this.identityStorage.getKeyType(keyName),this.identityStorage.getKey(keyName))};IdentityManager.prototype.addCertificate=function(certificate){this.identityStorage.addCertificate(certificate)};IdentityManager.prototype.setDefaultCertificateForKey=function(certificate){var keyName=certificate.getPublicKeyName();if(!this.identityStorage.doesKeyExist(keyName))throw new SecurityException(new Error("No corresponding Key record for certificate!"));this.identityStorage.setDefaultCertificateNameForKey(keyName,certificate.getName())};IdentityManager.prototype.addCertificateAsIdentityDefault=function(certificate){this.identityStorage.addCertificate(certificate);var keyName=certificate.getPublicKeyName();this.setDefaultKeyForIdentity(keyName);this.setDefaultCertificateForKey(certificate)};IdentityManager.prototype.addCertificateAsDefault=function(certificate){this.identityStorage.addCertificate(certificate);this.setDefaultCertificateForKey(certificate)};IdentityManager.prototype.getCertificate=function(certificateName){return new IdentityCertificate(this.identityStorage.getCertificate(certificateName,false))};IdentityManager.prototype.getAnyCertificate=function(certificateName){return new IdentityCertificate(this.identityStorage.getCertificate(certificateName,true))};IdentityManager.prototype.getDefaultCertificateNameForIdentity=function(identityName){return this.identityStorage.getDefaultCertificateNameForIdentity(identityName)};IdentityManager.prototype.getDefaultCertificateName=function(){return this.identityStorage.getDefaultCertificateNameForIdentity(this.getDefaultIdentity())};IdentityManager.prototype.signByCertificate=function(target,certificateName,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();if(target instanceof Data){var data=target;var keyName=IdentityManager.certificateNameToPublicKeyName(certificateName);data.setSignature(new Sha256WithRsaSignature);var signature=data.getSignature();signature.getKeyLocator().setType(KeyLocatorType.KEYNAME);signature.getKeyLocator().setKeyName(certificateName.getPrefix(-1));signature.setSignature(new Buffer(1));var encoding=data.wireEncode(wireFormat);signature.setSignature(this.privateKeyStorage.sign(encoding.signedBuf(),keyName));data.wireEncode(wireFormat)}else{var keyName=IdentityManager.certificateNameToPublicKeyName(certificateName);var signature=new Sha256WithRsaSignature;
signature.getKeyLocator().setType(KeyLocatorType.KEYNAME);signature.getKeyLocator().setKeyName(certificateName.getPrefix(-1));signature.setSignature(this.privateKeyStorage.sign(target,keyName));return signature}};IdentityManager.prototype.selfSign=function(keyName){throw new Error("IdentityManager.selfSign is not implemented")};IdentityManager.certificateNameToPublicKeyName=function(certificateName){var i=certificateName.size()-1;var idString="ID-CERT";while(i>=0){if(certificateName.get(i).toEscapedString()==idString)break;--i}var tmpName=certificateName.getSubName(0,i);var keyString="KEY";i=0;while(i<tmpName.size()){if(tmpName.get(i).toEscapedString()==keyString)break;++i}return tmpName.getSubName(0,i).append(tmpName.getSubName(i+1,tmpName.size()-i-1))}}).call(this,require("buffer").Buffer)},{"../../data.js":132,"../../encoding/wire-format.js":148,"../../key-locator.js":155,"../../name.js":159,"../../sha256-with-rsa-signature.js":177,"../security-exception.js":175,buffer:3}],165:[function(require,module,exports){var Name=require("../../name.js").Name;var SecurityException=require("../security-exception.js").SecurityException;var IdentityStorage=function IdentityStorage(){};exports.IdentityStorage=IdentityStorage;IdentityStorage.prototype.doesIdentityExist=function(identityName){throw new Error("IdentityStorage.doesIdentityExist is not implemented")};IdentityStorage.prototype.addIdentity=function(identityName){throw new Error("IdentityStorage.addIdentity is not implemented")};IdentityStorage.prototype.revokeIdentity=function(){throw new Error("IdentityStorage.revokeIdentity is not implemented")};IdentityStorage.prototype.getNewKeyName=function(identityName,useKsk){var ti=(new Date).getTime();var seconds=""+Math.floor(ti/1e3);var keyIdStr;if(useKsk)keyIdStr="KSK-"+seconds;else keyIdStr="DSK-"+seconds;var keyName=new Name(identityName).append(keyIdStr);if(this.doesKeyExist(keyName))throw new SecurityException(new Error("Key name already exists"));return keyName};IdentityStorage.prototype.doesKeyExist=function(keyName){throw new Error("IdentityStorage.doesKeyExist is not implemented")};IdentityStorage.prototype.addKey=function(keyName,keyType,publicKeyDer){throw new Error("IdentityStorage.addKey is not implemented")};IdentityStorage.prototype.getKey=function(keyName){throw new Error("IdentityStorage.getKey is not implemented")};IdentityStorage.prototype.getKeyType=function(keyName){throw new Error("IdentityStorage.getKeyType is not implemented")};IdentityStorage.prototype.activateKey=function(keyName){throw new Error("IdentityStorage.activateKey is not implemented")};IdentityStorage.prototype.deactivateKey=function(keyName){throw new Error("IdentityStorage.deactivateKey is not implemented")};IdentityStorage.prototype.doesCertificateExist=function(certificateName){throw new Error("IdentityStorage.doesCertificateExist is not implemented")};IdentityStorage.prototype.addCertificate=function(certificate){throw new Error("IdentityStorage.addCertificate is not implemented")};IdentityStorage.prototype.getCertificate=function(certificateName,allowAny){throw new Error("IdentityStorage.getCertificate is not implemented")};IdentityStorage.prototype.getDefaultIdentity=function(){throw new Error("IdentityStorage.getDefaultIdentity is not implemented")};IdentityStorage.prototype.getDefaultKeyNameForIdentity=function(identityName){throw new Error("IdentityStorage.getDefaultKeyNameForIdentity is not implemented")};IdentityStorage.prototype.getDefaultCertificateNameForIdentity=function(identityName){var keyName=this.getDefaultKeyNameForIdentity(identityName);return this.getDefaultCertificateNameForKey(keyName)};IdentityStorage.prototype.getDefaultCertificateNameForKey=function(keyName){throw new Error("IdentityStorage.getDefaultCertificateNameForKey is not implemented")};IdentityStorage.prototype.setDefaultIdentity=function(identityName){throw new Error("IdentityStorage.setDefaultIdentity is not implemented")};IdentityStorage.prototype.setDefaultKeyNameForIdentity=function(keyName,identityNameCheck){throw new Error("IdentityStorage.setDefaultKeyNameForIdentity is not implemented")};IdentityStorage.prototype.setDefaultCertificateNameForKey=function(keyName,certificateName){throw new Error("IdentityStorage.setDefaultCertificateNameForKey is not implemented")}},{"../../name.js":159,"../security-exception.js":175}],166:[function(require,module,exports){var Data=require("../../data.js").Data;var Name=require("../../name.js").Name;var Blob=require("../../util/blob.js").Blob;var KeyType=require("../security-types.js").KeyType;var DataUtils=require("../../encoding/data-utils.js").DataUtils;var SecurityException=require("../security-exception.js").SecurityException;var IdentityStorage=require("./identity-storage.js").IdentityStorage;var MemoryIdentityStorage=function MemoryIdentityStorage(){IdentityStorage.call(this);this.identityStore=[];this.defaultIdentity="";this.keyStore={};this.certificateStore={}};MemoryIdentityStorage.prototype=new IdentityStorage;MemoryIdentityStorage.prototype.name="MemoryIdentityStorage";exports.MemoryIdentityStorage=MemoryIdentityStorage;MemoryIdentityStorage.prototype.doesIdentityExist=function(identityName){return this.identityStore[identityName.toUri()]!==undefined};MemoryIdentityStorage.prototype.addIdentity=function(identityName){var identityUri=identityName.toUri();if(this.identityStore.indexOf(identityUri)>=0)throw new SecurityException(new Error("Identity already exists: "+identityUri));this.identityStore.push(identityUri)};MemoryIdentityStorage.prototype.revokeIdentity=function(){throw new Error("MemoryIdentityStorage.revokeIdentity is not implemented")};MemoryIdentityStorage.prototype.doesKeyExist=function(keyName){return this.keyStore[keyName.toUri()]!==undefined};MemoryIdentityStorage.prototype.addKey=function(keyName,keyType,publicKeyDer){var identityName=keyName.getSubName(0,keyName.size()-1);if(!this.doesIdentityExist(identityName))this.addIdentity(identityName);if(this.doesKeyExist(keyName))throw new SecurityException(new Error("A key with the same name already exists!"));this.keyStore[keyName.toUri()]={keyType:keyType,keyDer:new Blob(publicKeyDer)}};MemoryIdentityStorage.prototype.getKey=function(keyName){var keyNameUri=keyName.toUri();var entry=this.keyStore[keyNameUri];if(entry===undefined)return new Blob;return entry.keyDer};MemoryIdentityStorage.prototype.getKeyType=function(keyName){var keyNameUri=keyName.toUri();var entry=this.keyStore[keyNameUri];if(entry===undefined)throw new SecurityException(new Error("Cannot get public key type because the keyName doesn't exist"));return entry.keyType};MemoryIdentityStorage.prototype.activateKey=function(keyName){throw new Error("MemoryIdentityStorage.activateKey is not implemented")};MemoryIdentityStorage.prototype.deactivateKey=function(keyName){throw new Error("MemoryIdentityStorage.deactivateKey is not implemented")};MemoryIdentityStorage.prototype.doesCertificateExist=function(certificateName){return this.certificateStore[certificateName.toUri()]!==undefined};MemoryIdentityStorage.prototype.addCertificate=function(certificate){var certificateName=certificate.getName();var keyName=certificate.getPublicKeyName();if(!this.doesKeyExist(keyName))throw new SecurityException(new Error("No corresponding Key record for certificate! "+keyName.toUri()+" "+certificateName.toUri()));if(this.doesCertificateExist(certificateName))throw new SecurityException(new Error("Certificate has already been installed!"));var keyBlob=getKey(keyName);if(keyBlob.isNull()||!DataUtils.arraysEqual(keyBlob.buf(),certificate.getPublicKeyInfo().getKeyDer().buf()))throw new SecurityException(new Error("The certificate does not match the public key!"));this.certificateStore[certificateName.toUri()]=certificate.wireEncode()};MemoryIdentityStorage.prototype.getCertificate=function(certificateName,allowAny){var certificateNameUri=certificateName.toUri();if(this.certificateStore[certificateNameUri]===undefined)return null;var data=new Data;data.wireDecode(this.certificateStore[certificateNameUri]);return data};MemoryIdentityStorage.prototype.getDefaultIdentity=function(){if(this.defaultIdentity.length===0)throw new SecurityException(new Error("MemoryIdentityStorage.getDefaultIdentity: The default identity is not defined"));return new Name(this.defaultIdentity)};MemoryIdentityStorage.prototype.getDefaultKeyNameForIdentity=function(identityName){throw new Error("MemoryIdentityStorage.getDefaultKeyNameForIdentity is not implemented")};MemoryIdentityStorage.prototype.getDefaultCertificateNameForKey=function(keyName){throw new Error("MemoryIdentityStorage.getDefaultCertificateNameForKey is not implemented")};MemoryIdentityStorage.prototype.setDefaultIdentity=function(identityName){var identityUri=identityName.toUri();if(this.identityStore[identityUri]!==undefined)this.defaultIdentity=identityUri;else this.defaultIdentity=""};MemoryIdentityStorage.prototype.setDefaultKeyNameForIdentity=function(keyName,identityNameCheck){throw new Error("MemoryIdentityStorage.setDefaultKeyNameForIdentity is not implemented")};MemoryIdentityStorage.prototype.setDefaultCertificateNameForKey=function(keyName,certificateName){throw new Error("MemoryIdentityStorage.setDefaultCertificateNameForKey is not implemented")}},{"../../data.js":132,"../../encoding/data-utils.js":137,"../../name.js":159,"../../util/blob.js":184,"../security-exception.js":175,"../security-types.js":176,"./identity-storage.js":165}],167:[function(require,module,exports){(function(Buffer){var Blob=require("../../util/blob.js").Blob;var SecurityException=require("../security-exception.js").SecurityException;var PublicKey=require("../certificate/public-key.js").PublicKey;var KeyClass=require("../security-types.js").KeyClass;var DigestAlgorithm=require("../security-types.js").DigestAlgorithm;var DataUtils=require("../../encoding/data-utils.js").DataUtils;var PrivateKeyStorage=require("./private-key-storage.js").PrivateKeyStorage;var MemoryPrivateKeyStorage=function MemoryPrivateKeyStorage(){PrivateKeyStorage.call(this);this.publicKeyStore={};this.privateKeyStore={}};MemoryPrivateKeyStorage.prototype=new PrivateKeyStorage;MemoryPrivateKeyStorage.prototype.name="MemoryPrivateKeyStorage";exports.MemoryPrivateKeyStorage=MemoryPrivateKeyStorage;MemoryPrivateKeyStorage.prototype.setPublicKeyForKeyName=function(keyName,keyType,publicKeyDer){this.publicKeyStore[keyName.toUri()]=PublicKey.fromDer(keyType,new Blob(publicKeyDer,true))};MemoryPrivateKeyStorage.prototype.setPrivateKeyForKeyName=function(keyName,keyType,privateKeyDer){var keyBase64=privateKeyDer.toString("base64");var keyPem="-----BEGIN RSA PRIVATE KEY-----\n";for(var i=0;i<keyBase64.length;i+=64)keyPem+=keyBase64.substr(i,64)+"\n";keyPem+="-----END RSA PRIVATE KEY-----";this.privateKeyStore[keyName.toUri()]={keyType:keyType,privateKey:keyPem}};MemoryPrivateKeyStorage.prototype.setKeyPairForKeyName=function(keyName,keyType,publicKeyDer,privateKeyDer){this.setPublicKeyForKeyName(keyName,keyType,publicKeyDer);this.setPrivateKeyForKeyName(keyName,keyType,privateKeyDer)};MemoryPrivateKeyStorage.prototype.getPublicKey=function(keyName){var keyNameUri=keyName.toUri();var publicKey=this.publicKeyStore[keyNameUri];if(publicKey===undefined)throw new SecurityException(new Error("MemoryPrivateKeyStorage: Cannot find public key "+keyName.toUri()));return publicKey};MemoryPrivateKeyStorage.prototype.sign=function(data,keyName,digestAlgorithm){if(digestAlgorithm==null)digestAlgorithm=DigestAlgorithm.SHA256;if(digestAlgorithm!=DigestAlgorithm.SHA256)return new Blob;var keyUri=keyName.toUri();var privateKey=this.privateKeyStore[keyUri];if(privateKey===undefined)throw new SecurityException(new Error("MemoryPrivateKeyStorage: Cannot find private key "+keyUri));var rsa=require("crypto").createSign("RSA-SHA256");rsa.update(data);var signature=new Buffer(DataUtils.toNumbersIfString(rsa.sign(privateKey.privateKey)));return new Blob(signature,false)};MemoryPrivateKeyStorage.prototype.doesKeyExist=function(keyName,keyClass){var keyUri=keyName.toUri();if(keyClass==KeyClass.PUBLIC)return this.publicKeyStore[keyUri]!==undefined;else if(keyClass==KeyClass.PRIVATE)return this.privateKeyStore[keyUri]!==undefined;else return false}}).call(this,require("buffer").Buffer)},{"../../encoding/data-utils.js":137,"../../util/blob.js":184,"../certificate/public-key.js":163,"../security-exception.js":175,"../security-types.js":176,"./private-key-storage.js":168,buffer:3,crypto:9}],168:[function(require,module,exports){var PrivateKeyStorage=function PrivateKeyStorage(){};exports.PrivateKeyStorage=PrivateKeyStorage;PrivateKeyStorage.prototype.generateKeyPair=function(keyName,keyType,keySize){throw new Error("PrivateKeyStorage.generateKeyPair is not implemented")};PrivateKeyStorage.prototype.getPublicKey=function(keyName){throw new Error("PrivateKeyStorage.getPublicKey is not implemented")};PrivateKeyStorage.prototype.sign=function(data,keyName,digestAlgorithm){throw new Error("PrivateKeyStorage.sign is not implemented")};PrivateKeyStorage.prototype.decrypt=function(keyName,data,isSymmetric){throw new Error("PrivateKeyStorage.decrypt is not implemented")};PrivateKeyStorage.prototype.encrypt=function(keyName,data,isSymmetric){throw new Error("PrivateKeyStorage.encrypt is not implemented")};PrivateKeyStorage.prototype.generateKey=function(keyName,keyType,keySize){throw new Error("PrivateKeyStorage.generateKey is not implemented")};PrivateKeyStorage.prototype.doesKeyExist=function(keyName,keyClass){throw new Error("PrivateKeyStorage.doesKeyExist is not implemented")}},{}],169:[function(require,module,exports){var Name=require("../name.js").Name;var Interest=require("../interest.js").Interest;var Data=require("../data.js").Data;var KeyLocatorType=require("../key-locator.js").KeyLocatorType;var Sha256WithRsaSignature=require("../sha256-with-rsa-signature.js").Sha256WithRsaSignature;var WireFormat=require("../encoding/wire-format.js").WireFormat;var Tlv=require("../encoding/tlv/tlv.js").Tlv;var TlvEncoder=require("../encoding/tlv/tlv-encoder.js").TlvEncoder;var SecurityException=require("./security-exception.js").SecurityException;var KeyChain=function KeyChain(identityManager,policyManager){this.identityManager=identityManager;this.policyManager=policyManager;this.encryptionManager=null;this.face=null;this.maxSteps=100};exports.KeyChain=KeyChain;KeyChain.prototype.createIdentity=function(identityName){return this.identityManager.createIdentity(identityName)};KeyChain.prototype.getDefaultIdentity=function(){return this.identityManager.getDefaultIdentity()};KeyChain.prototype.getDefaultCertificateName=function(){return this.identityManager.getDefaultCertificateName()};KeyChain.prototype.generateRSAKeyPair=function(identityName,isKsk,keySize){return this.identityManager.generateRSAKeyPair(identityName,isKsk,keySize)};KeyChain.prototype.setDefaultKeyForIdentity=function(keyName,identityName){if(identityName==null)identityName=new Name;return this.identityManager.setDefaultKeyForIdentity(keyName,identityName)};KeyChain.prototype.generateRSAKeyPairAsDefault=function(identityName,isKsk,keySize){return this.identityManager.generateRSAKeyPairAsDefault(identityName,isKsk,keySize)};KeyChain.prototype.createSigningRequest=function(keyName){return this.identityManager.getPublicKey(keyName).getKeyDer()};KeyChain.prototype.installIdentityCertificate=function(certificate){this.identityManager.addCertificate(certificate)};KeyChain.prototype.setDefaultCertificateForKey=function(certificate){this.identityManager.setDefaultCertificateForKey(certificate)};KeyChain.prototype.getCertificate=function(certificateName){return this.identityManager.getCertificate(certificateName)};KeyChain.prototype.getAnyCertificate=function(certificateName){return this.identityManager.getAnyCertificate(certificateName)};KeyChain.prototype.getIdentityCertificate=function(certificateName){return this.identityManager.getCertificate(certificateName)};KeyChain.prototype.getAnyIdentityCertificate=function(certificateName){return this.identityManager.getAnyCertificate(certificateName)};KeyChain.prototype.revokeKey=function(keyName){};KeyChain.prototype.revokeCertificate=function(certificateName){};KeyChain.prototype.getIdentityManager=function(){return this.identityManager};KeyChain.prototype.getPolicyManager=function(){return this.policyManager};KeyChain.prototype.sign=function(target,certificateName,wireFormat){if(target instanceof Interest)this.signInterest(target,certificateName,wireFormat);else if(target instanceof Data)this.identityManager.signByCertificate(target,certificateName,wireFormat);else return this.identityManager.signByCertificate(target,certificateName)};KeyChain.prototype.signInterest=function(interest,certificateName,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var signature=new Sha256WithRsaSignature;signature.getKeyLocator().setType(KeyLocatorType.KEYNAME);signature.getKeyLocator().setKeyName(certificateName.getPrefix(-1));interest.getName().append(wireFormat.encodeSignatureInfo(signature));interest.getName().append(new Name.Component);var encoding=interest.wireEncode(wireFormat);var signedSignature=this.sign(encoding.signedBuf(),certificateName);var encoder=new TlvEncoder(256);encoder.writeBlobTlv(Tlv.SignatureValue,signedSignature.getSignature().buf());interest.setName(interest.getName().getPrefix(-1).append(wireFormat.encodeSignatureValue(signedSignature)))};KeyChain.prototype.signByIdentity=function(target,identityName,wireFormat){if(identityName==null)identityName=new Name;if(target instanceof Data){var signingCertificateName;if(identityName.size()==0){var inferredIdentity=this.policyManager.inferSigningIdentity(data.getName());if(inferredIdentity.size()==0)signingCertificateName=this.identityManager.getDefaultCertificateName();else signingCertificateName=this.identityManager.getDefaultCertificateNameForIdentity(inferredIdentity)}else signingCertificateName=this.identityManager.getDefaultCertificateNameForIdentity(identityName);if(signingCertificateName.size()==0)throw new SecurityException(new Error("No qualified certificate name found!"));if(!this.policyManager.checkSigningPolicy(data.getName(),signingCertificateName))throw new SecurityException(new Error("Signing Cert name does not comply with signing policy"));this.identityManager.signByCertificate(data,signingCertificateName,wireFormat)}else{var signingCertificateName=this.identityManager.getDefaultCertificateNameForIdentity(identityName);if(signingCertificateName.size()==0)throw new SecurityException(new Error("No qualified certificate name found!"));return this.identityManager.signByCertificate(array,signingCertificateName)}};KeyChain.prototype.verifyData=function(data,onVerified,onVerifyFailed,stepCount){if(this.policyManager.requireVerify(data)){var nextStep=this.policyManager.checkVerificationPolicy(data,stepCount,onVerified,onVerifyFailed);if(nextStep!=null){var thisKeyChain=this;this.face.expressInterest(nextStep.interest,function(callbackInterest,callbackData){thisKeyChain.onCertificateData(callbackInterest,callbackData,nextStep)},function(callbackInterest){thisKeyChain.onCertificateInterestTimeout(callbackInterest,nextStep.retry,onVerifyFailed,data,nextStep)})}}else if(this.policyManager.skipVerifyAndTrust(data))onVerified(data);else onVerifyFailed(data)};KeyChain.prototype.verifyInterest=function(interest,onVerified,onVerifyFailed,stepCount,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();if(this.policyManager.requireVerify(interest)){var nextStep=this.policyManager.checkVerificationPolicy(interest,stepCount,onVerified,onVerifyFailed,wireFormat);if(nextStep!=null){throw new SecurityException(new Error("verifyInterest: ValidationRequest not implemented yet"))}}else if(this.policyManager.skipVerifyAndTrust(interest))onVerified(interest);else onVerifyFailed(interest)};KeyChain.prototype.generateSymmetricKey=function(keyName,keyType){this.encryptionManager.createSymmetricKey(keyName,keyType)};KeyChain.prototype.encrypt=function(keyName,data,useSymmetric,encryptMode){return this.encryptionManager.encrypt(keyName,data,useSymmetric,encryptMode)};KeyChain.prototype.decrypt=function(keyName,data,useSymmetric,encryptMode){return this.encryptionManager.decrypt(keyName,data,useSymmetric,encryptMode)};KeyChain.prototype.setFace=function(face){this.face=face};KeyChain.prototype.onCertificateData=function(interest,data,nextStep){this.verifyData(data,nextStep.onVerified,nextStep.onVerifyFailed,nextStep.stepCount)};KeyChain.prototype.onCertificateInterestTimeout=function(interest,retry,onVerifyFailed,data,nextStep){if(retry>0){var thisKeyChain=this;this.face.expressInterest(interest,function(callbackInterest,callbackData){thisKeyChain.onCertificateData(callbackInterest,callbackData,nextStep)},function(callbackInterest){thisKeyChain.onCertificateInterestTimeout(callbackInterest,retry-1,onVerifyFailed,data,nextStep)})}else onVerifyFailed(data)}},{"../data.js":132,"../encoding/tlv/tlv-encoder.js":145,"../encoding/tlv/tlv.js":147,"../encoding/wire-format.js":148,"../interest.js":154,"../key-locator.js":155,"../name.js":159,"../sha256-with-rsa-signature.js":177,"./security-exception.js":175}],170:[function(require,module,exports){var Key=require("../key.js").Key;var KeyManager=function KeyManager(){this.publicKey="-----BEGIN PUBLIC KEY-----\n"+"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuAmnWYKE7E8G+hyy4TiT\n"+"U7t91KyIGvglEeT6HWEkW4LKzXLO22a1jVS9+yP96I6vp7N5vpS1t7oXtgWuzkO+\n"+"O85u6gfbvwp+67zJe2I89eHO4dmNnP4fx/j7WcCUCyzZfbyW67h5IoouoBIdQge2\n"+"Xdvh9rFdex9UUhyjEZv5676zlcqlhz8xGBrJmQHsqpD9ijY1XhKBvoSIoQ0ZKkpm\n"+"wVk8QYM9PbjUqzSQBj4aYXS+BPV6aRudVvyDt2DBXp2FNP0CGrosCXKnSl4Yv8BY\n"+"p0k0RmFZDuJuntLb/XIvPEfMX5li7g3zHzAlIJIVSwT+FRkd3H5cECFSIZFUYIuS\n"+"QQIDAQAB\n"+"-----END PUBLIC KEY-----";this.privateKey="-----BEGIN RSA PRIVATE KEY-----\n"+"MIIEpQIBAAKCAQEAuAmnWYKE7E8G+hyy4TiTU7t91KyIGvglEeT6HWEkW4LKzXLO\n"+"22a1jVS9+yP96I6vp7N5vpS1t7oXtgWuzkO+O85u6gfbvwp+67zJe2I89eHO4dmN\n"+"nP4fx/j7WcCUCyzZfbyW67h5IoouoBIdQge2Xdvh9rFdex9UUhyjEZv5676zlcql\n"+"hz8xGBrJmQHsqpD9ijY1XhKBvoSIoQ0ZKkpmwVk8QYM9PbjUqzSQBj4aYXS+BPV6\n"+"aRudVvyDt2DBXp2FNP0CGrosCXKnSl4Yv8BYp0k0RmFZDuJuntLb/XIvPEfMX5li\n"+"7g3zHzAlIJIVSwT+FRkd3H5cECFSIZFUYIuSQQIDAQABAoIBAQCKBftzfxavn6lM\n"+"5T8m+GZN0vzRBsBg8Z/jpsYKSLOayiHNKYCIPaSFpXuCIYEo6/JDJLB2xVLvwupL\n"+"gkGSwm2mrvCyJkihI38Cz6iQF6I+iia9bYrupgwxzsK7klm1c+J9kXXivYxj4hyL\n"+"wmoc/mnARMtYV7cTQvDbUEzgRQmPykWKBv6Y0SL1WprfiRfKIMwSqQk91ffj6whK\n"+"xBLAuUdseVBmo/ivLPq0a+wDrcvaJAxSB4eIwCHzAugkRA/NoK0vG3mra0lK5jvQ\n"+"rcNIuffxNAnresDVDTnYRc42etjePLAhlpeK/4sjYE/wPdeP8yzLHUg/hsSpAPIj\n"+"LXJNZqUBAoGBANxPmUQNf1lGHo/nLY3dVMD3+kYNnTUD8XwS81qdg8/dNyF8t+7D\n"+"OdJ1j7Itb+zGA1XXAGfTm6JoUG+eKKR2OSuyZcxygpOgzxAFanXKhTWZsKbG70xN\n"+"mX0sOAEhtTGsgFTEGEv977MwIlFa6n2bsp3Luj/AGmvNsOYvBDPXOklxAoGBANXZ\n"+"yXAaE7M5JALusLuEFxLGvWVz6TRdQ//c+FWvKrnh+nFlTlAPpDvlaPJJca8ViNev\n"+"xJ2UhGtbENXAqgwTYpnAi/yQD4dATViIveK6Pn4t12mpPAlkMbbMTR8jtp5l1oHc\n"+"hcwe8QuEOKuTX5+STpNGlWs+tsMb12mhCpc3eO3RAoGAMxjDE2WOA8afkACuMBkF\n"+"bzwUb+r4azNe7sf2aS3fRHaqMroabuYYoxdhHJItQ10pqN8U2P/bOO+4uCqWgo5o\n"+"9BmMQr7MSjEh1TVsW6V8/9GFhyjcl3XoA4Ad/SU0QTEhEofomrdqwMSJMRVFDZzu\n"+"8Gov6FlFx3sNbFW7Q8rHWgECgYEAq/TVz3iIgsLdvCXmosHSM9zvCpcr3FlqhmFO\n"+"pseVmaamVWxajnIlY6xSuRBpg5nTUWwas4Nq/1BYtyiXE+K6lFuJtOq6Mc145EoA\n"+"NkIAYkHGR0Y36m1QtGaPVQzImZHV7NJAHCR9Ov90+jIk4BErca1+FKB3IWhPzLYb\n"+"6ABJEyECgYEAthhzWSxPkqyiLl+2vnhdR3EEkvDX6MV6hGu4tDAf2A1Y0GSApyEa\n"+"SAA31hlxu5EgneLD7Ns2HMpIfQMydB5lcwKQc9g/tVI1eRzuk6Myi+2JmPEM2BLy\n"+"iX8yI+xnZlKDiZleQitCS4RQGz5HbXT70aYQIGxuvkQ/uf68jdrL6o8=\n"+"-----END RSA PRIVATE KEY-----";this.key=null};KeyManager.prototype.getKey=function(){if(this.key===null){this.key=new Key;this.key.fromPemString(this.publicKey,this.privateKey)}return this.key};var globalKeyManager=globalKeyManager||new KeyManager;exports.globalKeyManager=globalKeyManager},{"../key.js":156}],171:[function(require,module,exports){var Name=require("../../name.js").Name;var PolicyManager=require("./policy-manager.js").PolicyManager;var NoVerifyPolicyManager=function NoVerifyPolicyManager(){PolicyManager.call(this)};NoVerifyPolicyManager.prototype=new PolicyManager;NoVerifyPolicyManager.prototype.name="NoVerifyPolicyManager";exports.NoVerifyPolicyManager=NoVerifyPolicyManager;NoVerifyPolicyManager.prototype.skipVerifyAndTrust=function(dataOrInterest){return true};NoVerifyPolicyManager.prototype.requireVerify=function(dataOrInterest){return false};NoVerifyPolicyManager.prototype.checkVerificationPolicy=function(dataOrInterest,stepCount,onVerified,onVerifyFailed,wireFormat){onVerified(dataOrInterest);return null};NoVerifyPolicyManager.prototype.checkSigningPolicy=function(dataName,certificateName){return true};NoVerifyPolicyManager.prototype.inferSigningIdentity=function(dataName){return new Name}},{"../../name.js":159,"./policy-manager.js":172}],172:[function(require,module,exports){var PolicyManager=function PolicyManager(){};exports.PolicyManager=PolicyManager;PolicyManager.prototype.skipVerifyAndTrust=function(dataOrInterest){throw new Error("PolicyManager.skipVerifyAndTrust is not implemented")};PolicyManager.prototype.requireVerify=function(dataOrInterest){throw new Error("PolicyManager.requireVerify is not implemented")};PolicyManager.prototype.checkVerificationPolicy=function(dataOrInterest,stepCount,onVerified,onVerifyFailed,wireFormat){throw new Error("PolicyManager.checkVerificationPolicy is not implemented")};PolicyManager.prototype.checkSigningPolicy=function(dataName,certificateName){throw new Error("PolicyManager.checkSigningPolicy is not implemented")};PolicyManager.prototype.inferSigningIdentity=function(dataName){throw new Error("PolicyManager.inferSigningIdentity is not implemented")}},{}],173:[function(require,module,exports){var Name=require("../../name.js").Name;var Interest=require("../../interest.js").Interest;var Data=require("../../data.js").Data;var DataUtils=require("../../encoding/data-utils.js").DataUtils;var IdentityCertificate=require("../certificate/identity-certificate.js").IdentityCertificate;var KeyLocatorType=require("../../key-locator.js").KeyLocatorType;var SecurityException=require("../security-exception.js").SecurityException;var WireFormat=require("../../encoding/wire-format.js").WireFormat;var PolicyManager=require("./policy-manager.js").PolicyManager;var SelfVerifyPolicyManager=function SelfVerifyPolicyManager(identityStorage){PolicyManager.call(this);this.identityStorage=identityStorage};SelfVerifyPolicyManager.prototype=new PolicyManager;SelfVerifyPolicyManager.prototype.name="SelfVerifyPolicyManager";exports.SelfVerifyPolicyManager=SelfVerifyPolicyManager;SelfVerifyPolicyManager.prototype.skipVerifyAndTrust=function(dataOrInterest){return false};SelfVerifyPolicyManager.prototype.requireVerify=function(dataOrInterest){return true};SelfVerifyPolicyManager.prototype.checkVerificationPolicy=function(dataOrInterest,stepCount,onVerified,onVerifyFailed,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();if(dataOrInterest instanceof Data){var data=dataOrInterest;if(this.verify(data.getSignature(),data.wireEncode()))onVerified(data);else onVerifyFailed(data)}else if(dataOrInterest instanceof Interest){var interest=dataOrInterest;var signature=wireFormat.decodeSignatureInfoAndValue(interest.getName().get(-2).getValue().buf(),interest.getName().get(-1).getValue().buf());if(this.verify(signature,interest.wireEncode()))onVerified(interest);else onVerifyFailed(interest)}else throw new SecurityException(new Error("checkVerificationPolicy: unrecognized type for dataOrInterest"));return null};SelfVerifyPolicyManager.prototype.checkSigningPolicy=function(dataName,certificateName){return true};SelfVerifyPolicyManager.prototype.inferSigningIdentity=function(dataName){return new Name};SelfVerifyPolicyManager.prototype.verify=function(signatureInfo,signedBlob){var signature=signatureInfo;if(signature.getKeyLocator().getType()==KeyLocatorType.KEY)return SelfVerifyPolicyManager.verifySha256WithRsaSignature(signature,signedBlob,signature.getKeyLocator().getKeyData());else if(signature.getKeyLocator().getType()==KeyLocatorType.KEYNAME&&this.identityStorage!=null){var publicKeyDer=this.identityStorage.getKey(IdentityCertificate.certificateNameToPublicKeyName(signature.getKeyLocator().getKeyName()));if(publicKeyDer.isNull())return false;return SelfVerifyPolicyManager.verifySha256WithRsaSignature(signature,signedBlob,publicKeyDer)}else return false};SelfVerifyPolicyManager.verifyUsesString=null;SelfVerifyPolicyManager.verifySha256WithRsaSignature=function(signature,signedBlob,publicKeyDer){if(SelfVerifyPolicyManager.verifyUsesString===null){var hashResult=require("crypto").createHash("sha256").digest();SelfVerifyPolicyManager.verifyUsesString=typeof hashResult==="string"}var keyBase64=publicKeyDer.buf().toString("base64");var keyPem="-----BEGIN PUBLIC KEY-----\n";for(var i=0;i<keyBase64.length;i+=64)keyPem+=keyBase64.substr(i,64)+"\n";keyPem+="-----END PUBLIC KEY-----";var verifier=require("crypto").createVerify("RSA-SHA256");verifier.update(signedBlob.signedBuf());var signatureBytes=Data.verifyUsesString?DataUtils.toString(signature.getSignature().buf()):signature.getSignature().buf();return verifier.verify(keyPem,signatureBytes)}},{"../../data.js":132,"../../encoding/data-utils.js":137,"../../encoding/wire-format.js":148,"../../interest.js":154,"../../key-locator.js":155,"../../name.js":159,"../certificate/identity-certificate.js":162,"../security-exception.js":175,"./policy-manager.js":172,crypto:9}],174:[function(require,module,exports){var ValidationRequest=function ValidationRequest(interest,onVerified,onVerifyFailed,retry,stepCount){this.interest=interest;this.onVerified=onVerified;this.onVerifyFailed=onVerifyFailed;this.retry=retry;this.stepCount=stepCount};exports.ValidationRequest=ValidationRequest},{}],175:[function(require,module,exports){function SecurityException(error){this.message=error.message;for(var prop in error)this[prop]=error[prop]}SecurityException.prototype=new Error;SecurityException.prototype.name="SecurityException";exports.SecurityException=SecurityException},{}],176:[function(require,module,exports){var KeyType=function KeyType(){};exports.KeyType=KeyType;KeyType.RSA=0;KeyType.AES=1;KeyType.EC=2;var KeyClass=function KeyClass(){};exports.KeyClass=KeyClass;KeyClass.PUBLIC=1;KeyClass.PRIVATE=2;KeyClass.SYMMETRIC=3;var DigestAlgorithm=function DigestAlgorithm(){};exports.DigestAlgorithm=DigestAlgorithm;DigestAlgorithm.SHA256=1;var EncryptMode=function EncryptMode(){};exports.EncryptMode=EncryptMode;EncryptMode.DEFAULT=1;EncryptMode.CFB_AES=2},{}],177:[function(require,module,exports){(function(Buffer){var Blob=require("./util/blob.js").Blob;var BinaryXMLEncoder=require("./encoding/binary-xml-encoder.js").BinaryXMLEncoder;var BinaryXMLDecoder=require("./encoding/binary-xml-decoder.js").BinaryXMLDecoder;var NDNProtocolDTags=require("./util/ndn-protoco-id-tags.js").NDNProtocolDTags;var KeyLocator=require("./key-locator.js").KeyLocator;var LOG=require("./log.js").Log.LOG;var Sha256WithRsaSignature=function Sha256WithRsaSignature(value){if(typeof value==="object"&&value instanceof Sha256WithRsaSignature){this.keyLocator=new KeyLocator(value.keyLocator);this.signature=value.signature;this.witness=value.witness;this.digestAlgorithm=value.digestAlgorithm}else{this.keyLocator=new KeyLocator;this.signature=null;this.witness=null;this.digestAlgorithm=null}};exports.Sha256WithRsaSignature=Sha256WithRsaSignature;Sha256WithRsaSignature.prototype.clone=function(){return new Sha256WithRsaSignature(this)};Sha256WithRsaSignature.prototype.getKeyLocator=function(){return this.keyLocator};Sha256WithRsaSignature.prototype.getSignature=function(){return new Blob(this.signature,false)};Sha256WithRsaSignature.prototype.getSignatureAsBuffer=function(){return this.signature};Sha256WithRsaSignature.prototype.setKeyLocator=function(keyLocator){this.keyLocator=typeof keyLocator==="object"&&keyLocator instanceof KeyLocator?new KeyLocator(keyLocator):new KeyLocator
};Sha256WithRsaSignature.prototype.setSignature=function(signature){if(signature==null)this.signature=null;else if(typeof signature==="object"&&signature instanceof Blob)this.signature=new Buffer(signature.buf());else this.signature=new Buffer(signature)};Sha256WithRsaSignature.prototype.from_ndnb=function(decoder){decoder.readElementStartDTag(this.getElementLabel());if(LOG>4)console.log("STARTED DECODING SIGNATURE");if(decoder.peekDTag(NDNProtocolDTags.DigestAlgorithm)){if(LOG>4)console.log("DIGIEST ALGORITHM FOUND");this.digestAlgorithm=decoder.readUTF8DTagElement(NDNProtocolDTags.DigestAlgorithm)}if(decoder.peekDTag(NDNProtocolDTags.Witness)){if(LOG>4)console.log("WITNESS FOUND");this.witness=decoder.readBinaryDTagElement(NDNProtocolDTags.Witness)}if(LOG>4)console.log("SIGNATURE FOUND");this.signature=decoder.readBinaryDTagElement(NDNProtocolDTags.SignatureBits);decoder.readElementClose()};Sha256WithRsaSignature.prototype.to_ndnb=function(encoder){if(!this.validate())throw new Error("Cannot encode: field values missing.");encoder.writeElementStartDTag(this.getElementLabel());if(null!=this.digestAlgorithm&&!this.digestAlgorithm.equals(NDNDigestHelper.DEFAULT_DIGEST_ALGORITHM))encoder.writeDTagElement(NDNProtocolDTags.DigestAlgorithm,OIDLookup.getDigestOID(this.DigestAlgorithm));if(null!=this.witness)encoder.writeDTagElement(NDNProtocolDTags.Witness,this.witness);encoder.writeDTagElement(NDNProtocolDTags.SignatureBits,this.signature);encoder.writeElementClose()};Sha256WithRsaSignature.prototype.getElementLabel=function(){return NDNProtocolDTags.Signature};Sha256WithRsaSignature.prototype.validate=function(){return this.getSignature().size()>0};var Signature=function Signature(witnessOrSignatureObject,signature,digestAlgorithm){if(typeof witnessOrSignatureObject==="object"&&witnessOrSignatureObject instanceof Sha256WithRsaSignature)Sha256WithRsaSignature.call(this,witnessOrSignatureObject);else{Sha256WithRsaSignature.call(this);if(witnessOrSignatureObject!=null)this.witness=witnessOrSignatureObject;if(signature!=null)this.signature=signature;if(digestAlgorithm!=null)this.digestAlgorithm=digestAlgorithm}};Signature.prototype=new Sha256WithRsaSignature;exports.Signature=Signature}).call(this,require("buffer").Buffer)},{"./encoding/binary-xml-decoder.js":133,"./encoding/binary-xml-encoder.js":134,"./key-locator.js":155,"./log.js":157,"./util/blob.js":184,"./util/ndn-protoco-id-tags.js":189,buffer:3}],178:[function(require,module,exports){var DigestTree=require("./digest-tree.js").DigestTree;var Interest=require("../interest.js").Interest;var Data=require("../data.js").Data;var Name=require("../name.js").Name;var Blob=require("../util/blob.js").Blob;var MemoryContentCache=require("../util/memory-content-cache.js").MemoryContentCache;var ChronoSync2013=function ChronoSync2013(arg1,arg2,applicationDataPrefix,applicationBroadcastPrefix,sessionNo,face,keyChain,certificateName,syncLifetime,arg10){this.onReceivedSyncState=arg1;this.onInitialized=arg2;this.applicationDataPrefixUri=applicationDataPrefix.toUri();this.applicationBroadcastPrefix=applicationBroadcastPrefix;this.session=sessionNo;this.face=face;this.keyChain=keyChain;this.certificateName=certificateName;this.sync_lifetime=syncLifetime;this.usrseq=-1;this.digest_tree=new DigestTree;this.contentCache=new MemoryContentCache(face);this.pendingInterestTable=[];this.digest_log=new Array;this.digest_log.push(new ChronoSync2013.DigestLogEntry("00",[]));this.contentCache.registerPrefix(this.applicationBroadcastPrefix,arg10.bind(this),this.onInterest.bind(this));var interest=new Interest(this.applicationBroadcastPrefix);interest.getName().append("00");interest.setInterestLifetimeMilliseconds(1e3);interest.setAnswerOriginKind(Interest.ANSWER_NO_CONTENT_STORE);this.SyncStateMsg=require("./sync-state.js").SyncStateMsg;this.SyncState=require("./sync-state.js").SyncState;this.face.expressInterest(interest,this.onData.bind(this),this.initialTimeOut.bind(this))};exports.ChronoSync2013=ChronoSync2013;ChronoSync2013.prototype.getProducerSequenceNo=function(dataPrefix,sessionNo){var index=this.digest_tree.find(dataPrefix,sessionNo);if(index<0)return-1;else return this.digest_tree.get(index).getSequenceNo()};ChronoSync2013.prototype.publishNextSequenceNo=function(){this.usrseq++;var content=[new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:this.usrseq,session:this.session}})];var content_t=new this.SyncStateMsg({ss:content});this.broadcastSyncState(this.digest_tree.getRoot(),content_t);if(!this.update(content))console.log("Warning: ChronoSync: update did not create a new digest log entry");var interest=new Interest(this.applicationBroadcastPrefix);interest.getName().append(this.digest_tree.getRoot());interest.setInterestLifetimeMilliseconds(this.sync_lifetime);this.face.expressInterest(interest,this.onData.bind(this),this.syncTimeout.bind(this))};ChronoSync2013.prototype.getSequenceNo=function(){return this.usrseq};ChronoSync2013.DigestLogEntry=function ChronoSync2013DisgestLogEntry(digest,data){this.digest=digest;this.data=data};ChronoSync2013.DigestLogEntry.prototype.getDigest=function(){return this.digest};ChronoSync2013.DigestLogEntry.prototype.getData=function(){return this.data};ChronoSync2013.PendingInterest=function ChronoSync2013PendingInterest(interest,transport){this.interest=interest;this.transport=transport;if(this.interest.getInterestLifetimeMilliseconds()>=0)this.timeoutMilliseconds=(new Date).getTime()+this.interest.getInterestLifetimeMilliseconds();else this.timeoutMilliseconds=-1};ChronoSync2013.PendingInterest.prototype.getInterest=function(){return this.interest};ChronoSync2013.PendingInterest.prototype.getTransport=function(){return this.transport};ChronoSync2013.PendingInterest.prototype.isTimedOut=function(nowMilliseconds){return this.timeoutTimeMilliseconds>=0&&nowMilliseconds>=this.timeoutTimeMilliseconds};ChronoSync2013.SyncState=function ChronoSync2013SyncState(dataPrefixUri,sessionNo,sequenceNo){this.dataPrefixUri_=dataPrefixUri;this.sessionNo_=sessionNo;this.sequenceNo_=sequenceNo};ChronoSync2013.SyncState.prototype.getDataPrefix=function(){return this.dataPrefixUri_};ChronoSync2013.SyncState.prototype.getSessionNo=function(){return this.sessionNo_};ChronoSync2013.SyncState.prototype.getSequenceNo=function(){return this.sequenceNo_};ChronoSync2013.prototype.broadcastSyncState=function(digest,syncMessage){var array=new Uint8Array(syncMessage.toArrayBuffer());var data=new Data(this.applicationBroadcastPrefix);data.getName().append(digest);data.setContent(new Blob(array,false));this.keyChain.sign(data,this.certificateName);this.contentCacheAdd(data)};ChronoSync2013.prototype.update=function(content){for(var i=0;i<content.length;i++){if(content[i].type==0){if(this.digest_tree.update(content[i].name,content[i].seqno.seq,content[i].seqno.session)){if(this.applicationDataPrefixUri==content[i].name)this.usrseq=content[i].seqno.seq}}}if(this.logfind(this.digest_tree.getRoot())==-1){var newlog=new ChronoSync2013.DigestLogEntry(this.digest_tree.getRoot(),content);this.digest_log.push(newlog);return true}else return false};ChronoSync2013.prototype.logfind=function(digest){for(var i=0;i<this.digest_log.length;i++){if(digest==this.digest_log[i].digest)return i}return-1};ChronoSync2013.prototype.onInterest=function(prefix,interest,transport,registerPrefixId){var syncdigest=interest.getName().get(this.applicationBroadcastPrefix.size()).toEscapedString();if(interest.getName().size()==this.applicationBroadcastPrefix.size()+2){syncdigest=interest.getName().get(this.applicationBroadcastPrefix.size()+1).toEscapedString()}if(interest.getName().size()==this.applicationBroadcastPrefix.size()+2||syncdigest=="00"){this.processRecoveryInst(interest,syncdigest,transport)}else{this.pendingInterestTable.push(new ChronoSync2013.PendingInterest(interest,transport));if(syncdigest!=this.digest_tree.getRoot()){var index=this.logfind(syncdigest);var content=[];if(index==-1){var self=this;var timeout=new Interest(new Name("/timeout"));timeout.setInterestLifetimeMilliseconds(2e3);this.face.expressInterest(timeout,this.dummyOnData,this.judgeRecovery.bind(this,timeout,syncdigest,transport))}else{this.processSyncInst(index,syncdigest,transport)}}}};ChronoSync2013.prototype.onData=function(interest,co){var arr=new Uint8Array(co.getContent().size());arr.set(co.getContent().buf());var content_t=this.SyncStateMsg.decode(arr.buffer);var content=content_t.ss;var isRecovery=false;if(this.digest_tree.getRoot()=="00"){isRecovery=true;this.initialOndata(content)}else{if(interest.getName().size()==this.applicationBroadcastPrefix.size()+2)isRecovery=false;else isRecovery=true}var syncStates=[];for(var i=0;i<content.length;i++){if(content[i].type==0){syncStates.push(new ChronoSync2013.SyncState(content[i].name,content[i].seqno.session,content[i].seqno.seq))}}this.onReceivedSyncState(syncStates,isRecovery);var updated=this.update(content);if(updated){var n=new Name(this.applicationBroadcastPrefix);n.append(this.digest_tree.getRoot());var interest=new Interest(n);interest.setInterestLifetimeMilliseconds(this.sync_lifetime);this.face.expressInterest(interest,this.onData.bind(this),this.syncTimeout.bind(this))}};ChronoSync2013.prototype.initialTimeOut=function(interest){console.log("no other people");this.usrseq++;this.onInitialized();var content=[new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:this.usrseq,session:this.session}})];this.update(content);var n=new Name(this.applicationBroadcastPrefix);n.append(this.digest_tree.getRoot());var retryInterest=new Interest(n);retryInterest.setInterestLifetimeMilliseconds(this.sync_lifetime);this.face.expressInterest(retryInterest,this.onData.bind(this),this.syncTimeout.bind(this))};ChronoSync2013.prototype.processRecoveryInst=function(interest,syncdigest,transport){if(this.logfind(syncdigest)!=-1){var content=[];for(var i=0;i<this.digest_tree.digestnode.length;i++){content[i]=new this.SyncState({name:this.digest_tree.digestnode[i].getDataPrefix(),type:"UPDATE",seqno:{seq:this.digest_tree.digestnode[i].getSequenceNo(),session:this.digest_tree.digestnode[i].getSessionNo()}})}if(content.length!=0){var content_t=new this.SyncStateMsg({ss:content});var str=new Uint8Array(content_t.toArrayBuffer());var co=new Data(interest.getName());co.setContent(new Blob(str,false));this.keyChain.sign(co,this.certificateName);try{transport.send(co.wireEncode().buf())}catch(e){console.log(e.toString())}}}};ChronoSync2013.prototype.processSyncInst=function(index,syncdigest_t,transport){var content=[];var data_name=[];var data_seq=[];var data_ses=[];for(var j=index+1;j<this.digest_log.length;j++){var temp=this.digest_log[j].getData();for(var i=0;i<temp.length;i++){if(temp[i].type!=0){continue}if(this.digest_tree.find(temp[i].name,temp[i].seqno.session)!=-1){var n=data_name.indexOf(temp[i].name);if(n=-1){data_name.push(temp[i].name);data_seq.push(temp[i].seqno.seq);data_ses.push(temp[i].seqno.session)}else{data_seq[n]=temp[i].seqno.seq;data_ses[n]=temp[i].seqno.session}}}}for(var i=0;i<data_name.length;i++){content[i]=new this.SyncState({name:data_name[i],type:"UPDATE",seqno:{seq:data_seq[i],session:data_ses[i]}})}if(content.length!=0){var content_t=new this.SyncStateMsg({ss:content});var str=new Uint8Array(content_t.toArrayBuffer());var n=new Name(this.prefix);n.append(this.chatroom).append(syncdigest_t);var co=new Data(n);co.setContent(new Blob(str,false));this.keyChain.sign(co,this.certificateName);try{transport.send(co.wireEncode().buf())}catch(e){console.log(e.toString())}}};ChronoSync2013.prototype.sendRecovery=function(syncdigest_t){var n=new Name(this.applicationBroadcastPrefix);n.append("recovery").append(syncdigest_t);var interest=new Interest(n);interest.setInterestLifetimeMilliseconds(this.sync_lifetime);this.face.expressInterest(interest,this.onData.bind(this),this.syncTimeout.bind(this))};ChronoSync2013.prototype.judgeRecovery=function(interest,syncdigest_t,transport){var index=this.logfind(syncdigest_t);if(index!=-1){if(syncdigest_t!=this.digest_tree.root)this.processSyncInst(index,syncdigest_t,transport)}else this.sendRecovery(syncdigest_t)};ChronoSync2013.prototype.syncTimeout=function(interest){var component=interest.getName().get(4).toEscapedString();if(component==this.digest_tree.root){var n=new Name(interest.getName());var newInterest=new Interest(n);interest.setInterestLifetimeMilliseconds(this.sync_lifetime);this.face.expressInterest(newInterest,this.onData.bind(this),this.syncTimeout.bind(this))}};ChronoSync2013.prototype.initialOndata=function(content){this.update(content);var digest_t=this.digest_tree.getRoot();for(var i=0;i<content.length;i++){if(content[i].name==this.applicationDataPrefixUri&&content[i].seqno.session==this.session){var content_t=[new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:content[i].seqno.seq+1,session:this.session}})];if(this.update(content_t)){var newlog=new ChronoSync2013.DigestLogEntry(this.digest_tree.getRoot(),content_t);this.digest_log.push(newlog);this.onInitialized()}}}var content_t;if(this.usrseq>=0){content_t=new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:this.usrseq,session:this.session}})}else content_t=new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:0,session:this.session}});var content_tt=new this.SyncStateMsg({ss:content_t});this.broadcastSyncState(digest_t,content_tt);if(this.digest_tree.find(this.applicationDataPrefixUri,this.session)==-1){this.usrseq++;var content=[new this.SyncState({name:this.applicationDataPrefixUri,type:"UPDATE",seqno:{seq:this.usrseq,session:this.session}})];if(this.update(content)){this.onInitialized()}}};ChronoSync2013.prototype.contentCacheAdd=function(data){this.contentCache.add(data);var nowMilliseconds=(new Date).getTime();for(var i=this.pendingInterestTable.length-1;i>=0;i--){if(this.pendingInterestTable[i].isTimedOut(nowMilliseconds)){this.pendingInterestTable.splice(i,1);continue}if(this.pendingInterestTable[i].getInterest().matchesName(data.getName())){try{this.pendingInterestTable[i].getTransport().send(data.wireEncode().buf())}catch(e){}this.pendingInterestTable.splice(i,1)}}};ChronoSync2013.prototype.dummyOnData=function(interest,data){console.log("*** dummyOnData called. ***")}},{"../data.js":132,"../interest.js":154,"../name.js":159,"../util/blob.js":184,"../util/memory-content-cache.js":187,"./digest-tree.js":179,"./sync-state.js":180}],179:[function(require,module,exports){(function(Buffer){var crypto=require("crypto");var DataUtils=require("../encoding/data-utils.js").DataUtils;var DigestTree=function DigestTree(){this.root="00";this.digestnode=[]};exports.DigestTree=DigestTree;DigestTree.Node=function DigestTreeNode(dataPrefix,seqno_seq,seqno_session){this.dataPrefix=dataPrefix;this.seqno_seq=seqno_seq;this.seqno_session=seqno_session;this.recomputeDigest()};DigestTree.Node.prototype.getDataPrefix=function(){return this.dataPrefix};DigestTree.Node.prototype.getSequenceNo=function(){return this.seqno_seq};DigestTree.Node.prototype.getSessionNo=function(){return this.seqno_session};DigestTree.Node.prototype.getDigest=function(){return this.digest};DigestTree.Node.prototype.setSequenceNo=function(sequenceNo){this.seqno_seq=sequenceNo;this.recomputeDigest()};DigestTree.Node.prototype.Int32ToBuffer=function(value){var result=new Buffer(4);for(var i=0;i<4;i++){result[i]=value%256;value=Math.floor(value/256)}return result};DigestTree.Node.prototype.recomputeDigest=function(){var seqHash=new crypto.createHash("sha256");seqHash.update(this.Int32ToBuffer(this.seqno_session));seqHash.update(this.Int32ToBuffer(this.seqno_seq));var digest_seq=seqHash.digest();var nameHash=new crypto.createHash("sha256");nameHash.update(this.dataPrefix);var digest_name=nameHash.digest();var hash=new crypto.createHash("sha256");hash.update(digest_name);hash.update(digest_seq);this.digest=hash.digest("hex")};DigestTree.Node.Compare=function(node1,node2){var nameComparison=strcmp(node1.dataPrefix,node2.dataPrefix);if(nameComparison!=0)return nameComparison<0;return node1.seqno_session<node2.seqno_session};DigestTree.prototype.update=function(dataPrefix,sequenceNo,sessionNo){var n_index=this.find(dataPrefix,sessionNo);if(n_index>=0){if(this.digestnode[n_index].getSequenceNo()<sequenceNo)this.digestnode[n_index].setSequenceNo(sequenceNo);else return false}else{var temp=new DigestTree.Node(dataPrefix,sequenceNo,sessionNo);this.digestnode.push(temp);this.digestnode.sort(this.sortNodes)}this.recomputeRoot();return true};DigestTree.prototype.sortNodes=function(){var temp;for(var i=this.digestnode.length;i>0;i--){for(var j=0;j<i-1;j++){if(this.digestnode[j].getDataPrefix()>this.digestnode[j+1].getDataPrefix()){temp=this.digestnode[j];this.digestnode[j]=this.digestnode[j+1];this.digestnode[j+1]=temp}}}};DigestTree.prototype.sortNodes=function(node1,node2){if(node1.getDataPrefix()==node2.getDataPrefix()&&node1.getSessionNo()==node2.getSessionNo())return 0;if(node1.getDataPrefix()>node2.getDataPrefix()||node1.getDataPrefix()==node2.getDataPrefix()&&node1.getSessionNo()>node2.getSessionNo())return 1;else return-1};DigestTree.prototype.find=function(dataPrefix,sessionNo){for(var i=0;i<this.digestnode.length;++i){if(this.digestnode[i].getDataPrefix()==dataPrefix&&this.digestnode[i].getSessionNo()==sessionNo)return i}return-1};DigestTree.prototype.size=function(){return this.digestnode.size()};DigestTree.prototype.get=function(i){return this.digestnode[i]};DigestTree.prototype.getRoot=function(){return this.root};DigestTree.prototype.recomputeRoot=function(){var md=new crypto.createHash("sha256");for(var i=0;i<this.digestnode.length;i++){md.update(new Buffer(this.digestnode[i].digest,"hex"))}this.root=md.digest("hex")};function fromHexChar(c){if(c>="0"&&c<="9")return c-"0";else if(c>="a"&&c<="f")return c-"a"+10;else if(c>="A"&&c<="F")return c-"A"+10;else return-1}function strcmp(component1,component2){return str1==str2?0:str1>str2?1:-1}}).call(this,require("buffer").Buffer)},{"../encoding/data-utils.js":137,buffer:3,crypto:9}],180:[function(require,module,exports){var ProtoBuf=require("protobufjs");var Sync=ProtoBuf.newBuilder().import({"package":"Sync",messages:[{name:"SyncState",fields:[{rule:"required",type:"string",name:"name",id:1,options:{}},{rule:"required",type:"ActionType",name:"type",id:2,options:{}},{rule:"optional",type:"SeqNo",name:"seqno",id:3,options:{}}],enums:[{name:"ActionType",values:[{name:"UPDATE",id:0},{name:"DELETE",id:1},{name:"OTHER",id:2}],options:{}}],messages:[{name:"SeqNo",fields:[{rule:"required",type:"uint32",name:"seq",id:1,options:{}},{rule:"required",type:"uint32",name:"session",id:2,options:{}}],enums:[],messages:[],options:{}}],options:{}},{name:"SyncStateMsg",fields:[{rule:"repeated",type:"SyncState",name:"ss",id:1,options:{}}],enums:[],messages:[],options:{}}],enums:[],imports:[],options:{}}).build("Sync");exports.SyncStateMsg=Sync.SyncStateMsg;exports.SyncState=Sync.SyncState},{protobufjs:194}],181:[function(require,module,exports){var Transport=function Transport(){};exports.Transport=Transport;Transport.ConnectionInfo=function TransportConnectionInfo(){}},{}],182:[function(require,module,exports){(function(Buffer){var ElementReader=require("../encoding/element-reader.js").ElementReader;var LOG=require("../log.js").Log.LOG;var Transport=require("./transport.js").Transport;var UnixTransport=function UnixTransport(){Transport.call(this);this.socket=null;this.sock_ready=false;this.elementReader=null;this.connectionInfo=null;this.defaultGetConnectionInfo=null};UnixTransport.prototype=new Transport;UnixTransport.prototype.name="UnixTransport";exports.UnixTransport=UnixTransport;UnixTransport.ConnectionInfo=function UnixTransportConnectionInfo(filePath){Transport.ConnectionInfo.call(this);this.filePath=filePath};UnixTransport.ConnectionInfo.prototype=new Transport.ConnectionInfo;UnixTransport.ConnectionInfo.prototype.name="UnixTransport.ConnectionInfo";UnixTransport.ConnectionInfo.prototype.equals=function(other){if(other==null||other.filePath==undefined)return false;return this.filePath==other.filePath};UnixTransport.ConnectionInfo.prototype.toString=function(){return"{ filePath: "+this.filePath+" }"};UnixTransport.prototype.connect=function(connectionInfo,elementListener,onopenCallback,onclosedCallback){if(this.socket!=null)delete this.socket;this.elementReader=new ElementReader(elementListener);var net=require("net");this.socket=new net.createConnection(connectionInfo.filePath);var thisTransport=this;this.socket.on("data",function(data){if(typeof data=="object"){var buf=new Buffer(data);try{thisTransport.elementReader.onReceivedData(buf)}catch(ex){console.log("NDN.UnixTransport.ondata exception: "+ex);return}}});this.socket.on("connect",function(){if(LOG>3)console.log("socket.onopen: Unix socket connection opened.");thisTransport.sock_ready=true;onopenCallback()});this.socket.on("error",function(){if(LOG>3)console.log("socket.onerror: Unix socket error")});this.socket.on("close",function(){if(LOG>3)console.log("socket.onclose: Unix socket connection closed.");thisTransport.socket=null;onclosedCallback()});this.connectionInfo=connectionInfo};UnixTransport.prototype.send=function(data){if(this.sock_ready)this.socket.write(data);else console.log("Unix socket connection is not established.")};UnixTransport.prototype.close=function(){this.socket.end();if(LOG>3)console.log("Unix socket connection closed.")}}).call(this,require("buffer").Buffer)},{"../encoding/element-reader.js":139,"../log.js":157,"./transport.js":181,buffer:3,net:1}],183:[function(require,module,exports){(function(Buffer){var ElementReader=require("../encoding/element-reader.js").ElementReader;var LOG=require("../log.js").Log.LOG;var Transport=require("./transport.js").Transport;var Face;var WebSocketTransport=function WebSocketTransport(){Transport.call(this);if(!WebSocket)throw new Error("WebSocket support is not available on this platform.");this.ws=null;this.connectionInfo=null;this.elementReader=null;this.defaultGetConnectionInfo=Face.makeShuffledHostGetConnectionInfo(["A.ws.ndn.ucla.edu","B.ws.ndn.ucla.edu","C.ws.ndn.ucla.edu","D.ws.ndn.ucla.edu","E.ws.ndn.ucla.edu","F.ws.ndn.ucla.edu","G.ws.ndn.ucla.edu","H.ws.ndn.ucla.edu","I.ws.ndn.ucla.edu","J.ws.ndn.ucla.edu","K.ws.ndn.ucla.edu","L.ws.ndn.ucla.edu","M.ws.ndn.ucla.edu","N.ws.ndn.ucla.edu"],9696,function(host,port){return new WebSocketTransport.ConnectionInfo(host,port)})};WebSocketTransport.prototype=new Transport;WebSocketTransport.prototype.name="WebSocketTransport";WebSocketTransport.importFace=function(face){Face=face};exports.WebSocketTransport=WebSocketTransport;WebSocketTransport.ConnectionInfo=function WebSocketTransportConnectionInfo(host,port){Transport.ConnectionInfo.call(this);port=port!==undefined?port:9696;this.host=host;this.port=port};WebSocketTransport.ConnectionInfo.prototype=new Transport.ConnectionInfo;WebSocketTransport.ConnectionInfo.prototype.name="WebSocketTransport.ConnectionInfo";WebSocketTransport.ConnectionInfo.prototype.equals=function(other){if(other==null||other.host==undefined||other.port==undefined)return false;return this.host==other.host&&this.port==other.port};WebSocketTransport.ConnectionInfo.prototype.toString=function(){return"{ host: "+this.host+", port: "+this.port+" }"};WebSocketTransport.prototype.connect=function(connectionInfo,elementListener,onopenCallback,onclosedCallback){this.close();this.ws=new WebSocket("ws://"+connectionInfo.host+":"+connectionInfo.port);if(LOG>0)console.log("ws connection created.");this.connectionInfo=connectionInfo;this.ws.binaryType="arraybuffer";this.elementReader=new ElementReader(elementListener);var self=this;this.ws.onmessage=function(ev){var result=ev.data;if(result==null||result==undefined||result==""){console.log("INVALID ANSWER")}else if(result instanceof ArrayBuffer){var bytearray=new Buffer(new Uint8Array(result));if(LOG>3)console.log("BINARY RESPONSE IS "+bytearray.toString("hex"));try{self.elementReader.onReceivedData(bytearray)}catch(ex){console.log("NDN.ws.onmessage exception: "+ex);return}}};this.ws.onopen=function(ev){if(LOG>3)console.log(ev);if(LOG>3)console.log("ws.onopen: WebSocket connection opened.");if(LOG>3)console.log("ws.onopen: ReadyState: "+this.readyState);onopenCallback()};this.ws.onerror=function(ev){console.log("ws.onerror: ReadyState: "+this.readyState);console.log(ev);console.log("ws.onerror: WebSocket error: "+ev.data)};this.ws.onclose=function(ev){console.log("ws.onclose: WebSocket connection closed.");self.ws=null;onclosedCallback()}};WebSocketTransport.prototype.connectByFace=function(face,onopenCallback){this.connect(face.connectionInfo,face,onopenCallback,function(){face.closeByTransport()})};WebSocketTransport.prototype.send=function(data){if(this.ws!=null){var bytearray=new Uint8Array(data.length);bytearray.set(data);this.ws.send(bytearray.buffer);if(LOG>3)console.log("ws.send() returned.")}else console.log("WebSocket connection is not established.")};WebSocketTransport.prototype.close=function(){if(this.ws!=null)delete this.ws}}).call(this,require("buffer").Buffer)},{"../encoding/element-reader.js":139,"../log.js":157,"./transport.js":181,buffer:3}],184:[function(require,module,exports){(function(Buffer){var Blob=function Blob(value,copy){if(copy==null)copy=true;if(value==null)this.buffer=null;else if(typeof value==="object"&&value instanceof Blob)this.buffer=value.buffer;else{if(typeof value==="string")this.buffer=new Buffer(value,"utf8");else{if(copy)this.buffer=new Buffer(value);else{if(Buffer.isBuffer(value))this.buffer=value;else this.buffer=new Buffer(value)}}}this.length=this.buffer!=null?this.buffer.length:0};exports.Blob=Blob;Blob.prototype.size=function(){if(this.buffer!=null)return this.buffer.length;else return 0};Blob.prototype.buf=function(){return this.buffer};Blob.prototype.isNull=function(){return this.buffer==null};Blob.prototype.toHex=function(){if(this.buffer==null)return"";else return this.buffer.toString("hex")};Blob.prototype.equals=function(other){if(this.isNull())return other.isNull();else if(other.isNull())return false;else{if(this.buffer.length!=other.buffer.length)return false;for(var i=0;i<this.buffer.length;++i){if(this.buffer[i]!=other.buffer[i])return false}return true}}}).call(this,require("buffer").Buffer)},{buffer:3}],185:[function(require,module,exports){var WireFormat=require("../encoding/wire-format.js").WireFormat;var TlvEncoder=require("../encoding/tlv/tlv-encoder.js").TlvEncoder;var Blob=require("./blob.js").Blob;var CommandInterestGenerator=function CommandInterestGenerator(){this.lastTimestamp=Math.round((new Date).getTime())};exports.CommandInterestGenerator=CommandInterestGenerator;CommandInterestGenerator.prototype.generate=function(interest,keyChain,certificateName,wireFormat){wireFormat=wireFormat||WireFormat.getDefaultWireFormat();var timestamp=Math.round((new Date).getTime());while(timestamp<=this.lastTimestamp)timestamp+=1;var encoder=new TlvEncoder(8);encoder.writeNonNegativeInteger(timestamp);interest.getName().append(new Blob(encoder.getOutput(),false));interest.getName().append(new Blob(require("crypto").randomBytes(8),false));keyChain.sign(interest,certificateName,wireFormat);if(interest.getInterestLifetimeMilliseconds()==null||interest.getInterestLifetimeMilliseconds()<0)interest.setInterestLifetimeMilliseconds(1e3);this.lastTimestamp=timestamp}},{"../encoding/tlv/tlv-encoder.js":145,"../encoding/wire-format.js":148,"./blob.js":184,crypto:9}],186:[function(require,module,exports){(function(Buffer){var DynamicBuffer=function DynamicBuffer(length){if(!length)length=16;this.array=new Buffer(length)};exports.DynamicBuffer=DynamicBuffer;DynamicBuffer.prototype.ensureLength=function(length){if(this.array.length>=length)return;var newLength=this.array.length*2;if(length>newLength)newLength=length;var newArray=new Buffer(newLength);this.array.copy(newArray);this.array=newArray};DynamicBuffer.prototype.copy=function(value,offset){this.ensureLength(value.length+offset);if(Buffer.isBuffer(value))value.copy(this.array,offset);else new Buffer(value).copy(this.array,offset)};DynamicBuffer.prototype.ensureLengthFromBack=function(length){if(this.array.length>=length)return;var newLength=this.array.length*2;if(length>newLength)newLength=length;var newArray=new Buffer(newLength);this.array.copy(newArray,newArray.length-this.array.length);this.array=newArray};DynamicBuffer.prototype.copyFromBack=function(value,offsetFromBack){this.ensureLengthFromBack(offsetFromBack);if(Buffer.isBuffer(value))value.copy(this.array,this.array.length-offsetFromBack);else new Buffer(value).copy(this.array,this.array.length-offsetFromBack)};DynamicBuffer.prototype.slice=function(begin,end){return this.array.slice(begin,end)}}).call(this,require("buffer").Buffer)},{buffer:3}],187:[function(require,module,exports){var Name=require("../name.js").Name;var MemoryContentCache=function MemoryContentCache(face,cleanupIntervalMilliseconds){cleanupIntervalMilliseconds=cleanupIntervalMilliseconds||1e3;this.face=face;this.cleanupIntervalMilliseconds=cleanupIntervalMilliseconds;this.nextCleanupTime=(new Date).getTime()+cleanupIntervalMilliseconds;this.onDataNotFoundForPrefix={};this.registeredPrefixIdList=[];this.noStaleTimeCache=[];this.staleTimeCache=[];this.emptyComponent=new Name.Component};exports.MemoryContentCache=MemoryContentCache;MemoryContentCache.prototype.registerPrefix=function(prefix,onRegisterFailed,onDataNotFound,flags,wireFormat){if(onDataNotFound)this.onDataNotFoundForPrefix[prefix.toUri()]=onDataNotFound;var thisMemoryContentCache=this;var registeredPrefixId=this.face.registerPrefix(prefix,function(prefix,interest,transport){thisMemoryContentCache.onInterest(prefix,interest,transport)},onRegisterFailed,flags,wireFormat);this.registeredPrefixIdList.push(registeredPrefixId)};MemoryContentCache.prototype.unregisterAll=function(){for(var i=0;i<this.registeredPrefixIdList.length;++i)this.face.removeRegisteredPrefix(this.registeredPrefixIdList[i]);this.registeredPrefixIdList=[];this.onDataNotFoundForPrefix={}};MemoryContentCache.prototype.add=function(data){this.doCleanup();if(data.getMetaInfo().getFreshnessPeriod()!=null&&data.getMetaInfo().getFreshnessPeriod()>=0){var content=new MemoryContentCache.StaleTimeContent(data);var i=this.staleTimeCache.length-1;while(i>=0){if(this.staleTimeCache[i].staleTimeMilliseconds<=content.staleTimeMilliseconds)break;--i}this.staleTimeCache.splice(i+1,0,content)}else this.noStaleTimeCache.push(new MemoryContentCache.Content(data))};MemoryContentCache.prototype.onInterest=function(prefix,interest,transport){this.doCleanup();var selectedComponent=0;var selectedEncoding=null;var totalSize=this.staleTimeCache.length+this.noStaleTimeCache.length;for(var i=0;i<totalSize;++i){var content;if(i<this.staleTimeCache.length)content=this.staleTimeCache[i];else content=this.noStaleTimeCache[i-this.staleTimeCache.length];if(interest.matchesName(content.getName())){if(interest.getChildSelector()<0){transport.send(content.getDataEncoding());return}else{var component;if(content.getName().size()>interest.getName().size())component=content.getName().get(interest.getName().size());else component=this.emptyComponent;var gotBetterMatch=false;if(selectedEncoding===null)gotBetterMatch=true;else{if(interest.getChildSelector()==0){if(component.compare(selectedComponent)<0)gotBetterMatch=true}else{if(component.compare(selectedComponent)>0)gotBetterMatch=true}}if(gotBetterMatch){selectedComponent=component;selectedEncoding=content.getDataEncoding()}}}}if(selectedEncoding!==null)transport.send(selectedEncoding);else{var onDataNotFound=this.onDataNotFoundForPrefix[prefix.toUri()];if(onDataNotFound)onDataNotFound(prefix,interest,transport)}};MemoryContentCache.prototype.doCleanup=function(){var now=(new Date).getTime();if(now>=this.nextCleanupTime){while(this.staleTimeCache.length>0&&this.staleTimeCache[0].isStale(now))this.staleTimeCache.shift();this.nextCleanupTime=now+this.cleanupIntervalMilliseconds
}};MemoryContentCache.Content=function MemoryContentCacheContent(data){if(data){this.name=new Name(data.getName());this.dataEncoding=data.wireEncode().buf()}};MemoryContentCache.Content.prototype.getName=function(){return this.name};MemoryContentCache.Content.prototype.getDataEncoding=function(){return this.dataEncoding};MemoryContentCache.StaleTimeContent=function MemoryContentCacheStaleTimeContent(data){MemoryContentCache.Content.call(this,data);this.staleTimeMilliseconds=(new Date).getTime()+data.getMetaInfo().getFreshnessPeriod()};MemoryContentCache.StaleTimeContent.prototype=new MemoryContentCache.Content;MemoryContentCache.StaleTimeContent.prototype.name="StaleTimeContent";MemoryContentCache.StaleTimeContent.prototype.isStale=function(nowMilliseconds){return this.staleTimeMilliseconds<=nowMilliseconds}},{"../name.js":159}],188:[function(require,module,exports){(function(Buffer){var DataUtils=require("../encoding/data-utils.js").DataUtils;var BinaryXMLDecoder=require("../encoding/binary-xml-decoder.js").BinaryXMLDecoder;var NDNProtocolDTags=require("./ndn-protoco-id-tags.js").NDNProtocolDTags;var Name=require("../name.js").Name;var NameEnumeration=function NameEnumeration(face,onComponents){this.face=face;this.onComponents=onComponents;this.contentParts=[];var self=this;this.onData=function(interest,data){self.processData(data)};this.onTimeout=function(interest){self.processTimeout()}};exports.NameEnumeration=NameEnumeration;NameEnumeration.getComponents=function(face,prefix,onComponents){var command=new Name(prefix);command.add([193,46,69,46,98,101]);var enumeration=new NameEnumeration(face,onComponents);face.expressInterest(command,enumeration.onData,enumeration.onTimeout)};NameEnumeration.prototype.processData=function(data){try{if(!NameEnumeration.endsWithSegmentNumber(data.getName()))this.onComponents(null);else{var segmentNumber=data.getName().get(-1).toSegment();var expectedSegmentNumber=this.contentParts.length;if(segmentNumber!=expectedSegmentNumber)this.face.expressInterest(data.getName().getPrefix(-1).addSegment(expectedSegmentNumber),this.onData,this.onTimeout);else{this.contentParts.push(data.getContent().buf());if(data.getMetaInfo()!=null&&data.getMetaInfo().getFinalBlockId().getValue().size()>0){var finalSegmentNumber=data.getMetaInfo().getFinalBlockId().toSegment();if(segmentNumber==finalSegmentNumber){this.onComponents(NameEnumeration.parseComponents(Buffer.concat(this.contentParts)));return}}this.face.expressInterest(data.getName().getPrefix(-1).addSegment(expectedSegmentNumber+1),this.onData,this.onTimeout)}}}catch(ex){console.log("NameEnumeration: ignoring exception: "+ex)}};NameEnumeration.prototype.processTimeout=function(){try{this.onComponents(null)}catch(ex){console.log("NameEnumeration: ignoring exception: "+ex)}};NameEnumeration.parseComponents=function(content){var components=[];var decoder=new BinaryXMLDecoder(content);decoder.readElementStartDTag(NDNProtocolDTags.Collection);while(decoder.peekDTag(NDNProtocolDTags.Link)){decoder.readElementStartDTag(NDNProtocolDTags.Link);decoder.readElementStartDTag(NDNProtocolDTags.Name);components.push(new Buffer(decoder.readBinaryDTagElement(NDNProtocolDTags.Component)));decoder.readElementClose();decoder.readElementClose()}decoder.readElementClose();return components};NameEnumeration.endsWithSegmentNumber=function(name){return name.size()>=1&&name.get(-1).getValue().size()>=1&&name.get(-1).getValue().buf()[0]==0}}).call(this,require("buffer").Buffer)},{"../encoding/binary-xml-decoder.js":133,"../encoding/data-utils.js":137,"../name.js":159,"./ndn-protoco-id-tags.js":189,buffer:3}],189:[function(require,module,exports){var NDNProtocolDTags={Any:13,Name:14,Component:15,Certificate:16,Collection:17,CompleteName:18,Content:19,SignedInfo:20,ContentDigest:21,ContentHash:22,Count:24,Header:25,Interest:26,Key:27,KeyLocator:28,KeyName:29,Length:30,Link:31,LinkAuthenticator:32,NameComponentCount:33,RootDigest:36,Signature:37,Start:38,Timestamp:39,Type:40,Nonce:41,Scope:42,Exclude:43,Bloom:44,BloomSeed:45,AnswerOriginKind:47,InterestLifetime:48,Witness:53,SignatureBits:54,DigestAlgorithm:55,BlockSize:56,FreshnessSeconds:58,FinalBlockID:59,PublisherPublicKeyDigest:60,PublisherCertificateDigest:61,PublisherIssuerKeyDigest:62,PublisherIssuerCertificateDigest:63,Data:64,WrappedKey:65,WrappingKeyIdentifier:66,WrapAlgorithm:67,KeyAlgorithm:68,Label:69,EncryptedKey:70,EncryptedNonceKey:71,WrappingKeyName:72,Action:73,FaceID:74,IPProto:75,Host:76,Port:77,MulticastInterface:78,ForwardingFlags:79,FaceInstance:80,ForwardingEntry:81,MulticastTTL:82,MinSuffixComponents:83,MaxSuffixComponents:84,ChildSelector:85,RepositoryInfo:86,Version:87,RepositoryVersion:88,GlobalPrefix:89,LocalName:90,Policy:91,Namespace:92,GlobalPrefixName:93,PolicyVersion:94,KeyValueSet:95,KeyValuePair:96,IntegerValue:97,DecimalValue:98,StringValue:99,BinaryValue:100,NameValue:101,Entry:102,ACL:103,ParameterizedName:104,Prefix:105,Suffix:106,Root:107,ProfileName:108,Parameters:109,InfoString:110,StatusResponse:112,StatusCode:113,StatusText:114,SyncNode:115,SyncNodeKind:116,SyncNodeElement:117,SyncVersion:118,SyncNodeElements:119,SyncContentHash:120,SyncLeafCount:121,SyncTreeDepth:122,SyncByteCount:123,ConfigSlice:124,ConfigSliceList:125,ConfigSliceOp:126,NDNProtocolDataUnit:17702112,NDNPROTOCOL_DATA_UNIT:"NDNProtocolDataUnit"};exports.NDNProtocolDTags=NDNProtocolDTags;var NDNProtocolDTagsStrings=[null,null,null,null,null,null,null,null,null,null,null,null,null,"Any","Name","Component","Certificate","Collection","CompleteName","Content","SignedInfo","ContentDigest","ContentHash",null,"Count","Header","Interest","Key","KeyLocator","KeyName","Length","Link","LinkAuthenticator","NameComponentCount",null,null,"RootDigest","Signature","Start","Timestamp","Type","Nonce","Scope","Exclude","Bloom","BloomSeed",null,"AnswerOriginKind","InterestLifetime",null,null,null,null,"Witness","SignatureBits","DigestAlgorithm","BlockSize",null,"FreshnessSeconds","FinalBlockID","PublisherPublicKeyDigest","PublisherCertificateDigest","PublisherIssuerKeyDigest","PublisherIssuerCertificateDigest","Data","WrappedKey","WrappingKeyIdentifier","WrapAlgorithm","KeyAlgorithm","Label","EncryptedKey","EncryptedNonceKey","WrappingKeyName","Action","FaceID","IPProto","Host","Port","MulticastInterface","ForwardingFlags","FaceInstance","ForwardingEntry","MulticastTTL","MinSuffixComponents","MaxSuffixComponents","ChildSelector","RepositoryInfo","Version","RepositoryVersion","GlobalPrefix","LocalName","Policy","Namespace","GlobalPrefixName","PolicyVersion","KeyValueSet","KeyValuePair","IntegerValue","DecimalValue","StringValue","BinaryValue","NameValue","Entry","ACL","ParameterizedName","Prefix","Suffix","Root","ProfileName","Parameters","InfoString",null,"StatusResponse","StatusCode","StatusText","SyncNode","SyncNodeKind","SyncNodeElement","SyncVersion","SyncNodeElements","SyncContentHash","SyncLeafCount","SyncTreeDepth","SyncByteCount","ConfigSlice","ConfigSliceList","ConfigSliceOp"];exports.NDNProtocolDTagsStrings=NDNProtocolDTagsStrings},{}],190:[function(require,module,exports){var LOG=require("../log.js").Log.LOG;var NDNTime=function NDNTime(input){this.NANOS_MAX=999877929;if(typeof input=="number")this.msec=input;else{if(LOG>1)console.log("UNRECOGNIZED TYPE FOR TIME")}};exports.NDNTime=NDNTime;NDNTime.prototype.getJavascriptDate=function(){var d=new Date;d.setTime(this.msec);return d}},{"../log.js":157}],191:[function(require,module,exports){var Blob=require("./blob.js").Blob;var SignedBlob=function SignedBlob(value,signedPortionBeginOffset,signedPortionEndOffset){Blob.call(this,value);if(this.buffer==null){this.signedPortionBeginOffset=0;this.signedPortionEndOffset=0}else if(typeof value==="object"&&value instanceof SignedBlob){this.signedPortionBeginOffset=signedPortionBeginOffset==null?value.signedPortionBeginOffset:signedPortionBeginOffset;this.signedPortionEndOffset=signedPortionEndOffset==null?value.signedPortionEndOffset:signedPortionEndOffset}else{this.signedPortionBeginOffset=signedPortionBeginOffset||0;this.signedPortionEndOffset=signedPortionEndOffset||0}if(this.buffer==null)this.signedBuffer=null;else this.signedBuffer=this.buffer.slice(this.signedPortionBeginOffset,this.signedPortionEndOffset)};SignedBlob.prototype=new Blob;SignedBlob.prototype.name="SignedBlob";exports.SignedBlob=SignedBlob;SignedBlob.prototype.signedSize=function(){if(this.signedBuffer!=null)return this.signedBuffer.length;else return 0};SignedBlob.prototype.signedBuf=function(){if(this.signedBuffer!=null)return this.signedBuffer;else return null};SignedBlob.prototype.getSignedPortionBeginOffset=function(){return this.signedPortionBeginOffset};SignedBlob.prototype.getSignedPortionEndOffset=function(){return this.signedPortionEndOffset}},{"./blob.js":184}],192:[function(require,module,exports){(function(){var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}var inBrowser=typeof navigator!=="undefined";if(inBrowser&&j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(inBrowser&&j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-->0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(i>=0){if(p<8){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=this[i]>>(p-=8)&255;if(p<=0){p+=this.DB;--i}}if((d&128)!=0)d|=-256;if(k==0&&(this.s&128)!=(d&128))++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(x==0)return-1;var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0)++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return this.s!=0;return(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(j>0)w|=e[j-1]>>this.DB+i-k1}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone();var y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0)y.lShiftTo(g,y);return y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(v.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return false}if(y.compareTo(n1)!=0)return false}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;BigInteger.prototype.Barrett=Barrett;if(typeof exports!=="undefined"){exports=module.exports=BigInteger}else{this.BigInteger=BigInteger}}).call(this)},{}],193:[function(require,module,exports){(function(global){"use strict";function init(ByteBuffer){var ProtoBuf={};ProtoBuf.VERSION="3.8.2";ProtoBuf.WIRE_TYPES={};ProtoBuf.WIRE_TYPES.VARINT=0;ProtoBuf.WIRE_TYPES.BITS64=1;ProtoBuf.WIRE_TYPES.LDELIM=2;ProtoBuf.WIRE_TYPES.STARTGROUP=3;ProtoBuf.WIRE_TYPES.ENDGROUP=4;ProtoBuf.WIRE_TYPES.BITS32=5;ProtoBuf.PACKABLE_WIRE_TYPES=[ProtoBuf.WIRE_TYPES.VARINT,ProtoBuf.WIRE_TYPES.BITS64,ProtoBuf.WIRE_TYPES.BITS32];ProtoBuf.TYPES={int32:{name:"int32",wireType:ProtoBuf.WIRE_TYPES.VARINT},uint32:{name:"uint32",wireType:ProtoBuf.WIRE_TYPES.VARINT},sint32:{name:"sint32",wireType:ProtoBuf.WIRE_TYPES.VARINT},int64:{name:"int64",wireType:ProtoBuf.WIRE_TYPES.VARINT},uint64:{name:"uint64",wireType:ProtoBuf.WIRE_TYPES.VARINT},sint64:{name:"sint64",wireType:ProtoBuf.WIRE_TYPES.VARINT},bool:{name:"bool",wireType:ProtoBuf.WIRE_TYPES.VARINT},"double":{name:"double",wireType:ProtoBuf.WIRE_TYPES.BITS64},string:{name:"string",wireType:ProtoBuf.WIRE_TYPES.LDELIM},bytes:{name:"bytes",wireType:ProtoBuf.WIRE_TYPES.LDELIM},fixed32:{name:"fixed32",wireType:ProtoBuf.WIRE_TYPES.BITS32},sfixed32:{name:"sfixed32",wireType:ProtoBuf.WIRE_TYPES.BITS32},fixed64:{name:"fixed64",wireType:ProtoBuf.WIRE_TYPES.BITS64},sfixed64:{name:"sfixed64",wireType:ProtoBuf.WIRE_TYPES.BITS64},"float":{name:"float",wireType:ProtoBuf.WIRE_TYPES.BITS32},"enum":{name:"enum",wireType:ProtoBuf.WIRE_TYPES.VARINT},message:{name:"message",wireType:ProtoBuf.WIRE_TYPES.LDELIM},group:{name:"group",wireType:ProtoBuf.WIRE_TYPES.STARTGROUP}};
ProtoBuf.ID_MIN=1;ProtoBuf.ID_MAX=536870911;ProtoBuf.ByteBuffer=ByteBuffer;ProtoBuf.Long=ByteBuffer.Long||null;ProtoBuf.convertFieldsToCamelCase=false;ProtoBuf.populateAccessors=true;ProtoBuf.Util=function(){"use strict";if(!Object.create)Object.create=function(o){if(arguments.length>1)throw Error("Object.create polyfill only accepts the first parameter.");function F(){}F.prototype=o;return new F};var Util={};Util.IS_NODE=false;try{Util.IS_NODE=typeof require==="function"&&typeof require("fs").readFileSync==="function"&&typeof require("path").resolve==="function"}catch(e){}Util.XHR=function(){var XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var xhr=null;for(var i=0;i<XMLHttpFactories.length;i++){try{xhr=XMLHttpFactories[i]()}catch(e){continue}break}if(!xhr)throw Error("XMLHttpRequest is not supported");return xhr};Util.fetch=function(path,callback){if(callback&&typeof callback!="function")callback=null;if(Util.IS_NODE){if(callback){require("fs").readFile(path,function(err,data){if(err)callback(null);else callback(""+data)})}else try{return require("fs").readFileSync(path)}catch(e){return null}}else{var xhr=Util.XHR();xhr.open("GET",path,callback?true:false);xhr.setRequestHeader("Accept","text/plain");if(typeof xhr.overrideMimeType==="function")xhr.overrideMimeType("text/plain");if(callback){xhr.onreadystatechange=function(){if(xhr.readyState!=4)return;if(xhr.status==200||xhr.status==0&&typeof xhr.responseText==="string")callback(xhr.responseText);else callback(null)};if(xhr.readyState==4)return;xhr.send(null)}else{xhr.send(null);if(xhr.status==200||xhr.status==0&&typeof xhr.responseText==="string")return xhr.responseText;return null}}};Util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};return Util}();ProtoBuf.Lang={OPEN:"{",CLOSE:"}",OPTOPEN:"[",OPTCLOSE:"]",OPTEND:",",EQUAL:"=",END:";",STRINGOPEN:'"',STRINGCLOSE:'"',STRINGOPEN_SQ:"'",STRINGCLOSE_SQ:"'",COPTOPEN:"(",COPTCLOSE:")",DELIM:/[\s\{\}=;\[\],'"\(\)]/g,RULE:/^(?:required|optional|repeated)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+|([0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?))$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0x[0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^[0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?$/,ID:/^(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,BOOL:/^(?:true|false)$/i};ProtoBuf.DotProto=function(ProtoBuf,Lang){"use strict";var DotProto={};var Tokenizer=function(proto){this.source=""+proto;this.index=0;this.line=1;this.stack=[];this.readingString=false;this.stringEndsWith=Lang.STRINGCLOSE};var TokenizerPrototype=Tokenizer.prototype;TokenizerPrototype._readString=function(){Lang.STRING.lastIndex=this.index-1;var match;if((match=Lang.STRING.exec(this.source))!==null){var s=typeof match[1]!=="undefined"?match[1]:match[2];this.index=Lang.STRING.lastIndex;this.stack.push(this.stringEndsWith);return s}throw Error("Unterminated string at line "+this.line+", index "+this.index)};TokenizerPrototype.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(this.readingString){this.readingString=false;return this._readString()}var repeat,last;do{repeat=false;while(Lang.WHITESPACE.test(last=this.source.charAt(this.index))){this.index++;if(last==="\n")this.line++;if(this.index===this.source.length)return null}if(this.source.charAt(this.index)==="/"){if(this.source.charAt(++this.index)==="/"){while(this.source.charAt(this.index)!=="\n"){this.index++;if(this.index==this.source.length)return null}this.index++;this.line++;repeat=true}else if(this.source.charAt(this.index)==="*"){last="";while(last+(last=this.source.charAt(this.index))!=="*/"){this.index++;if(last==="\n")this.line++;if(this.index===this.source.length)return null}this.index++;repeat=true}else throw Error("Unterminated comment at line "+this.line+": /"+this.source.charAt(this.index))}}while(repeat);if(this.index===this.source.length)return null;var end=this.index;Lang.DELIM.lastIndex=0;var delim=Lang.DELIM.test(this.source.charAt(end));if(!delim){++end;while(end<this.source.length&&!Lang.DELIM.test(this.source.charAt(end)))end++}else++end;var token=this.source.substring(this.index,this.index=end);if(token===Lang.STRINGOPEN)this.readingString=true,this.stringEndsWith=Lang.STRINGCLOSE;else if(token===Lang.STRINGOPEN_SQ)this.readingString=true,this.stringEndsWith=Lang.STRINGCLOSE_SQ;return token};TokenizerPrototype.peek=function(){if(this.stack.length===0){var token=this.next();if(token===null)return null;this.stack.push(token)}return this.stack[0]};TokenizerPrototype.toString=function(){return"Tokenizer("+this.index+"/"+this.source.length+" at line "+this.line+")"};DotProto.Tokenizer=Tokenizer;var Parser=function(proto){this.tn=new Tokenizer(proto)};var ParserPrototype=Parser.prototype;ParserPrototype.parse=function(){var topLevel={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]};var token,head=true;while(token=this.tn.next()){switch(token){case"package":if(!head||topLevel["package"]!==null)throw Error("Unexpected package at line "+this.tn.line);topLevel["package"]=this._parsePackage(token);break;case"import":if(!head)throw Error("Unexpected import at line "+this.tn.line);topLevel.imports.push(this._parseImport(token));break;case"message":this._parseMessage(topLevel,null,token);head=false;break;case"enum":this._parseEnum(topLevel,token);head=false;break;case"option":if(!head)throw Error("Unexpected option at line "+this.tn.line);this._parseOption(topLevel,token);break;case"service":this._parseService(topLevel,token);break;case"extend":this._parseExtend(topLevel,token);break;case"syntax":this._parseIgnoredStatement(topLevel,token);break;default:throw Error("Unexpected token at line "+this.tn.line+": "+token)}}delete topLevel["name"];return topLevel};ParserPrototype._parseNumber=function(val){var sign=1;if(val.charAt(0)=="-")sign=-1,val=val.substring(1);if(Lang.NUMBER_DEC.test(val))return sign*parseInt(val,10);else if(Lang.NUMBER_HEX.test(val))return sign*parseInt(val.substring(2),16);else if(Lang.NUMBER_OCT.test(val))return sign*parseInt(val.substring(1),8);else if(Lang.NUMBER_FLT.test(val))return sign*parseFloat(val);throw Error("Illegal number at line "+this.tn.line+": "+(sign<0?"-":"")+val)};ParserPrototype._parseString=function(){var value="",token;do{token=this.tn.next();value+=this.tn.next();token=this.tn.next();if(token!==this.tn.stringEndsWith)throw Error("Illegal end of string at line "+this.tn.line+": "+token);token=this.tn.peek()}while(token===Lang.STRINGOPEN||token===Lang.STRINGOPEN_SQ);return value};ParserPrototype._parseId=function(val,neg){var id=-1;var sign=1;if(val.charAt(0)=="-")sign=-1,val=val.substring(1);if(Lang.NUMBER_DEC.test(val))id=parseInt(val);else if(Lang.NUMBER_HEX.test(val))id=parseInt(val.substring(2),16);else if(Lang.NUMBER_OCT.test(val))id=parseInt(val.substring(1),8);else throw Error("Illegal id at line "+this.tn.line+": "+(sign<0?"-":"")+val);id=sign*id|0;if(!neg&&id<0)throw Error("Illegal id at line "+this.tn.line+": "+(sign<0?"-":"")+val);return id};ParserPrototype._parsePackage=function(token){token=this.tn.next();if(!Lang.TYPEREF.test(token))throw Error("Illegal package name at line "+this.tn.line+": "+token);var pkg=token;token=this.tn.next();if(token!=Lang.END)throw Error("Illegal end of package at line "+this.tn.line+": "+token);return pkg};ParserPrototype._parseImport=function(token){token=this.tn.peek();if(token==="public")this.tn.next(),token=this.tn.peek();if(token!==Lang.STRINGOPEN&&token!==Lang.STRINGOPEN_SQ)throw Error("Illegal start of import at line "+this.tn.line+": "+token);var imported=this._parseString();token=this.tn.next();if(token!==Lang.END)throw Error("Illegal end of import at line "+this.tn.line+": "+token);return imported};ParserPrototype._parseOption=function(parent,token){token=this.tn.next();var custom=false;if(token==Lang.COPTOPEN)custom=true,token=this.tn.next();if(!Lang.TYPEREF.test(token))if(!/google\.protobuf\./.test(token))throw Error("Illegal option name in message "+parent.name+" at line "+this.tn.line+": "+token);var name=token;token=this.tn.next();if(custom){if(token!==Lang.COPTCLOSE)throw Error("Illegal end in message "+parent.name+", option "+name+" at line "+this.tn.line+": "+token);name="("+name+")";token=this.tn.next();if(Lang.FQTYPEREF.test(token))name+=token,token=this.tn.next()}if(token!==Lang.EQUAL)throw Error("Illegal operator in message "+parent.name+", option "+name+" at line "+this.tn.line+": "+token);var value;token=this.tn.peek();if(token===Lang.STRINGOPEN||token===Lang.STRINGOPEN_SQ)value=this._parseString();else{this.tn.next();if(Lang.NUMBER.test(token))value=this._parseNumber(token,true);else if(Lang.BOOL.test(token))value=token==="true";else if(Lang.TYPEREF.test(token))value=token;else throw Error("Illegal option value in message "+parent.name+", option "+name+" at line "+this.tn.line+": "+token)}token=this.tn.next();if(token!==Lang.END)throw Error("Illegal end of option in message "+parent.name+", option "+name+" at line "+this.tn.line+": "+token);parent["options"][name]=value};ParserPrototype._parseIgnoredStatement=function(parent,keyword){var token;do{token=this.tn.next();if(token===null)throw Error("Unexpected EOF in "+parent.name+", "+keyword+" at line "+this.tn.line);if(token===Lang.END)break}while(true)};ParserPrototype._parseService=function(parent,token){token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal service name at line "+this.tn.line+": "+token);var name=token;var svc={name:name,rpc:{},options:{}};token=this.tn.next();if(token!==Lang.OPEN)throw Error("Illegal start of service "+name+" at line "+this.tn.line+": "+token);do{token=this.tn.next();if(token==="option")this._parseOption(svc,token);else if(token==="rpc")this._parseServiceRPC(svc,token);else if(token!==Lang.CLOSE)throw Error("Illegal type of service "+name+" at line "+this.tn.line+": "+token)}while(token!==Lang.CLOSE);parent["services"].push(svc)};ParserPrototype._parseServiceRPC=function(svc,token){var type=token;token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal method name in service "+svc["name"]+" at line "+this.tn.line+": "+token);var name=token;var method={request:null,response:null,options:{}};token=this.tn.next();if(token!==Lang.COPTOPEN)throw Error("Illegal start of request type in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);token=this.tn.next();if(!Lang.TYPEREF.test(token))throw Error("Illegal request type in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);method["request"]=token;token=this.tn.next();if(token!=Lang.COPTCLOSE)throw Error("Illegal end of request type in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);token=this.tn.next();if(token.toLowerCase()!=="returns")throw Error("Illegal delimiter in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);token=this.tn.next();if(token!=Lang.COPTOPEN)throw Error("Illegal start of response type in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);token=this.tn.next();method["response"]=token;token=this.tn.next();if(token!==Lang.COPTCLOSE)throw Error("Illegal end of response type in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);token=this.tn.next();if(token===Lang.OPEN){do{token=this.tn.next();if(token==="option")this._parseOption(method,token);else if(token!==Lang.CLOSE)throw Error("Illegal start of option inservice "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token)}while(token!==Lang.CLOSE);if(this.tn.peek()===Lang.END)this.tn.next()}else if(token!==Lang.END)throw Error("Illegal delimiter in service "+svc["name"]+"#"+name+" at line "+this.tn.line+": "+token);if(typeof svc[type]==="undefined")svc[type]={};svc[type][name]=method};ParserPrototype._parseMessage=function(parent,fld,token){var msg={};var isGroup=token==="group";token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal "+(isGroup?"group":"message")+" name"+(parent?" in message "+parent["name"]:"")+" at line "+this.tn.line+": "+token);msg["name"]=token;if(isGroup){token=this.tn.next();if(token!==Lang.EQUAL)throw Error("Illegal id assignment after group "+msg.name+" at line "+this.tn.line+": "+token);token=this.tn.next();try{fld["id"]=this._parseId(token)}catch(e){throw Error("Illegal field id value for group "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token)}msg["isGroup"]=true}msg["fields"]=[];msg["enums"]=[];msg["messages"]=[];msg["options"]={};msg["oneofs"]={};token=this.tn.next();if(token===Lang.OPTOPEN&&fld)this._parseFieldOptions(msg,fld,token),token=this.tn.next();if(token!==Lang.OPEN)throw Error("Illegal start of "+(isGroup?"group":"message")+" "+msg.name+" at line "+this.tn.line+": "+token);do{token=this.tn.next();if(token===Lang.CLOSE){token=this.tn.peek();if(token===Lang.END)this.tn.next();break}else if(Lang.RULE.test(token))this._parseMessageField(msg,token);else if(token==="oneof")this._parseMessageOneOf(msg,token);else if(token==="enum")this._parseEnum(msg,token);else if(token==="message")this._parseMessage(msg,null,token);else if(token==="option")this._parseOption(msg,token);else if(token==="extensions")msg["extensions"]=this._parseExtensions(msg,token);else if(token==="extend")this._parseExtend(msg,token);else throw Error("Illegal token in message "+msg.name+" at line "+this.tn.line+": "+token)}while(true);parent["messages"].push(msg);return msg};ParserPrototype._parseMessageField=function(msg,token){var fld={},grp=null;fld["rule"]=token;fld["options"]={};token=this.tn.next();if(token==="group"){grp=this._parseMessage(msg,fld,token);if(!/^[A-Z]/.test(grp["name"]))throw Error("Group names must start with a capital letter");fld["type"]=grp["name"];fld["name"]=grp["name"].toLowerCase();token=this.tn.peek();if(token===Lang.END)this.tn.next()}else{if(!Lang.TYPE.test(token)&&!Lang.TYPEREF.test(token))throw Error("Illegal field type in message "+msg.name+" at line "+this.tn.line+": "+token);fld["type"]=token;token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal field name in message "+msg.name+" at line "+this.tn.line+": "+token);fld["name"]=token;token=this.tn.next();if(token!==Lang.EQUAL)throw Error("Illegal token in field "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token);token=this.tn.next();try{fld["id"]=this._parseId(token)}catch(e){throw Error("Illegal field id in message "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token)}token=this.tn.next();if(token===Lang.OPTOPEN)this._parseFieldOptions(msg,fld,token),token=this.tn.next();if(token!==Lang.END)throw Error("Illegal delimiter in message "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token)}msg["fields"].push(fld);return fld};ParserPrototype._parseMessageOneOf=function(msg,token){token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal oneof name in message "+msg.name+" at line "+this.tn.line+": "+token);var name=token,fld;var fields=[];token=this.tn.next();if(token!==Lang.OPEN)throw Error("Illegal start of oneof "+name+" at line "+this.tn.line+": "+token);while(this.tn.peek()!==Lang.CLOSE){fld=this._parseMessageField(msg,"optional");fld["oneof"]=name;fields.push(fld["id"])}this.tn.next();msg["oneofs"][name]=fields};ParserPrototype._parseFieldOptions=function(msg,fld,token){var first=true;do{token=this.tn.next();if(token===Lang.OPTCLOSE)break;else if(token===Lang.OPTEND){if(first)throw Error("Illegal start of options in message "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token);token=this.tn.next()}this._parseFieldOption(msg,fld,token);first=false}while(true)};ParserPrototype._parseFieldOption=function(msg,fld,token){var custom=false;if(token===Lang.COPTOPEN)token=this.tn.next(),custom=true;if(!Lang.TYPEREF.test(token))throw Error("Illegal field option in "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token);var name=token;token=this.tn.next();if(custom){if(token!==Lang.COPTCLOSE)throw Error("Illegal delimiter in "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token);name="("+name+")";token=this.tn.next();if(Lang.FQTYPEREF.test(token))name+=token,token=this.tn.next()}if(token!==Lang.EQUAL)throw Error("Illegal token in "+msg.name+"#"+fld.name+" at line "+this.tn.line+": "+token);var value;token=this.tn.peek();if(token===Lang.STRINGOPEN||token===Lang.STRINGOPEN_SQ){value=this._parseString()}else if(Lang.NUMBER.test(token,true))value=this._parseNumber(this.tn.next(),true);else if(Lang.BOOL.test(token))value=this.tn.next().toLowerCase()==="true";else if(Lang.TYPEREF.test(token))value=this.tn.next();else throw Error("Illegal value in message "+msg.name+"#"+fld.name+", option "+name+" at line "+this.tn.line+": "+token);fld["options"][name]=value};ParserPrototype._parseEnum=function(msg,token){var enm={};token=this.tn.next();if(!Lang.NAME.test(token))throw Error("Illegal enum name in message "+msg.name+" at line "+this.tn.line+": "+token);enm["name"]=token;token=this.tn.next();if(token!==Lang.OPEN)throw Error("Illegal start of enum "+enm.name+" at line "+this.tn.line+": "+token);enm["values"]=[];enm["options"]={};do{token=this.tn.next();if(token===Lang.CLOSE){token=this.tn.peek();if(token===Lang.END)this.tn.next();break}if(token=="option")this._parseOption(enm,token);else{if(!Lang.NAME.test(token))throw Error("Illegal name in enum "+enm.name+" at line "+this.tn.line+": "+token);this._parseEnumValue(enm,token)}}while(true);msg["enums"].push(enm)};ParserPrototype._parseEnumValue=function(enm,token){var val={};val["name"]=token;token=this.tn.next();if(token!==Lang.EQUAL)throw Error("Illegal token in enum "+enm.name+" at line "+this.tn.line+": "+token);token=this.tn.next();try{val["id"]=this._parseId(token,true)}catch(e){throw Error("Illegal id in enum "+enm.name+" at line "+this.tn.line+": "+token)}enm["values"].push(val);token=this.tn.next();if(token===Lang.OPTOPEN){var opt={options:{}};this._parseFieldOptions(enm,opt,token);token=this.tn.next()}if(token!==Lang.END)throw Error("Illegal delimiter in enum "+enm.name+" at line "+this.tn.line+": "+token)};ParserPrototype._parseExtensions=function(msg,token){var range=[];token=this.tn.next();if(token==="min")range.push(ProtoBuf.ID_MIN);else if(token==="max")range.push(ProtoBuf.ID_MAX);else range.push(this._parseNumber(token));token=this.tn.next();if(token!=="to")throw Error("Illegal extensions delimiter in message "+msg.name+" at line "+this.tn.line+": "+token);token=this.tn.next();if(token==="min")range.push(ProtoBuf.ID_MIN);else if(token==="max")range.push(ProtoBuf.ID_MAX);else range.push(this._parseNumber(token));token=this.tn.next();if(token!==Lang.END)throw Error("Illegal extensions delimiter in message "+msg.name+" at line "+this.tn.line+": "+token);return range};ParserPrototype._parseExtend=function(parent,token){token=this.tn.next();if(!Lang.TYPEREF.test(token))throw Error("Illegal message name at line "+this.tn.line+": "+token);var ext={};ext["ref"]=token;ext["fields"]=[];token=this.tn.next();if(token!==Lang.OPEN)throw Error("Illegal start of extend "+ext.name+" at line "+this.tn.line+": "+token);do{token=this.tn.next();if(token===Lang.CLOSE){token=this.tn.peek();if(token==Lang.END)this.tn.next();break}else if(Lang.RULE.test(token))this._parseMessageField(ext,token);else throw Error("Illegal token in extend "+ext.name+" at line "+this.tn.line+": "+token)}while(true);parent["messages"].push(ext);return ext};ParserPrototype.toString=function(){return"Parser"};DotProto.Parser=Parser;return DotProto}(ProtoBuf,ProtoBuf.Lang);ProtoBuf.Reflect=function(ProtoBuf){"use strict";var Reflect={};var T=function(builder,parent,name){this.builder=builder;this.parent=parent;this.name=name;this.className};var TPrototype=T.prototype;TPrototype.fqn=function(){var name=this.name,ptr=this;do{ptr=ptr.parent;if(ptr==null)break;name=ptr.name+"."+name}while(true);return name};TPrototype.toString=function(includeClass){return(includeClass?this.className+" ":"")+this.fqn()};TPrototype.build=function(){throw Error(this.toString(true)+" cannot be built directly")};Reflect.T=T;var Namespace=function(builder,parent,name,options){T.call(this,builder,parent,name);this.className="Namespace";this.children=[];this.options=options||{}};var NamespacePrototype=Namespace.prototype=Object.create(T.prototype);NamespacePrototype.getChildren=function(type){type=type||null;if(type==null)return this.children.slice();var children=[];for(var i=0,k=this.children.length;i<k;++i)if(this.children[i]instanceof type)children.push(this.children[i]);return children};NamespacePrototype.addChild=function(child){var other;if(other=this.getChild(child.name)){if(other instanceof Message.Field&&other.name!==other.originalName&&this.getChild(other.originalName)===null)other.name=other.originalName;else if(child instanceof Message.Field&&child.name!==child.originalName&&this.getChild(child.originalName)===null)child.name=child.originalName;else throw Error("Duplicate name in namespace "+this.toString(true)+": "+child.name)}this.children.push(child)};NamespacePrototype.getChild=function(nameOrId){var key=typeof nameOrId==="number"?"id":"name";for(var i=0,k=this.children.length;i<k;++i)if(this.children[i][key]===nameOrId)return this.children[i];return null};NamespacePrototype.resolve=function(qn,excludeFields){var part=qn.split("."),ptr=this,i=0;if(part[i]===""){while(ptr.parent!==null)ptr=ptr.parent;i++}var child;do{do{child=ptr.getChild(part[i]);if(!child||!(child instanceof Reflect.T)||excludeFields&&child instanceof Reflect.Message.Field){ptr=null;break}ptr=child;i++}while(i<part.length);if(ptr!=null)break;if(this.parent!==null){return this.parent.resolve(qn,excludeFields)}}while(ptr!=null);return ptr};NamespacePrototype.build=function(){var ns={};var children=this.children;for(var i=0,k=children.length,child;i<k;++i){child=children[i];if(child instanceof Namespace)ns[child.name]=child.build()}if(Object.defineProperty)Object.defineProperty(ns,"$options",{value:this.buildOpt()});return ns};NamespacePrototype.buildOpt=function(){var opt={},keys=Object.keys(this.options);for(var i=0,k=keys.length;i<k;++i){var key=keys[i],val=this.options[keys[i]];opt[key]=val}return opt};NamespacePrototype.getOption=function(name){if(typeof name==="undefined")return this.options;return typeof this.options[name]!=="undefined"?this.options[name]:null};Reflect.Namespace=Namespace;var Message=function(builder,parent,name,options,isGroup){Namespace.call(this,builder,parent,name,options);this.className="Message";this.extensions=[ProtoBuf.ID_MIN,ProtoBuf.ID_MAX];this.clazz=null;this.isGroup=!!isGroup;this._fields=null;this._fieldsById=null;this._fieldsByName=null};var MessagePrototype=Message.prototype=Object.create(Namespace.prototype);MessagePrototype.build=function(rebuild){if(this.clazz&&!rebuild)return this.clazz;var clazz=function(ProtoBuf,T){var fields=T.getChildren(ProtoBuf.Reflect.Message.Field),oneofs=T.getChildren(ProtoBuf.Reflect.Message.OneOf);var Message=function(values,var_args){ProtoBuf.Builder.Message.call(this);for(var i=0,k=oneofs.length;i<k;++i)this[oneofs[i].name]=null;for(i=0,k=fields.length;i<k;++i){var field=fields[i];this[field.name]=field.repeated?[]:null;if(field.required&&field.defaultValue!==null)this[field.name]=field.defaultValue}if(arguments.length>0){if(arguments.length===1&&typeof values==="object"&&typeof values.encode!=="function"&&!ProtoBuf.Util.isArray(values)&&!(values instanceof ByteBuffer)&&!(values instanceof ArrayBuffer)&&!(ProtoBuf.Long&&values instanceof ProtoBuf.Long)){var keys=Object.keys(values);for(i=0,k=keys.length;i<k;++i)this.$set(keys[i],values[keys[i]])}else for(i=0,k=arguments.length;i<k;++i)this.$set(fields[i].name,arguments[i])}};var MessagePrototype=Message.prototype=Object.create(ProtoBuf.Builder.Message.prototype);MessagePrototype.add=function(key,value,noAssert){var field=T._fieldsByName[key];if(!noAssert){if(!field)throw Error(this+"#"+key+" is undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: "+field.toString(true));if(!field.repeated)throw Error(this+"#"+key+" is not a repeated field")}if(this[field.name]===null)this[field.name]=[];this[field.name].push(noAssert?value:field.verifyValue(value,true))};MessagePrototype.$add=MessagePrototype.add;MessagePrototype.set=function(key,value,noAssert){if(key&&typeof key==="object"){for(var i in key)if(key.hasOwnProperty(i))this.$set(i,key[i],noAssert);return this}var field=T._fieldsByName[key];if(!noAssert){if(!field)throw Error(this+"#"+key+" is not a field: undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: "+field.toString(true));this[field.name]=value=field.verifyValue(value)}else{this[field.name]=value}if(field.oneof){if(value!==null){if(this[field.oneof.name]!==null)this[this[field.oneof.name]]=null;this[field.oneof.name]=field.name}else if(field.oneof.name===key)this[field.oneof.name]=null}return this};MessagePrototype.$set=MessagePrototype.set;MessagePrototype.get=function(key,noAssert){if(noAssert)return this[key];var field=T._fieldsByName[key];if(!field||!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: undefined");if(!(field instanceof ProtoBuf.Reflect.Message.Field))throw Error(this+"#"+key+" is not a field: "+field.toString(true));return this[field.name]};MessagePrototype.$get=MessagePrototype.get;for(var i=0;i<fields.length;i++){var field=fields[i];if(field instanceof ProtoBuf.Reflect.Message.ExtensionField)continue;if(T.builder.options["populateAccessors"])(function(field){var Name=field.originalName.replace(/(_[a-zA-Z])/g,function(match){return match.toUpperCase().replace("_","")});Name=Name.substring(0,1).toUpperCase()+Name.substring(1);var name=field.originalName.replace(/([A-Z])/g,function(match){return"_"+match});var setter=function(value,noAssert){this[field.name]=noAssert?value:field.verifyValue(value);return this};var getter=function(){return this[field.name]};if(T.getChild("set"+Name)===null)MessagePrototype["set"+Name]=setter;if(T.getChild("set_"+name)===null)MessagePrototype["set_"+name]=setter;if(T.getChild("get"+Name)===null)MessagePrototype["get"+Name]=getter;if(T.getChild("get_"+name)===null)MessagePrototype["get_"+name]=getter})(field)}MessagePrototype.encode=function(buffer,noVerify){if(typeof buffer==="boolean")noVerify=buffer,buffer=undefined;var isNew=false;if(!buffer)buffer=new ByteBuffer,isNew=true;var le=buffer.littleEndian;try{T.encode(this,buffer.LE(),noVerify);return(isNew?buffer.flip():buffer).LE(le)}catch(e){buffer.LE(le);throw e}};MessagePrototype.calculate=function(){return T.calculate(this)};MessagePrototype.encodeDelimited=function(buffer){var isNew=false;if(!buffer)buffer=new ByteBuffer,isNew=true;var enc=(new ByteBuffer).LE();T.encode(this,enc).flip();buffer.writeVarint32(enc.remaining());buffer.append(enc);return isNew?buffer.flip():buffer};MessagePrototype.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){if(e["encoded"])e["encoded"]=e["encoded"].toArrayBuffer();throw e}};MessagePrototype.toArrayBuffer=MessagePrototype.encodeAB;MessagePrototype.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){if(e["encoded"])e["encoded"]=e["encoded"].toBuffer();throw e}};MessagePrototype.toBuffer=MessagePrototype.encodeNB;MessagePrototype.encode64=function(){try{return this.encode().toBase64()}catch(e){if(e["encoded"])e["encoded"]=e["encoded"].toBase64();throw e}};MessagePrototype.toBase64=MessagePrototype.encode64;MessagePrototype.encodeHex=function(){try{return this.encode().toHex()}catch(e){if(e["encoded"])e["encoded"]=e["encoded"].toHex();throw e}};MessagePrototype.toHex=MessagePrototype.encodeHex;function cloneRaw(obj,includeBinaryAsBase64){var clone={};for(var i in obj)if(obj.hasOwnProperty(i)){if(obj[i]===null||typeof obj[i]!=="object")clone[i]=obj[i];else if(obj[i]instanceof ByteBuffer){if(includeBinaryAsBase64)clone[i]=obj[i].toBase64()}else clone[i]=cloneRaw(obj[i],includeBinaryAsBase64)}return clone}MessagePrototype.toRaw=function(includeBinaryAsBase64){return cloneRaw(this,!!includeBinaryAsBase64)};Message.decode=function(buffer,enc){if(typeof buffer==="string")buffer=ByteBuffer.wrap(buffer,enc?enc:"base64");buffer=buffer instanceof ByteBuffer?buffer:ByteBuffer.wrap(buffer);var le=buffer.littleEndian;try{var msg=T.decode(buffer.LE());buffer.LE(le);return msg}catch(e){buffer.LE(le);throw e}};Message.decodeDelimited=function(buffer,enc){if(typeof buffer==="string")buffer=ByteBuffer.wrap(buffer,enc?enc:"base64");buffer=buffer instanceof ByteBuffer?buffer:ByteBuffer.wrap(buffer);if(buffer.remaining()<1)return null;var off=buffer.offset,len=buffer.readVarint32();if(buffer.remaining()<len){buffer.offset=off;return null}try{var msg=T.decode(buffer.slice(buffer.offset,buffer.offset+len).LE());buffer.offset+=len;return msg}catch(err){buffer.offset+=len;throw err}};Message.decode64=function(str){return Message.decode(str,"base64")};Message.decodeHex=function(str){return Message.decode(str,"hex")};MessagePrototype.toString=function(){return T.toString()};var $options;var $type;if(Object.defineProperty)Object.defineProperty(Message,"$options",{value:T.buildOpt()}),Object.defineProperty(MessagePrototype,"$type",{get:function(){return T}});return Message}(ProtoBuf,this);this._fields=[];this._fieldsById={};this._fieldsByName={};for(var i=0,k=this.children.length,child;i<k;i++){child=this.children[i];if(child instanceof Enum)clazz[child.name]=child.build();else if(child instanceof Message)clazz[child.name]=child.build();else if(child instanceof Message.Field)child.build(),this._fields.push(child),this._fieldsById[child.id]=child,this._fieldsByName[child.name]=child;else if(!(child instanceof Message.OneOf)&&!(child instanceof Extension))throw Error("Illegal reflect child of "+this.toString(true)+": "+children[i].toString(true))}return this.clazz=clazz};MessagePrototype.encode=function(message,buffer,noVerify){var fieldMissing=null,field;for(var i=0,k=this._fields.length,val;i<k;++i){field=this._fields[i];val=message[field.name];if(field.required&&val===null){if(fieldMissing===null)fieldMissing=field}else field.encode(noVerify?val:field.verifyValue(val),buffer)}if(fieldMissing!==null){var err=Error("Missing at least one required field for "+this.toString(true)+": "+fieldMissing);err["encoded"]=buffer;throw err}return buffer};MessagePrototype.calculate=function(message){for(var n=0,i=0,k=this._fields.length,field,val;i<k;++i){field=this._fields[i];val=message[field.name];if(field.required&&val===null)throw Error("Missing at least one required field for "+this.toString(true)+": "+field);else n+=field.calculate(val)}return n};function skipTillGroupEnd(expectedId,buf){var tag=buf.readVarint32(),wireType=tag&7,id=tag>>3;switch(wireType){case ProtoBuf.WIRE_TYPES.VARINT:do tag=buf.readUint8();while((tag&128)===128);break;case ProtoBuf.WIRE_TYPES.BITS64:buf.offset+=8;break;case ProtoBuf.WIRE_TYPES.LDELIM:tag=buf.readVarint32();buf.offset+=tag;break;case ProtoBuf.WIRE_TYPES.STARTGROUP:skipTillGroupEnd(id,buf);break;case ProtoBuf.WIRE_TYPES.ENDGROUP:if(id===expectedId)return false;else throw Error("Illegal GROUPEND after unknown group: "+id+" ("+expectedId+" expected)");case ProtoBuf.WIRE_TYPES.BITS32:buf.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+expectedId+": "+wireType)}return true}MessagePrototype.decode=function(buffer,length,expectedGroupEndId){length=typeof length==="number"?length:-1;
var start=buffer.offset,msg=new this.clazz,tag,wireType,id,field;while(buffer.offset<start+length||length===-1&&buffer.remaining()>0){tag=buffer.readVarint32();wireType=tag&7;id=tag>>3;if(wireType===ProtoBuf.WIRE_TYPES.ENDGROUP){if(id!==expectedGroupEndId)throw Error("Illegal group end indicator for "+this.toString(true)+": "+id+" ("+(expectedGroupEndId?expectedGroupEndId+" expected":"not a group")+")");break}if(!(field=this._fieldsById[id])){switch(wireType){case ProtoBuf.WIRE_TYPES.VARINT:buffer.readVarint32();break;case ProtoBuf.WIRE_TYPES.BITS32:buffer.offset+=4;break;case ProtoBuf.WIRE_TYPES.BITS64:buffer.offset+=8;break;case ProtoBuf.WIRE_TYPES.LDELIM:var len=buffer.readVarint32();buffer.offset+=len;break;case ProtoBuf.WIRE_TYPES.STARTGROUP:while(skipTillGroupEnd(id,buffer)){}break;default:throw Error("Illegal wire type for unknown field "+id+" in "+this.toString(true)+"#decode: "+wireType)}continue}if(field.repeated&&!field.options["packed"])msg[field.name].push(field.decode(wireType,buffer));else{msg[field.name]=field.decode(wireType,buffer);if(field.oneof){if(this[field.oneof.name]!==null)this[this[field.oneof.name]]=null;msg[field.oneof.name]=field.name}}}for(var i=0,k=this._fields.length;i<k;++i){field=this._fields[i];if(msg[field.name]===null)if(field.required){var err=Error("Missing at least one required field for "+this.toString(true)+": "+field.name);err["decoded"]=msg;throw err}else if(field.defaultValue!==null)msg[field.name]=field.defaultValue}return msg};Reflect.Message=Message;var Field=function(builder,message,rule,type,name,id,options,oneof){T.call(this,builder,message,name);this.className="Message.Field";this.required=rule==="required";this.repeated=rule==="repeated";this.type=type;this.resolvedType=null;this.id=id;this.options=options||{};this.defaultValue=null;this.oneof=oneof||null;this.originalName=this.name;if(this.builder.options["convertFieldsToCamelCase"]&&!(this instanceof Message.ExtensionField))this.name=Field._toCamelCase(this.name)};Field._toCamelCase=function(name){return name.replace(/_([a-zA-Z])/g,function($0,$1){return $1.toUpperCase()})};var FieldPrototype=Field.prototype=Object.create(T.prototype);FieldPrototype.build=function(){this.defaultValue=typeof this.options["default"]!=="undefined"?this.verifyValue(this.options["default"]):null};function mkLong(value,unsigned){if(value&&typeof value.low==="number"&&typeof value.high==="number"&&typeof value.unsigned==="boolean"&&value.low===value.low&&value.high===value.high)return new ProtoBuf.Long(value.low,value.high,typeof unsigned==="undefined"?value.unsigned:unsigned);if(typeof value==="string")return ProtoBuf.Long.fromString(value,unsigned||false,10);if(typeof value==="number")return ProtoBuf.Long.fromNumber(value,unsigned||false);throw Error("not convertible to Long")}FieldPrototype.verifyValue=function(value,skipRepeated){skipRepeated=skipRepeated||false;var fail=function(val,msg){throw Error("Illegal value for "+this.toString(true)+" of type "+this.type.name+": "+val+" ("+msg+")")}.bind(this);if(value===null){if(this.required)fail(typeof value,"required");return null}var i;if(this.repeated&&!skipRepeated){if(!ProtoBuf.Util.isArray(value))value=[value];var res=[];for(i=0;i<value.length;i++)res.push(this.verifyValue(value[i],true));return res}if(!this.repeated&&ProtoBuf.Util.isArray(value))fail(typeof value,"no array expected");switch(this.type){case ProtoBuf.TYPES["int32"]:case ProtoBuf.TYPES["sint32"]:case ProtoBuf.TYPES["sfixed32"]:if(typeof value!=="number"||value===value&&value%1!==0)fail(typeof value,"not an integer");return value>4294967295?value|0:value;case ProtoBuf.TYPES["uint32"]:case ProtoBuf.TYPES["fixed32"]:if(typeof value!=="number"||value===value&&value%1!==0)fail(typeof value,"not an integer");return value<0?value>>>0:value;case ProtoBuf.TYPES["int64"]:case ProtoBuf.TYPES["sint64"]:case ProtoBuf.TYPES["sfixed64"]:{if(ProtoBuf.Long)try{return mkLong(value,false)}catch(e){fail(typeof value,e.message)}else fail(typeof value,"requires Long.js")}case ProtoBuf.TYPES["uint64"]:case ProtoBuf.TYPES["fixed64"]:{if(ProtoBuf.Long)try{return mkLong(value,true)}catch(e){fail(typeof value,e.message)}else fail(typeof value,"requires Long.js")}case ProtoBuf.TYPES["bool"]:if(typeof value!=="boolean")fail(typeof value,"not a boolean");return value;case ProtoBuf.TYPES["float"]:case ProtoBuf.TYPES["double"]:if(typeof value!=="number")fail(typeof value,"not a number");return value;case ProtoBuf.TYPES["string"]:if(typeof value!=="string"&&!(value&&value instanceof String))fail(typeof value,"not a string");return""+value;case ProtoBuf.TYPES["bytes"]:if(ByteBuffer.isByteBuffer(value))return value;return ByteBuffer.wrap(value,"base64");case ProtoBuf.TYPES["enum"]:{var values=this.resolvedType.getChildren(Enum.Value);for(i=0;i<values.length;i++)if(values[i].name==value)return values[i].id;else if(values[i].id==value)return values[i].id;fail(value,"not a valid enum value")}case ProtoBuf.TYPES["group"]:case ProtoBuf.TYPES["message"]:{if(!value||typeof value!=="object")fail(typeof value,"object expected");if(value instanceof this.resolvedType.clazz)return value;if(value instanceof ProtoBuf.Builder.Message){var obj={};for(var i in value)if(value.hasOwnProperty(i))obj[i]=value[i];value=obj}return new this.resolvedType.clazz(value)}}throw Error("[INTERNAL] Illegal value for "+this.toString(true)+": "+value+" (undefined type "+this.type+")")};FieldPrototype.encode=function(value,buffer){if(this.type===null||typeof this.type!=="object")throw Error("[INTERNAL] Unresolved type in "+this.toString(true)+": "+this.type);if(value===null||this.repeated&&value.length==0)return buffer;try{if(this.repeated){var i;if(this.options["packed"]&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){buffer.writeVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM);buffer.ensureCapacity(buffer.offset+=1);var start=buffer.offset;for(i=0;i<value.length;i++)this.encodeValue(value[i],buffer);var len=buffer.offset-start,varintLen=ByteBuffer.calculateVarint32(len);if(varintLen>1){var contents=buffer.slice(start,buffer.offset);start+=varintLen-1;buffer.offset=start;buffer.append(contents)}buffer.writeVarint32(len,start-varintLen)}else{for(i=0;i<value.length;i++)buffer.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(value[i],buffer)}}else buffer.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(value,buffer)}catch(e){throw Error("Illegal value for "+this.toString(true)+": "+value+" ("+e+")")}return buffer};FieldPrototype.encodeValue=function(value,buffer){if(value===null)return buffer;switch(this.type){case ProtoBuf.TYPES["int32"]:if(value<0)buffer.writeVarint64(value);else buffer.writeVarint32(value);break;case ProtoBuf.TYPES["uint32"]:buffer.writeVarint32(value);break;case ProtoBuf.TYPES["sint32"]:buffer.writeVarint32ZigZag(value);break;case ProtoBuf.TYPES["fixed32"]:buffer.writeUint32(value);break;case ProtoBuf.TYPES["sfixed32"]:buffer.writeInt32(value);break;case ProtoBuf.TYPES["int64"]:case ProtoBuf.TYPES["uint64"]:buffer.writeVarint64(value);break;case ProtoBuf.TYPES["sint64"]:buffer.writeVarint64ZigZag(value);break;case ProtoBuf.TYPES["fixed64"]:buffer.writeUint64(value);break;case ProtoBuf.TYPES["sfixed64"]:buffer.writeInt64(value);break;case ProtoBuf.TYPES["bool"]:if(typeof value==="string")buffer.writeVarint32(value.toLowerCase()==="false"?0:!!value);else buffer.writeVarint32(value?1:0);break;case ProtoBuf.TYPES["enum"]:buffer.writeVarint32(value);break;case ProtoBuf.TYPES["float"]:buffer.writeFloat32(value);break;case ProtoBuf.TYPES["double"]:buffer.writeFloat64(value);break;case ProtoBuf.TYPES["string"]:buffer.writeVString(value);break;case ProtoBuf.TYPES["bytes"]:if(value.remaining()<0)throw Error("Illegal value for "+this.toString(true)+": "+value.remaining()+" bytes remaining");var prevOffset=value.offset;buffer.writeVarint32(value.remaining());buffer.append(value);value.offset=prevOffset;break;case ProtoBuf.TYPES["message"]:var bb=(new ByteBuffer).LE();this.resolvedType.encode(value,bb);buffer.writeVarint32(bb.offset);buffer.append(bb.flip());break;case ProtoBuf.TYPES["group"]:this.resolvedType.encode(value,buffer);buffer.writeVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(true)+": "+value+" (unknown type)")}return buffer};FieldPrototype.calculate=function(value){value=this.verifyValue(value);if(this.type===null||typeof this.type!=="object")throw Error("[INTERNAL] Unresolved type in "+this.toString(true)+": "+this.type);if(value===null||this.repeated&&value.length==0)return 0;var n=0;try{if(this.repeated){var i,ni;if(this.options["packed"]&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){n+=ByteBuffer.calculateVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.LDELIM);ni=0;for(i=0;i<value.length;i++)ni+=this.calculateValue(value[i]);n+=ByteBuffer.calculateVarint32(ni);n+=ni}else{for(i=0;i<value.length;i++)n+=ByteBuffer.calculateVarint32(this.id<<3|this.type.wireType),n+=this.calculateValue(value[i])}}else{n+=ByteBuffer.calculateVarint32(this.id<<3|this.type.wireType);n+=this.calculateValue(value)}}catch(e){throw Error("Illegal value for "+this.toString(true)+": "+value+" ("+e+")")}return n};FieldPrototype.calculateValue=function(value){if(value===null)return 0;var n;switch(this.type){case ProtoBuf.TYPES["int32"]:return value<0?ByteBuffer.calculateVarint64(value):ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES["uint32"]:return ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES["sint32"]:return ByteBuffer.calculateVarint32(ByteBuffer.zigZagEncode32(value));case ProtoBuf.TYPES["fixed32"]:case ProtoBuf.TYPES["sfixed32"]:case ProtoBuf.TYPES["float"]:return 4;case ProtoBuf.TYPES["int64"]:case ProtoBuf.TYPES["uint64"]:return ByteBuffer.calculateVarint64(value);case ProtoBuf.TYPES["sint64"]:return ByteBuffer.calculateVarint64(ByteBuffer.zigZagEncode64(value));case ProtoBuf.TYPES["fixed64"]:case ProtoBuf.TYPES["sfixed64"]:return 8;case ProtoBuf.TYPES["bool"]:return 1;case ProtoBuf.TYPES["enum"]:return ByteBuffer.calculateVarint32(value);case ProtoBuf.TYPES["double"]:return 8;case ProtoBuf.TYPES["string"]:n=ByteBuffer.calculateUTF8Bytes(value);return ByteBuffer.calculateVarint32(n)+n;case ProtoBuf.TYPES["bytes"]:if(value.remaining()<0)throw Error("Illegal value for "+this.toString(true)+": "+value.remaining()+" bytes remaining");return ByteBuffer.calculateVarint32(value.remaining())+value.remaining();case ProtoBuf.TYPES["message"]:n=this.resolvedType.calculate(value);return ByteBuffer.calculateVarint32(n)+n;case ProtoBuf.TYPES["group"]:n=this.resolvedType.calculate(value);return n+ByteBuffer.calculateVarint32(this.id<<3|ProtoBuf.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(true)+": "+value+" (unknown type)")};FieldPrototype.decode=function(wireType,buffer,skipRepeated){var value,nBytes;if(wireType!=this.type.wireType&&(skipRepeated||(wireType!=ProtoBuf.WIRE_TYPES.LDELIM||!this.repeated)))throw Error("Illegal wire type for field "+this.toString(true)+": "+wireType+" ("+this.type.wireType+" expected)");if(wireType==ProtoBuf.WIRE_TYPES.LDELIM&&this.repeated&&this.options["packed"]&&ProtoBuf.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){if(!skipRepeated){nBytes=buffer.readVarint32();nBytes=buffer.offset+nBytes;var values=[];while(buffer.offset<nBytes)values.push(this.decode(this.type.wireType,buffer,true));return values}}switch(this.type){case ProtoBuf.TYPES["int32"]:return buffer.readVarint32()|0;case ProtoBuf.TYPES["uint32"]:return buffer.readVarint32()>>>0;case ProtoBuf.TYPES["sint32"]:return buffer.readVarint32ZigZag()|0;case ProtoBuf.TYPES["fixed32"]:return buffer.readUint32()>>>0;case ProtoBuf.TYPES["sfixed32"]:return buffer.readInt32()|0;case ProtoBuf.TYPES["int64"]:return buffer.readVarint64();case ProtoBuf.TYPES["uint64"]:return buffer.readVarint64().toUnsigned();case ProtoBuf.TYPES["sint64"]:return buffer.readVarint64ZigZag();case ProtoBuf.TYPES["fixed64"]:return buffer.readUint64();case ProtoBuf.TYPES["sfixed64"]:return buffer.readInt64();case ProtoBuf.TYPES["bool"]:return!!buffer.readVarint32();case ProtoBuf.TYPES["enum"]:return buffer.readVarint32();case ProtoBuf.TYPES["float"]:return buffer.readFloat();case ProtoBuf.TYPES["double"]:return buffer.readDouble();case ProtoBuf.TYPES["string"]:return buffer.readVString();case ProtoBuf.TYPES["bytes"]:{nBytes=buffer.readVarint32();if(buffer.remaining()<nBytes)throw Error("Illegal number of bytes for "+this.toString(true)+": "+nBytes+" required but got only "+buffer.remaining());value=buffer.clone();value.limit=value.offset+nBytes;buffer.offset+=nBytes;return value}case ProtoBuf.TYPES["message"]:{nBytes=buffer.readVarint32();return this.resolvedType.decode(buffer,nBytes)}case ProtoBuf.TYPES["group"]:return this.resolvedType.decode(buffer,-1,this.id)}throw Error("[INTERNAL] Illegal wire type for "+this.toString(true)+": "+wireType)};Reflect.Message.Field=Field;var ExtensionField=function(builder,message,rule,type,name,id,options){Field.call(this,builder,message,rule,type,name,id,options);this.extension};ExtensionField.prototype=Object.create(Field.prototype);Reflect.Message.ExtensionField=ExtensionField;var OneOf=function(builder,message,name){T.call(this,builder,message,name);this.fields=[]};Reflect.Message.OneOf=OneOf;var Enum=function(builder,parent,name,options){Namespace.call(this,builder,parent,name,options);this.className="Enum";this.object=null};var EnumPrototype=Enum.prototype=Object.create(Namespace.prototype);EnumPrototype.build=function(){var enm={},values=this.getChildren(Enum.Value);for(var i=0,k=values.length;i<k;++i)enm[values[i]["name"]]=values[i]["id"];if(Object.defineProperty)Object.defineProperty(enm,"$options",{value:this.buildOpt()});return this.object=enm};Reflect.Enum=Enum;var Value=function(builder,enm,name,id){T.call(this,builder,enm,name);this.className="Enum.Value";this.id=id};Value.prototype=Object.create(T.prototype);Reflect.Enum.Value=Value;var Extension=function(builder,parent,name,field){T.call(this,builder,parent,name);this.field=field};Extension.prototype=Object.create(T.prototype);Reflect.Extension=Extension;var Service=function(builder,root,name,options){Namespace.call(this,builder,root,name,options);this.className="Service";this.clazz=null};var ServicePrototype=Service.prototype=Object.create(Namespace.prototype);ServicePrototype.build=function(rebuild){if(this.clazz&&!rebuild)return this.clazz;return this.clazz=function(ProtoBuf,T){var Service=function(rpcImpl){ProtoBuf.Builder.Service.call(this);this.rpcImpl=rpcImpl||function(name,msg,callback){setTimeout(callback.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}};var ServicePrototype=Service.prototype=Object.create(ProtoBuf.Builder.Service.prototype);if(Object.defineProperty)Object.defineProperty(Service,"$options",{value:T.buildOpt()}),Object.defineProperty(ServicePrototype,"$options",{value:Service["$options"]});var rpc=T.getChildren(ProtoBuf.Reflect.Service.RPCMethod);for(var i=0;i<rpc.length;i++){(function(method){ServicePrototype[method.name]=function(req,callback){try{if(!req||!(req instanceof method.resolvedRequestType.clazz)){setTimeout(callback.bind(this,Error("Illegal request type provided to service method "+T.name+"#"+method.name)),0);return}this.rpcImpl(method.fqn(),req,function(err,res){if(err){callback(err);return}try{res=method.resolvedResponseType.clazz.decode(res)}catch(notABuffer){}if(!res||!(res instanceof method.resolvedResponseType.clazz)){callback(Error("Illegal response type received in service method "+T.name+"#"+method.name));return}callback(null,res)})}catch(err){setTimeout(callback.bind(this,err),0)}};Service[method.name]=function(rpcImpl,req,callback){new Service(rpcImpl)[method.name](req,callback)};if(Object.defineProperty)Object.defineProperty(Service[method.name],"$options",{value:method.buildOpt()}),Object.defineProperty(ServicePrototype[method.name],"$options",{value:Service[method.name]["$options"]})})(rpc[i])}return Service}(ProtoBuf,this)};Reflect.Service=Service;var Method=function(builder,svc,name,options){T.call(this,builder,svc,name);this.className="Service.Method";this.options=options||{}};var MethodPrototype=Method.prototype=Object.create(T.prototype);MethodPrototype.buildOpt=NamespacePrototype.buildOpt;Reflect.Service.Method=Method;var RPCMethod=function(builder,svc,name,request,response,options){Method.call(this,builder,svc,name,options);this.className="Service.RPCMethod";this.requestName=request;this.responseName=response;this.resolvedRequestType=null;this.resolvedResponseType=null};RPCMethod.prototype=Object.create(Method.prototype);Reflect.Service.RPCMethod=RPCMethod;return Reflect}(ProtoBuf);ProtoBuf.Builder=function(ProtoBuf,Lang,Reflect){"use strict";var Builder=function(options){this.ns=new Reflect.Namespace(this,null,"");this.ptr=this.ns;this.resolved=false;this.result=null;this.files={};this.importRoot=null;this.options=options||{}};var BuilderPrototype=Builder.prototype;BuilderPrototype.reset=function(){this.ptr=this.ns};BuilderPrototype.define=function(pkg,options){if(typeof pkg!=="string"||!Lang.TYPEREF.test(pkg))throw Error("Illegal package: "+pkg);var part=pkg.split("."),i;for(i=0;i<part.length;i++)if(!Lang.NAME.test(part[i]))throw Error("Illegal package: "+part[i]);for(i=0;i<part.length;i++){if(this.ptr.getChild(part[i])===null)this.ptr.addChild(new Reflect.Namespace(this,this.ptr,part[i],options));this.ptr=this.ptr.getChild(part[i])}return this};Builder.isValidMessage=function(def){if(typeof def["name"]!=="string"||!Lang.NAME.test(def["name"]))return false;if(typeof def["values"]!=="undefined"||typeof def["rpc"]!=="undefined")return false;var i;if(typeof def["fields"]!=="undefined"){if(!ProtoBuf.Util.isArray(def["fields"]))return false;var ids=[],id;for(i=0;i<def["fields"].length;i++){if(!Builder.isValidMessageField(def["fields"][i]))return false;id=parseInt(def["fields"][i]["id"],10);if(ids.indexOf(id)>=0)return false;ids.push(id)}ids=null}if(typeof def["enums"]!=="undefined"){if(!ProtoBuf.Util.isArray(def["enums"]))return false;for(i=0;i<def["enums"].length;i++)if(!Builder.isValidEnum(def["enums"][i]))return false}if(typeof def["messages"]!=="undefined"){if(!ProtoBuf.Util.isArray(def["messages"]))return false;for(i=0;i<def["messages"].length;i++)if(!Builder.isValidMessage(def["messages"][i])&&!Builder.isValidExtend(def["messages"][i]))return false}if(typeof def["extensions"]!=="undefined")if(!ProtoBuf.Util.isArray(def["extensions"])||def["extensions"].length!==2||typeof def["extensions"][0]!=="number"||typeof def["extensions"][1]!=="number")return false;return true};Builder.isValidMessageField=function(def){if(typeof def["rule"]!=="string"||typeof def["name"]!=="string"||typeof def["type"]!=="string"||typeof def["id"]==="undefined")return false;if(!Lang.RULE.test(def["rule"])||!Lang.NAME.test(def["name"])||!Lang.TYPEREF.test(def["type"])||!Lang.ID.test(""+def["id"]))return false;if(typeof def["options"]!=="undefined"){if(typeof def["options"]!=="object")return false;var keys=Object.keys(def["options"]);for(var i=0,key;i<keys.length;i++)if(typeof(key=keys[i])!=="string"||typeof def["options"][key]!=="string"&&typeof def["options"][key]!=="number"&&typeof def["options"][key]!=="boolean")return false}return true};Builder.isValidEnum=function(def){if(typeof def["name"]!=="string"||!Lang.NAME.test(def["name"]))return false;if(typeof def["values"]==="undefined"||!ProtoBuf.Util.isArray(def["values"])||def["values"].length==0)return false;for(var i=0;i<def["values"].length;i++){if(typeof def["values"][i]!="object")return false;if(typeof def["values"][i]["name"]!=="string"||typeof def["values"][i]["id"]==="undefined")return false;if(!Lang.NAME.test(def["values"][i]["name"])||!Lang.NEGID.test(""+def["values"][i]["id"]))return false}return true};BuilderPrototype.create=function(defs){if(!defs)return this;if(!ProtoBuf.Util.isArray(defs))defs=[defs];if(defs.length==0)return this;var stack=[];stack.push(defs);while(stack.length>0){defs=stack.pop();if(ProtoBuf.Util.isArray(defs)){while(defs.length>0){var def=defs.shift();if(Builder.isValidMessage(def)){var obj=new Reflect.Message(this,this.ptr,def["name"],def["options"],def["isGroup"]);var oneofs={};if(def["oneofs"]){var keys=Object.keys(def["oneofs"]);for(var i=0,k=keys.length;i<k;++i)obj.addChild(oneofs[keys[i]]=new Reflect.Message.OneOf(this,obj,keys[i]))}if(def["fields"]&&def["fields"].length>0){for(i=0,k=def["fields"].length;i<k;++i){var fld=def["fields"][i];if(obj.getChild(fld["id"])!==null)throw Error("Duplicate field id in message "+obj.name+": "+fld["id"]);if(fld["options"]){var opts=Object.keys(fld["options"]);for(var j=0,l=opts.length;j<l;++j){if(typeof opts[j]!=="string")throw Error("Illegal field option name in message "+obj.name+"#"+fld["name"]+": "+opts[j]);if(typeof fld["options"][opts[j]]!=="string"&&typeof fld["options"][opts[j]]!=="number"&&typeof fld["options"][opts[j]]!=="boolean")throw Error("Illegal field option value in message "+obj.name+"#"+fld["name"]+"#"+opts[j]+": "+fld["options"][opts[j]])}}var oneof=null;if(typeof fld["oneof"]==="string"){oneof=oneofs[fld["oneof"]];if(typeof oneof==="undefined")throw Error("Illegal oneof in message "+obj.name+"#"+fld["name"]+": "+fld["oneof"])}fld=new Reflect.Message.Field(this,obj,fld["rule"],fld["type"],fld["name"],fld["id"],fld["options"],oneof);if(oneof)oneof.fields.push(fld);obj.addChild(fld)}}var subObj=[];if(typeof def["enums"]!=="undefined"&&def["enums"].length>0)for(i=0;i<def["enums"].length;i++)subObj.push(def["enums"][i]);if(def["messages"]&&def["messages"].length>0)for(i=0;i<def["messages"].length;i++)subObj.push(def["messages"][i]);if(def["extensions"]){obj.extensions=def["extensions"];if(obj.extensions[0]<ProtoBuf.ID_MIN)obj.extensions[0]=ProtoBuf.ID_MIN;if(obj.extensions[1]>ProtoBuf.ID_MAX)obj.extensions[1]=ProtoBuf.ID_MAX}this.ptr.addChild(obj);if(subObj.length>0){stack.push(defs);defs=subObj;subObj=null;this.ptr=obj;obj=null;continue}subObj=null;obj=null}else if(Builder.isValidEnum(def)){obj=new Reflect.Enum(this,this.ptr,def["name"],def["options"]);for(i=0;i<def["values"].length;i++)obj.addChild(new Reflect.Enum.Value(this,obj,def["values"][i]["name"],def["values"][i]["id"]));this.ptr.addChild(obj);obj=null}else if(Builder.isValidService(def)){obj=new Reflect.Service(this,this.ptr,def["name"],def["options"]);for(i in def["rpc"])if(def["rpc"].hasOwnProperty(i))obj.addChild(new Reflect.Service.RPCMethod(this,obj,i,def["rpc"][i]["request"],def["rpc"][i]["response"],def["rpc"][i]["options"]));this.ptr.addChild(obj);obj=null}else if(Builder.isValidExtend(def)){obj=this.ptr.resolve(def["ref"]);if(obj){for(i=0;i<def["fields"].length;i++){if(obj.getChild(def["fields"][i]["id"])!==null)throw Error("Duplicate extended field id in message "+obj.name+": "+def["fields"][i]["id"]);if(def["fields"][i]["id"]<obj.extensions[0]||def["fields"][i]["id"]>obj.extensions[1])throw Error("Illegal extended field id in message "+obj.name+": "+def["fields"][i]["id"]+" ("+obj.extensions.join(" to ")+" expected)");var name=def["fields"][i]["name"];if(this.options["convertFieldsToCamelCase"])name=Reflect.Message.Field._toCamelCase(def["fields"][i]["name"]);fld=new Reflect.Message.ExtensionField(this,obj,def["fields"][i]["rule"],def["fields"][i]["type"],this.ptr.fqn()+"."+name,def["fields"][i]["id"],def["fields"][i]["options"]);var ext=new Reflect.Extension(this,this.ptr,def["fields"][i]["name"],fld);fld.extension=ext;this.ptr.addChild(ext);obj.addChild(fld)}}else if(!/\.?google\.protobuf\./.test(def["ref"]))throw Error("Extended message "+def["ref"]+" is not defined")}else throw Error("Not a valid definition: "+JSON.stringify(def));def=null}}else throw Error("Not a valid namespace: "+JSON.stringify(defs));defs=null;this.ptr=this.ptr.parent}this.resolved=false;this.result=null;return this};BuilderPrototype["import"]=function(json,filename){if(typeof filename==="string"){if(ProtoBuf.Util.IS_NODE)filename=require("path")["resolve"](filename);if(this.files[filename]===true){this.reset();return this}this.files[filename]=true}if(!!json["imports"]&&json["imports"].length>0){var importRoot,delim="/",resetRoot=false;if(typeof filename==="object"){this.importRoot=filename["root"];resetRoot=true;importRoot=this.importRoot;filename=filename["file"];if(importRoot.indexOf("\\")>=0||filename.indexOf("\\")>=0)delim="\\"}else if(typeof filename==="string"){if(this.importRoot)importRoot=this.importRoot;else{if(filename.indexOf("/")>=0){importRoot=filename.replace(/\/[^\/]*$/,"");if(importRoot==="")importRoot="/"}else if(filename.indexOf("\\")>=0){importRoot=filename.replace(/\\[^\\]*$/,"");delim="\\"}else importRoot="."}}else importRoot=null;for(var i=0;i<json["imports"].length;i++){if(typeof json["imports"][i]==="string"){if(!importRoot)throw Error("Cannot determine import root: File name is unknown");var importFilename=json["imports"][i];if(/^google\/protobuf\//.test(importFilename))continue;importFilename=importRoot+delim+importFilename;if(this.files[importFilename]===true)continue;if(/\.proto$/i.test(importFilename)&&!ProtoBuf.DotProto)importFilename=importFilename.replace(/\.proto$/,".json");var contents=ProtoBuf.Util.fetch(importFilename);if(contents===null)throw Error("Failed to import '"+importFilename+"' in '"+filename+"': File not found");if(/\.json$/i.test(importFilename))this["import"](JSON.parse(contents+""),importFilename);else this["import"](new ProtoBuf.DotProto.Parser(contents+"").parse(),importFilename)}else if(!filename)this["import"](json["imports"][i]);else if(/\.(\w+)$/.test(filename))this["import"](json["imports"][i],filename.replace(/^(.+)\.(\w+)$/,function($0,$1,$2){return $1+"_import"+i+"."+$2}));else this["import"](json["imports"][i],filename+"_import"+i)}if(resetRoot)this.importRoot=null}if(json["messages"]){if(json["package"])this.define(json["package"],json["options"]);this.create(json["messages"]);this.reset()}if(json["enums"]){if(json["package"])this.define(json["package"],json["options"]);this.create(json["enums"]);this.reset()}if(json["services"]){if(json["package"])this.define(json["package"],json["options"]);this.create(json["services"]);this.reset()}if(json["extends"]){if(json["package"])this.define(json["package"],json["options"]);this.create(json["extends"]);this.reset()}return this};Builder.isValidService=function(def){return!(typeof def["name"]!=="string"||!Lang.NAME.test(def["name"])||typeof def["rpc"]!=="object")};Builder.isValidExtend=function(def){if(typeof def["ref"]!=="string"||!Lang.TYPEREF.test(def["ref"]))return false;var i;if(typeof def["fields"]!=="undefined"){if(!ProtoBuf.Util.isArray(def["fields"]))return false;var ids=[],id;for(i=0;i<def["fields"].length;i++){if(!Builder.isValidMessageField(def["fields"][i]))return false;id=parseInt(def["id"],10);if(ids.indexOf(id)>=0)return false;ids.push(id)}ids=null}return true};BuilderPrototype.resolveAll=function(){var res;if(this.ptr==null||typeof this.ptr.type==="object")return;if(this.ptr instanceof Reflect.Namespace){var children=this.ptr.children;for(var i=0,k=children.length;i<k;++i)this.ptr=children[i],this.resolveAll()}else if(this.ptr instanceof Reflect.Message.Field){if(!Lang.TYPE.test(this.ptr.type)){if(!Lang.TYPEREF.test(this.ptr.type))throw Error("Illegal type reference in "+this.ptr.toString(true)+": "+this.ptr.type);res=(this.ptr instanceof Reflect.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,true);if(!res)throw Error("Unresolvable type reference in "+this.ptr.toString(true)+": "+this.ptr.type);this.ptr.resolvedType=res;if(res instanceof Reflect.Enum)this.ptr.type=ProtoBuf.TYPES["enum"];else if(res instanceof Reflect.Message)this.ptr.type=res.isGroup?ProtoBuf.TYPES["group"]:ProtoBuf.TYPES["message"];else throw Error("Illegal type reference in "+this.ptr.toString(true)+": "+this.ptr.type)}else this.ptr.type=ProtoBuf.TYPES[this.ptr.type]}else if(this.ptr instanceof ProtoBuf.Reflect.Enum.Value){}else if(this.ptr instanceof ProtoBuf.Reflect.Service.Method){if(this.ptr instanceof ProtoBuf.Reflect.Service.RPCMethod){res=this.ptr.parent.resolve(this.ptr.requestName);if(!res||!(res instanceof ProtoBuf.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(true)+": "+this.ptr.requestName);this.ptr.resolvedRequestType=res;res=this.ptr.parent.resolve(this.ptr.responseName);if(!res||!(res instanceof ProtoBuf.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(true)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=res}else{throw Error("Illegal service type in "+this.ptr.toString(true))}}else if(!(this.ptr instanceof ProtoBuf.Reflect.Message.OneOf)&&!(this.ptr instanceof ProtoBuf.Reflect.Extension))throw Error("Illegal object in namespace: "+typeof this.ptr+":"+this.ptr);this.reset()};BuilderPrototype.build=function(path){this.reset();if(!this.resolved)this.resolveAll(),this.resolved=true,this.result=null;if(this.result==null)this.result=this.ns.build();if(!path)return this.result;else{var part=path.split(".");var ptr=this.result;for(var i=0;i<part.length;i++)if(ptr[part[i]])ptr=ptr[part[i]];else{ptr=null;break}return ptr}};BuilderPrototype.lookup=function(path){return path?this.ns.resolve(path):this.ns};BuilderPrototype.toString=function(){return"Builder"};Builder.Message=function(){};Builder.Service=function(){};return Builder}(ProtoBuf,ProtoBuf.Lang,ProtoBuf.Reflect);ProtoBuf.loadProto=function(proto,builder,filename){if(typeof builder==="string"||builder&&typeof builder["file"]==="string"&&typeof builder["root"]==="string")filename=builder,builder=undefined;return ProtoBuf.loadJson(new ProtoBuf.DotProto.Parser(proto).parse(),builder,filename)};ProtoBuf.protoFromString=ProtoBuf.loadProto;ProtoBuf.loadProtoFile=function(filename,callback,builder){if(callback&&typeof callback==="object")builder=callback,callback=null;else if(!callback||typeof callback!=="function")callback=null;if(callback)return ProtoBuf.Util.fetch(typeof filename==="string"?filename:filename["root"]+"/"+filename["file"],function(contents){if(contents===null){callback(Error("Failed to fetch file"));return}try{callback(null,ProtoBuf.loadProto(contents,builder,filename))}catch(e){callback(e)}});var contents=ProtoBuf.Util.fetch(typeof filename==="object"?filename["root"]+"/"+filename["file"]:filename);return contents===null?null:ProtoBuf.loadProto(contents,builder,filename)};ProtoBuf.protoFromFile=ProtoBuf.loadProtoFile;ProtoBuf.newBuilder=function(options){options=options||{};if(typeof options["convertFieldsToCamelCase"]==="undefined")options["convertFieldsToCamelCase"]=ProtoBuf.convertFieldsToCamelCase;if(typeof options["populateAccessors"]==="undefined")options["populateAccessors"]=ProtoBuf.populateAccessors;return new ProtoBuf.Builder(options)};ProtoBuf.loadJson=function(json,builder,filename){if(typeof builder==="string"||builder&&typeof builder["file"]==="string"&&typeof builder["root"]==="string")filename=builder,builder=null;if(!builder||typeof builder!=="object")builder=ProtoBuf.newBuilder();if(typeof json==="string")json=JSON.parse(json);builder["import"](json,filename);builder.resolveAll();return builder};ProtoBuf.loadJsonFile=function(filename,callback,builder){if(callback&&typeof callback==="object")builder=callback,callback=null;else if(!callback||typeof callback!=="function")callback=null;if(callback)return ProtoBuf.Util.fetch(typeof filename==="string"?filename:filename["root"]+"/"+filename["file"],function(contents){if(contents===null){callback(Error("Failed to fetch file"));return}try{callback(null,ProtoBuf.loadJson(JSON.parse(contents),builder,filename))}catch(e){callback(e)}});var contents=ProtoBuf.Util.fetch(typeof filename==="object"?filename["root"]+"/"+filename["file"]:filename);return contents===null?null:ProtoBuf.loadJson(JSON.parse(contents),builder,filename)};return ProtoBuf}if(typeof require==="function"&&typeof module==="object"&&module&&typeof exports==="object"&&exports)module["exports"]=init(require("bytebuffer"));
else if(typeof define==="function"&&define["amd"])define(["ByteBuffer"],init);else(global["dcodeIO"]=global["dcodeIO"]||{})["ProtoBuf"]=init(global["dcodeIO"]["ByteBuffer"])})(this)},{bytebuffer:195,fs:1,path:23}],194:[function(require,module,exports){var ProtoBuf=require("./dist/ProtoBuf.js");module.exports=ProtoBuf},{"./dist/ProtoBuf.js":193}],195:[function(require,module,exports){(function(global){"use strict";function loadByteBuffer(Long){var ByteBuffer=function(capacity,littleEndian,noAssert){if(typeof capacity==="undefined")capacity=ByteBuffer.DEFAULT_CAPACITY;if(typeof littleEndian==="undefined")littleEndian=ByteBuffer.DEFAULT_ENDIAN;if(typeof noAssert==="undefined")noAssert=ByteBuffer.DEFAULT_NOASSERT;if(!noAssert){capacity=capacity|0;if(capacity<0)throw RangeError("Illegal capacity");littleEndian=!!littleEndian;noAssert=!!noAssert}this.buffer=capacity===0?EMPTY_BUFFER:new ArrayBuffer(capacity);this.view=capacity===0?null:new DataView(this.buffer);this.offset=0;this.markedOffset=-1;this.limit=capacity;this.littleEndian=typeof littleEndian!=="undefined"?!!littleEndian:false;this.noAssert=!!noAssert};ByteBuffer.VERSION="3.5.4";ByteBuffer.LITTLE_ENDIAN=true;ByteBuffer.BIG_ENDIAN=false;ByteBuffer.DEFAULT_CAPACITY=16;ByteBuffer.DEFAULT_ENDIAN=ByteBuffer.BIG_ENDIAN;ByteBuffer.DEFAULT_NOASSERT=false;ByteBuffer.Long=Long||null;var ByteBufferPrototype=ByteBuffer.prototype;var EMPTY_BUFFER=new ArrayBuffer(0);var stringFromCharCode=String.fromCharCode;function stringSource(s){var i=0;return function(){return i<s.length?s.charCodeAt(i++):null}}function stringDestination(){var cs=[],ps=[];return function(){if(arguments.length===0)return ps.join("")+stringFromCharCode.apply(String,cs);if(cs.length+arguments.length>1024)ps.push(stringFromCharCode.apply(String,cs)),cs.length=0;Array.prototype.push.apply(cs,arguments)}}ByteBuffer.allocate=function(capacity,littleEndian,noAssert){return new ByteBuffer(capacity,littleEndian,noAssert)};ByteBuffer.concat=function(buffers,encoding,littleEndian,noAssert){if(typeof encoding==="boolean"||typeof encoding!=="string"){noAssert=littleEndian;littleEndian=encoding;encoding=undefined}var capacity=0;for(var i=0,k=buffers.length,length;i<k;++i){if(!ByteBuffer.isByteBuffer(buffers[i]))buffers[i]=ByteBuffer.wrap(buffers[i],encoding);length=buffers[i].limit-buffers[i].offset;if(length>0)capacity+=length}if(capacity===0)return new ByteBuffer(0,littleEndian,noAssert);var bb=new ByteBuffer(capacity,littleEndian,noAssert),bi;var view=new Uint8Array(bb.buffer);i=0;while(i<k){bi=buffers[i++];length=bi.limit-bi.offset;if(length<=0)continue;view.set(new Uint8Array(bi.buffer).subarray(bi.offset,bi.limit),bb.offset);bb.offset+=length}bb.limit=bb.offset;bb.offset=0;return bb};ByteBuffer.isByteBuffer=function(bb){return(bb&&bb instanceof ByteBuffer)===true};ByteBuffer.type=function(){return ArrayBuffer};ByteBuffer.wrap=function(buffer,encoding,littleEndian,noAssert){if(typeof encoding!=="string"){noAssert=littleEndian;littleEndian=encoding;encoding=undefined}if(typeof buffer==="string"){if(typeof encoding==="undefined")encoding="utf8";switch(encoding){case"base64":return ByteBuffer.fromBase64(buffer,littleEndian);case"hex":return ByteBuffer.fromHex(buffer,littleEndian);case"binary":return ByteBuffer.fromBinary(buffer,littleEndian);case"utf8":return ByteBuffer.fromUTF8(buffer,littleEndian);case"debug":return ByteBuffer.fromDebug(buffer,littleEndian);default:throw Error("Unsupported encoding: "+encoding)}}if(buffer===null||typeof buffer!=="object")throw TypeError("Illegal buffer");var bb;if(ByteBuffer.isByteBuffer(buffer)){bb=ByteBufferPrototype.clone.call(buffer);bb.markedOffset=-1;return bb}if(buffer instanceof Uint8Array){bb=new ByteBuffer(0,littleEndian,noAssert);if(buffer.length>0){bb.buffer=buffer.buffer;bb.offset=buffer.byteOffset;bb.limit=buffer.byteOffset+buffer.length;bb.view=buffer.length>0?new DataView(buffer.buffer):null}}else if(buffer instanceof ArrayBuffer){bb=new ByteBuffer(0,littleEndian,noAssert);if(buffer.byteLength>0){bb.buffer=buffer;bb.offset=0;bb.limit=buffer.byteLength;bb.view=buffer.byteLength>0?new DataView(buffer):null}}else if(Object.prototype.toString.call(buffer)==="[object Array]"){bb=new ByteBuffer(buffer.length,littleEndian,noAssert);bb.limit=buffer.length;for(i=0;i<buffer.length;++i)bb.view.setUint8(i,buffer[i])}else throw TypeError("Illegal buffer");return bb};ByteBufferPrototype.writeInt8=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value|=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=1;var capacity0=this.buffer.byteLength;if(offset>capacity0)this.resize((capacity0*=2)>offset?capacity0:offset);offset-=1;this.view.setInt8(offset,value);if(relative)this.offset+=1;return this};ByteBufferPrototype.writeByte=ByteBufferPrototype.writeInt8;ByteBufferPrototype.readInt8=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var value=this.view.getInt8(offset);if(relative)this.offset+=1;return value};ByteBufferPrototype.readByte=ByteBufferPrototype.readInt8;ByteBufferPrototype.writeUint8=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value>>>=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=1;var capacity1=this.buffer.byteLength;if(offset>capacity1)this.resize((capacity1*=2)>offset?capacity1:offset);offset-=1;this.view.setUint8(offset,value);if(relative)this.offset+=1;return this};ByteBufferPrototype.readUint8=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var value=this.view.getUint8(offset);if(relative)this.offset+=1;return value};ByteBufferPrototype.writeInt16=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value|=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=2;var capacity2=this.buffer.byteLength;if(offset>capacity2)this.resize((capacity2*=2)>offset?capacity2:offset);offset-=2;this.view.setInt16(offset,value,this.littleEndian);if(relative)this.offset+=2;return this};ByteBufferPrototype.writeShort=ByteBufferPrototype.writeInt16;ByteBufferPrototype.readInt16=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+2+") <= "+this.buffer.byteLength)}var value=this.view.getInt16(offset,this.littleEndian);if(relative)this.offset+=2;return value};ByteBufferPrototype.readShort=ByteBufferPrototype.readInt16;ByteBufferPrototype.writeUint16=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value>>>=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=2;var capacity3=this.buffer.byteLength;if(offset>capacity3)this.resize((capacity3*=2)>offset?capacity3:offset);offset-=2;this.view.setUint16(offset,value,this.littleEndian);if(relative)this.offset+=2;return this};ByteBufferPrototype.readUint16=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+2+") <= "+this.buffer.byteLength)}var value=this.view.getUint16(offset,this.littleEndian);if(relative)this.offset+=2;return value};ByteBufferPrototype.writeInt32=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value|=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=4;var capacity4=this.buffer.byteLength;if(offset>capacity4)this.resize((capacity4*=2)>offset?capacity4:offset);offset-=4;this.view.setInt32(offset,value,this.littleEndian);if(relative)this.offset+=4;return this};ByteBufferPrototype.writeInt=ByteBufferPrototype.writeInt32;ByteBufferPrototype.readInt32=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+4+") <= "+this.buffer.byteLength)}var value=this.view.getInt32(offset,this.littleEndian);if(relative)this.offset+=4;return value};ByteBufferPrototype.readInt=ByteBufferPrototype.readInt32;ByteBufferPrototype.writeUint32=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value>>>=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=4;var capacity5=this.buffer.byteLength;if(offset>capacity5)this.resize((capacity5*=2)>offset?capacity5:offset);offset-=4;this.view.setUint32(offset,value,this.littleEndian);if(relative)this.offset+=4;return this};ByteBufferPrototype.readUint32=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+4+") <= "+this.buffer.byteLength)}var value=this.view.getUint32(offset,this.littleEndian);if(relative)this.offset+=4;return value};if(Long){ByteBufferPrototype.writeInt64=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value==="number")value=Long.fromNumber(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}if(typeof value==="number")value=Long.fromNumber(value);offset+=8;var capacity6=this.buffer.byteLength;if(offset>capacity6)this.resize((capacity6*=2)>offset?capacity6:offset);offset-=8;if(this.littleEndian){this.view.setInt32(offset,value.low,true);this.view.setInt32(offset+4,value.high,true)}else{this.view.setInt32(offset,value.high,false);this.view.setInt32(offset+4,value.low,false)}if(relative)this.offset+=8;return this};ByteBufferPrototype.writeLong=ByteBufferPrototype.writeInt64;ByteBufferPrototype.readInt64=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+8+") <= "+this.buffer.byteLength)}var value=this.littleEndian?new Long(this.view.getInt32(offset,true),this.view.getInt32(offset+4,true),false):new Long(this.view.getInt32(offset+4,false),this.view.getInt32(offset,false),false);if(relative)this.offset+=8;return value};ByteBufferPrototype.readLong=ByteBufferPrototype.readInt64;ByteBufferPrototype.writeUint64=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value==="number")value=Long.fromNumber(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}if(typeof value==="number")value=Long.fromNumber(value);offset+=8;var capacity7=this.buffer.byteLength;if(offset>capacity7)this.resize((capacity7*=2)>offset?capacity7:offset);offset-=8;if(this.littleEndian){this.view.setInt32(offset,value.low,true);this.view.setInt32(offset+4,value.high,true)}else{this.view.setInt32(offset,value.high,false);this.view.setInt32(offset+4,value.low,false)}if(relative)this.offset+=8;return this};ByteBufferPrototype.readUint64=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+8+") <= "+this.buffer.byteLength)}var value=this.littleEndian?new Long(this.view.getInt32(offset,true),this.view.getInt32(offset+4,true),true):new Long(this.view.getInt32(offset+4,false),this.view.getInt32(offset,false),true);if(relative)this.offset+=8;return value}}ByteBufferPrototype.writeFloat32=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number")throw TypeError("Illegal value: "+value+" (not a number)");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=4;var capacity8=this.buffer.byteLength;if(offset>capacity8)this.resize((capacity8*=2)>offset?capacity8:offset);offset-=4;this.view.setFloat32(offset,value,this.littleEndian);if(relative)this.offset+=4;return this};ByteBufferPrototype.writeFloat=ByteBufferPrototype.writeFloat32;ByteBufferPrototype.readFloat32=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+4+") <= "+this.buffer.byteLength)}var value=this.view.getFloat32(offset,this.littleEndian);if(relative)this.offset+=4;return value};ByteBufferPrototype.readFloat=ByteBufferPrototype.readFloat32;ByteBufferPrototype.writeFloat64=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number")throw TypeError("Illegal value: "+value+" (not a number)");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}offset+=8;var capacity9=this.buffer.byteLength;if(offset>capacity9)this.resize((capacity9*=2)>offset?capacity9:offset);offset-=8;this.view.setFloat64(offset,value,this.littleEndian);if(relative)this.offset+=8;return this};ByteBufferPrototype.writeDouble=ByteBufferPrototype.writeFloat64;ByteBufferPrototype.readFloat64=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+8+") <= "+this.buffer.byteLength)}var value=this.view.getFloat64(offset,this.littleEndian);if(relative)this.offset+=8;return value};ByteBufferPrototype.readDouble=ByteBufferPrototype.readFloat64;ByteBuffer.MAX_VARINT32_BYTES=5;ByteBuffer.calculateVarint32=function(value){value=value>>>0;if(value<1<<7)return 1;else if(value<1<<14)return 2;else if(value<1<<21)return 3;else if(value<1<<28)return 4;else return 5};ByteBuffer.zigZagEncode32=function(n){return((n|=0)<<1^n>>31)>>>0};ByteBuffer.zigZagDecode32=function(n){return n>>>1^-(n&1)|0};ByteBufferPrototype.writeVarint32=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value|=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var size=ByteBuffer.calculateVarint32(value),b;offset+=size;var capacity10=this.buffer.byteLength;if(offset>capacity10)this.resize((capacity10*=2)>offset?capacity10:offset);offset-=size;this.view.setUint8(offset,b=value|128);value>>>=0;if(value>=1<<7){b=value>>7|128;this.view.setUint8(offset+1,b);if(value>=1<<14){b=value>>14|128;this.view.setUint8(offset+2,b);if(value>=1<<21){b=value>>21|128;this.view.setUint8(offset+3,b);if(value>=1<<28){this.view.setUint8(offset+4,value>>28&15);size=5}else{this.view.setUint8(offset+3,b&127);size=4}}else{this.view.setUint8(offset+2,b&127);size=3}}else{this.view.setUint8(offset+1,b&127);size=2}}else{this.view.setUint8(offset,b&127);size=1}if(relative){this.offset+=size;return this}return size};ByteBufferPrototype.writeVarint32ZigZag=function(value,offset){return this.writeVarint32(ByteBuffer.zigZagEncode32(value),offset)};ByteBufferPrototype.readVarint32=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var size=0,value=0>>>0,temp,ioffset;do{ioffset=offset+size;if(!this.noAssert&&ioffset>this.limit){var err=Error("Truncated");err["truncated"]=true;throw err}temp=this.view.getUint8(ioffset);if(size<5)value|=(temp&127)<<7*size>>>0;++size}while((temp&128)===128);value=value|0;if(relative){this.offset+=size;return value}return{value:value,length:size}};ByteBufferPrototype.readVarint32ZigZag=function(offset){var val=this.readVarint32(offset);if(typeof val==="object")val["value"]=ByteBuffer.zigZagDecode32(val["value"]);else val=ByteBuffer.zigZagDecode32(val);return val};if(Long){ByteBuffer.MAX_VARINT64_BYTES=10;ByteBuffer.calculateVarint64=function(value){if(typeof value==="number")value=Long.fromNumber(value);var part0=value.toInt()>>>0,part1=value.shiftRightUnsigned(28).toInt()>>>0,part2=value.shiftRightUnsigned(56).toInt()>>>0;if(part2==0){if(part1==0){if(part0<1<<14)return part0<1<<7?1:2;else return part0<1<<21?3:4}else{if(part1<1<<14)return part1<1<<7?5:6;else return part1<1<<21?7:8}}else return part2<1<<7?9:10};ByteBuffer.zigZagEncode64=function(value){if(typeof value==="number")value=Long.fromNumber(value,false);else if(value.unsigned!==false)value=value.toSigned();return value.shiftLeft(1).xor(value.shiftRight(63)).toUnsigned()};ByteBuffer.zigZagDecode64=function(value){if(typeof value==="number")value=Long.fromNumber(value,false);else if(value.unsigned!==false)value=value.toSigned();return value.shiftRightUnsigned(1).xor(value.and(Long.ONE).toSigned().negate()).toSigned()};ByteBufferPrototype.writeVarint64=function(value,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof value==="number")value=Long.fromNumber(value);else if(!(value&&value instanceof Long))throw TypeError("Illegal value: "+value+" (not an integer or Long)");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}if(typeof value==="number")value=Long.fromNumber(value,false);else if(value.unsigned!==false)value=value.toSigned();var size=ByteBuffer.calculateVarint64(value),part0=value.toInt()>>>0,part1=value.shiftRightUnsigned(28).toInt()>>>0,part2=value.shiftRightUnsigned(56).toInt()>>>0;offset+=size;var capacity11=this.buffer.byteLength;if(offset>capacity11)this.resize((capacity11*=2)>offset?capacity11:offset);offset-=size;switch(size){case 10:this.view.setUint8(offset+9,part2>>>7&1);case 9:this.view.setUint8(offset+8,size!==9?part2|128:part2&127);case 8:this.view.setUint8(offset+7,size!==8?part1>>>21|128:part1>>>21&127);case 7:this.view.setUint8(offset+6,size!==7?part1>>>14|128:part1>>>14&127);case 6:this.view.setUint8(offset+5,size!==6?part1>>>7|128:part1>>>7&127);case 5:this.view.setUint8(offset+4,size!==5?part1|128:part1&127);case 4:this.view.setUint8(offset+3,size!==4?part0>>>21|128:part0>>>21&127);case 3:this.view.setUint8(offset+2,size!==3?part0>>>14|128:part0>>>14&127);case 2:this.view.setUint8(offset+1,size!==2?part0>>>7|128:part0>>>7&127);case 1:this.view.setUint8(offset,size!==1?part0|128:part0&127)}if(relative){this.offset+=size;return this}else{return size}};ByteBufferPrototype.writeVarint64ZigZag=function(value,offset){return this.writeVarint64(ByteBuffer.zigZagEncode64(value),offset)};ByteBufferPrototype.readVarint64=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var start=offset,part0=0,part1=0,part2=0,b=0;b=this.view.getUint8(offset++);part0=b&127;if(b&128){b=this.view.getUint8(offset++);part0|=(b&127)<<7;if(b&128){b=this.view.getUint8(offset++);part0|=(b&127)<<14;if(b&128){b=this.view.getUint8(offset++);part0|=(b&127)<<21;if(b&128){b=this.view.getUint8(offset++);part1=b&127;if(b&128){b=this.view.getUint8(offset++);part1|=(b&127)<<7;if(b&128){b=this.view.getUint8(offset++);part1|=(b&127)<<14;if(b&128){b=this.view.getUint8(offset++);part1|=(b&127)<<21;if(b&128){b=this.view.getUint8(offset++);part2=b&127;if(b&128){b=this.view.getUint8(offset++);part2|=(b&127)<<7;if(b&128){throw Error("Buffer overrun")}}}}}}}}}}var value=Long.fromBits(part0|part1<<28,part1>>>4|part2<<24,false);if(relative){this.offset=offset;return value}else{return{value:value,length:offset-start}}};ByteBufferPrototype.readVarint64ZigZag=function(offset){var val=this.readVarint64(offset);if(val&&val["value"]instanceof Long)val["value"]=ByteBuffer.zigZagDecode64(val["value"]);else val=ByteBuffer.zigZagDecode64(val);return val}}ByteBufferPrototype.writeCString=function(str,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;var i,k=str.length;if(!this.noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string");for(i=0;i<k;++i){if(str.charCodeAt(i)===0)throw RangeError("Illegal str: Contains NULL-characters")}if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var start=offset;k=utfx.calculateUTF16asUTF8(stringSource(str))[1];offset+=k+1;var capacity12=this.buffer.byteLength;if(offset>capacity12)this.resize((capacity12*=2)>offset?capacity12:offset);offset-=k+1;utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view.setUint8(offset++,b)}.bind(this));this.view.setUint8(offset++,0);if(relative){this.offset=offset-start;return this}return k};ByteBufferPrototype.readCString=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var start=offset,temp;var sd,b=-1;utfx.decodeUTF8toUTF16(function(){if(b===0)return null;if(offset>=this.limit)throw RangeError("Illegal range: Truncated data, "+offset+" < "+this.limit);return(b=this.view.getUint8(offset++))===0?null:b}.bind(this),sd=stringDestination(),true);if(relative){this.offset=offset;return sd()}else{return{string:sd(),length:offset-start}}};ByteBufferPrototype.writeIString=function(str,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var start=offset,k;k=utfx.calculateUTF16asUTF8(stringSource(str),this.noAssert)[1];offset+=4+k;var capacity13=this.buffer.byteLength;if(offset>capacity13)this.resize((capacity13*=2)>offset?capacity13:offset);offset-=4+k;this.view.setUint32(offset,k,this.littleEndian);offset+=4;utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view.setUint8(offset++,b)}.bind(this));if(offset!==start+4+k)throw RangeError("Illegal range: Truncated data, "+offset+" == "+(offset+4+k));if(relative){this.offset=offset;return this}return offset-start};ByteBufferPrototype.readIString=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+4+") <= "+this.buffer.byteLength)}var temp=0,start=offset,str;temp=this.view.getUint32(offset,this.littleEndian);offset+=4;var k=offset+temp,sd;utfx.decodeUTF8toUTF16(function(){return offset<k?this.view.getUint8(offset++):null}.bind(this),sd=stringDestination(),this.noAssert);str=sd();if(relative){this.offset=offset;return str}else{return{string:str,length:offset-start}}};ByteBuffer.METRICS_CHARS="c";ByteBuffer.METRICS_BYTES="b";ByteBufferPrototype.writeUTF8String=function(str,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var k;var start=offset;k=utfx.calculateUTF16asUTF8(stringSource(str))[1];offset+=k;var capacity14=this.buffer.byteLength;if(offset>capacity14)this.resize((capacity14*=2)>offset?capacity14:offset);offset-=k;utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view.setUint8(offset++,b)}.bind(this));if(relative){this.offset=offset;return this}return offset-start};ByteBufferPrototype.writeString=ByteBufferPrototype.writeUTF8String;ByteBuffer.calculateUTF8Chars=function(str){return utfx.calculateUTF16asUTF8(stringSource(str))[0]};ByteBuffer.calculateUTF8Bytes=function(str){return utfx.calculateUTF16asUTF8(stringSource(str))[1]};ByteBufferPrototype.readUTF8String=function(length,metrics,offset){if(typeof metrics==="number"){offset=metrics;metrics=undefined}var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(typeof metrics==="undefined")metrics=ByteBuffer.METRICS_CHARS;if(!this.noAssert){if(typeof length!=="number"||length%1!==0)throw TypeError("Illegal length: "+length+" (not an integer)");length|=0;if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var i=0,start=offset,sd;if(metrics===ByteBuffer.METRICS_CHARS){sd=stringDestination();utfx.decodeUTF8(function(){return i<length&&offset<this.limit?this.view.getUint8(offset++):null}.bind(this),function(cp){++i;utfx.UTF8toUTF16(cp,sd)}.bind(this));if(i!==length)throw RangeError("Illegal range: Truncated data, "+i+" == "+length);if(relative){this.offset=offset;return sd()}else{return{string:sd(),length:offset-start}}}else if(metrics===ByteBuffer.METRICS_BYTES){if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+length>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+length+") <= "+this.buffer.byteLength)}var k=offset+length;utfx.decodeUTF8toUTF16(function(){return offset<k?this.view.getUint8(offset++):null}.bind(this),sd=stringDestination(),this.noAssert);if(offset!==k)throw RangeError("Illegal range: Truncated data, "+offset+" == "+k);if(relative){this.offset=offset;return sd()}else{return{string:sd(),length:offset-start}}}else throw TypeError("Unsupported metrics: "+metrics)};ByteBufferPrototype.readString=ByteBufferPrototype.readUTF8String;ByteBufferPrototype.writeVString=function(str,offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string");if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}var start=offset,k,l;k=utfx.calculateUTF16asUTF8(stringSource(str),this.noAssert)[1];l=ByteBuffer.calculateVarint32(k);offset+=l+k;var capacity15=this.buffer.byteLength;if(offset>capacity15)this.resize((capacity15*=2)>offset?capacity15:offset);offset-=l+k;offset+=this.writeVarint32(k,offset);
utfx.encodeUTF16toUTF8(stringSource(str),function(b){this.view.setUint8(offset++,b)}.bind(this));if(offset!==start+k+l)throw RangeError("Illegal range: Truncated data, "+offset+" == "+(offset+k+l));if(relative){this.offset=offset;return this}return offset-start};ByteBufferPrototype.readVString=function(offset){var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+1+") <= "+this.buffer.byteLength)}var temp=this.readVarint32(offset),start=offset,str;offset+=temp["length"];temp=temp["value"];var k=offset+temp,sd=stringDestination();utfx.decodeUTF8toUTF16(function(){return offset<k?this.view.getUint8(offset++):null}.bind(this),sd,this.noAssert);str=sd();if(relative){this.offset=offset;return str}else{return{string:str,length:offset-start}}};ByteBufferPrototype.append=function(source,encoding,offset){if(typeof encoding==="number"||typeof encoding!=="string"){offset=encoding;encoding=undefined}var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}if(!(source instanceof ByteBuffer))source=ByteBuffer.wrap(source,encoding);var length=source.limit-source.offset;if(length<=0)return this;offset+=length;var capacity16=this.buffer.byteLength;if(offset>capacity16)this.resize((capacity16*=2)>offset?capacity16:offset);offset-=length;new Uint8Array(this.buffer,offset).set(new Uint8Array(source.buffer).subarray(source.offset,source.limit));source.offset+=length;if(relative)this.offset+=length;return this};ByteBufferPrototype.appendTo=function(target,offset){target.append(this,offset);return this};ByteBufferPrototype.assert=function(assert){this.noAssert=!assert;return this};ByteBufferPrototype.capacity=function(){return this.buffer.byteLength};ByteBufferPrototype.clear=function(){this.offset=0;this.limit=this.buffer.byteLength;this.markedOffset=-1;return this};ByteBufferPrototype.clone=function(copy){var bb=new ByteBuffer(0,this.littleEndian,this.noAssert);if(copy){var buffer=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(buffer).set(this.buffer);bb.buffer=buffer;bb.view=new DataView(buffer)}else{bb.buffer=this.buffer;bb.view=this.view}bb.offset=this.offset;bb.markedOffset=this.markedOffset;bb.limit=this.limit;return bb};ByteBufferPrototype.compact=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin===0&&end===this.buffer.byteLength)return this;var len=end-begin;if(len===0){this.buffer=EMPTY_BUFFER;this.view=null;if(this.markedOffset>=0)this.markedOffset-=begin;this.offset=0;this.limit=0;return this}var buffer=new ArrayBuffer(len);new Uint8Array(buffer).set(new Uint8Array(this.buffer).subarray(begin,end));this.buffer=buffer;this.view=new DataView(buffer);if(this.markedOffset>=0)this.markedOffset-=begin;this.offset=0;this.limit=len;return this};ByteBufferPrototype.copy=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin===end)return new ByteBuffer(0,this.littleEndian,this.noAssert);var capacity=end-begin,bb=new ByteBuffer(capacity,this.littleEndian,this.noAssert);bb.offset=0;bb.limit=capacity;if(bb.markedOffset>=0)bb.markedOffset-=begin;this.copyTo(bb,0,begin,end);return bb};ByteBufferPrototype.copyTo=function(target,targetOffset,sourceOffset,sourceLimit){var relative,targetRelative;if(!this.noAssert){if(!ByteBuffer.isByteBuffer(target))throw TypeError("Illegal target: Not a ByteBuffer")}targetOffset=(targetRelative=typeof targetOffset==="undefined")?target.offset:targetOffset|0;sourceOffset=(relative=typeof sourceOffset==="undefined")?this.offset:sourceOffset|0;sourceLimit=typeof sourceLimit==="undefined"?this.limit:sourceLimit|0;if(targetOffset<0||targetOffset>target.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+targetOffset+" <= "+target.buffer.byteLength);if(sourceOffset<0||sourceLimit>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+sourceOffset+" <= "+this.buffer.byteLength);var len=sourceLimit-sourceOffset;if(len===0)return target;target.ensureCapacity(targetOffset+len);new Uint8Array(target.buffer).set(new Uint8Array(this.buffer).subarray(sourceOffset,sourceLimit),targetOffset);if(relative)this.offset+=len;if(targetRelative)target.offset+=len;return this};ByteBufferPrototype.ensureCapacity=function(capacity){var current=this.buffer.byteLength;if(current<capacity)return this.resize((current*=2)>capacity?current:capacity);return this};ByteBufferPrototype.fill=function(value,begin,end){var relative=typeof begin==="undefined";if(relative)begin=this.offset;if(typeof value==="string"&&value.length>0)value=value.charCodeAt(0);if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof value!=="number"||value%1!==0)throw TypeError("Illegal value: "+value+" (not an integer)");value|=0;if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin>=end)return this;while(begin<end)this.view.setUint8(begin++,value);if(relative)this.offset=begin;return this};ByteBufferPrototype.flip=function(){this.limit=this.offset;this.offset=0;return this};ByteBufferPrototype.mark=function(offset){offset=typeof offset==="undefined"?this.offset:offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}this.markedOffset=offset;return this};ByteBufferPrototype.order=function(littleEndian){if(!this.noAssert){if(typeof littleEndian!=="boolean")throw TypeError("Illegal littleEndian: Not a boolean")}this.littleEndian=!!littleEndian;return this};ByteBufferPrototype.LE=function(littleEndian){this.littleEndian=typeof littleEndian!=="undefined"?!!littleEndian:true;return this};ByteBufferPrototype.BE=function(bigEndian){this.littleEndian=typeof bigEndian!=="undefined"?!bigEndian:false;return this};ByteBufferPrototype.prepend=function(source,encoding,offset){if(typeof encoding==="number"||typeof encoding!=="string"){offset=encoding;encoding=undefined}var relative=typeof offset==="undefined";if(relative)offset=this.offset;if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: "+offset+" (not an integer)");offset>>>=0;if(offset<0||offset+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+offset+" (+"+0+") <= "+this.buffer.byteLength)}if(!(source instanceof ByteBuffer))source=ByteBuffer.wrap(source,encoding);var len=source.limit-source.offset;if(len<=0)return this;var diff=len-offset;var arrayView;if(diff>0){var buffer=new ArrayBuffer(this.buffer.byteLength+diff);arrayView=new Uint8Array(buffer);arrayView.set(new Uint8Array(this.buffer).subarray(offset,this.buffer.byteLength),len);this.buffer=buffer;this.view=new DataView(buffer);this.offset+=diff;if(this.markedOffset>=0)this.markedOffset+=diff;this.limit+=diff;offset+=diff}else{arrayView=new Uint8Array(this.buffer)}arrayView.set(new Uint8Array(source.buffer).subarray(source.offset,source.limit),offset-len);source.offset=source.limit;if(relative)this.offset-=len;return this};ByteBufferPrototype.prependTo=function(target,offset){target.prepend(this,offset);return this};ByteBufferPrototype.printDebug=function(out){if(typeof out!=="function")out=console.log.bind(console);out(this.toString()+"\n"+"-------------------------------------------------------------------\n"+this.toDebug(true))};ByteBufferPrototype.remaining=function(){return this.limit-this.offset};ByteBufferPrototype.reset=function(){if(this.markedOffset>=0){this.offset=this.markedOffset;this.markedOffset=-1}else{this.offset=0}return this};ByteBufferPrototype.resize=function(capacity){if(!this.noAssert){if(typeof capacity!=="number"||capacity%1!==0)throw TypeError("Illegal capacity: "+capacity+" (not an integer)");capacity|=0;if(capacity<0)throw RangeError("Illegal capacity: 0 <= "+capacity)}if(this.buffer.byteLength<capacity){var buffer=new ArrayBuffer(capacity);new Uint8Array(buffer).set(new Uint8Array(this.buffer));this.buffer=buffer;this.view=new DataView(buffer)}return this};ByteBufferPrototype.reverse=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin===end)return this;Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(begin,end));this.view=new DataView(this.buffer);return this};ByteBufferPrototype.skip=function(length){if(!this.noAssert){if(typeof length!=="number"||length%1!==0)throw TypeError("Illegal length: "+length+" (not an integer)");length|=0}var offset=this.offset+length;if(!this.noAssert){if(offset<0||offset>this.buffer.byteLength)throw RangeError("Illegal length: 0 <= "+this.offset+" + "+length+" <= "+this.buffer.byteLength)}this.offset=offset;return this};ByteBufferPrototype.slice=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var bb=this.clone();bb.offset=begin;bb.limit=end;return bb};ByteBufferPrototype.toBuffer=function(forceCopy){var offset=this.offset,limit=this.limit;if(offset>limit){var t=offset;offset=limit;limit=t}if(!this.noAssert){if(typeof offset!=="number"||offset%1!==0)throw TypeError("Illegal offset: Not an integer");offset>>>=0;if(typeof limit!=="number"||limit%1!==0)throw TypeError("Illegal limit: Not an integer");limit>>>=0;if(offset<0||offset>limit||limit>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+offset+" <= "+limit+" <= "+this.buffer.byteLength)}if(!forceCopy&&offset===0&&limit===this.buffer.byteLength){return this.buffer}if(offset===limit){return EMPTY_BUFFER}var buffer=new ArrayBuffer(limit-offset);new Uint8Array(buffer).set(new Uint8Array(this.buffer).subarray(offset,limit),0);return buffer};ByteBufferPrototype.toArrayBuffer=ByteBufferPrototype.toBuffer;ByteBufferPrototype.toString=function(encoding,begin,end){if(typeof encoding==="undefined")return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";if(typeof encoding==="number")encoding="utf8",begin=encoding,end=begin;switch(encoding){case"utf8":return this.toUTF8(begin,end);case"base64":return this.toBase64(begin,end);case"hex":return this.toHex(begin,end);case"binary":return this.toBinary(begin,end);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+encoding)}};var lxiv=function(){"use strict";var lxiv={};var aout=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var ain=[];for(var i=0,k=aout.length;i<k;++i)ain[aout[i]]=i;lxiv.encode=function(src,dst){var b,t;while((b=src())!==null){dst(aout[b>>2&63]);t=(b&3)<<4;if((b=src())!==null){t|=b>>4&15;dst(aout[(t|b>>4&15)&63]);t=(b&15)<<2;if((b=src())!==null)dst(aout[(t|b>>6&3)&63]),dst(aout[b&63]);else dst(aout[t&63]),dst(61)}else dst(aout[t&63]),dst(61),dst(61)}};lxiv.decode=function(src,dst){var c,t1,t2;function fail(c){throw Error("Illegal character code: "+c)}while((c=src())!==null){t1=ain[c];if(typeof t1==="undefined")fail(c);if((c=src())!==null){t2=ain[c];if(typeof t2==="undefined")fail(c);dst(t1<<2>>>0|(t2&48)>>4);if((c=src())!==null){t1=ain[c];if(typeof t1==="undefined")if(c===61)break;else fail(c);dst((t2&15)<<4>>>0|(t1&60)>>2);if((c=src())!==null){t2=ain[c];if(typeof t2==="undefined")if(c===61)break;else fail(c);dst((t1&3)<<6>>>0|t2)}}}}};lxiv.test=function(str){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(str)};return lxiv}();ByteBufferPrototype.toBase64=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var sd;lxiv.encode(function(){return begin<end?this.view.getUint8(begin++):null}.bind(this),sd=stringDestination());return sd()};ByteBuffer.fromBase64=function(str,littleEndian,noAssert){if(!noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string");if(str.length%4!==0)throw TypeError("Illegal str: Length not a multiple of 4")}var bb=new ByteBuffer(str.length/4*3,littleEndian,noAssert),i=0;lxiv.decode(stringSource(str),function(b){bb.view.setUint8(i++,b)});bb.limit=i;return bb};ByteBuffer.btoa=function(str){return ByteBuffer.fromBinary(str).toBase64()};ByteBuffer.atob=function(b64){return ByteBuffer.fromBase64(b64).toBinary()};ByteBufferPrototype.toBinary=function(begin,end){begin=typeof begin==="undefined"?this.offset:begin;end=typeof end==="undefined"?this.limit:end;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}if(begin===end)return"";var cc=[],pt=[];while(begin<end){cc.push(this.view.getUint8(begin++));if(cc.length>=1024)pt.push(String.fromCharCode.apply(String,cc)),cc=[]}return pt.join("")+String.fromCharCode.apply(String,cc)};ByteBuffer.fromBinary=function(str,littleEndian,noAssert){if(!noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string")}var i=0,k=str.length,charCode,bb=new ByteBuffer(k,littleEndian,noAssert);while(i<k){charCode=str.charCodeAt(i);if(!noAssert&&charCode>255)throw RangeError("Illegal charCode at "+i+": 0 <= "+charCode+" <= 255");bb.view.setUint8(i++,charCode)}bb.limit=k;return bb};ByteBufferPrototype.toDebug=function(columns){var i=-1,k=this.buffer.byteLength,b,hex="",asc="",out="";while(i<k){if(i!==-1){b=this.view.getUint8(i);if(b<16)hex+="0"+b.toString(16).toUpperCase();else hex+=b.toString(16).toUpperCase();if(columns){asc+=b>32&&b<127?String.fromCharCode(b):"."}}++i;if(columns){if(i>0&&i%16===0&&i!==k){while(hex.length<3*16+3)hex+=" ";out+=hex+asc+"\n";hex=asc=""}}if(i===this.offset&&i===this.limit)hex+=i===this.markedOffset?"!":"|";else if(i===this.offset)hex+=i===this.markedOffset?"[":"<";else if(i===this.limit)hex+=i===this.markedOffset?"]":">";else hex+=i===this.markedOffset?"'":columns||i!==0&&i!==k?" ":""}if(columns&&hex!==" "){while(hex.length<3*16+3)hex+=" ";out+=hex+asc+"\n"}return columns?out:hex};ByteBuffer.fromDebug=function(str,littleEndian,noAssert){var k=str.length,bb=new ByteBuffer((k+1)/3|0,littleEndian,noAssert);var i=0,j=0,ch,b,rs=false,ho=false,hm=false,hl=false,fail=false;while(i<k){switch(ch=str.charAt(i++)){case"!":if(!noAssert){if(ho||hm||hl){fail=true;break}ho=hm=hl=true}bb.offset=bb.markedOffset=bb.limit=j;rs=false;break;case"|":if(!noAssert){if(ho||hl){fail=true;break}ho=hl=true}bb.offset=bb.limit=j;rs=false;break;case"[":if(!noAssert){if(ho||hm){fail=true;break}ho=hm=true}bb.offset=bb.markedOffset=j;rs=false;break;case"<":if(!noAssert){if(ho){fail=true;break}ho=true}bb.offset=j;rs=false;break;case"]":if(!noAssert){if(hl||hm){fail=true;break}hl=hm=true}bb.limit=bb.markedOffset=j;rs=false;break;case">":if(!noAssert){if(hl){fail=true;break}hl=true}bb.limit=j;rs=false;break;case"'":if(!noAssert){if(hm){fail=true;break}hm=true}bb.markedOffset=j;rs=false;break;case" ":rs=false;break;default:if(!noAssert){if(rs){fail=true;break}}b=parseInt(ch+str.charAt(i++),16);if(!noAssert){if(isNaN(b)||b<0||b>255)throw TypeError("Illegal str: Not a debug encoded string")}bb.view.setUint8(j++,b);rs=true}if(fail)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!noAssert){if(!ho||!hl)throw TypeError("Illegal str: Missing offset or limit");if(j<bb.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+k)}return bb};ByteBufferPrototype.toHex=function(begin,end){begin=typeof begin==="undefined"?this.offset:begin;end=typeof end==="undefined"?this.limit:end;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var out=new Array(end-begin),b;while(begin<end){b=this.view.getUint8(begin++);if(b<16)out.push("0",b.toString(16));else out.push(b.toString(16))}return out.join("")};ByteBuffer.fromHex=function(str,littleEndian,noAssert){if(!noAssert){if(typeof str!=="string")throw TypeError("Illegal str: Not a string");if(str.length%2!==0)throw TypeError("Illegal str: Length not a multiple of 2")}var k=str.length,bb=new ByteBuffer(k/2|0,littleEndian),b;for(var i=0,j=0;i<k;i+=2){b=parseInt(str.substring(i,i+2),16);if(!noAssert)if(!isFinite(b)||b<0||b>255)throw TypeError("Illegal str: Contains non-hex characters");bb.view.setUint8(j++,b)}bb.limit=j;return bb};var utfx=function(){"use strict";var utfx={};utfx.MAX_CODEPOINT=1114111;utfx.encodeUTF8=function(src,dst){var cp=null;if(typeof src==="number")cp=src,src=function(){return null};while(cp!==null||(cp=src())!==null){if(cp<128)dst(cp&127);else if(cp<2048)dst(cp>>6&31|192),dst(cp&63|128);else if(cp<65536)dst(cp>>12&15|224),dst(cp>>6&63|128),dst(cp&63|128);else dst(cp>>18&7|240),dst(cp>>12&63|128),dst(cp>>6&63|128),dst(cp&63|128);cp=null}};utfx.decodeUTF8=function(src,dst){var a,b,c,d,fail=function(b){b=b.slice(0,b.indexOf(null));var err=Error(b.toString());err.name="TruncatedError";err["bytes"]=b;throw err};while((a=src())!==null){if((a&128)===0)dst(a);else if((a&224)===192)(b=src())===null&&fail([a,b]),dst((a&31)<<6|b&63);else if((a&240)===224)((b=src())===null||(c=src())===null)&&fail([a,b,c]),dst((a&15)<<12|(b&63)<<6|c&63);else if((a&248)===240)((b=src())===null||(c=src())===null||(d=src())===null)&&fail([a,b,c,d]),dst((a&7)<<18|(b&63)<<12|(c&63)<<6|d&63);else throw RangeError("Illegal starting byte: "+a)}};utfx.UTF16toUTF8=function(src,dst){var c1,c2=null;while(true){if((c1=c2!==null?c2:src())===null)break;if(c1>=55296&&c1<=57343){if((c2=src())!==null){if(c2>=56320&&c2<=57343){dst((c1-55296)*1024+c2-56320+65536);c2=null;continue}}}dst(c1)}if(c2!==null)dst(c2)};utfx.UTF8toUTF16=function(src,dst){var cp=null;if(typeof src==="number")cp=src,src=function(){return null};while(cp!==null||(cp=src())!==null){if(cp<=65535)dst(cp);else cp-=65536,dst((cp>>10)+55296),dst(cp%1024+56320);cp=null}};utfx.encodeUTF16toUTF8=function(src,dst){utfx.UTF16toUTF8(src,function(cp){utfx.encodeUTF8(cp,dst)})};utfx.decodeUTF8toUTF16=function(src,dst){utfx.decodeUTF8(src,function(cp){utfx.UTF8toUTF16(cp,dst)})};utfx.calculateCodePoint=function(cp){return cp<128?1:cp<2048?2:cp<65536?3:4};utfx.calculateUTF8=function(src){var cp,l=0;while((cp=src())!==null)l+=utfx.calculateCodePoint(cp);return l};utfx.calculateUTF16asUTF8=function(src){var n=0,l=0;utfx.UTF16toUTF8(src,function(cp){++n;l+=utfx.calculateCodePoint(cp)});return[n,l]};return utfx}();ByteBufferPrototype.toUTF8=function(begin,end){if(typeof begin==="undefined")begin=this.offset;if(typeof end==="undefined")end=this.limit;if(!this.noAssert){if(typeof begin!=="number"||begin%1!==0)throw TypeError("Illegal begin: Not an integer");begin>>>=0;if(typeof end!=="number"||end%1!==0)throw TypeError("Illegal end: Not an integer");end>>>=0;if(begin<0||begin>end||end>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+begin+" <= "+end+" <= "+this.buffer.byteLength)}var sd;try{utfx.decodeUTF8toUTF16(function(){return begin<end?this.view.getUint8(begin++):null}.bind(this),sd=stringDestination())}catch(e){if(begin!==end)throw RangeError("Illegal range: Truncated data, "+begin+" != "+end)}return sd()};ByteBuffer.fromUTF8=function(str,littleEndian,noAssert){if(!noAssert)if(typeof str!=="string")throw TypeError("Illegal str: Not a string");var bb=new ByteBuffer(utfx.calculateUTF16asUTF8(stringSource(str),true)[1],littleEndian,noAssert),i=0;utfx.encodeUTF16toUTF8(stringSource(str),function(b){bb.view.setUint8(i++,b)});bb.limit=i;return bb};return ByteBuffer}if(typeof require==="function"&&typeof module==="object"&&module&&typeof exports==="object"&&exports)module["exports"]=function(){var Long;try{Long=require("long")}catch(e){}return loadByteBuffer(Long)}();else if(typeof define==="function"&&define["amd"])define("ByteBuffer",["Long"],function(Long){return loadByteBuffer(Long)});else(global["dcodeIO"]=global["dcodeIO"]||{})["ByteBuffer"]=loadByteBuffer(global["dcodeIO"]["Long"])})(this)},{"long":197}],196:[function(require,module,exports){(function(global){"use strict";var Long=function(low,high,unsigned){this.low=low|0;this.high=high|0;this.unsigned=!!unsigned};Long.isLong=function(obj){return(obj&&obj instanceof Long)===true};var INT_CACHE={};var UINT_CACHE={};Long.fromInt=function(value,unsigned){var obj,cachedObj;if(!unsigned){value=value|0;if(-128<=value&&value<128){cachedObj=INT_CACHE[value];if(cachedObj)return cachedObj}obj=new Long(value,value<0?-1:0,false);if(-128<=value&&value<128)INT_CACHE[value]=obj;return obj}else{value=value>>>0;if(0<=value&&value<256){cachedObj=UINT_CACHE[value];if(cachedObj)return cachedObj}obj=new Long(value,(value|0)<0?-1:0,true);if(0<=value&&value<256)UINT_CACHE[value]=obj;return obj}};Long.fromNumber=function(value,unsigned){unsigned=!!unsigned;if(isNaN(value)||!isFinite(value))return Long.ZERO;if(!unsigned&&value<=-TWO_PWR_63_DBL)return Long.MIN_VALUE;if(!unsigned&&value+1>=TWO_PWR_63_DBL)return Long.MAX_VALUE;if(unsigned&&value>=TWO_PWR_64_DBL)return Long.MAX_UNSIGNED_VALUE;if(value<0)return Long.fromNumber(-value,unsigned).negate();return new Long(value%TWO_PWR_32_DBL|0,value/TWO_PWR_32_DBL|0,unsigned)};Long.fromBits=function(lowBits,highBits,unsigned){return new Long(lowBits,highBits,unsigned)};Long.fromString=function(str,unsigned,radix){if(str.length===0)throw Error("number format error: empty string");if(str==="NaN"||str==="Infinity"||str==="+Infinity"||str==="-Infinity")return Long.ZERO;if(typeof unsigned==="number")radix=unsigned,unsigned=false;radix=radix||10;if(radix<2||36<radix)throw Error("radix out of range: "+radix);var p;if((p=str.indexOf("-"))>0)throw Error('number format error: interior "-" character: '+str);else if(p===0)return Long.fromString(str.substring(1),unsigned,radix).negate();var radixToPower=Long.fromNumber(Math.pow(radix,8));var result=Long.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(Long.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(Long.fromNumber(value))}}result.unsigned=unsigned;return result};Long.fromValue=function(val){if(typeof val==="number")return Long.fromNumber(val);if(typeof val==="string")return Long.fromString(val);if(Long.isLong(val))return val;return new Long(val.low,val.high,val.unsigned)};var TWO_PWR_16_DBL=1<<16;var TWO_PWR_24_DBL=1<<24;var TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL;var TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL;var TWO_PWR_63_DBL=TWO_PWR_64_DBL/2;var TWO_PWR_24=Long.fromInt(TWO_PWR_24_DBL);Long.ZERO=Long.fromInt(0);Long.UZERO=Long.fromInt(0,true);Long.ONE=Long.fromInt(1);Long.UONE=Long.fromInt(1,true);Long.NEG_ONE=Long.fromInt(-1);Long.MAX_VALUE=Long.fromBits(4294967295|0,2147483647|0,false);Long.MAX_UNSIGNED_VALUE=Long.fromBits(4294967295|0,4294967295|0,true);Long.MIN_VALUE=Long.fromBits(0,2147483648|0,false);Long.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low};Long.prototype.toNumber=function(){if(this.unsigned){return(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0)}return this.high*TWO_PWR_32_DBL+(this.low>>>0)};Long.prototype.toString=function(radix){radix=radix||10;if(radix<2||36<radix)throw RangeError("radix out of range: "+radix);if(this.isZero())return"0";var rem;if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){var radixLong=Long.fromNumber(radix);var div=this.div(radixLong);rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else return"-"+this.negate().toString(radix)}var radixToPower=Long.fromNumber(Math.pow(radix,6),this.unsigned);rem=this;var result="";while(true){var remDiv=rem.div(radixToPower),intval=rem.subtract(remDiv.multiply(radixToPower)).toInt()>>>0,digits=intval.toString(radix);rem=remDiv;if(rem.isZero())return digits+result;else{while(digits.length<6)digits="0"+digits;result=""+digits+result}}};Long.prototype.getHighBits=function(){return this.high};Long.prototype.getHighBitsUnsigned=function(){return this.high>>>0};Long.prototype.getLowBits=function(){return this.low};Long.prototype.getLowBitsUnsigned=function(){return this.low>>>0};Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();var val=this.high!=0?this.high:this.low;for(var bit=31;bit>0;bit--)if((val&1<<bit)!=0)break;return this.high!=0?bit+33:bit+1};Long.prototype.isZero=function(){return this.high===0&&this.low===0};Long.prototype.isNegative=function(){return!this.unsigned&&this.high<0};Long.prototype.isPositive=function(){return this.unsigned||this.high>=0};Long.prototype.isOdd=function(){return(this.low&1)===1};Long.prototype.isEven=function(){return(this.low&1)===0};Long.prototype.equals=function(other){if(!Long.isLong(other))other=Long.fromValue(other);if(this.unsigned!==other.unsigned&&this.high>>>31===1&&other.high>>>31===1)return false;return this.high===other.high&&this.low===other.low};Long.prototype.notEquals=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return!this.equals(other)};Long.prototype.lessThan=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return this.compare(other)<0};Long.prototype.lessThanOrEqual=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return this.compare(other)<=0};Long.prototype.greaterThan=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return this.compare(other)>0};Long.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0};Long.prototype.compare=function(other){if(this.equals(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();if(thisNeg&&!otherNeg)return-1;if(!thisNeg&&otherNeg)return 1;if(!this.unsigned)return this.subtract(other).isNegative()?-1:1;return other.high>>>0>this.high>>>0||other.high===this.high&&other.low>>>0>this.low>>>0?-1:1};Long.prototype.negate=function(){if(!this.unsigned&&this.equals(Long.MIN_VALUE))return Long.MIN_VALUE;return this.not().add(Long.ONE)};Long.prototype.add=function(addend){if(!Long.isLong(addend))addend=Long.fromValue(addend);var a48=this.high>>>16;var a32=this.high&65535;var a16=this.low>>>16;var a00=this.low&65535;var b48=addend.high>>>16;var b32=addend.high&65535;var b16=addend.low>>>16;var b00=addend.low&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)};Long.prototype.subtract=function(subtrahend){if(!Long.isLong(subtrahend))subtrahend=Long.fromValue(subtrahend);return this.add(subtrahend.negate())};Long.prototype.multiply=function(multiplier){if(this.isZero())return Long.ZERO;if(!Long.isLong(multiplier))multiplier=Long.fromValue(multiplier);if(multiplier.isZero())return Long.ZERO;if(this.equals(Long.MIN_VALUE))return multiplier.isOdd()?Long.MIN_VALUE:Long.ZERO;if(multiplier.equals(Long.MIN_VALUE))return this.isOdd()?Long.MIN_VALUE:Long.ZERO;if(this.isNegative()){if(multiplier.isNegative())return this.negate().multiply(multiplier.negate());else return this.negate().multiply(multiplier).negate()}else if(multiplier.isNegative())return this.multiply(multiplier.negate()).negate();if(this.lessThan(TWO_PWR_24)&&multiplier.lessThan(TWO_PWR_24))return Long.fromNumber(this.toNumber()*multiplier.toNumber(),this.unsigned);var a48=this.high>>>16;var a32=this.high&65535;var a16=this.low>>>16;var a00=this.low&65535;var b48=multiplier.high>>>16;var b32=multiplier.high&65535;var b16=multiplier.low>>>16;var b00=multiplier.low&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)};Long.prototype.div=function(divisor){if(!Long.isLong(divisor))divisor=Long.fromValue(divisor);if(divisor.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?Long.UZERO:Long.ZERO;var approx,rem,res;if(this.equals(Long.MIN_VALUE)){if(divisor.equals(Long.ONE)||divisor.equals(Long.NEG_ONE))return Long.MIN_VALUE;else if(divisor.equals(Long.MIN_VALUE))return Long.ONE;else{var halfThis=this.shiftRight(1);approx=halfThis.div(divisor).shiftLeft(1);if(approx.equals(Long.ZERO)){return divisor.isNegative()?Long.ONE:Long.NEG_ONE}else{rem=this.subtract(divisor.multiply(approx));res=approx.add(rem.div(divisor));return res}}}else if(divisor.equals(Long.MIN_VALUE))return this.unsigned?Long.UZERO:Long.ZERO;if(this.isNegative()){if(divisor.isNegative())return this.negate().div(divisor.negate());return this.negate().div(divisor).negate()}else if(divisor.isNegative())return this.div(divisor.negate()).negate();res=Long.ZERO;rem=this;while(rem.greaterThanOrEqual(divisor)){approx=Math.max(1,Math.floor(rem.toNumber()/divisor.toNumber()));
var log2=Math.ceil(Math.log(approx)/Math.LN2),delta=log2<=48?1:Math.pow(2,log2-48),approxRes=Long.fromNumber(approx),approxRem=approxRes.multiply(divisor);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=Long.fromNumber(approx,this.unsigned);approxRem=approxRes.multiply(divisor)}if(approxRes.isZero())approxRes=Long.ONE;res=res.add(approxRes);rem=rem.subtract(approxRem)}return res};Long.prototype.modulo=function(divisor){if(!Long.isLong(divisor))divisor=Long.fromValue(divisor);return this.subtract(this.div(divisor).multiply(divisor))};Long.prototype.not=function(){return Long.fromBits(~this.low,~this.high,this.unsigned)};Long.prototype.and=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low&other.low,this.high&other.high,this.unsigned)};Long.prototype.or=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low|other.low,this.high|other.high,this.unsigned)};Long.prototype.xor=function(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low^other.low,this.high^other.high,this.unsigned)};Long.prototype.shiftLeft=function(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return Long.fromBits(this.low<<numBits,this.high<<numBits|this.low>>>32-numBits,this.unsigned);else return Long.fromBits(0,this.low<<numBits-32,this.unsigned)};Long.prototype.shiftRight=function(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return Long.fromBits(this.low>>>numBits|this.high<<32-numBits,this.high>>numBits,this.unsigned);else return Long.fromBits(this.high>>numBits-32,this.high>=0?0:-1,this.unsigned)};Long.prototype.shiftRightUnsigned=function(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();numBits&=63;if(numBits===0)return this;else{var high=this.high;if(numBits<32){var low=this.low;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits,this.unsigned)}else if(numBits===32)return Long.fromBits(high,0,this.unsigned);else return Long.fromBits(high>>>numBits-32,0,this.unsigned)}};Long.prototype.toSigned=function(){if(!this.unsigned)return this;return new Long(this.low,this.high,false)};Long.prototype.toUnsigned=function(){if(this.unsigned)return this;return new Long(this.low,this.high,true)};if(typeof require==="function"&&typeof module==="object"&&module&&typeof exports==="object"&&exports)module["exports"]=Long;else if(typeof define==="function"&&define["amd"])define(function(){return Long});else(global["dcodeIO"]=global["dcodeIO"]||{})["Long"]=Long})(this)},{}],197:[function(require,module,exports){module.exports=require("./dist/Long.js")},{"./dist/Long.js":196}],198:[function(require,module,exports){module.exports=require(60)},{buffer:3,debug:211,"lru-cache":258}],199:[function(require,module,exports){module.exports=require(61)},{"./../Utility/binarySearch.js":209,debug:211}],200:[function(require,module,exports){module.exports=require(62)},{debug:211,"ndn-js":268,"ndn-js/js/encoding/tlv/tlv-decoder.js":285,"ndn-js/js/encoding/tlv/tlv.js":288}],201:[function(require,module,exports){module.exports=require(63)},{"./../Utility/binarySearch.js":209,"./NameTreeNode.js":202}],202:[function(require,module,exports){module.exports=require(64)},{"./../Utility/binarySearch.js":209}],203:[function(require,module,exports){module.exports=require(65)},{"./../Utility/binarySearch.js":209,debug:211}],204:[function(require,module,exports){module.exports=require(66)},{_process:24,buffer:3,leveldown:214,levelup:234}],205:[function(require,module,exports){module.exports=require(67)},{}],206:[function(require,module,exports){module.exports=require(68)},{buffer:3,debug:211,"ndn-lib/js/encoding/element-reader.js":343,"ndn-lib/js/transport/transport.js":348}],207:[function(require,module,exports){module.exports=require(69)},{buffer:3,debug:211,"ndn-lib/js/encoding/element-reader.js":343,"ndn-lib/js/transport/transport.js":348}],208:[function(require,module,exports){module.exports=require(70)},{"./MessageChannel.js":206,"./WebRTCDataChannel.js":207,"ndn-js":268}],209:[function(require,module,exports){module.exports=require(71)},{}],210:[function(require,module,exports){module.exports=require(72)},{"./dist/src/DataStructures/ContentStore.js":198,"./dist/src/DataStructures/FIB.js":199,"./dist/src/DataStructures/Interfaces.js":200,"./dist/src/DataStructures/NameTree.js":201,"./dist/src/DataStructures/PIT.js":203,"./dist/src/DataStructures/Repository.js":204,"./dist/src/DataStructures/repoEntry.js":205,"./dist/src/Transports/node/export.js":208,buffer:3,"ndn-js":268}],211:[function(require,module,exports){module.exports=require(47)},{"./debug":212}],212:[function(require,module,exports){module.exports=require(48)},{ms:213}],213:[function(require,module,exports){module.exports=require(49)},{}],214:[function(require,module,exports){module.exports=require(73)},{"./iterator":215,"abstract-leveldown":218,buffer:3,"idb-wrapper":220,isbuffer:221,"typedarray-to-buffer":223,util:39,xtend:225}],215:[function(require,module,exports){module.exports=require(74)},{"abstract-leveldown":218,ltgt:222,util:39}],216:[function(require,module,exports){module.exports=require(75)},{_process:24}],217:[function(require,module,exports){module.exports=require(76)},{_process:24}],218:[function(require,module,exports){module.exports=require(77)},{"./abstract-chained-batch":216,"./abstract-iterator":217,_process:24,buffer:3,xtend:219}],219:[function(require,module,exports){module.exports=require(78)},{}],220:[function(require,module,exports){module.exports=require(79)},{}],221:[function(require,module,exports){module.exports=require(80)},{buffer:3}],222:[function(require,module,exports){module.exports=require(81)},{buffer:3}],223:[function(require,module,exports){module.exports=require(82)},{buffer:3}],224:[function(require,module,exports){module.exports=require(83)},{}],225:[function(require,module,exports){module.exports=require(84)},{"./has-keys":224,"object-keys":227}],226:[function(require,module,exports){module.exports=require(85)},{}],227:[function(require,module,exports){module.exports=require(86)},{"./shim":229}],228:[function(require,module,exports){module.exports=require(87)},{}],229:[function(require,module,exports){module.exports=require(88)},{"./foreach":226,"./isArguments":228}],230:[function(require,module,exports){module.exports=require(89)},{"./errors":233,"./util":236}],231:[function(require,module,exports){module.exports=require(90)},{"./encodings":232}],232:[function(require,module,exports){module.exports=require(91)},{buffer:3}],233:[function(require,module,exports){module.exports=require(92)},{errno:244}],234:[function(require,module,exports){module.exports=require(93)},{"./batch":230,"./codec":231,"./errors":233,"./read-stream":235,"./util":236,"./write-stream":237,_process:24,"deferred-leveldown":239,events:19,prr:245,util:39,xtend:256}],235:[function(require,module,exports){module.exports=require(94)},{"./errors":233,"./util":236,"readable-stream":255,util:39,xtend:256}],236:[function(require,module,exports){module.exports=require(95)},{"../package.json":257,"./encodings":232,"./errors":233,leveldown:2,"leveldown/package":2,semver:2,xtend:256}],237:[function(require,module,exports){module.exports=require(96)},{"./util":236,_process:24,bl:238,stream:37,util:39,xtend:256}],238:[function(require,module,exports){module.exports=require(97)},{buffer:3,"readable-stream":255,util:39}],239:[function(require,module,exports){module.exports=require(98)},{_process:24,"abstract-leveldown":242,buffer:3,util:39}],240:[function(require,module,exports){module.exports=require(75)},{_process:24}],241:[function(require,module,exports){module.exports=require(76)},{_process:24}],242:[function(require,module,exports){module.exports=require(77)},{"./abstract-chained-batch":240,"./abstract-iterator":241,_process:24,buffer:3,xtend:256}],243:[function(require,module,exports){module.exports=require(102)},{prr:245}],244:[function(require,module,exports){module.exports=require(103)},{"./custom":243}],245:[function(require,module,exports){module.exports=require(104)},{}],246:[function(require,module,exports){module.exports=require(26)},{"./_stream_readable":248,"./_stream_writable":250,_process:24,"core-util-is":251,inherits:252}],247:[function(require,module,exports){module.exports=require(27)},{"./_stream_transform":249,"core-util-is":251,inherits:252}],248:[function(require,module,exports){module.exports=require(28)},{_process:24,buffer:3,"core-util-is":251,events:19,inherits:252,isarray:253,stream:37,"string_decoder/":254}],249:[function(require,module,exports){module.exports=require(29)},{"./_stream_duplex":246,"core-util-is":251,inherits:252}],250:[function(require,module,exports){module.exports=require(30)},{"./_stream_duplex":246,_process:24,buffer:3,"core-util-is":251,inherits:252,stream:37}],251:[function(require,module,exports){module.exports=require(31)},{buffer:3}],252:[function(require,module,exports){module.exports=require(20)},{}],253:[function(require,module,exports){module.exports=require(21)},{}],254:[function(require,module,exports){module.exports=require(32)},{buffer:3}],255:[function(require,module,exports){module.exports=require(114)},{"./lib/_stream_duplex.js":246,"./lib/_stream_passthrough.js":247,"./lib/_stream_readable.js":248,"./lib/_stream_transform.js":249,"./lib/_stream_writable.js":250,stream:37}],256:[function(require,module,exports){module.exports=require(78)},{}],257:[function(require,module,exports){module.exports=require(116)},{}],258:[function(require,module,exports){module.exports=require(117)},{}],259:[function(require,module,exports){module.exports=require(118)},{jsbn:333}],260:[function(require,module,exports){module.exports=require(119)},{}],261:[function(require,module,exports){module.exports=require(120)},{}],262:[function(require,module,exports){module.exports=require(121)},{"./sha256.js":267,jsbn:333}],263:[function(require,module,exports){module.exports=require(122)},{jsbn:333}],264:[function(require,module,exports){module.exports=require(123)},{"./rsa.js":263,jsbn:333}],265:[function(require,module,exports){module.exports=require(124)},{"./asn1hex-1.1.js":259,"./base64.js":260,"./rsa2.js":264}],266:[function(require,module,exports){module.exports=require(125)},{"./rsapem-1.1.js":265,jsbn:333}],267:[function(require,module,exports){module.exports=require(126)},{"./core.js":261}],268:[function(require,module,exports){module.exports=require(127)},{"./js/closure.js":271,"./js/data.js":273,"./js/encoding/binary-xml-wire-format.js":277,"./js/encoding/data-utils.js":278,"./js/encoding/encoding-utils.js":281,"./js/encoding/protobuf-tlv.js":282,"./js/encoding/tlv-wire-format.js":284,"./js/encoding/wire-format.js":289,"./js/exclude.js":290,"./js/face.js":292,"./js/forwarding-flags.js":294,"./js/interest.js":295,"./js/key-locator.js":296,"./js/key.js":297,"./js/meta-info.js":299,"./js/name.js":300,"./js/publisher-public-key-digest.js":302,"./js/security/identity/identity-manager.js":305,"./js/security/identity/identity-storage.js":306,"./js/security/identity/memory-identity-storage.js":307,"./js/security/identity/memory-private-key-storage.js":308,"./js/security/key-chain.js":310,"./js/security/key-manager.js":311,"./js/security/policy/no-verify-policy-manager.js":312,"./js/security/policy/policy-manager.js":313,"./js/security/policy/self-verify-policy-manager.js":314,"./js/security/policy/validation-request.js":315,"./js/security/security-exception.js":316,"./js/security/security-types.js":317,"./js/sha256-with-rsa-signature.js":318,"./js/sync/chrono-sync2013.js":319,"./js/transport/tcp-transport.js":269,"./js/transport/unix-transport.js":323,"./js/util/blob.js":325,"./js/util/memory-content-cache.js":328,"./js/util/name-enumeration.js":329,"./js/util/ndn-time.js":331}],269:[function(require,module,exports){module.exports=require(128)},{"./transport/web-socket-transport":324}],270:[function(require,module,exports){module.exports=require(129)},{"../contrib/securityLib/asn1hex-1.1.js":259,"../contrib/securityLib/base64.js":260,"../contrib/securityLib/crypto-1.0.js":262,"../contrib/securityLib/rsasign-1.2.js":266,"./key.js":297,buffer:3}],271:[function(require,module,exports){module.exports=require(130)},{}],272:[function(require,module,exports){module.exports=require(131)},{"./encoding/wire-format.js":289,"./forwarding-flags.js":294,"./name.js":300}],273:[function(require,module,exports){module.exports=require(132)},{"./crypto.js":270,"./encoding/binary-xml-encoder.js":275,"./encoding/binary-xml-wire-format.js":277,"./encoding/data-utils.js":278,"./encoding/wire-format.js":289,"./key-locator.js":296,"./meta-info.js":299,"./name.js":300,"./security/key-manager.js":311,"./sha256-with-rsa-signature.js":318,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330,"./util/signed-blob.js":332,buffer:3}],274:[function(require,module,exports){module.exports=require(133)},{"../log.js":298,"../util/ndn-protoco-id-tags.js":330,"../util/ndn-time.js":331,"./data-utils.js":278,"./decoding-exception.js":279,buffer:3}],275:[function(require,module,exports){module.exports=require(134)},{"../log.js":298,"../util/dynamic-buffer.js":327,"../util/ndn-protoco-id-tags.js":330,"./data-utils.js":278}],276:[function(require,module,exports){module.exports=require(135)},{"../util/dynamic-buffer.js":327,"./binary-xml-decoder.js":274}],277:[function(require,module,exports){module.exports=require(136)},{"../exclude.js":290,"../key-locator.js":296,"../meta-info.js":299,"../name.js":300,"../publisher-public-key-digest.js":302,"../sha256-with-rsa-signature.js":318,"../util/blob.js":325,"../util/ndn-protoco-id-tags.js":330,"./binary-xml-decoder.js":274,"./binary-xml-encoder.js":275,"./data-utils.js":278,"./wire-format.js":289}],278:[function(require,module,exports){module.exports=require(137)},{buffer:3}],279:[function(require,module,exports){module.exports=require(138)},{}],280:[function(require,module,exports){module.exports=require(139)},{"../log.js":298,"./binary-xml-structure-decoder.js":276,"./data-utils.js":278,"./tlv/tlv-structure-decoder.js":287,"./tlv/tlv.js":288}],281:[function(require,module,exports){module.exports=require(140)},{"../data.js":273,"../face-instance.js":291,"../forwarding-entry.js":293,"../interest.js":295,"../key-locator.js":296,"../key.js":297,"../log.js":298,"./binary-xml-decoder.js":274,"./binary-xml-encoder.js":275,"./data-utils.js":278,"./wire-format.js":289}],282:[function(require,module,exports){module.exports=require(141)},{"../util/blob.js":325,"./tlv/tlv-decoder.js":285,"./tlv/tlv-encoder.js":286,"protobufjs/dist/ProtoBuf.js":334}],283:[function(require,module,exports){module.exports=require(142)},{"../crypto.js":270,"../exclude.js":290,"../forwarding-flags.js":294,"../key-locator.js":296,"../meta-info.js":299,"../publisher-public-key-digest.js":302,"../sha256-with-rsa-signature.js":318,"../util/blob.js":325,"./decoding-exception.js":279,"./tlv/tlv-decoder.js":285,"./tlv/tlv-encoder.js":286,"./tlv/tlv.js":288,"./wire-format.js":289,buffer:3}],284:[function(require,module,exports){module.exports=require(143)},{"./tlv-0_1-wire-format.js":283,"./wire-format.js":289}],285:[function(require,module,exports){module.exports=require(144)},{"../decoding-exception.js":279}],286:[function(require,module,exports){module.exports=require(145)},{"../../util/dynamic-buffer.js":327,"./tlv.js":288}],287:[function(require,module,exports){module.exports=require(146)},{"./tlv-decoder.js":285,buffer:3}],288:[function(require,module,exports){module.exports=require(147)},{}],289:[function(require,module,exports){module.exports=require(148)},{"./tlv-wire-format.js":284}],290:[function(require,module,exports){module.exports=require(149)},{"./encoding/binary-xml-decoder.js":274,"./encoding/binary-xml-encoder.js":275,"./encoding/data-utils.js":278,"./name.js":300,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330}],291:[function(require,module,exports){module.exports=require(150)},{"./publisher-public-key-digest.js":302,"./util/ndn-protoco-id-tags.js":330}],292:[function(require,module,exports){module.exports=require(151)},{"./closure.js":271,"./control-parameters.js":272,"./data.js":273,"./encoding/binary-xml-decoder.js":274,"./encoding/binary-xml-encoder.js":275,"./encoding/binary-xml-wire-format.js":277,"./encoding/data-utils.js":278,"./encoding/tlv-wire-format.js":284,"./encoding/tlv/tlv-decoder.js":285,"./encoding/tlv/tlv.js":288,"./encoding/wire-format.js":289,"./forwarding-entry.js":293,"./forwarding-flags.js":294,"./interest.js":295,"./key-locator.js":296,"./key.js":297,"./log.js":298,"./meta-info.js":299,"./name.js":300,"./security/key-manager.js":311,"./transport/tcp-transport.js":269,"./transport/transport.js":322,"./transport/unix-transport.js":323,"./util/command-interest-generator.js":326,"./util/ndn-protoco-id-tags.js":330,buffer:3,crypto:9,fs:1}],293:[function(require,module,exports){module.exports=require(152)},{"./forwarding-flags.js":294,"./name.js":300,"./publisher-public-key-digest.js":302,"./util/ndn-protoco-id-tags.js":330}],294:[function(require,module,exports){module.exports=require(153)},{}],295:[function(require,module,exports){module.exports=require(154)},{"./encoding/binary-xml-wire-format.js":277,"./encoding/wire-format.js":289,"./exclude.js":290,"./key-locator.js":296,"./name.js":300,"./publisher-public-key-digest.js":302,"./util/blob.js":325,"./util/signed-blob.js":332,buffer:3}],296:[function(require,module,exports){module.exports=require(155)},{"./log.js":298,"./name.js":300,"./publisher-id.js":301,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330,buffer:3}],297:[function(require,module,exports){module.exports=require(156)},{"./encoding/data-utils.js":278,"./log.js":298,buffer:3,crypto:9}],298:[function(require,module,exports){module.exports=require(157)},{}],299:[function(require,module,exports){module.exports=require(158)},{"./encoding/binary-xml-decoder.js":274,"./encoding/binary-xml-encoder.js":275,"./key-locator.js":296,"./log.js":298,"./name.js":300,"./publisher-public-key-digest.js":302,"./security/key-manager.js":311,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330,"./util/ndn-time.js":331,buffer:3}],300:[function(require,module,exports){module.exports=require(159)},{"./encoding/binary-xml-decoder.js":274,"./encoding/binary-xml-encoder.js":275,"./encoding/data-utils.js":278,"./encoding/tlv/tlv-encoder.js":286,"./encoding/wire-format.js":289,"./log.js":298,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330,buffer:3}],301:[function(require,module,exports){module.exports=require(160)},{"./encoding/decoding-exception.js":279,"./util/ndn-protoco-id-tags.js":330}],302:[function(require,module,exports){module.exports=require(161)},{"./log.js":298,"./util/ndn-protoco-id-tags.js":330}],303:[function(require,module,exports){module.exports=require(162)},{}],304:[function(require,module,exports){module.exports=require(163)},{"../security-exception.js":316,"../security-types.js":317}],305:[function(require,module,exports){module.exports=require(164)},{"../../data.js":273,"../../encoding/wire-format.js":289,"../../key-locator.js":296,"../../name.js":300,"../../sha256-with-rsa-signature.js":318,"../security-exception.js":316,buffer:3}],306:[function(require,module,exports){module.exports=require(165)},{"../../name.js":300,"../security-exception.js":316}],307:[function(require,module,exports){module.exports=require(166)},{"../../data.js":273,"../../encoding/data-utils.js":278,"../../name.js":300,"../../util/blob.js":325,"../security-exception.js":316,"../security-types.js":317,"./identity-storage.js":306}],308:[function(require,module,exports){module.exports=require(167)},{"../../encoding/data-utils.js":278,"../../util/blob.js":325,"../certificate/public-key.js":304,"../security-exception.js":316,"../security-types.js":317,"./private-key-storage.js":309,buffer:3,crypto:9}],309:[function(require,module,exports){module.exports=require(168)},{}],310:[function(require,module,exports){module.exports=require(169)},{"../data.js":273,"../encoding/tlv/tlv-encoder.js":286,"../encoding/tlv/tlv.js":288,"../encoding/wire-format.js":289,"../interest.js":295,"../key-locator.js":296,"../name.js":300,"../sha256-with-rsa-signature.js":318,"./security-exception.js":316}],311:[function(require,module,exports){module.exports=require(170)},{"../key.js":297}],312:[function(require,module,exports){module.exports=require(171)},{"../../name.js":300,"./policy-manager.js":313}],313:[function(require,module,exports){module.exports=require(172)},{}],314:[function(require,module,exports){module.exports=require(173)},{"../../data.js":273,"../../encoding/data-utils.js":278,"../../encoding/wire-format.js":289,"../../interest.js":295,"../../key-locator.js":296,"../../name.js":300,"../certificate/identity-certificate.js":303,"../security-exception.js":316,"./policy-manager.js":313,crypto:9}],315:[function(require,module,exports){module.exports=require(174)},{}],316:[function(require,module,exports){module.exports=require(175)},{}],317:[function(require,module,exports){module.exports=require(176)},{}],318:[function(require,module,exports){module.exports=require(177)},{"./encoding/binary-xml-decoder.js":274,"./encoding/binary-xml-encoder.js":275,"./key-locator.js":296,"./log.js":298,"./util/blob.js":325,"./util/ndn-protoco-id-tags.js":330,buffer:3}],319:[function(require,module,exports){module.exports=require(178)},{"../data.js":273,"../interest.js":295,"../name.js":300,"../util/blob.js":325,"../util/memory-content-cache.js":328,"./digest-tree.js":320,"./sync-state.js":321}],320:[function(require,module,exports){module.exports=require(179)},{"../encoding/data-utils.js":278,buffer:3,crypto:9}],321:[function(require,module,exports){module.exports=require(180)},{protobufjs:335}],322:[function(require,module,exports){module.exports=require(181)},{}],323:[function(require,module,exports){module.exports=require(182)},{"../encoding/element-reader.js":280,"../log.js":298,"./transport.js":322,buffer:3,net:1}],324:[function(require,module,exports){module.exports=require(183)},{"../encoding/element-reader.js":280,"../log.js":298,"./transport.js":322,buffer:3}],325:[function(require,module,exports){module.exports=require(184)},{buffer:3}],326:[function(require,module,exports){module.exports=require(185)},{"../encoding/tlv/tlv-encoder.js":286,"../encoding/wire-format.js":289,"./blob.js":325,crypto:9}],327:[function(require,module,exports){module.exports=require(186)},{buffer:3}],328:[function(require,module,exports){module.exports=require(187)},{"../name.js":300}],329:[function(require,module,exports){module.exports=require(188)},{"../encoding/binary-xml-decoder.js":274,"../encoding/data-utils.js":278,"../name.js":300,"./ndn-protoco-id-tags.js":330,buffer:3}],330:[function(require,module,exports){module.exports=require(189)},{}],331:[function(require,module,exports){module.exports=require(190)},{"../log.js":298}],332:[function(require,module,exports){module.exports=require(191)},{"./blob.js":325}],333:[function(require,module,exports){module.exports=require(192)},{}],334:[function(require,module,exports){module.exports=require(193)},{bytebuffer:336,fs:1,path:23}],335:[function(require,module,exports){module.exports=require(194)},{"./dist/ProtoBuf.js":334}],336:[function(require,module,exports){module.exports=require(195)},{"long":338}],337:[function(require,module,exports){module.exports=require(196)},{}],338:[function(require,module,exports){module.exports=require(197)},{"./dist/Long.js":337}],339:[function(require,module,exports){module.exports=require(133)},{"../log.js":347,"../util/ndn-protoco-id-tags.js":350,"../util/ndn-time.js":351,"./data-utils.js":341,"./decoding-exception.js":342,buffer:3}],340:[function(require,module,exports){module.exports=require(135)},{"../util/dynamic-buffer.js":349,"./binary-xml-decoder.js":339}],341:[function(require,module,exports){module.exports=require(137)},{buffer:3}],342:[function(require,module,exports){module.exports=require(138)},{}],343:[function(require,module,exports){module.exports=require(139)},{"../log.js":347,"./binary-xml-structure-decoder.js":340,"./data-utils.js":341,"./tlv/tlv-structure-decoder.js":345,"./tlv/tlv.js":346}],344:[function(require,module,exports){module.exports=require(144)},{"../decoding-exception.js":342}],345:[function(require,module,exports){module.exports=require(146)},{"./tlv-decoder.js":344,buffer:3}],346:[function(require,module,exports){module.exports=require(147)},{}],347:[function(require,module,exports){module.exports=require(157)},{}],348:[function(require,module,exports){module.exports=require(181)},{}],349:[function(require,module,exports){module.exports=require(186)},{buffer:3}],350:[function(require,module,exports){module.exports=require(189)},{}],351:[function(require,module,exports){module.exports=require(190)},{"../log.js":347}],352:[function(require,module,exports){(function(process){(function(global,undefined){"use strict";if(global.setImmediate){return}var nextHandle=1;var tasksByHandle={};var currentlyRunningATask=false;var doc=global.document;var setImmediate;function addFromSetImmediateArguments(args){tasksByHandle[nextHandle]=partiallyApplied.apply(undefined,args);return nextHandle++}function partiallyApplied(handler){var args=[].slice.call(arguments,1);return function(){if(typeof handler==="function"){handler.apply(undefined,args)}else{new Function(""+handler)()}}}function runIfPresent(handle){if(currentlyRunningATask){setTimeout(partiallyApplied(runIfPresent,handle),0)}else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=true;try{task()}finally{clearImmediate(handle);currentlyRunningATask=false}}}}function clearImmediate(handle){delete tasksByHandle[handle]}function installNextTickImplementation(){setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);process.nextTick(partiallyApplied(runIfPresent,handle));return handle}}function canUsePostMessage(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=true;var oldOnMessage=global.onmessage;global.onmessage=function(){postMessageIsAsynchronous=false};global.postMessage("","*");global.onmessage=oldOnMessage;return postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix="setImmediate$"+Math.random()+"$";var onGlobalMessage=function(event){if(event.source===global&&typeof event.data==="string"&&event.data.indexOf(messagePrefix)===0){runIfPresent(+event.data.slice(messagePrefix.length))}};if(global.addEventListener){global.addEventListener("message",onGlobalMessage,false)}else{global.attachEvent("onmessage",onGlobalMessage)}setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);global.postMessage(messagePrefix+handle,"*");return handle}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){var handle=event.data;runIfPresent(handle)};setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);channel.port2.postMessage(handle);return handle}}function installReadyStateChangeImplementation(){var html=doc.documentElement;setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);var script=doc.createElement("script");script.onreadystatechange=function(){runIfPresent(handle);script.onreadystatechange=null;html.removeChild(script);script=null};html.appendChild(script);return handle}}function installSetTimeoutImplementation(){setImmediate=function(){var handle=addFromSetImmediateArguments(arguments);setTimeout(partiallyApplied(runIfPresent,handle),0);return handle}}var attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global);attachTo=attachTo&&attachTo.setTimeout?attachTo:global;if({}.toString.call(global.process)==="[object process]"){installNextTickImplementation()}else if(canUsePostMessage()){installPostMessageImplementation()}else if(global.MessageChannel){installMessageChannelImplementation()}else if(doc&&"onreadystatechange"in doc.createElement("script")){installReadyStateChangeImplementation()}else{installSetTimeoutImplementation()}attachTo.setImmediate=setImmediate;attachTo.clearImmediate=clearImmediate})(new Function("return this")())}).call(this,require("_process"))},{_process:24}],353:[function(require,module,exports){var gremlin=require("ndn-gremlin");var dropkick=require("dropkick");var IO=require("ndn-io");require("setimmediate");exports.joinRoom=function(roomName,onFileAnnounce,onMessage,userList){window.onMessage=onMessage;window.io=new IO(new gremlin,{},function onReady(){io.gremlin.addConnection("ws://"+location.hostname,function(id){console.log("add connection calback",id);window.hostFace=id;window.sessionTime=Date.now();window.announcementName=new io.gremlin.ndn.Name(["!",roomName,"!",window.handle]);var announcement=new io.gremlin.ndn.Interest(announcementName.appendTimestamp(sessionTime));announcement.setInterestLifetimeMilliseconds(20);io.gremlin.addRegisteredPrefix(roomName,id).registerPrefix(roomName,id).registerPrefix("!/"+roomName,id).registerPrefix("@/"+handle,id).addRegisteredPrefix("@",id).addRegisteredPrefix("!/"+roomName,id).addRegisteredPrefix("#",id).addListener({prefix:"!/"+roomName,blocking:true},function(interest,faceID,unblock){console.log("listener triggered");var type=interest.name.get(2).value;if(type.length===1){if(type[0]===64){var chatMessageName=interest.name.getSubName(2);chatRoom.fetcher.setName(chatMessageName).setType("json").setInterestLifetimeMilliseconds(1e3).get(function(err,message){if(!err){onMessage(message)}})}else if(type[0]===35){var slug=interest.name.get(4).toEscapedString();var extension=interest.name.get(5).toEscapedString();onFileAnnounce(slug,extension);unblock()}else if(type[0]===33){console.log("new member");var memhandle=interest.name.get(3).toEscapedString();var timeStamp=interest.name.get(-1).toTimestamp();console.log("newmember",memhandle,timeStamp,sessionTime);if($("#"+memhandle).length===0){userList.append("<li id= '"+memhandle+"' data-username='"+memhandle+"'>"+memhandle+"</li>")}if(timeStamp>=sessionTime){io.gremlin.handleInterest(announcement.wireEncode().buffer,function(){},true);onMessage({handle:roomName,message:memhandle+" has joined the room",id:Date.now()})}}else if(type[0]===48){var memhandle=interest.name.get(3).toEscapedString();if($("#"+memhandle).length>0){$("#"+memhandle).remove();onMessage({handle:roomName,message:memhandle+" has left the room",id:Date.now()})}}}});io.gremlin.handleInterest(announcement.wireEncode().buffer,function(){});window.chatRoom=io.createNamespace("@/"+handle,function onChatPubliherReady(err,data){console.log(err,data);window.sequence=0;chatRoom.publisher.serve("@/"+handle+"/"+roomName)});window.filebox=io.createNamespace("#/"+roomName,function(){console.log("filebox ready");filebox.publisher.serve("#/"+roomName)})})})};exports.leaveRoom=function(){var announcementName=new io.gremlin.ndn.Name(["!",roomName,"0",handle]);var announcement=new io.gremlin.ndn.Interest(announcementName.append(filebox.publisher.name))};exports.shareFile=function(file){var extension=file.name.substr(file.name.indexOf(".")+1);var slug=file.name.substr(0,file.name.indexOf(".")).toLowerCase().replace(/-+/g,"").replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");var prefix=new io.gremlin.ndn.Name(["#",roomName,slug,extension]);filebox.publisher.setName(prefix).setToPublish(file).setFreshnessMilliseconds(60*60*1e3).publish(function(err,data){});var announcementName=new io.gremlin.ndn.Name(["!",roomName]);var announcement=new io.gremlin.ndn.Interest(announcementName.append(filebox.publisher.name));io.gremlin.registerPrefix(prefix,hostFace).handleInterest(announcement.wireEncode().buffer,function(){console.log("hey you, file announced")})};exports.getFile=function(slug,extension,callback){console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!filename",filebox.prefix.toUri());
filebox.fetcher.setType("file").setName("#/"+roomName+"/"+slug+"/"+extension).setInterestLifetimeMilliseconds(4e3).get(function(err,data){console.log("file fetch callback",err,data);callback(err,data)})};exports.chat=function(message){var name=new io.gremlin.ndn.Name(["@",handle,roomName]);console.log(name);var message={handle:window.handle,message:message,id:Date.now()};chatRoom.publisher.setName(name.appendSequenceNumber(sequence++)).setFreshnessMilliseconds(60*60*1e3).setToPublish(message).publish(function onDataServeable(firstDataSegment){console.log("heeeeeee");onMessage(message);var announcementName=new io.gremlin.ndn.Name(["!",roomName]);announcementName.append(name);console.log(announcementName.toUri());var announcementInterest=new io.gremlin.ndn.Interest(announcementName);io.gremlin.handleInterest(announcementInterest.wireEncode().buffer,function(){"excecuted chat",sequence-1},true)})};module.exports=exports},{dropkick:354,"ndn-gremlin":361,"ndn-io":46,setimmediate:516}],354:[function(require,module,exports){"use strict";var EventEmitter=require("events").EventEmitter;module.exports=function(target){var dropkick=new EventEmitter;var emitFile=dropkick.emit.bind(dropkick,"file");var emitUri=dropkick.emit.bind(dropkick,"uri");function handleDragEnter(evt){evt.stopPropagation();evt.preventDefault();return false}function handleDragOver(evt){evt.stopPropagation();evt.preventDefault();evt.dataTransfer.dropEffect="copy";return false}function handleDrop(evt){var transfer=evt&&evt.dataTransfer;var files=[].slice.call(transfer&&transfer.files||[]);var urls=[];var dataTypes=transfer?[].slice.call(transfer.types):[];evt.stopPropagation();evt.preventDefault();dataTypes.forEach(function(transferType){var data=transfer.getData(transferType);switch(transferType){case"text/x-moz-url":{urls.push(data)}case"text/uri-list":{urls.push(data)}}});files.forEach(emitFile);urls.forEach(emitUri)}function processItems(items){}target.addEventListener("dragenter",handleDragEnter);target.addEventListener("dragover",handleDragOver);target.addEventListener("drop",handleDrop);return dropkick}},{events:19}],355:[function(require,module,exports){module.exports=require(50)},{"./Manager.js":356,"./node/ConnectionListeners.js":357,"./node/addConnection.js":359,"./node/createSuffix.js":360,debug:362,"ndn-js-contrib":377,os:22}],356:[function(require,module,exports){module.exports=require(51)},{}],357:[function(require,module,exports){module.exports=require(52)},{"./adapter/adapter.js":358,debug:362}],358:[function(require,module,exports){module.exports=require(53)},{}],359:[function(require,module,exports){module.exports=require(54)},{}],360:[function(require,module,exports){module.exports=require(55)},{"./adapter/adapter.js":358,debug:362}],361:[function(require,module,exports){module.exports=require(56)},{"./dist/src/Forwarder.js":355}],362:[function(require,module,exports){module.exports=require(47)},{"./debug":363}],363:[function(require,module,exports){module.exports=require(48)},{ms:364}],364:[function(require,module,exports){module.exports=require(49)},{}],365:[function(require,module,exports){module.exports=require(60)},{buffer:3,debug:362,"lru-cache":422}],366:[function(require,module,exports){module.exports=require(61)},{"./../Utility/binarySearch.js":376,debug:362}],367:[function(require,module,exports){module.exports=require(62)},{debug:362,"ndn-js":432,"ndn-js/js/encoding/tlv/tlv-decoder.js":449,"ndn-js/js/encoding/tlv/tlv.js":452}],368:[function(require,module,exports){module.exports=require(63)},{"./../Utility/binarySearch.js":376,"./NameTreeNode.js":369}],369:[function(require,module,exports){module.exports=require(64)},{"./../Utility/binarySearch.js":376}],370:[function(require,module,exports){module.exports=require(65)},{"./../Utility/binarySearch.js":376,debug:362}],371:[function(require,module,exports){module.exports=require(66)},{_process:24,buffer:3,leveldown:378,levelup:398}],372:[function(require,module,exports){module.exports=require(67)},{}],373:[function(require,module,exports){module.exports=require(68)},{buffer:3,debug:362,"ndn-lib/js/encoding/element-reader.js":507,"ndn-lib/js/transport/transport.js":512}],374:[function(require,module,exports){module.exports=require(69)},{buffer:3,debug:362,"ndn-lib/js/encoding/element-reader.js":507,"ndn-lib/js/transport/transport.js":512}],375:[function(require,module,exports){module.exports=require(70)},{"./MessageChannel.js":373,"./WebRTCDataChannel.js":374,"ndn-js":432}],376:[function(require,module,exports){module.exports=require(71)},{}],377:[function(require,module,exports){module.exports=require(72)},{"./dist/src/DataStructures/ContentStore.js":365,"./dist/src/DataStructures/FIB.js":366,"./dist/src/DataStructures/Interfaces.js":367,"./dist/src/DataStructures/NameTree.js":368,"./dist/src/DataStructures/PIT.js":370,"./dist/src/DataStructures/Repository.js":371,"./dist/src/DataStructures/repoEntry.js":372,"./dist/src/Transports/node/export.js":375,buffer:3,"ndn-js":432}],378:[function(require,module,exports){module.exports=require(73)},{"./iterator":379,"abstract-leveldown":382,buffer:3,"idb-wrapper":384,isbuffer:385,"typedarray-to-buffer":387,util:39,xtend:389}],379:[function(require,module,exports){module.exports=require(74)},{"abstract-leveldown":382,ltgt:386,util:39}],380:[function(require,module,exports){module.exports=require(75)},{_process:24}],381:[function(require,module,exports){module.exports=require(76)},{_process:24}],382:[function(require,module,exports){module.exports=require(77)},{"./abstract-chained-batch":380,"./abstract-iterator":381,_process:24,buffer:3,xtend:383}],383:[function(require,module,exports){module.exports=require(78)},{}],384:[function(require,module,exports){module.exports=require(79)},{}],385:[function(require,module,exports){module.exports=require(80)},{buffer:3}],386:[function(require,module,exports){module.exports=require(81)},{buffer:3}],387:[function(require,module,exports){module.exports=require(82)},{buffer:3}],388:[function(require,module,exports){module.exports=require(83)},{}],389:[function(require,module,exports){module.exports=require(84)},{"./has-keys":388,"object-keys":391}],390:[function(require,module,exports){module.exports=require(85)},{}],391:[function(require,module,exports){module.exports=require(86)},{"./shim":393}],392:[function(require,module,exports){module.exports=require(87)},{}],393:[function(require,module,exports){module.exports=require(88)},{"./foreach":390,"./isArguments":392}],394:[function(require,module,exports){module.exports=require(89)},{"./errors":397,"./util":400}],395:[function(require,module,exports){module.exports=require(90)},{"./encodings":396}],396:[function(require,module,exports){module.exports=require(91)},{buffer:3}],397:[function(require,module,exports){module.exports=require(92)},{errno:408}],398:[function(require,module,exports){module.exports=require(93)},{"./batch":394,"./codec":395,"./errors":397,"./read-stream":399,"./util":400,"./write-stream":401,_process:24,"deferred-leveldown":403,events:19,prr:409,util:39,xtend:420}],399:[function(require,module,exports){module.exports=require(94)},{"./errors":397,"./util":400,"readable-stream":419,util:39,xtend:420}],400:[function(require,module,exports){module.exports=require(95)},{"../package.json":421,"./encodings":396,"./errors":397,leveldown:2,"leveldown/package":2,semver:2,xtend:420}],401:[function(require,module,exports){module.exports=require(96)},{"./util":400,_process:24,bl:402,stream:37,util:39,xtend:420}],402:[function(require,module,exports){module.exports=require(97)},{buffer:3,"readable-stream":419,util:39}],403:[function(require,module,exports){module.exports=require(98)},{_process:24,"abstract-leveldown":406,buffer:3,util:39}],404:[function(require,module,exports){module.exports=require(75)},{_process:24}],405:[function(require,module,exports){module.exports=require(76)},{_process:24}],406:[function(require,module,exports){module.exports=require(77)},{"./abstract-chained-batch":404,"./abstract-iterator":405,_process:24,buffer:3,xtend:420}],407:[function(require,module,exports){module.exports=require(102)},{prr:409}],408:[function(require,module,exports){module.exports=require(103)},{"./custom":407}],409:[function(require,module,exports){module.exports=require(104)},{}],410:[function(require,module,exports){module.exports=require(26)},{"./_stream_readable":412,"./_stream_writable":414,_process:24,"core-util-is":415,inherits:416}],411:[function(require,module,exports){module.exports=require(27)},{"./_stream_transform":413,"core-util-is":415,inherits:416}],412:[function(require,module,exports){module.exports=require(28)},{_process:24,buffer:3,"core-util-is":415,events:19,inherits:416,isarray:417,stream:37,"string_decoder/":418}],413:[function(require,module,exports){module.exports=require(29)},{"./_stream_duplex":410,"core-util-is":415,inherits:416}],414:[function(require,module,exports){module.exports=require(30)},{"./_stream_duplex":410,_process:24,buffer:3,"core-util-is":415,inherits:416,stream:37}],415:[function(require,module,exports){module.exports=require(31)},{buffer:3}],416:[function(require,module,exports){module.exports=require(20)},{}],417:[function(require,module,exports){module.exports=require(21)},{}],418:[function(require,module,exports){module.exports=require(32)},{buffer:3}],419:[function(require,module,exports){module.exports=require(114)},{"./lib/_stream_duplex.js":410,"./lib/_stream_passthrough.js":411,"./lib/_stream_readable.js":412,"./lib/_stream_transform.js":413,"./lib/_stream_writable.js":414,stream:37}],420:[function(require,module,exports){module.exports=require(78)},{}],421:[function(require,module,exports){module.exports=require(116)},{}],422:[function(require,module,exports){module.exports=require(117)},{}],423:[function(require,module,exports){module.exports=require(118)},{jsbn:497}],424:[function(require,module,exports){module.exports=require(119)},{}],425:[function(require,module,exports){module.exports=require(120)},{}],426:[function(require,module,exports){module.exports=require(121)},{"./sha256.js":431,jsbn:497}],427:[function(require,module,exports){module.exports=require(122)},{jsbn:497}],428:[function(require,module,exports){module.exports=require(123)},{"./rsa.js":427,jsbn:497}],429:[function(require,module,exports){module.exports=require(124)},{"./asn1hex-1.1.js":423,"./base64.js":424,"./rsa2.js":428}],430:[function(require,module,exports){module.exports=require(125)},{"./rsapem-1.1.js":429,jsbn:497}],431:[function(require,module,exports){module.exports=require(126)},{"./core.js":425}],432:[function(require,module,exports){module.exports=require(127)},{"./js/closure.js":435,"./js/data.js":437,"./js/encoding/binary-xml-wire-format.js":441,"./js/encoding/data-utils.js":442,"./js/encoding/encoding-utils.js":445,"./js/encoding/protobuf-tlv.js":446,"./js/encoding/tlv-wire-format.js":448,"./js/encoding/wire-format.js":453,"./js/exclude.js":454,"./js/face.js":456,"./js/forwarding-flags.js":458,"./js/interest.js":459,"./js/key-locator.js":460,"./js/key.js":461,"./js/meta-info.js":463,"./js/name.js":464,"./js/publisher-public-key-digest.js":466,"./js/security/identity/identity-manager.js":469,"./js/security/identity/identity-storage.js":470,"./js/security/identity/memory-identity-storage.js":471,"./js/security/identity/memory-private-key-storage.js":472,"./js/security/key-chain.js":474,"./js/security/key-manager.js":475,"./js/security/policy/no-verify-policy-manager.js":476,"./js/security/policy/policy-manager.js":477,"./js/security/policy/self-verify-policy-manager.js":478,"./js/security/policy/validation-request.js":479,"./js/security/security-exception.js":480,"./js/security/security-types.js":481,"./js/sha256-with-rsa-signature.js":482,"./js/sync/chrono-sync2013.js":483,"./js/transport/tcp-transport.js":433,"./js/transport/unix-transport.js":487,"./js/util/blob.js":489,"./js/util/memory-content-cache.js":492,"./js/util/name-enumeration.js":493,"./js/util/ndn-time.js":495}],433:[function(require,module,exports){module.exports=require(128)},{"./transport/web-socket-transport":488}],434:[function(require,module,exports){module.exports=require(129)},{"../contrib/securityLib/asn1hex-1.1.js":423,"../contrib/securityLib/base64.js":424,"../contrib/securityLib/crypto-1.0.js":426,"../contrib/securityLib/rsasign-1.2.js":430,"./key.js":461,buffer:3}],435:[function(require,module,exports){module.exports=require(130)},{}],436:[function(require,module,exports){module.exports=require(131)},{"./encoding/wire-format.js":453,"./forwarding-flags.js":458,"./name.js":464}],437:[function(require,module,exports){module.exports=require(132)},{"./crypto.js":434,"./encoding/binary-xml-encoder.js":439,"./encoding/binary-xml-wire-format.js":441,"./encoding/data-utils.js":442,"./encoding/wire-format.js":453,"./key-locator.js":460,"./meta-info.js":463,"./name.js":464,"./security/key-manager.js":475,"./sha256-with-rsa-signature.js":482,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494,"./util/signed-blob.js":496,buffer:3}],438:[function(require,module,exports){module.exports=require(133)},{"../log.js":462,"../util/ndn-protoco-id-tags.js":494,"../util/ndn-time.js":495,"./data-utils.js":442,"./decoding-exception.js":443,buffer:3}],439:[function(require,module,exports){module.exports=require(134)},{"../log.js":462,"../util/dynamic-buffer.js":491,"../util/ndn-protoco-id-tags.js":494,"./data-utils.js":442}],440:[function(require,module,exports){module.exports=require(135)},{"../util/dynamic-buffer.js":491,"./binary-xml-decoder.js":438}],441:[function(require,module,exports){module.exports=require(136)},{"../exclude.js":454,"../key-locator.js":460,"../meta-info.js":463,"../name.js":464,"../publisher-public-key-digest.js":466,"../sha256-with-rsa-signature.js":482,"../util/blob.js":489,"../util/ndn-protoco-id-tags.js":494,"./binary-xml-decoder.js":438,"./binary-xml-encoder.js":439,"./data-utils.js":442,"./wire-format.js":453}],442:[function(require,module,exports){module.exports=require(137)},{buffer:3}],443:[function(require,module,exports){module.exports=require(138)},{}],444:[function(require,module,exports){module.exports=require(139)},{"../log.js":462,"./binary-xml-structure-decoder.js":440,"./data-utils.js":442,"./tlv/tlv-structure-decoder.js":451,"./tlv/tlv.js":452}],445:[function(require,module,exports){module.exports=require(140)},{"../data.js":437,"../face-instance.js":455,"../forwarding-entry.js":457,"../interest.js":459,"../key-locator.js":460,"../key.js":461,"../log.js":462,"./binary-xml-decoder.js":438,"./binary-xml-encoder.js":439,"./data-utils.js":442,"./wire-format.js":453}],446:[function(require,module,exports){module.exports=require(141)},{"../util/blob.js":489,"./tlv/tlv-decoder.js":449,"./tlv/tlv-encoder.js":450,"protobufjs/dist/ProtoBuf.js":498}],447:[function(require,module,exports){module.exports=require(142)},{"../crypto.js":434,"../exclude.js":454,"../forwarding-flags.js":458,"../key-locator.js":460,"../meta-info.js":463,"../publisher-public-key-digest.js":466,"../sha256-with-rsa-signature.js":482,"../util/blob.js":489,"./decoding-exception.js":443,"./tlv/tlv-decoder.js":449,"./tlv/tlv-encoder.js":450,"./tlv/tlv.js":452,"./wire-format.js":453,buffer:3}],448:[function(require,module,exports){module.exports=require(143)},{"./tlv-0_1-wire-format.js":447,"./wire-format.js":453}],449:[function(require,module,exports){module.exports=require(144)},{"../decoding-exception.js":443}],450:[function(require,module,exports){module.exports=require(145)},{"../../util/dynamic-buffer.js":491,"./tlv.js":452}],451:[function(require,module,exports){module.exports=require(146)},{"./tlv-decoder.js":449,buffer:3}],452:[function(require,module,exports){module.exports=require(147)},{}],453:[function(require,module,exports){module.exports=require(148)},{"./tlv-wire-format.js":448}],454:[function(require,module,exports){module.exports=require(149)},{"./encoding/binary-xml-decoder.js":438,"./encoding/binary-xml-encoder.js":439,"./encoding/data-utils.js":442,"./name.js":464,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494}],455:[function(require,module,exports){module.exports=require(150)},{"./publisher-public-key-digest.js":466,"./util/ndn-protoco-id-tags.js":494}],456:[function(require,module,exports){module.exports=require(151)},{"./closure.js":435,"./control-parameters.js":436,"./data.js":437,"./encoding/binary-xml-decoder.js":438,"./encoding/binary-xml-encoder.js":439,"./encoding/binary-xml-wire-format.js":441,"./encoding/data-utils.js":442,"./encoding/tlv-wire-format.js":448,"./encoding/tlv/tlv-decoder.js":449,"./encoding/tlv/tlv.js":452,"./encoding/wire-format.js":453,"./forwarding-entry.js":457,"./forwarding-flags.js":458,"./interest.js":459,"./key-locator.js":460,"./key.js":461,"./log.js":462,"./meta-info.js":463,"./name.js":464,"./security/key-manager.js":475,"./transport/tcp-transport.js":433,"./transport/transport.js":486,"./transport/unix-transport.js":487,"./util/command-interest-generator.js":490,"./util/ndn-protoco-id-tags.js":494,buffer:3,crypto:9,fs:1}],457:[function(require,module,exports){module.exports=require(152)},{"./forwarding-flags.js":458,"./name.js":464,"./publisher-public-key-digest.js":466,"./util/ndn-protoco-id-tags.js":494}],458:[function(require,module,exports){module.exports=require(153)},{}],459:[function(require,module,exports){module.exports=require(154)},{"./encoding/binary-xml-wire-format.js":441,"./encoding/wire-format.js":453,"./exclude.js":454,"./key-locator.js":460,"./name.js":464,"./publisher-public-key-digest.js":466,"./util/blob.js":489,"./util/signed-blob.js":496,buffer:3}],460:[function(require,module,exports){module.exports=require(155)},{"./log.js":462,"./name.js":464,"./publisher-id.js":465,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494,buffer:3}],461:[function(require,module,exports){module.exports=require(156)},{"./encoding/data-utils.js":442,"./log.js":462,buffer:3,crypto:9}],462:[function(require,module,exports){module.exports=require(157)},{}],463:[function(require,module,exports){module.exports=require(158)},{"./encoding/binary-xml-decoder.js":438,"./encoding/binary-xml-encoder.js":439,"./key-locator.js":460,"./log.js":462,"./name.js":464,"./publisher-public-key-digest.js":466,"./security/key-manager.js":475,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494,"./util/ndn-time.js":495,buffer:3}],464:[function(require,module,exports){module.exports=require(159)},{"./encoding/binary-xml-decoder.js":438,"./encoding/binary-xml-encoder.js":439,"./encoding/data-utils.js":442,"./encoding/tlv/tlv-encoder.js":450,"./encoding/wire-format.js":453,"./log.js":462,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494,buffer:3}],465:[function(require,module,exports){module.exports=require(160)},{"./encoding/decoding-exception.js":443,"./util/ndn-protoco-id-tags.js":494}],466:[function(require,module,exports){module.exports=require(161)},{"./log.js":462,"./util/ndn-protoco-id-tags.js":494}],467:[function(require,module,exports){module.exports=require(162)},{}],468:[function(require,module,exports){module.exports=require(163)},{"../security-exception.js":480,"../security-types.js":481}],469:[function(require,module,exports){module.exports=require(164)},{"../../data.js":437,"../../encoding/wire-format.js":453,"../../key-locator.js":460,"../../name.js":464,"../../sha256-with-rsa-signature.js":482,"../security-exception.js":480,buffer:3}],470:[function(require,module,exports){module.exports=require(165)},{"../../name.js":464,"../security-exception.js":480}],471:[function(require,module,exports){module.exports=require(166)},{"../../data.js":437,"../../encoding/data-utils.js":442,"../../name.js":464,"../../util/blob.js":489,"../security-exception.js":480,"../security-types.js":481,"./identity-storage.js":470}],472:[function(require,module,exports){module.exports=require(167)},{"../../encoding/data-utils.js":442,"../../util/blob.js":489,"../certificate/public-key.js":468,"../security-exception.js":480,"../security-types.js":481,"./private-key-storage.js":473,buffer:3,crypto:9}],473:[function(require,module,exports){module.exports=require(168)},{}],474:[function(require,module,exports){module.exports=require(169)},{"../data.js":437,"../encoding/tlv/tlv-encoder.js":450,"../encoding/tlv/tlv.js":452,"../encoding/wire-format.js":453,"../interest.js":459,"../key-locator.js":460,"../name.js":464,"../sha256-with-rsa-signature.js":482,"./security-exception.js":480}],475:[function(require,module,exports){module.exports=require(170)},{"../key.js":461}],476:[function(require,module,exports){module.exports=require(171)},{"../../name.js":464,"./policy-manager.js":477}],477:[function(require,module,exports){module.exports=require(172)},{}],478:[function(require,module,exports){module.exports=require(173)},{"../../data.js":437,"../../encoding/data-utils.js":442,"../../encoding/wire-format.js":453,"../../interest.js":459,"../../key-locator.js":460,"../../name.js":464,"../certificate/identity-certificate.js":467,"../security-exception.js":480,"./policy-manager.js":477,crypto:9}],479:[function(require,module,exports){module.exports=require(174)},{}],480:[function(require,module,exports){module.exports=require(175)},{}],481:[function(require,module,exports){module.exports=require(176)},{}],482:[function(require,module,exports){module.exports=require(177)},{"./encoding/binary-xml-decoder.js":438,"./encoding/binary-xml-encoder.js":439,"./key-locator.js":460,"./log.js":462,"./util/blob.js":489,"./util/ndn-protoco-id-tags.js":494,buffer:3}],483:[function(require,module,exports){module.exports=require(178)},{"../data.js":437,"../interest.js":459,"../name.js":464,"../util/blob.js":489,"../util/memory-content-cache.js":492,"./digest-tree.js":484,"./sync-state.js":485}],484:[function(require,module,exports){module.exports=require(179)},{"../encoding/data-utils.js":442,buffer:3,crypto:9}],485:[function(require,module,exports){module.exports=require(180)},{protobufjs:499}],486:[function(require,module,exports){module.exports=require(181)},{}],487:[function(require,module,exports){module.exports=require(182)},{"../encoding/element-reader.js":444,"../log.js":462,"./transport.js":486,buffer:3,net:1}],488:[function(require,module,exports){module.exports=require(183)},{"../encoding/element-reader.js":444,"../log.js":462,"./transport.js":486,buffer:3}],489:[function(require,module,exports){module.exports=require(184)},{buffer:3}],490:[function(require,module,exports){module.exports=require(185)},{"../encoding/tlv/tlv-encoder.js":450,"../encoding/wire-format.js":453,"./blob.js":489,crypto:9}],491:[function(require,module,exports){module.exports=require(186)},{buffer:3}],492:[function(require,module,exports){module.exports=require(187)},{"../name.js":464}],493:[function(require,module,exports){module.exports=require(188)},{"../encoding/binary-xml-decoder.js":438,"../encoding/data-utils.js":442,"../name.js":464,"./ndn-protoco-id-tags.js":494,buffer:3}],494:[function(require,module,exports){module.exports=require(189)},{}],495:[function(require,module,exports){module.exports=require(190)},{"../log.js":462}],496:[function(require,module,exports){module.exports=require(191)},{"./blob.js":489}],497:[function(require,module,exports){module.exports=require(192)},{}],498:[function(require,module,exports){module.exports=require(193)},{bytebuffer:500,fs:1,path:23}],499:[function(require,module,exports){module.exports=require(194)},{"./dist/ProtoBuf.js":498}],500:[function(require,module,exports){module.exports=require(195)},{"long":502}],501:[function(require,module,exports){module.exports=require(196)},{}],502:[function(require,module,exports){module.exports=require(197)},{"./dist/Long.js":501}],503:[function(require,module,exports){module.exports=require(133)},{"../log.js":511,"../util/ndn-protoco-id-tags.js":514,"../util/ndn-time.js":515,"./data-utils.js":505,"./decoding-exception.js":506,buffer:3}],504:[function(require,module,exports){module.exports=require(135)},{"../util/dynamic-buffer.js":513,"./binary-xml-decoder.js":503}],505:[function(require,module,exports){module.exports=require(137)},{buffer:3}],506:[function(require,module,exports){module.exports=require(138)},{}],507:[function(require,module,exports){module.exports=require(139)},{"../log.js":511,"./binary-xml-structure-decoder.js":504,"./data-utils.js":505,"./tlv/tlv-structure-decoder.js":509,"./tlv/tlv.js":510}],508:[function(require,module,exports){module.exports=require(144)},{"../decoding-exception.js":506}],509:[function(require,module,exports){module.exports=require(146)},{"./tlv-decoder.js":508,buffer:3}],510:[function(require,module,exports){module.exports=require(147)},{}],511:[function(require,module,exports){module.exports=require(157)},{}],512:[function(require,module,exports){module.exports=require(181)},{}],513:[function(require,module,exports){module.exports=require(186)},{buffer:3}],514:[function(require,module,exports){module.exports=require(189)},{}],515:[function(require,module,exports){module.exports=require(190)},{"../log.js":511}],516:[function(require,module,exports){module.exports=require(352)},{_process:24}]},{},[40]);